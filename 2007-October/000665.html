<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Freenx-cvs] r405 - in freenx-server/tags: . FreeNX-0.7.1	FreeNX-0.7.1/nxserver-helper
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/freenx-cvs/2007-October/index.html" >
   <LINK REL="made" HREF="mailto:freenx-cvs%40lists.berlios.de?Subject=Re%3A%20%5BFreenx-cvs%5D%20r405%20-%20in%20freenx-server/tags%3A%20.%20FreeNX-0.7.1%0A%09FreeNX-0.7.1/nxserver-helper&In-Reply-To=%3C200710142225.l9EMPFEm001476%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000533.html">
   <LINK REL="Next"  HREF="000534.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Freenx-cvs] r405 - in freenx-server/tags: . FreeNX-0.7.1	FreeNX-0.7.1/nxserver-helper</H1>
    <B>fabianx at BerliOS</B> 
    <A HREF="mailto:freenx-cvs%40lists.berlios.de?Subject=Re%3A%20%5BFreenx-cvs%5D%20r405%20-%20in%20freenx-server/tags%3A%20.%20FreeNX-0.7.1%0A%09FreeNX-0.7.1/nxserver-helper&In-Reply-To=%3C200710142225.l9EMPFEm001476%40sheep.berlios.de%3E"
       TITLE="[Freenx-cvs] r405 - in freenx-server/tags: . FreeNX-0.7.1	FreeNX-0.7.1/nxserver-helper">fabianx at mail.berlios.de
       </A><BR>
    <I>Mon Oct 15 00:25:58 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000533.html">[Freenx-cvs] r404 - freenx-server/trunk
</A></li>
        <LI>Next message: <A HREF="000534.html">[Freenx-cvs] r406 - freenx-website
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#665">[ date ]</a>
              <a href="thread.html#665">[ thread ]</a>
              <a href="subject.html#665">[ subject ]</a>
              <a href="author.html#665">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: fabianx
Date: 2007-10-15 00:25:14 +0200 (Mon, 15 Oct 2007)
New Revision: 405

Added:
   freenx-server/tags/FreeNX-0.7.1/
   freenx-server/tags/FreeNX-0.7.1/ChangeLog
   freenx-server/tags/FreeNX-0.7.1/node.conf.sample
   freenx-server/tags/FreeNX-0.7.1/nxdesktop_helper
   freenx-server/tags/FreeNX-0.7.1/nxdialog
   freenx-server/tags/FreeNX-0.7.1/nxkeygen
   freenx-server/tags/FreeNX-0.7.1/nxloadconfig
   freenx-server/tags/FreeNX-0.7.1/nxnode
   freenx-server/tags/FreeNX-0.7.1/nxprint
   freenx-server/tags/FreeNX-0.7.1/nxserver
   freenx-server/tags/FreeNX-0.7.1/nxserver-helper/nxserver-helper.c
   freenx-server/tags/FreeNX-0.7.1/nxsetup
   freenx-server/tags/FreeNX-0.7.1/nxviewer_helper
Removed:
   freenx-server/tags/FreeNX-0.7.1/ChangeLog
   freenx-server/tags/FreeNX-0.7.1/node.conf.sample
   freenx-server/tags/FreeNX-0.7.1/nxclient
   freenx-server/tags/FreeNX-0.7.1/nxkeygen
   freenx-server/tags/FreeNX-0.7.1/nxloadconfig
   freenx-server/tags/FreeNX-0.7.1/nxnode
   freenx-server/tags/FreeNX-0.7.1/nxprint
   freenx-server/tags/FreeNX-0.7.1/nxserver
   freenx-server/tags/FreeNX-0.7.1/nxserver-helper/nxserver-helper.c
   freenx-server/tags/FreeNX-0.7.1/nxsetup
Log:
Release of FreeNX-0.7.1 &quot;Hip Hop Edition&quot;.



Copied: freenx-server/tags/FreeNX-0.7.1 (from rev 334, freenx-server/trunk)

Deleted: freenx-server/tags/FreeNX-0.7.1/ChangeLog
===================================================================
--- freenx-server/trunk/ChangeLog	2007-05-29 15:27:07 UTC (rev 334)
+++ freenx-server/tags/FreeNX-0.7.1/ChangeLog	2007-10-14 22:25:14 UTC (rev 405)
@@ -1,366 +0,0 @@
-xx.xx.2007 FreeNX 0.6.1
-	* Fixed the printing support for CUPS 1.2.
-	  Older versions of CUPS are no longer supported.
-	  * Note: You must do as root:
-
-	          cp /usr/lib/cups/backend/ipp /usr/lib/cups/backend/nxipp
-		  chmod 755 /usr/lib/cups/backend/nxipp
-
-		  Or alternatively re-run nxsetup.
-
-	* Added foomatic support.
-	  * Note: You might need to do: ln -s /usr/bin/foomatic-ppdfile
-	          /usr/lib/cups/driver/
-	* Added setting of CUPS_SERVER environment var.
-	* Added automatic downloading of PPDs, if the client supports it.
-	* Added configuration vars to tweak the new behaviour.
-	* Added cups seamless support with no &quot;use this driver?&quot; dialogs at all.
-	  * Note: You need nxcupsd-wrapper on the client side for CUPS 1.2
-	          clients.
-
-	          Get it from nxutils repository.
-
-	* Fixed Support for &quot;Running&quot; sessions - again.
-	* Made the NXAgent exited with exit code 1 message more verbose.
-	* Added support for nxipp to nxnode and nxsetup.
-	* Added nxcups-gethost script for automatic usage in KDE.
-	* Fixed RDP/VNC sessions. No application should be started for that type. 
-	  (Patch by Bernard Cafarelli &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">voyageur at operamail.com</A>&gt;)
-	* Added backingstore fix for older clients from Gentoo.
-	  (<A HREF="http://bugs.gentoo.org/show_bug.cgi?id=149298">http://bugs.gentoo.org/show_bug.cgi?id=149298</A>)
-	* Fixed VNC sessions.
-	* Fixed fullscreen sessions.
-	  (Patch by Gentoo Bugtracker)
-	* Fixed --broadcast.
-	* Added &quot;passwd -u nx&quot; to nxsetup to fix slackware.
-	* Fixed respecting of enconding settings in case of rootless mode.
-	* Fixed smb mounting in case nxclient sends the wrong port. 
-	  (Patch by Jan Lockenvitz &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">jan.lockenvitz.ext at siemens.com</A>&gt;)
-	* Fixed loadbalancing - was still using an undocumented variable.
-
-23.01.2007 FreeNX 0.6.0 &quot;Juliana birthday edition&quot;
-	* Opened the 0.6.0 branch.
-	* Added nxnode slave mode.
-	* General code cleanup.
-		* Huge cleanup of nxnode.
-	* Removed &quot;no-x11-forwarding&quot; from keys to allow client to use the
-	  faster interactive sessions.
-	* Fixed nxsetup automatic testing of sessions and cleared up
-	  explanations.
-	* Added support for NX 2.0.0 style nxclient dialogs.
-	* Support for NX 2.0.0 backend in nxloadconfig.
-	* Fixed cups printing (added username and password).
-	* Fixed one more stray tail process.
-	* Added example script for &quot;load&quot; based loadbalancing.
-	* Fixed spaces in parameters for NX Client 2.0.0.
-	  (<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">ssycplkbocve at spammotel.com</A>)
-	* Added version 2.1.0 support.
-	* Fixed LD_LIBRARY_PRELOAD default path in nxloadconfig.
-	* Fixed nxclient to work with 2.1.0 backend.
-	* Added autodetection of backend.
-
-01.07.2006 FreeNX 0.5.0 &quot;UKUUG 2006 Edition&quot;
-	* Opened the 0.5.0 branch.
-	* Added load balancing.
-	* Completely removed support for 1.4.0 backend.
-	* Rootless mode is now the default.
-	* Reworked nxnode / suspend on connection failure should work now.
-	* Added support for &quot;Running&quot; sessions.
-	* Fixed --send command. (Emmanuel Blindauer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">freenx at mooby.net</A>&gt;)
-	* Fixed resume with nxclient &gt;=1.5.0-106 for Windows.
-	* Fixed rootless sessions with Windows nxclient.
-	* Fixed keyboard issues by enabling the keybd channel.
-	* Fixed one more stray tail process and being able to
-	  cleanup after a hopelessly failed reconnection. (i.e. agent died)
-	* Fixed detection of xauth / netcat. Added option to disable extra
-	  checks.
-	* Fixed --terminate / --suspend when hostname has a '-' in it.
-	  (Emmanuel Blindauer &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">freenx at mooby.net</A>&gt;)
-	* ESD_NO_SPAWN is always set when ESPEAKER is set.
-	  (&quot;Felipe Alfaro Solana&quot; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">felipe.alfaro at gmail.com</A>&gt;)
-	* Added perl replacement for 'rev' function on Sun OS 5.10.
-	* Fixed NODE_AUTOSTART to be unable to block sessions.
-	* Fixed stale sessions introduced by the new session handling model.
-	* Added usage of TCP NODELAY option.
-	* Fixed loadbalancing IP issues.
-	* Added --force-terminate to remove session info.
-	  Fixed issue with suspend/terminate commands.
-	* Added correct errorcode 596 instead of 504.
-	* Implemented &quot;round-robin&quot; and &quot;load&quot; loadbalancing algorithms.
-	  Cleaned up node.conf keys.
-	* Fixed help for --restart.
-	* Fixed session_running function, which fixes all remaining stale
-	  session problems.
-	* Removed termination of nxagent in case of rootless mode.
-	  (Fixes kontact without --nofork)
-	* Last minute fixes for new functions using rev.
-	* Added experimental last minute support for NX 2.0.0 backend.
-	  (set ENABLE_2_0_0_BACKEND=1)
-
-XX.XX.2006 FreeNX 0.4.5 &quot;aKademy Edition&quot;
-	* Made nxsetup more user-friendly and hopefully finally failsafe.
-	* Added --agent to nxnode/nxserver to allow easier debugging.
-	* Added addgroup/groupadd to nxsetup
-	* Added --ignore-errors support on nxsetup/nxloadconfig
-	* Added check for expect.
-
-06.08.2005 FreeNX 0.4.4 &quot;UKUUG Enterprise Edition&quot;
-	* Added ENABLE_1_5_0_BACKEND configuration directive:
-		* Fixed fullscreen support in nxdesktop (still feels more like
-		  'Available Area', but with Ctrl-Alt-F you can get &quot;real&quot;
-		  fullscreen)
-	* Added COMMAND_MD5SUM directive
-	* Security: $USER_FAKE_HOME/.nx now gets 0700
-	* Fixed support for CUPS forwarding.
-	* Added secure re-transmitting to client.
-	* Removed grep from getent to not search through the whole database.
-	  (Suggestion by &quot;Matthew S. Harris&quot; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">mharris at google.com</A>&gt;,
-	                 &quot;Ed Warnicke&quot;       &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">eaw at cisco.com</A>&gt;)
-	* Set sleeps to 60 instead of 10 seconds, removed one wrong trap.
-	  (Suggestion by &quot;Sunil&quot; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">funtoos at yahoo.com</A>&gt;)
-	* Made automatic timeout configurable.
-	  (Patch by &quot;Ed Warnicke&quot; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">eaw at cisco.com</A>&gt;)
-	* Made nxsetup more enterprise friendly. Added --localuser
-	  (RedHat only) and --gid. 
-	  (Based on a patch by &quot;Ed Warnicke&quot; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">eaw at cisco.com</A>&gt;)
-	* Fixed resume of multiple sessions.	
-
-28.07.2005 FreeNX 0.4.3 &quot;NoMachine 1.5.0 Edition&quot;
-	* Fixed reconnection problems with !M 1.5.0 client.
-	* Fixed reconnection problems with !M 1.5.0 backend.
-	* Added evaluation of $NX_ETC_DIR/node.conf.d/* config files.
-	* Fixed a possible security problem. (The client was able
-	  to overwrite parameters set by the server)
-	* Added ENABLE_1_5_0_BACKEND configuration directive:
-		* Added support for fake cookie authentication with
-		  !M 1.5.0 client and 1.5.0 backend.
-		* Fixed nxagent termination problems with !M 1.5.0
-		  backend.
-		* Added RDP highcolor support for !M 1.5.0 client
-		  with !M 1.5.0 backend.
-	* Added secure logging - Passwords are no longer shown in log files.
-	* Security: Certain passwords for VNC/RDP could have been visible via 
-	  `ps aux`.
-	* Added experimental usermode authentication scheme.
-	  (Disabled by default)
-
-16.07.2005 FreeNX 0.4.2 &quot;Solaris / Bugfix / Linux Infotag Pforzheim Edition&quot;
-	* Removed forwarding support via &quot;freenx.&lt;user&gt;&quot;, because it was
-	  buggy.
-	* Cleaned up lots of code.
-		* Fixed one case of a left over file.
-		* Removed one unnecessary usage of a temporary file.
-	* Added exit handlers in nxserver and nxnode for more stability on 
-	  reboot of system.
-	* Changed nxnode to be much more stable.
-		* Catched one additional &quot;unclean termination of nxagent&quot; 
-		  case, which lead to &quot;zombie&quot; sessions.
-	* Reworked reconnection support for more stability.
-		* Added displaying of reconnection failure in
-		  system log / client ssh log.
-	* Added even more possibilities to catch and report session startup 
-	  failures.
-	* Fixed PNG and JPEG-levels pack method.
-	* Added usage of netcat -z to check that the port is really not used by
-	  another agent.
-	* Added nxserver --cleanup, which terminates all running sessions.
-	  Useful after a power outage.
-	* Fixed nxclient invocation with non-standard installation path
-	* Added detection of SSH2_CLIENT variable (commercial ssh)
-	* Finally fixed problems with GNOME.
-	* FINALLY added Solaris Support Patch.
-
-24.06.2005 FreeNX 0.4.1 &quot;LinuxTag Edition&quot;
-	* Fixed a small security problem giving access to session database.
-	* Added support for 1.5.0 OSS components. (especially rootless mode)
-	* Fixed Filesharing over the Internet. (Thanks to <A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">rogierm at users.berlios.de</A>)
-	* Fixed Resume on Windows with non-fullscreen sessions.
-	* Added suspend/resume support for 1.5.0 OSS components.
-	* Fixed display of suspended sessions in nxserver --list.
-
-04.05.2005 FreeNX 0.4.0 &quot;SambaXP Edition&quot;
-	* Opened the 0.4.0 branch.
-	* Added initial support for filesharing via samba.
-	* Improvements to be more node.conf compatible.
-	* Added COMMAND_NETCAT, COMMAND_SSH &amp; COMMAND_SSH_KEYGEN directive
-	* Added support for 'nxloadconfig --check' to validate node.conf 
-	  settings
-	* Added initial support for sound (esd/artsd).
-	* Added optional support for utmp/wtmp/lastlog database.
-	* Removed support for OSS components prior version 1.4.0 in nxnode.
-	  Added -option option to nxagent/nxdesktop/nxviewer.
-	* Added forwarding to commercial server via destination port.
-	* Added more compatible getparam function
-	* Sets LD_PRELOAD for applications and LD_LIBRARY_PATH for 
-	  nxagent/nxproxy by default.
-		- SET_LD_LIBRARY_PATH replaces NX_NOMACHINE_WAY and is 
-		  enabled by default, as it is now safe to do so
-	* Implemented SSHD_CHECK_IP directive.
-	* Added the SESSION_HISTORY directive. Session history will by default 
-	  be kept for 30 days.
-	* Implemented DEFAULT_X_WM for unix-application virtual desktop mode.
-	* Implemented SESSION_LIMIT and SESSION_USER_LIMIT.
-	* Fixed nxviewer commandline for geometry and fullscreen-support
-	* Added NX_LOG_LEVEL instead of NX_LOGGING, allowing less verbose 
-	  logfile.
-	* Added SESSION_LOG_CLEAN for configurable removal of the temporary 
-	  session directory.
-	* Added &quot;--ssh2&quot; cmdline switch for commercial ssh2-server support 
-	  in nxsetup.
-	* Added ENABLE_FORCE_ENCRYPTION to enforce the usage of encryption on 
-	  the server.
-	* Added nxprint and added -printer to nxclient together with handling
-	  of drivers cache.
-	* Fixed a possible race-condition. (reported by Edward Warnicke
-	  &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">eaw at cisco.com</A>&gt;)
-	* Feature Request #847 (stderror of some applications to log-file)
-	* Feature Request #900 (Detect ssh/sshd in nxsetup)
-	* Added printing support via userspace CUPSd and Samba.
-
-20.03.2005 FreeNX 0.3.1 &quot;Bugfix Edition&quot;
-	* Fixed keyboard mapping problems.
-	* Fixed unix-custom mode; now allowing parameters to be passed.
-	* Fixed password prompt detection support in nxnode-login.
-	* Fixed locking to prevent usage of the same display.
-	* Fixed resume when agent is no longer there.
-	* Fixed error message shown to user, when session startup fails.
-	* Fixed handling of /tmp/.X*-lock files.
-	* Fixed handling of not closed sessions in &quot;Terminating&quot; status.
-	* Fixed resume of multiple suspended sessions.
-
-05.03.2005 FreeNX 0.3.0 &quot;Chemnitzer LinuxTage Edition&quot;
-	* Initial CVS checkin.
-	* Added unix-default as session type - by Kalev Lember 
-	  &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">kalev at smartlink.ee</A>&gt;
-	* Fixed nxclient loop - by &quot;Neil Wilson&quot; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">neil at aldur.co.uk</A>&gt;.
-	* Several fixes by Thorsten Sandfuchs &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">fux at users.berlios.de</A>&gt;.
-	* Optional config file support (system- and user-wide)
-		- by Jon Severinsson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">jonno at users.berlios.de</A>&gt;.
-	* Moved logfile to /var/log/nxserver.log.
-	* Moved nx homedir to /var/lib/nxserver/home
-	* Complete rewrite of authentication code
-		* passdb, su or ssh is now supported.
-		- by Jon Severinsson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">jonno at users.berlios.de</A>&gt;.
-	* Added NODE_AUTOSTART, EXPORT_{USERIP/SESSIONID} config file
-	  directives.
-	* Added mechanism to forward connection to commercial NoMachine 
-	  nxserver (as available from www.nomachine.com).
-	* Added mechanism to forward connection to another nxserver. This
-	  allows using a &quot;chain&quot; of nxservers.
-	* Added &quot;floating window&quot; support by using rootless nxagent as
-	  it will be standard in NX 1.5.0.
-	* Added &quot;floating window&quot; support by just nxproxy/nxproxy connection
-	  and added configuration directive to enable rootless mode.
-	* Added nxsetup --uninstall and added more feature to nxsetup.
-	  Note: You need to use nxsetup --install for installation now.
-	* Added Disabling of port-forwarding, X11-forwarding, ... to ssh-key.
-
-	* Security: Fixed a security blunder. Authority file was not used 
-	            and so basically xhost +localhost was set. (ported from
-		    0.2.8)
-		    
-		    Update immediately.
-                   
-	* Security: Fixed two possible security problems (umask was not set
-                   correctly; ported from 0.2.8)
-
-20.11.2004 FreeNX 0.2.7 &quot;Skolelinux Edition&quot;
-	* Fix nxserver to work again with KNX-Client. ('\r' is evil)
-	* Fix timeout in nxnode-login to allow proper session management
-	  again.
-	* Fixed possible race condition for the wait-file.
-
-11.11.2004 FreeNX 0.2.6
-	
-	* Security: Fixed a possible exploit in ssh-usage
-	    (thanx to Sebastian Krahmer from the SuSE security team)
-	* Important: Public/Private key is no longer used for PAM auth mode.
-	
-14.10.2004 FreeNX 0.2.5
-	* Added Xdialog interface for nxclient and automatic usage
-	  of commercial nxclient when available. (Thx go to Rick Stout 
-	  &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">zipsonic at gmail.com</A>&gt;)
-	* Added bugfix from the 0.3.0 branch for more flexible nxdesktop in
-	  nxnode.
-	* Added patch by Rick Stout for permission problems in nxnode.
-	* Added patch by Rick Stout for a typo in nxkeygen.
-	* Updated gentoo-nomachine.diff.
-	* Updated CONTRIB to include a description of lazy-image encoding.
-
-11.09.2004 FreeNX 0.2.4
-	* Added timeout to avoid having hanging tail processes.
-	* Added &quot;locking&quot; of the display-offset if nxagent failed to start.
-	* Fixed ssh encryption for resume on client 1.4.0-snapshot 5.
-	* Fixed mktemp, which was non-portable to FreeBSD and Red Hat 9.
-
-10.09.2004 FreeNX 0.2-3
-	* Added support for autoreconnection or autoreconnection just 
-	  for the case when an older client version is used.
-	  	* This makes it possible to use Reconnection with the 
-	  	  stable version 1.3.2-7 (enabled by default)
-	* Added instructions how to install the NoMachine sources to INSTALL
-	* Changed $NX_DIR/bin/ssh to ssh to fix gentoo-nomachine.diff
-	* Added nxkeygen by Stuart Herbert for easier change from the 
-	  NoMachine key to another key afterwards.
-	
-	* Security: Any user was able to change the status of other sessions
-	            in the session database by providing the correct uniqueid.
-
-10.09.2004 FreeNX 0.2-2
-	* Added additional support for safe session suspend, 
-	  autosuspend when network connection times out works now!
-	* AuthorizedKeysFile cannot be safely determined on Gentoo;
-	  changed it to config option now.
-	* Added config option to completely disable passdb support.
-	* Fixed bugs in nxclient dialog frontend.
-	* Removed all usage of nxssh due to security concerns from SuSE. 
-	* Fixed session management for knx client.
-	* Added detection of failed nxagent startup.
-	* Updated the gentoo-nomachine.diff to be not fuzzy.
-
-08.09.2004 FreeNX 0.2-1
-	* Fixed support for one windows client version. 
-	* Fixed setting of key with --adduser.
-	  (Thanks to Stuart Herbert &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">stuart at gentoo.org</A>&gt;)
-	* Fixed _some_ cases for AuthorizedKeysFile in sshd_config.
-	  (Thanks to Peter Holik &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">peter at holik.at</A>&gt;)
-
-	* Fixed gentoo-nomachine.diff (nxnode not in path, but nxnode-login would try that)
-	* Fixed the bug with hanging tail processes.
-
-07.09.2004 FreeNX 0.2-0
-	* Reworked the whole security model in nxsetup due to requests from SuSE and Gentoo.
-		- nxsetup does not use the NoMachine key by default. 
-		- PAM authentication is enabled by default.
-	
-	* Added nxclient for compatibility with nxclient -dialog mode.
-	
-	* Minor changes
-		* Added SSHD_AUTH_PORT to config vars in nxserver
-		* Made all programs NX_ aware
-		* Programs do now honor the setting of AuthorizedKeysFile in sshd_config
-		* Changed nxsetup check from direct reading of passwd to getent
-		  (Thanks to Tom Hibbert &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">tom at nsp.co.nz</A>&gt;)
-		* Changed overall messages in nxsetup
-	
-	* Made a overall clean upstream package.
-	* Added Gentoo / NoMachine compatibility diff
-
-06.09.2004 
-	* Added pam authentication
-	* Added user_db switch
-	* moved some su - to nxnode-login
-
-02.09.2004 
-	* Added support for snapshot 4 (43/66)
-	* Fixed compatibility issue with 1.3.0 
-	  (Used by Knoppix 3.4 and earlier)
-	* added sane logging (LOGGING is now properly used)
-
-20.06.2004 
-	* Added Protocol version 1.4.0
-	* Cleanup
-	* Added missing functions
-
-14.06.2004 
-	* Added Protocol version 1.3.2

Copied: freenx-server/tags/FreeNX-0.7.1/ChangeLog (from rev 404, freenx-server/trunk/ChangeLog)

Deleted: freenx-server/tags/FreeNX-0.7.1/node.conf.sample
===================================================================
--- freenx-server/trunk/node.conf.sample	2007-05-29 15:27:07 UTC (rev 334)
+++ freenx-server/tags/FreeNX-0.7.1/node.conf.sample	2007-10-14 22:25:14 UTC (rev 405)
@@ -1,431 +0,0 @@
-# node.conf
-#
-# This file is provided by FreeNX. It should be placed either into
-# /etc/nxserver/node.conf (FreeNX style) or /usr/NX/etc/node.conf
-# (NoMachine NX style).
-#
-# It is mostly compatible with NoMachine node.conf. The most important 
-# difference is that no spaces are allowed when assigning values (eg 
-# &quot;A=value&quot; is allowed, &quot;A = value&quot; is NOT).
-#
-# This file is sourced by bash, so you can do some fancy stuff here if you
-# want to, but be aware that it is sourced 3 times per connection. If you 
-# want autostart stuff, set NODE_AUTOSTART instead!
-# 
-#
-# You surely are aware that FreeNX is based on the fantastic results that
-# the hard work by NoMachine.com has achieved. NoMachine.com released the
-# core NX libraries under the GPL. The installation of these libs are the
-# precondition for all FreeNX scripts to work. If you are installing this
-# software with the help of one of the package management tools of your
-# Linux distribution, you can assume that this dependency is taken care of
-# by the tool.
-#
-# You have questions about the inner workings of the NX technology?
-#
-# Then you are recommended to first check out the rich and very detailed
-# NoMachine documentation and their online Knowledge Base at 
-#
-#           <A HREF="http://www.nomachine.com/kb/">http://www.nomachine.com/kb/</A>
-#
-# Other sources of information are the NoMachine mailing lists 
-# (<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">nxusers at nomachine.com</A> and <A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">nxdevelopers at nomachine.com</A>):
-#
-#           <A HREF="http://www.nomachine.com/mailinglists.php">http://www.nomachine.com/mailinglists.php</A>
-#
-# The FreeNX (<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">freenx-knx at kde.org</A>) list is here:
-#
-#           <A HREF="https://mail.kde.org/mailman/listinfo/freenx-knx">https://mail.kde.org/mailman/listinfo/freenx-knx</A>
-#
-# SVN: $Id$
-
-#########################################################################
-# General FreeNX directives
-#########################################################################
-
-# The host name which is used by NX server. It's should be used if it's
-# different than the default hostname (as returned by `hostname`)
-#SERVER_NAME=&quot;$(hostname)&quot;
-
-# The port number where local 'sshd' is listening.
-#SSHD_PORT=22
-
-
-#########################################################################
-# Authentication / Security directives
-#########################################################################
-
-# Authentication directives
-
-# This adds the usermode to the possible authentication methods
-# Usermode means that a user can start the nxserver as his shell
-# and connect directly to the right server via a custom client.
-#ENABLE_USERMODE_AUTHENTICATION=&quot;0&quot;
-
-# This adds the passdb to the possible authentication methods
-#ENABLE_PASSDB_AUTHENTICATION=&quot;1&quot;
-
-# This adds SSH to the possible authentication methods. For it to work sshd
-# must be set up at localhost accepting password authentication.
-#ENABLE_SSH_AUTHENTICATION=&quot;1&quot;
-
-# This adds SU to the possible authentication methods. For it to work the 
-# &quot;nx&quot; user must be in the wheel (RedHat, Fedora) or the users group (SUSE)
-# and the user logging in must have a valid shell that accepts the -c
-# parameter.
-#ENABLE_SU_AUTHENTICATION=&quot;0&quot;
-
-# Require all users to be in the passdb, regardless of authentication method
-#ENABLE_USER_DB=&quot;0&quot;
-
-
-# If enabled forces the user to use encryption. This will bail out
-# if the user does not have encryption enabled.
-#ENABLE_FORCE_ENCRYPTION=&quot;0&quot;
-
-# Refuse the NX client connection if SSHD does not export the
-# SSH_CONNECTION and SSH_CLIENT variables in the environment
-# passed to the NX server.
-# 1: Will check the remote IP and will not accept the
-#    connection if it can't be determined.
-# 0: Will accept the connection even if the remote IP
-#    is not provided.
-#SSHD_CHECK_IP=&quot;0&quot;
-
-
-#########################################################################
-# Restriction directives
-#########################################################################
-
-# The base display number from which sessions are started.
-#DISPLAY_BASE=1000
-
-# The maximum number of contemporary sessions that can be run on FreeNX
-#SESSION_LIMIT=200
-
-# The maximum number of contemporary sessions that a single user can run
-# on FreeNX. Defaults to the value of SESSION_LIMIT.
-#SESSION_USER_LIMIT=200
-
-# The number of displays reserved for sessions, it has to be greater or equal
-# to the maximum number of contemporary sessions that a server can run.
-#DISPLAY_LIMIT=200
-
-
-# User for which sessions should be persistent. Either the keyword &quot;all&quot; or a
-# comma-separated list of usernames or groups in the @groupname syntax.
-#ENABLE_PERSISTENT_SESSION=&quot;all&quot;
-
-# Users and groups for whom persistent sessions should be disabled.
-# Especially useful if ENABLE_PERSISTENT_SESSION=&quot;all&quot;
-#DISABLE_PERSISTENT_SESSION=&quot;&quot;
-
-
-#########################################################################
-# Logging directives
-#########################################################################
-
-# This directives controls the verbosity of the server-wide log.
-# 0: No Logging
-# 1: Errors
-# 2: Warnings
-# 3: Important information
-# 4: Server - Client communication
-# 5: Information
-# 6: Debugging information
-# 7: stderror of some applications
-#NX_LOG_LEVEL=0
-
-# By setting this to 0 the nxserver might be a bit faster, but passwords can be found in the log files.
-#NX_LOG_SECURE=1
-
-# Before turning logging on, please make sure that NX_LOGFILE is
-# writeable for the &quot;nx&quot; user
-#NX_LOGFILE=/var/log/nxserver.log
-
-# This directive controls if the temporary session directory
-# ($HOME/.nx/C-&lt;hostname&gt;-&lt;display&gt;-&lt;session_id&gt;) should be kept after a
-# session has ended. A successfully terminated session will be saved as
-# T-C-&lt;hostname&gt;-&lt;display&gt;-&lt;session_id&gt; while a failed session will be saved
-# as F-C-&lt;hostname&gt;-&lt;display&gt;-&lt;session_id&gt;.
-# The default is to cleanup the directories.
-#SESSION_LOG_CLEAN=1
-
-# Amount of seconds nxserver is to keep session history. The default of 2592000
-# is equivalent to 30 days. If this is 0 no session history will be kept
-# and a negative value denotes infinity.
-#SESSION_HISTORY=2592000
-
-
-#########################################################################
-# Forwarding directives
-#########################################################################
-
-# FreeNX with ENABLE_SERVER_FORWARD=&quot;1&quot; will automatically forward all
-# connections to the host specified in SERVER_FORWARD_HOST with the
-# secret key SERVER_FORWARD_KEY.
-#
-# This allows to have a &quot;chain&quot; of NX Servers. Note that you will need to
-# use &quot;SSL encryption&quot; for all connections.
-
-#ENABLE_SERVER_FORWARD=&quot;0&quot;
-#SERVER_FORWARD_HOST=&quot;&quot;
-#SERVER_FORWARD_PORT=22
-#SERVER_FORWARD_KEY=&quot;/usr/NX/share/client.id_dsa.key&quot;
-
-
-# FreeNX with ENABLE_NOMACHINE_FORWARD_PORT=&quot;1&quot; will automatically forward all
-# connections to the commercial NoMachine nxserver installed on the same
-# machine, which go in by port NOMACHINE_FORWARD_PORT. This feature is introduced
-# to enable the usage of FreeNX and NoMachine NX side by side on the same machine
-# without conflicts.
-#
-# Note: You need to let SSHD listen to several ports to make use of this
-#       directive.
-
-#ENABLE_NOMACHINE_FORWARD_PORT=&quot;0&quot;
-#NOMACHINE_FORWARD_PORT=&quot;22&quot;
-
-#NOMACHINE_SERVER=&quot;/usr/NX/bin/nxserver&quot;
-#NOMACHINE_NX_HOME_DIR=&quot;/usr/NX/home/nx&quot;
-
-
-# LOAD BALANCING
-# ==============
-#
-# To do load balancing setup some hosts in LOAD_BALANCE_SERVERS and
-# make:
-#
-#   - either sure that all incoming connections are sent to the master
-#     server by using forwarding directives on the &quot;slave&quot; servers.
-#
-#   - or share the session database space via NFS between the servers.
-#     (not recommended at the moment as race conditions for DISPLAYs can 
-#      occur)
-#
-
-#LOAD_BALANCE_SERVERS=&quot;&quot;
-
-# The following load_balance_algorithms are available at the moment:
-#
-# &quot;load&quot;, &quot;round-robin&quot;, &quot;random&quot;
-#
-
-#LOAD_BALANCE_ALGORITHM=&quot;load&quot;
-
-# By setting ENABLE_LOADBALANCE=&quot;1&quot; you can let users choose their
-# preferred host, while being forwarded to another server. Of course
-# this is just a preference. The loadbalancing algorithm can completely
-# choose to ignore the users choice.
-
-#ENABLE_LOAD_BALANCE_PREFERENCE=&quot;0&quot;
-
-#########################################################################
-# Services directives
-#########################################################################
-
-# FreeNX with ENABLE_ESD_PRELOAD=&quot;1&quot; will automatically try to setup
-# the sound with the help of the esd media helper.
-#
-# Currently ESD will be used just by the Windows NX Client.
-#
-# Be sure that $ESD_BIN_PRELOAD is in your path, does exist and work
-# before enabling this directive.
-
-#ENABLE_ESD_PRELOAD=&quot;0&quot;
-#ESD_BIN_PRELOAD=&quot;esddsp&quot;
-
-# FreeNX with ENABLE_ARTSD_PRELOAD=&quot;1&quot; will automatically try to setup
-# the sound with the help of the artsd media helper.
-#
-# Currently ARTSD will be used just by the Linux NX Client.
-#
-# Be sure that $ARTSD_BIN_PRELOAD is in your path, does exist and work
-# before enabling this directive.
-
-#ENABLE_ARTSD_PRELOAD=&quot;0&quot;
-#ARTSD_BIN_PRELOAD=&quot;artsdsp&quot;
-
-# FreeNX with ENABLE_KDE_CUPS=&quot;1&quot; will automatically write 
-# $KDE_PRINTRC and put the current used socket into it.
-#
-# If you additionally enable ENABLE_KDE_CUPS_DYNAMIC it will set the 
-# Host entry to the script nxcups-gethost, which dynamically tries all 
-# possible entries to find the current printing host.
-#
-# The order is: CUPS_SERVER (env var), ~/.cups/client.conf, $KDE_PRINTRC,
-#               $CUPS_DEFAULT_SOCK, localhost
-#
-# So this option is most useful with ENABLE_CUPS_SERVER_EXPORT=&quot;1&quot;.
-# 
-# $KDE_PRINTRC is automatically calculated if its not set.
-
-#ENABLE_KDE_CUPS=&quot;0&quot;
-#ENABLE_KDE_CUPS_DYNAMIC=&quot;0&quot;
-#KDE_PRINTRC=&quot;$KDEHOME/share/config/kdeprintrc&quot;
-
-# FreeNX with ENABLE_CUPS_SERVER_EXPORT=&quot;1&quot; will automatically
-# export the environment variable CUPS_SERVER.
-
-#ENABLE_CUPS_SERVER_EXPORT=&quot;1&quot;
-
-# FreeNX with ENABLE_CUPS_SEAMLESS will automatically try to download the 
-# necessary ppds from the client.
-# 
-# As the forwarding is just active as soon as nxagent is started,
-# we need a small delay of $CUPS_SEAMLESS_DELAY.
-#
-# Note: You need to use a patched cupsd on client side.
-
-#ENABLE_CUPS_SEAMLESS=&quot;0&quot;
-#CUPS_SEAMLESS_DELAY=&quot;10&quot;
-
-# FreeNX with ENABLE_FOOMATIC will integrate the foomatic db to the list
-# of available ppd drivers via the $COMMAND_FOOMATIC command.
-
-#ENABLE_FOOMATIC=&quot;1&quot;
-#COMMAND_FOOMATIC=&quot;/usr/lib/cups/driver/foomatic-ppdfile&quot;
-
-# CUPS_BACKEND and CUPS_ETC are the corresponding paths of your CUPS 
-# installation.
-
-#CUPS_BACKEND=&quot;/usr/lib/cups/backend&quot;
-#CUPS_IPP_BACKEND=&quot;$CUPS_BACKEND/nxipp&quot;
-#CUPS_DEFAULT_SOCK=&quot;/var/run/cups/cups.sock&quot;
-#CUPS_ETC=&quot;/etc/cups&quot;
-
-#########################################################################
-# Path directives
-#########################################################################
-
-# USER_FAKE_HOME is the base directory for the .nx directory. Use this
-# parameter instead of the users home directory if $HOME is on a NFS share.
-# Note that this directory must be unique for every user! To accomplish this
-# it is recommended to include $USER in the path.
-#USER_FAKE_HOME=$HOME
-
-# Add the nx libraries to LD_LIBRARY_PATH before starting nx agents.
-# WARNING: This will NOT (and should not) affect applications. ONLY Disable
-# this if the nx libraries are in a standard system path (such as /usr/lib)!
-#SET_LD_LIBRARY_PATH=&quot;1&quot;
-
-
-# The command binary for the default window manager. If set it is run when a
-# 'unix-custom' session is requested by the NX Client and an application
-# to run is specified. It defaults to empty (ie no WM is run).
-# If KILL_DEFAULT_X_WM is set the WM is terminated after the started 
-# application finishes. Else FreeNX will wait for the WM to complete.
-#DEFAULT_X_WM=&quot;&quot;
-#KILL_DEFAULT_X_WM=&quot;1&quot;
-
-# When a 'unix-default' session is requested by the client the user's X startup
-# script will be run if pressent and executable, otherwise the default X
-# session will be run.
-# Depending on distribution USER_X_STARTUP_SCRIPT might be .Xclients, .xinitrc
-# and .Xsession
-# Depending on distribution DEFAULT_X_SESSION might be /etc/X11/xdm/Xsession,
-# /etc/X11/Sessions/Xsession or /etc/X11/xinit/xinitrc
-#USER_X_STARTUP_SCRIPT=.Xclients
-#DEFAULT_X_SESSION=/etc/X11/xdm/Xsession
-
-# The key that contains the name of the script that starts a KDE session.
-# It's run when a 'unix-kde' session is requested by the client.
-#COMMAND_START_KDE=startkde
-
-# The key that contains the name of the script that starts a gnome session.
-# It's run when a 'unix-gnome' session is requested by the client.
-#COMMAND_START_GNOME=gnome-session
-
-# The key that contains the name of the script that starts a CDE session.
-# It's run when a 'unix-cde' session is requested by the client.
-#COMMAND_START_CDE=cdwm
-
-# The key that contains the name of the complete path of command name
-# 'xterm'. It is run when a unix &quot;xterm&quot; session is requested by the
-# client.
-#COMMAND_XTERM=xterm
-
-# The key that contains the name of the complete path of command name
-# 'xauth'.
-#COMMAND_XAUTH=/usr/X11R6/bin/xauth
-
-# The key that contains the name of the complete path of command name
-# 'smbmount'.
-#COMMAND_SMBMOUNT=smbmount
-
-# The key that contains the name of the complete path of command name
-# 'smbumount'.
-#COMMAND_SMBUMOUNT=smbumount
-
-# The key that contains the name of the complete path of the 'netcat' command.
-#COMMAND_NETCAT=netcat
-
-# The key that contains the name of the complete path of the 'ssh' and
-# 'ssh-keygen' command.
-#COMMAND_SSH=ssh
-#COMMAND_SSH_KEYGEN=ssh-keygen
-
-# The key that contains the name of the complete path of the 'cupsd' command.
-#COMMAND_CUPSD=/usr/sbin/cupsd
-
-# The tool to generate md5sums with
-#COMMAND_MD5SUM=md5sum
-
-#########################################################################
-# Misc directives
-#########################################################################
-
-# When you installed a 2.0.0 NX Backend, set this to 1.
-#ENABLE_2_0_0_BACKEND=&quot;0&quot;
-
-# When set to 1 this will automatically resume started sessions
-#ENABLE_AUTORECONNECT=&quot;0&quot;
-
-# When set to 1 this will automatically resume started sessions
-# but only if an older client version is used
-#ENABLE_AUTORECONNECT_BEFORE_140=&quot;1&quot;
-
-# When set to 1 exports NXUSERIP / NXSESSIONID in nxnode
-#EXPORT_USERIP=&quot;0&quot;
-#EXPORT_SESSIONID=&quot;1&quot;
-
-# This can be set to any executable, which is started after session startup
-# like: $NODE_AUTOSTART {start|restore}
-#NODE_AUTOSTART=&quot;&quot;
-
-# When set to 1 will start nxagent in rootless mode.
-#ENABLE_ROOTLESS_MODE=&quot;1&quot;
-
-# If enabled writes entries via the COMMAND_SESSREG program
-# into utmp/wtmp/lastlog database.
-# Note: You have to make sure that you add the nx user to the
-#       utmp or tty group or how its called on your system
-#       before this directive works.
-#ENABLE_USESSION=&quot;0&quot;
-#COMMAND_SESSREG=&quot;sessreg&quot;
-
-# Extra options sent to the different nx agents. See !M documentation
-# for examples of useful parameters.
-#AGENT_EXTRA_OPTIONS_RFB=&quot;&quot;
-#AGENT_EXTRA_OPTIONS_RDP=&quot;&quot;
-#AGENT_EXTRA_OPTIONS_X=&quot;&quot;
-
-# The number of seconds we wait for the nxagent to start before
-# deciding startup has failed
-#AGENT_STARTUP_TIMEOUT=&quot;60&quot;
-
-# The font server the agent will use. If set to &quot;&quot; no font server is used.
-# For this to do any good, the client has to have the same font server set
-# in /etc/X11/XF86Config
-#AGENT_FONT_SERVER=&quot;&quot;
-
-# Disable or enable use of 'tcp nodelay' on proxy. Old versions of Linux
-# kernels have problems using this option on sockets that will cause a loss
-# of TCP connections. This option is not set by default to allow clients to
-# specify whether to enable or disable TCP nodelay. Setting this option to
-# the value of &quot;0&quot; NX proxy avoids using 'tcp nodelay' but it will cause a
-# loss of interaction in sessions.
-#PROXY_TCP_NODELAY=&quot;&quot;
-
-# Extra options to nxproxy. See !M documentation for useful parameters.
-#PROXY_EXTRA_OPTIONS=&quot;&quot;

Copied: freenx-server/tags/FreeNX-0.7.1/node.conf.sample (from rev 402, freenx-server/trunk/node.conf.sample)

Deleted: freenx-server/tags/FreeNX-0.7.1/nxclient
===================================================================
--- freenx-server/trunk/nxclient	2007-05-29 15:27:07 UTC (rev 334)
+++ freenx-server/tags/FreeNX-0.7.1/nxclient	2007-10-14 22:25:14 UTC (rev 405)
@@ -1,338 +0,0 @@
-#!/bin/bash
-#
-# Copyright (c) 2004 by Fabian Franz &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">freenx at fabian-franz.de</A>&gt;
-#           (c) 2004 by Rick Stout &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">zipsonic at gmail.com</A>&gt;
-#
-# License: GPL, version 2
-#
-# Note: NX does not check the exit-code from nxclient,
-#       but we set it to a &quot;good value&quot; anyway in case 
-#       it does check it someday.
-#
-# SVN: $Id$
-#
-# ========================================================================
-
-# First check if the commercial nxclient is available and use it
-# but check that it isn't this script to prevent a loop!
-NXCLIENT=&quot;/usr/NX/bin/nxclient&quot;
-[ -x &quot;$NXCLIENT&quot; -a &quot;$(file -bi $NXCLIENT)&quot; != 'application/x-shellscript' ] \
-	&amp;&amp; exec ${NXCLIENT} &quot;$@&quot;
-
-TEMP=`getopt -a -o d: --long local,noautokill,dialog:,caption:,message:,display:,printer:,parent: -n $(basename $0) -- &quot;$@&quot;`
-
-if [ $? != 0 ] ; then echo &quot;Terminating...&quot; &gt;&amp;2 ; exit 1 ; fi
-
-# Note the quotes around `$TEMP': they are essential!
-eval set -- &quot;$TEMP&quot;
-
-DIALOG_TYPE=&quot;ok&quot;;
-DIALOG_CAPTION=&quot;&quot;
-DIALOG_MESSAGE=&quot;&quot;
-DIALOG_LOCAL=&quot;&quot;
-DIALOG_NOAUTOKILL=&quot;&quot;
-DIALOG_PRINTER=&quot;&quot;
-DIALOG_PARENT=&quot;$PPID&quot;
-
-while true
-do
-        case &quot;$1&quot; in
-		--dialog) DIALOG_TYPE=&quot;$2&quot;; shift 2 ;;
-		--caption) DIALOG_CAPTION=&quot;$2&quot;; shift 2 ;;
-		--message) DIALOG_MESSAGE=&quot;$2&quot;; shift 2 ;;
-		--local) DIALOG_LOCAL=&quot;yes&quot;; shift ;;
-		--noautokill) DIALOG_NOAUTOKILL=&quot;yes&quot;; shift ;;
-		--display) DISPLAY=&quot;$2&quot;; shift 2 ;;
-		--printer) DIALOG_PRINTER=&quot;$2&quot;; shift 2 ;;
-		--parent) DIALOG_PARENT=&quot;$2&quot;; shift 2 ;;
-		--) shift ; break ;;
-                *) echo &quot;Internal error!&quot; ; exit 1; ;;
-	esac
-done
-
-export DISPLAY
-
-# if --printer is set, the dialog type is overridden
-[ -n &quot;$DIALOG_PRINTER&quot; ] &amp;&amp; DIALOG_TYPE=&quot;printer&quot;
-
-if [ -x /usr/bin/Xdialog ] 
-then
-	dialog_interface=&quot;xdialog&quot;
-	DIALOG=/usr/bin/Xdialog # just in case that we have no good path
-else
-	dialog_interface=&quot;xmessage&quot;
-	xmessage=$(which xmessage 2&gt;/dev/null)
-	[ -z &quot;$xmessage&quot; ] &amp;&amp; xmessage=&quot;/usr/X11R6/bin/xmessage&quot;
-fi
-
-#
-# utility functions for all interfaces
-#
-
-# utility_printer &quot;get|set|getlist|getvendlist|getdrvlist&quot;
-#
-#	get &lt;name&gt; - gets the current driver for name
-#	set &lt;name&gt; &lt;driver&gt; &lt;description&gt; - sets the current driver and description for name
-#	getvendlist - gets a list of vendors
-#	getdrvlist &lt;vendor&gt; - gets a list of drivers for vendor
-#	getextdrvlist &lt;vendor&gt; - gets an extended list (with driver and 
-#                                description) of drivers for vendor
-#	getdesc &lt;driver&gt; - gets the description for driver &lt;driver&gt;
-#	getlist - gets a list of drivers
-
-#
-# drivers.cache has the following format:
-#	
-#	driver|&lt;printername&gt;|&lt;ppdfile&gt;|&lt;description&gt;
-#
-
-#
-# Example: IFS='|' DEFAULT_PRINTER=( $(utility_printer get &lt;myprinter&gt;) )
-# 	  
-#	You can then select ${DEFAULT_PRINTER[1]} for &lt;printername&gt;.
-# 
-
-utility_printer()
-{
-	UTILITY_DRIVERS_CACHE=&quot;$HOME/.nx/config/drivers.cache&quot;
-	[ -n &quot;$USER_FAKE_HOME&quot; ] &amp;&amp; UTILITY_DRIVERS_CACHE=&quot;$USER_FAKE_HOME/.nx/config/drivers.cache&quot;
-	UTILITY_NXPRINT=&quot;nxprint&quot;
-	[ -n &quot;$PATH_BIN&quot; ] &amp;&amp; UTILITY_NXPRINT=&quot;$PATH_BIN/nxprint&quot;
-	# Export configuration vars for nxprint
-	export ENABLE_FOOMATIC COMMAND_FOOMATIC
-	case &quot;$1&quot; in 
-		get)
-			grep &quot;driver|$2|&quot; &quot;$UTILITY_DRIVERS_CACHE&quot; 2&gt;/dev/null
-		;;
-		set)
-			# FIXME: Handle possible race conditions?
-			grep -v &quot;driver|$2|&quot; &quot;$UTILITY_DRIVERS_CACHE&quot; 2&gt;/dev/null &gt; $UTILITY_DRIVERS_CACHE.tmp
-			echo &quot;driver|$2|$3|$4&quot; &gt;&gt; $UTILITY_DRIVERS_CACHE.tmp
-			mv -f $UTILITY_DRIVERS_CACHE.tmp $UTILITY_DRIVERS_CACHE
-		;;
-		getvendlist)
-			$UTILITY_NXPRINT -d | awk -F'|' '{ print $2 }' | uniq | tr '\n' '|'
-		;;
-		getdrvlist)
-			$UTILITY_NXPRINT -d | awk -F'|' '($2==&quot;'$2'&quot;) { print $4}' | tr '\n' '|'
-		;;
-		getextdrvlist)
-			$UTILITY_NXPRINT -d | awk -F'|' '($2==&quot;'$2'&quot;) { print $4 &quot;|&quot; $3 }'
-		;;
-
-		getdesc)
-			$UTILITY_NXPRINT -d | awk -F'|' '($4==&quot;'$2'&quot;) { print $3}'
-		;;
-		getlist)
-			$UTILITY_NXPRINT -d
-		;;
-	esac
-}
-
-#
-# xmessage dialog interface
-#
-
-xmessage_ok()
-{
-	$xmessage -buttons &quot;Ok:0&quot; -center &quot;$DIALOG_MESSAGE&quot;
-	return 0 # Give cancel on close ...
-}
-
-xmessage_yesno()
-{
-	$xmessage -buttons &quot;Yes:2,No:0&quot; -center &quot;$DIALOG_MESSAGE&quot;
-}
-
-xmessage_yesnosuspend()
-{
-	$xmessage -buttons &quot;Suspend:3,Terminate:2,Cancel:0&quot; -center &quot;$DIALOG_MESSAGE&quot;
-}
-
-xmessage_panic()
-{
-	$xmessage -buttons &quot;Terminate:2,Cancel:0&quot; -center &quot;$DIALOG_MESSAGE&quot;
-}
-
-xmessage_quit()
-{
-	$xmessage -buttons &quot;Quit:0&quot; -center &quot;$DIALOG_MESSAGE&quot;
-	return 0 # Give cancel on close ...
-}
-
-xmessage_printer_ask()
-{
-	$xmessage -buttons &quot;Ok:100,Configure:101,Cancel:102&quot; -center &quot;$DIALOG_MESSAGE&quot;
-	RC=$?
-	[ $RC -lt 100 ] &amp;&amp; return 2
-	let RC=$RC-100
-	return $RC
-}
-
-xmessage_printer_configure()
-{
-	IFS=','
-	$xmessage -buttons &quot;$*&quot; -center &quot;$DIALOG_MESSAGE&quot;
-	RC=$?
-	unset IFS
-	VENDOR=&quot;&quot;
-	if [ $RC -gt 100 ]
-	then
-		let NR=$RC-100
-		VENDOR=&quot;${!NR}&quot;
-	fi
-	echo &quot;$VENDOR&quot;
-}
-
-xmessage_printer_configure_vendor()
-{
-	IFS='|' VENDOR_LIST=( $(utility_printer getvendlist) )
-	xmessage_printer_configure &quot;${VENDOR_LIST[@]}&quot;
-}
-
-xmessage_printer_configure_driver()
-{
-	IFS='|' DRIVER_LIST=( $(utility_printer getdrvlist &quot;$1&quot;) )
-	xmessage_printer_configure &quot;${DRIVER_LIST[@]}&quot;
-}
-
-#
-# xdialog interface
-#
-
-xdialog_ok()
-{
-	$DIALOG --title &quot;$DIALOG_CAPTION&quot; --msgbox &quot;$DIALOG_MESSAGE&quot; 0 0
-	return 0 # Give cancel on close ...
-}
-
-xdialog_yesno()
-{
-	$DIALOG --title &quot;$DIALOG_CAPTION&quot; --yesno &quot;$DIALOG_MESSAGE&quot; 0 0
-	RC=$?
-	[ $RC -eq 0 ] &amp;&amp; return 2
-	[ $RC -eq 1 ] &amp;&amp; return 0
-}
-
-xdialog_yesnosuspend()
-{
-	$DIALOG --title &quot;$DIALOG_CAPTION&quot; --buttons-style text --ok-label &quot;Suspend&quot; --cancel-label &quot;Terminate&quot; --yesno &quot;$DIALOG_MESSAGE Close window to cancel.&quot; 400x150
-	RC=$?
-	[ $RC -eq 0 ] &amp;&amp; return 3
-	[ $RC -eq 1 ] &amp;&amp; return 2
-}
-
-xdialog_panic()
-{
-	$DIALOG --title &quot;$DIALOG_CAPTION&quot; --buttons-style text --default-no --ok-label &quot;Terminate&quot; --cancel-label &quot;Cancel&quot; --yesno &quot;$DIALOG_MESSAGE&quot; 0x0
-	RC=$?
-	[ $RC -eq 0 ] &amp;&amp; return 2
-	[ $RC -eq 1 ] &amp;&amp; return 0
-}
-
-xdialog_quit()
-{
-        $DIALOG --buttons-style text --ok-label &quot;Quit&quot; --title &quot;$DIALOG_CAPTION&quot; --msgbox &quot;$DIALOG_MESSAGE&quot; 0 0
-        return 0 # Give cancel on close ...
-}
-
-xdialog_printer_ask()
-{
-	$DIALOG --title &quot;$DIALOG_CAPTION&quot; --buttons-style text --ok-label &quot;Ok&quot; --cancel-label &quot;Configure&quot; --yesno &quot;$DIALOG_MESSAGE\n\nClose window to cancel.&quot; 400x250
-	RC=$?
-	[ $RC -eq 255 ] &amp;&amp; return 2
-	return $RC
-}
-
-xdialog_printer_configure_vendor()
-{
-	IFS='|' VENDOR_LIST=( $(utility_printer getvendlist | sed 's/|/||off|/g') )
-	$DIALOG --stdout --title &quot;$DIALOG_CAPTION&quot; --radiolist &quot;$DIALOG_MESSAGE&quot; 0 0 6 &quot;${VENDOR_LIST[@]}&quot;
-}
-
-# xdialog_printer_configure_driver vendor old_driver
-xdialog_printer_configure_driver()
-{
-	IFS='|' XDIALOG_LIST=( $(utility_printer getextdrvlist &quot;$1&quot; | sed 's,$,|off,g; /'&quot;$(basename $2)&quot;'/ s,|off,|on,g' | tr '\n' '|') )
-	$DIALOG --stdout --title &quot;$DIALOG_CAPTION&quot; --radiolist &quot;$DIALOG_MESSAGE&quot; 0 0 6 &quot;${XDIALOG_LIST[@]}&quot;
-}
-
-
-#
-# helper functions
-#
-
-helper_dialog_printer()
-{
-	IFS=&quot;|&quot; PRINTER_INFORMATION=( $(utility_printer get &quot;$DIALOG_PRINTER&quot;) )
-	PRINTER_CONFIGURE=&quot;yes&quot;
-	[ -z &quot;$DIALOG_CAPTION&quot; ] &amp;&amp; DIALOG_CAPTION=&quot;NX Printer configuration for $DIALOG_PRINTER&quot;
-	
-	# Do we have old printer information present?
-	if [ -n &quot;$PRINTER_INFORMATION&quot; ]
-	then
-		DIALOG_MESSAGE=$(echo -e &quot;Found driver for printer $DIALOG_PRINTER.\n\nOld choice was: ${PRINTER_INFORMATION[3]}.\n\nIf you want to keep the settings click on 'Ok' \n- else click on 'Configure'.&quot;) ${dialog_interface}_printer_ask
-		RC=$?
-		# bail out with exit code 2 in case the user cancelled the operation
-		[ $RC -eq 2 ] &amp;&amp; echo &quot;cancel: aborted&quot; &amp;&amp; exit 2
-		[ $RC -eq 0 ] &amp;&amp; PRINTER_CONFIGURE=&quot;no&quot;
-	fi
-	
-	VENDOR=&quot;&quot;
-	OLD_DRIVER=&quot;${PRINTER_INFORMATION[2]}&quot;
-
-	if [ &quot;$PRINTER_CONFIGURE&quot; = &quot;yes&quot; ]
-	then
-		DRIVER=&quot;&quot;
-		VENDOR=$(DIALOG_MESSAGE=&quot;Choose vendor for printer $DIALOG_PRINTER.&quot; ${dialog_interface}_printer_configure_vendor)
-		[ -n &quot;$VENDOR&quot; ] &amp;&amp; DRIVER=$(DIALOG_MESSAGE=&quot;Choose driver for printer $DIALOG_PRINTER.&quot; ${dialog_interface}_printer_configure_driver &quot;$VENDOR&quot; &quot;${OLD_DRIVER:-invalid}&quot;)
-		# set the new printer driver
-		if [ -n &quot;$DRIVER&quot; ]
-		then
-			DESC=$(utility_printer getdesc &quot;$DRIVER&quot;)
-			utility_printer set &quot;$DIALOG_PRINTER&quot; &quot;$DRIVER&quot; &quot;$DESC&quot;
-		fi
-	else
-		DRIVER=&quot;$OLD_DRIVER&quot;
-	fi
-
-	# echo the choosen &lt;ppdfile&gt; to stdout
-	[ -n &quot;$DRIVER&quot; ] &amp;&amp; echo &quot;$DRIVER&quot;
-	[ -z &quot;$DRIVER&quot; ] &amp;&amp; echo &quot;cancel: aborted&quot; &amp;&amp; exit 2
-			
-	exit 0
-}
-
-#
-# main case statement
-#
-
-case $DIALOG_TYPE in 
-	ok)
-		${dialog_interface}_ok
-	;;
-	yesno)
-		${dialog_interface}_yesno
-	;;
-	yesnosuspend)
-		${dialog_interface}_yesnosuspend
-	;;
-	panic)
-		${dialog_interface}_panic
-	;;
-	quit)
-		${dialog_interface}_quit
-	;;
-	printer)
-		helper_dialog_printer
-	;;
-esac
-
-#
-# Time for exit code checks :)
-#
-
-RC=$?
-	[ $RC -eq 2 ] &amp;&amp; kill -TERM $DIALOG_PARENT
-	[ $RC -eq 3 ] &amp;&amp; kill -HUP $DIALOG_PARENT
-exit 0

Copied: freenx-server/tags/FreeNX-0.7.1/nxdesktop_helper (from rev 398, freenx-server/trunk/nxdesktop_helper)

Copied: freenx-server/tags/FreeNX-0.7.1/nxdialog (from rev 396, freenx-server/trunk/nxdialog)

Deleted: freenx-server/tags/FreeNX-0.7.1/nxkeygen
===================================================================
--- freenx-server/trunk/nxkeygen	2007-05-29 15:27:07 UTC (rev 334)
+++ freenx-server/tags/FreeNX-0.7.1/nxkeygen	2007-10-14 22:25:14 UTC (rev 405)
@@ -1,69 +0,0 @@
-#!/bin/bash
-#
-# /usr/NX/bin/nxkeygen
-#		Create a new client/server key pair
-#
-#		Originally written for Gentoo Linux
-#
-# Author	Stuart Herbert
-#		(<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">stuart at gentoo.org</A>)
-#
-# Copyright	(c) 2004 Gentoo Foundation
-#		Released under v2 of the GNU GPL
-#
-# SVN: $Id$
-#
-# ========================================================================
-
-# Read the config file
-. $(PATH=$(cd $(dirname $0) &amp;&amp; pwd):$PATH which nxloadconfig) --
-
-NX_KEY_DIR=&quot;$NX_HOME_DIR/.ssh&quot;
-DATE=&quot;`date '+%Y%m%d-%H%M%S'`&quot;
-NX_CLIENT_KEY=&quot;${NX_KEY_DIR}/client.id_dsa.key&quot;
-NX_SERVER_KEY=&quot;${NX_KEY_DIR}/server.id_dsa.pub.key&quot;
-
-main ()
-{
-	# create a new key
-	umask 177
-	$COMMAND_SSH_KEYGEN -q -t dsa -N '' -f ${NX_KEY_DIR}/local.id_dsa
-
-	# backup the existing keys
-	
-	if [ -f &quot;${NX_SERVER_KEY}&quot; ]; then
-		echo &quot;Backing up existing server key to ${NX_SERVER_KEY}.${DATE}&quot;
-		mv -f &quot;${NX_SERVER_KEY}&quot; &quot;${NX_SERVER_KEY}.${DATE}&quot;
-	fi
-
-	if [ -f &quot;${NX_CLIENT_KEY}&quot; ]; then
-		echo &quot;Backing up existing client key to ${NX_CLIENT_KEY}.${DATE}&quot;
-		mv -f &quot;${NX_CLIENT_KEY}&quot; &quot;${NX_CLIENT_KEY}.${DATE}&quot;
-	fi
-
-	# put the new keys in place
-
-	mv -f &quot;${NX_KEY_DIR}/local.id_dsa&quot; &quot;${NX_CLIENT_KEY}&quot;
-	mv -f &quot;${NX_KEY_DIR}/local.id_dsa.pub&quot; &quot;${NX_SERVER_KEY}&quot;
-
-	for x in ${NX_CLIENT_KEY} ${NX_SERVER_KEY} ; do
-		chmod 600 $x
-		chown nx:root $x
-	done
-	
-	# copy the key to the authorized_keys2 file
-	rm -f $NX_KEY_DIR/$SSH_AUTHORIZED_KEYS
-	echo -n &quot;no-port-forwarding,no-agent-forwarding,command=\&quot;$PATH_BIN/nxserver\&quot; &quot; &gt;$NX_KEY_DIR/$SSH_AUTHORIZED_KEYS
-	cat ${NX_SERVER_KEY} &gt;&gt; $NX_KEY_DIR/$SSH_AUTHORIZED_KEYS
-
-	# now tell the user what to do
-
-	echo &quot;Unique key generated; your users must install&quot;
-	echo
-	echo &quot;    ${NX_CLIENT_KEY}&quot;
-	echo
-	echo &quot;on their computers.&quot;
-}
-
-main &quot;$@&quot;
-

Copied: freenx-server/tags/FreeNX-0.7.1/nxkeygen (from rev 372, freenx-server/trunk/nxkeygen)

Deleted: freenx-server/tags/FreeNX-0.7.1/nxloadconfig
===================================================================
--- freenx-server/trunk/nxloadconfig	2007-05-29 15:27:07 UTC (rev 334)
+++ freenx-server/tags/FreeNX-0.7.1/nxloadconfig	2007-10-14 22:25:14 UTC (rev 405)
@@ -1,574 +0,0 @@
-#!/bin/bash
-#
-# Copyright (c) 2005 by Fabian Franz &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">freenx at fabian-franz.de</A>&gt;
-#           (c) 2005 by Jon Severinsson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">jonno at users.berlios.de</A>&gt;
-#
-# License: GPL, version 2
-#
-# SVN: $Id$
-#
-# ========================================================================
-
-#########################################################################
-# Commandline support for --help, --check and --userconf
-#########################################################################
-
-HELP=&quot;no&quot;
-CHECK=&quot;no&quot;
-USERCONF=&quot;no&quot;
-NXLCFG_IGNORE_ERRORS=&quot;no&quot;
-
-while [ &quot;$1&quot; ]
-do
-	case &quot;$1&quot; in
-		--help) HELP=&quot;yes&quot;; shift ;;
-		--check) CHECK=&quot;yes&quot;; shift ;;
-		--ignore-errors) NXLCFG_IGNORE_ERRORS=&quot;yes&quot;; shift;;
-		--userconf) USERCONF=&quot;yes&quot; ; 
-					case &quot;$2&quot; in
-						&quot;&quot; | --*) shift ;;
-						*) USER=$2 ; shift 2 ;;
-					esac ;;
-		--) shift ; break ;;
-		*) echo &quot;Invalid flag $1&quot; ; HELP=&quot;yes&quot;; shift ; break ;;
-	esac
-done
-
-if [ &quot;$HELP&quot; = &quot;yes&quot; ]
-then
-	echo &quot;nxloadconfig - Load the FreeNX configuration variables into the environment.&quot;
-	echo &quot;Syntax: nxloadconfig --help&quot;
-	echo &quot;        nxloadconfig [--check] [--userconf [&lt;username&gt;]]&quot;
-	echo
-	echo &quot;  --check                  Write errors to standard output.&quot;
-	echo &quot;	--ignore-errors		 just warn, and don't exit with a error, if errors occure&quot;
-	echo &quot;  --userconf [&lt;username&gt;]  Parse &lt;username&gt;.node.conf as well as node.conf.&quot;
-	echo &quot;                           Assume current user if no username is specified.&quot;
-	exit 0
-fi
-
-#########################################################################
-# INTERNAL STUFF
-# DO NOT TOUCH unless you REALLY know what you are doing
-#########################################################################
-
-NX_VERSION=1.5.0-61-SVN
-NX_LICENSE=&quot;OS (GPL)&quot;
-
-# Where can different nx components be found
-NX_DIR=/usr
-PATH_BIN=$NX_DIR/bin # if you change that, be sure to also change the public keys
-PATH_LIB=$NX_DIR/lib
-NX_ETC_DIR=/etc/nxserver
-NX_SESS_DIR=/var/lib/nxserver/db
-NX_HOME_DIR=/var/lib/nxserver/home
-
-# Advanced users ONLY
-AGENT_LIBRARY_PATH=&quot;&quot; #Calculated
-PROXY_LIBRARY_PATH=&quot;&quot; #Calculated
-APPLICATION_LIBRARY_PATH=&quot;&quot; #Calculated
-APPLICATION_LIBRARY_PRELOAD=&quot;&quot; #Calculated
-
-# the name of the authorized keys file for ssh
-SSH_AUTHORIZED_KEYS=&quot;authorized_keys2&quot;
-
-# retest values like xauth, netcat
-# set to 0 if you are sure, you set the right values
-
-NXCONFIG_RETEST=1
-
-#########################################################################
-# Default Values
-# A user should NEVER touch this, edit $NX_ETC_DIR/node.conf instead
-#########################################################################
-
-# General FreeNX directives
-
-SERVER_NAME=&quot;$(hostname)&quot;
-SSHD_PORT=22
-
-# Authentication / Security directives
-
-ENABLE_USERMODE_AUTHENTICATION=&quot;0&quot;
-ENABLE_PASSDB_AUTHENTICATION=&quot;1&quot;
-ENABLE_SSH_AUTHENTICATION=&quot;1&quot;
-ENABLE_SU_AUTHENTICATION=&quot;0&quot;
-ENABLE_USER_DB=&quot;0&quot;
-
-ENABLE_FORCE_ENCRYPTION=&quot;0&quot;
-SSHD_CHECK_IP=&quot;0&quot;
-
-
-# Restriction directives
-
-DISPLAY_BASE=1000
-SESSION_LIMIT=200
-SESSION_USER_LIMIT=&quot;&quot; #Calculated
-DISPLAY_LIMIT=200
-
-ENABLE_PERSISTENT_SESSION=&quot;all&quot;
-DISABLE_PERSISTENT_SESSION=&quot;&quot;
-
-
-# Logging directives
-
-NX_LOG_LEVEL=0
-NX_LOG_SECURE=1
-NX_LOGFILE=/var/log/nxserver.log
-SESSION_LOG_CLEAN=1
-SESSION_HISTORY=2592000
-
-
-# Forwarding directives
-
-ENABLE_SERVER_FORWARD=&quot;0&quot;
-SERVER_FORWARD_HOST=&quot;&quot;
-SERVER_FORWARD_PORT=22
-SERVER_FORWARD_KEY=&quot;/usr/NX/share/client.id_dsa.key&quot;
-
-NOMACHINE_SERVER=&quot;/usr/NX/bin/nxserver&quot;
-NOMACHINE_NX_HOME_DIR=&quot;/usr/NX/home/nx&quot;
-ENABLE_NOMACHINE_FORWARD_PORT=&quot;0&quot;
-NOMACHINE_FORWARD_PORT=&quot;22&quot;
-
-LOAD_BALANCE_SERVERS=&quot;&quot;
-LOAD_BALANCE_ALGORITHM=&quot;load&quot;
-ENABLE_LOAD_BALANCE_PREFERENCE=&quot;0&quot;
-
-# Services directives
-
-ENABLE_ESD_PRELOAD=&quot;0&quot;
-ESD_BIN_PRELOAD=&quot;esddsp&quot;
-ENABLE_ARTSD_PRELOAD=&quot;0&quot;
-ARTSD_BIN_PRELOAD=&quot;artsdsp&quot;
-
-ENABLE_KDE_CUPS=&quot;0&quot;
-ENABLE_KDE_CUPS_DYNAMIC=&quot;0&quot;
-KDE_PRINTRC=&quot;&quot; # Calculated
-
-ENABLE_CUPS_SERVER_EXPORT=&quot;1&quot;
-ENABLE_CUPS_SEAMLESS=&quot;0&quot;
-CUPS_SEAMLESS_DELAY=&quot;10&quot;
-ENABLE_FOOMATIC=&quot;1&quot;
-COMMAND_FOOMATIC=&quot;/usr/lib/cups/driver/foomatic-ppdfile&quot;
-
-CUPS_BACKEND=&quot;/usr/lib/cups/backend&quot;
-CUPS_IPP_BACKEND=&quot;$CUPS_BACKEND/nxipp&quot;
-CUPS_DEFAULT_SOCK=&quot;/var/run/cups/cups.sock&quot;
-CUPS_ETC=&quot;/etc/cups/&quot;
-
-# Path directives
-
-USER_FAKE_HOME=&quot;&quot; #Calculated
-SET_LD_LIBRARY_PATH=&quot;1&quot;
-
-DEFAULT_X_WM=&quot;&quot;
-KILL_DEFAULT_X_WM=&quot;1&quot;
-USER_X_STARTUP_SCRIPT=.Xclients
-DEFAULT_X_SESSION=/etc/X11/xdm/Xsession
-COMMAND_START_KDE=startkde
-COMMAND_START_GNOME=gnome-session
-COMMAND_START_CDE=cdwm
-COMMAND_XTERM=xterm
-COMMAND_XAUTH=/usr/X11R6/bin/xauth
-COMMAND_SMBMOUNT=smbmount
-COMMAND_SMBUMOUNT=smbumount
-COMMAND_NETCAT=netcat
-COMMAND_SSH=ssh
-COMMAND_SSH_KEYGEN=ssh-keygen
-COMMAND_CUPSD=/usr/sbin/cupsd
-COMMAND_MD5SUM=md5sum
-
-
-# Misc directives
-
-ENABLE_2_0_0_BACKEND=&quot;&quot;
-ENABLE_AUTORECONNECT=&quot;0&quot;
-ENABLE_AUTORECONNECT_BEFORE_140=&quot;1&quot;
-EXPORT_USERIP=&quot;0&quot;
-EXPORT_SESSIONID=&quot;1&quot;
-NODE_AUTOSTART=&quot;&quot;
-ENABLE_ROOTLESS_MODE=&quot;1&quot;
-ENABLE_USESSION=&quot;0&quot;
-COMMAND_SESSREG=&quot;sessreg&quot;
-AGENT_EXTRA_OPTIONS_RFB=&quot;&quot;
-AGENT_EXTRA_OPTIONS_RDP=&quot;&quot;
-AGENT_EXTRA_OPTIONS_X=&quot;&quot;
-AGENT_STARTUP_TIMEOUT=&quot;60&quot;
-AGENT_FONT_SERVER=&quot;&quot;
-PROXY_TCP_NODELAY=&quot;&quot;
-PROXY_EXTRA_OPTIONS=&quot;&quot;
-
-############################################################################
-# OS specific directives
-############################################################################
-
-OS=&quot;$( uname -sr )&quot;
-
-case &quot;$OS&quot; in
-	&quot;SunOS 5.10&quot;)
-		DEFAULT_X_WM=cdwm
-		DEFAULT_X_SESSION=/etc/X11/gdm/Xsession
-		COMMAND_XTERM=/usr/openwin/bin/xterm
-		COMMAND_XAUTH=/usr/openwin/bin/xauth
-		COMMAND_CUPSD=/opt/sfw/cups/sbin/cupsd
-		COMMAND_MD5SUM=gmd5sum
-		PATH=/usr/xpg4/bin:/usr/openwin/bin:$PATH
-		export PATH
-		;;
-esac
-
-# replace incompatible commands
-
-case &quot;$OS&quot; in
-       &quot;SunOS 5.10&quot;)
-               function which()
-               {
-                       [ -e &quot;$1&quot; ] &amp;&amp; echo $1 &amp;&amp; return 0
-                       [ -z &quot;$1&quot; ] &amp;&amp; return 1
-                       for i in  $(echo $PATH | tr &quot;:&quot; &quot;\n&quot;); do
-                               [ -e $i/$1 ] &amp;&amp; echo $i/$1 &amp;&amp; return 0
-                       done
-                       return 1
-               }
-
-	       function rev() {
-		       perl -lpe'$_ = reverse'
-	       }
-       ;;
-esac
-
-#########################################################################
-# Retested values
-#########################################################################
-
-if [ &quot;$NXCONFIG_RETEST&quot; = &quot;1&quot; ]
-then
-	{ ! which &quot;$COMMAND_XAUTH&quot; &amp;&amp; which xauth; } &gt;/dev/null 2&gt;&amp;1 &amp;&amp; COMMAND_XAUTH=$(which xauth)
-	{ ! which &quot;$COMMAND_NETCAT&quot; &amp;&amp; which nc; } &gt;/dev/null 2&gt;&amp;1 &amp;&amp; COMMAND_NETCAT=$(which nc)
-fi
-
-#########################################################################
-# node.conf file evaluation
-#########################################################################
-
-if [ -d $NX_ETC_DIR/node.conf.d ]
-then
-	for i in $NX_ETC_DIR/node.conf.d/*
-	do
-		[ -e $i ] &amp;&amp; . $i
-	done
-fi
-
-[ -e $NX_ETC_DIR/node.conf ] &amp;&amp; . $NX_ETC_DIR/node.conf
-[ &quot;$USERCONF&quot; = &quot;yes&quot; -a -e $NX_ETC_DIR/$USER.node.conf ] &amp;&amp; . $NX_ETC_DIR/$USER.node.conf
-
-
-#########################################################################
-# Calculated values
-#########################################################################
-
-[ -z &quot;$SESSION_USER_LIMIT&quot; ] &amp;&amp; SESSION_USER_LIMIT=$SESSION_LIMIT
-[ -z &quot;$USER_FAKE_HOME&quot; ] &amp;&amp; USER_FAKE_HOME=$HOME
-
-[ -z &quot;$AGENT_LIBRARY_PATH&quot; ] &amp;&amp; AGENT_LIBRARY_PATH=$PATH_LIB
-[ -z &quot;$PROXY_LIBRARY_PATH&quot; ] &amp;&amp; PROXY_LIBRARY_PATH=$PATH_LIB
-[ -z &quot;$APPLICATION_LIBRARY_PATH&quot; ] &amp;&amp; APPLICATION_LIBRARY_PATH=$PATH_LIB
-[ -z &quot;$APPLICATION_LIBRARY_PRELOAD&quot; ] &amp;&amp; APPLICATION_LIBRARY_PRELOAD=&quot;$APPLICATION_LIBRARY_PATH/libX11.so.6.2:$APPLICATION_LIBRARY_PATH/libXext.so.6.4:$APPLICATION_LIBRARY_PATH/libXcomp.so:$APPLICATION_LIBRARY_PATH/libXcompext.so.1:$APPLICATION_LIBRARY_PATH/libXrender.so.1.2&quot;
-if [ -z &quot;$ENABLE_2_0_0_BACKEND&quot; ]
-then
-	ENABLE_2_0_0_BACKEND=&quot;1&quot;
-	[ -z &quot;$(strings $PATH_BIN/nxagent | egrep 'NXAGENT - Version 2.[01].0')&quot; ] &amp;&amp; ENABLE_2_0_0_BACKEND=&quot;0&quot;
-fi 
-
-[ -z &quot;$KDE_PRINTRC&quot; -a -n &quot;$KDEHOME&quot; ] &amp;&amp; KDE_PRINTRC=&quot;$KDEHOME/share/config/kdeprintrc&quot;
-[ -z &quot;$KDE_PRINTRC&quot; ] &amp;&amp; KDE_PRINTRC=$(kde-config --localprefix)&quot;/share/config/kdeprintrc&quot;
-[ -z &quot;$KDE_PRINTRC&quot; -o ! -r &quot;$KDE_PRINTRC&quot; ] &amp;&amp; KDE_PRINTRC=&quot;$HOME/.kde/share/config/kdeprintrc&quot;
-
-#########################################################################
-# Support for --check
-#########################################################################
-
-if [ &quot;$CHECK&quot; = &quot;yes&quot; ]
-then
-	ERROR=&quot;no&quot;
-	WARNING=&quot;no&quot;
-	
-	# Internal Stuff
-	
-	[ ! -d &quot;$PATH_BIN&quot; ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;PATH_BIN=$PATH_BIN\&quot;&quot;
-	# Check for NX agents ...
-	
-	[ ! -f &quot;$PATH_BIN/nxagent&quot; ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Could not find nxagent in $PATH_BIN. Please install some OSS components.&quot;
-		
-	[ ! -f &quot;$PATH_BIN/nxdesktop&quot; ] &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: Could not find nxdesktop in $PATH_BIN. RDP sessions won't work.&quot;
-		
-	[ ! -f &quot;$PATH_BIN/nxviewer&quot; ] &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: Could not find nxviewer in $PATH_BIN. VNC sessions won't work.&quot;
-
-	# Check for paths
-		
-	[ ! -d &quot;$PATH_LIB&quot; ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;PATH_LIB=$PATH_LIB\&quot;&quot;
-	[ ! -d &quot;$NX_ETC_DIR&quot; ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;NX_ETC_DIR=$NX_ETC_DIR\&quot;&quot;
-	[ ! -d &quot;$NX_SESS_DIR&quot; ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;NX_SESS_DIR=$NX_SESS_DIR\&quot;&quot;
-	[ ! -d &quot;$NX_HOME_DIR&quot; ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;NX_HOME_DIR=$NX_HOME_DIR\&quot;&quot;
-
-	[ ! -d &quot;$AGENT_LIBRARY_PATH&quot; ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;AGENT_LIBRARY_PATH=$AGENT_LIBRARY_PATH\&quot;&quot;
-	[ ! -d &quot;$PROXY_LIBRARY_PATH&quot; ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;PROXY_LIBRARY_PATH=$PROXY_LIBRARY_PATH\&quot;&quot;
-	[ ! -d &quot;$APPLICATION_LIBRARY_PATH&quot; ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;APPLICATION_LIBRARY_PATH=$APPLICATION_LIBRARY_PATH\&quot;&quot;
-	
-	OLD_IFS=$IFS
-	IFS=&quot;:&quot;
-	for LIBRARY in $APPLICATION_LIBRARY_PRELOAD; do
-		[ ! -e $LIBRARY ] &amp;&amp; \
-			ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;APPLICATION_LIBRARY_PRELOAD=$APPLICATION_LIBRARY_PRELOAD\&quot;&quot; &amp;&amp; break ;
-	done
-	IFS=$OLD_IFS
-	
-	[ -z &quot;$SSH_AUTHORIZED_KEYS&quot; ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;SSH_AUTHORIZED_KEYS=$SSH_AUTHORIZED_KEYS\&quot;&quot;
-	
-	
-	# General FreeNX directives
-	
-	[ -z &quot;$SERVER_NAME&quot; ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;SERVER_NAME=$SERVER_NAME\&quot;&quot;
-	[ -z $(echo &quot;$SSHD_PORT&quot; | egrep &quot;^[1-9][0-9]{0,4}$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;SSHD_PORT=$SSHD_PORT\&quot;&quot;
-	
-	
-	# Authentication / Security directives
-	
-	[ -z $(echo &quot;$ENABLE_PASSDB_AUTHENTICATION&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;ENABLE_PASSDB_AUTHENTICATION=$ENABLE_PASSDB_AUTHENTICATION\&quot;&quot;
-	[ -z $(echo &quot;$ENABLE_SSH_AUTHENTICATION&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;ENABLE_SSH_AUTHENTICATION=$ENABLE_SSH_AUTHENTICATION:\&quot;&quot;
-	[ -z $(echo &quot;$ENABLE_SU_AUTHENTICATION&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;ENABLE_SU_AUTHENTICATION=$NENABLE_SU_AUTHENTICATION\&quot;&quot;
-	[ -z $(echo &quot;$ENABLE_USER_DB&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;ENABLE_USER_DB=$ENABLE_USER_DB\&quot;&quot;
-	
-	[ -z $(echo &quot;$ENABLE_FORCE_ENCRYPTION&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;ENABLE_FORCE_ENCRYPTION=$ENABLE_FORCE_ENCRYPTION\&quot;&quot;
-	[ -z $(echo &quot;$SSHD_CHECK_IP&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;SSHD_CHECK_IP=$SSHD_CHECK_IP\&quot;&quot;
-	
-	
-	# Restriction directives
-	
-	[ -z $(echo &quot;$DISPLAY_BASE&quot; | egrep &quot;^[1-9][0-9]{0,4}$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;DISPLAY_BASE=$DISPLAY_BASE\&quot;&quot;
-	[ -z $(echo &quot;$SESSION_LIMIT&quot; | egrep &quot;^[1-9][0-9]{0,4}$&quot;) ] &amp;&amp;  \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;SESSION_LIMIT=$SESSION_LIMIT\&quot;&quot;
-	[ -z $(echo &quot;$SESSION_USER_LIMIT&quot; | egrep &quot;^[1-9][0-9]{0,4}$&quot;) -o $SESSION_USER_LIMIT -gt $SESSION_LIMIT ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;SESSION_USER_LIMIT=$SESSION_USER_LIMIT\&quot;&quot;
-	[ -z $(echo &quot;$DISPLAY_LIMIT&quot; | egrep &quot;^[1-9][0-9]{0,4}$&quot;) -o $DISPLAY_LIMIT -lt $SESSION_LIMIT ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;DISPLAY_LIMIT=$DISPLAY_LIMIT\&quot;&quot;
-	
-	OLD_IFS=$IFS
-	IFS=&quot;,&quot;
-	if [ &quot;$ENABLE_PERSISTENT_SESSION&quot; != &quot;all&quot; ]
-	then
-		for USERNAME in $ENABLE_PERSISTENT_SESSION; do
-			[ &quot;${USERNAME:0:1}&quot; != &quot;@&quot; ] &amp;&amp; [ -z $(getent passwd $USERNAME) ] &amp;&amp; \
-				ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;ENABLE_PERSISTENT_SESSION=$ENABLE_PERSISTENT_SESSION\&quot;&quot; &amp;&amp; break ;
-			[ &quot;${USERNAME:0:1}&quot; = &quot;@&quot; ] &amp;&amp; [ -z $(getent group ${USERNAME:1}) ] &amp;&amp; \
-				ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;ENABLE_PERSISTENT_SESSION=$ENABLE_PERSISTENT_SESSION\&quot;&quot; &amp;&amp; break ;
-		done
-	fi
-	for USERNAME in $DISABLE_PERSISTENT_SESSION; do
-		[ &quot;${USERNAME:0:1}&quot; != &quot;@&quot; ] &amp;&amp; [ -z $(getent passwd $USERNAME) ] &amp;&amp; \
-			ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;DISABLE_PERSISTENT_SESSION=$DISABLE_PERSISTENT_SESSION\&quot;&quot; &amp;&amp; break ;
-		[ &quot;${USERNAME:0:1}&quot; = &quot;@&quot; ] &amp;&amp; [ -z $(getent group ${USERNAME:1}) ] &amp;&amp; \
-			ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;DISABLE_PERSISTENT_SESSION=$DISABLE_PERSISTENT_SESSION\&quot;&quot; &amp;&amp; break ;
-	done
-	IFS=$OLD_IFS
-	
-	
-	# Logging directives
-	
-	[ -z $(echo &quot;$NX_LOG_LEVEL&quot; | egrep &quot;^[0-7]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;NX_LOG_LEVEL=$NX_LOG_LEVEL\&quot;&quot;
-	[ &quot;$NX_LOG_LEVEL&quot; != &quot;0&quot; -a ! -e &quot;$NX_LOGFILE&quot; ] &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: Invalid value \&quot;NX_LOGFILE=$NX_LOGFILE\&quot;&quot; \
-					  &amp;&amp; echo &quot;         No logfile will be kept.&quot;
-		# How do I check if another user might write to a file? ( -w checks only current user)
-	[ -z $(echo &quot;$SESSION_LOG_CLEAN&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;SESSION_LOG_CLEAN=$SESSION_LOG_CLEAN\&quot;&quot;
-	[ -z $(echo &quot;$SESSION_HISTORY&quot; | egrep &quot;^-?[0-9]+$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;SESSION_HISTORY=$SESSION_HISTORY\&quot;&quot;
-	
-	
-	# Forwarding directives
-	
-	[ -z $(echo &quot;$ENABLE_SERVER_FORWARD&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;ENABLE_SERVER_FORWARD=$ENABLE_SERVER_FORWARD\&quot;&quot;
-	[ &quot;$ENABLE_SERVER_FORWARD&quot; = &quot;1&quot; -a -z &quot;$SERVER_FORWARD_HOST&quot; ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;SERVER_FORWARD_HOST=$SERVER_FORWARD_HOST\&quot;&quot; 
-		# Any ideas on how I can check for a VALID host is velcome!
-		# In my private scripts I use 'resolveip -q' and check if output conforms to [0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}, 
-		# but resolveip is part of mysql, and I don't think I should add that dependancy...
-	[ &quot;$ENABLE_SERVER_FORWARD&quot; = &quot;1&quot; -a -z $(echo &quot;$SERVER_FORWARD_PORT&quot; | egrep &quot;^[1-9][0-9]{0,4}$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;SERVER_FORWARD_PORT=$SERVER_FORWARD_PORT\&quot;&quot;
-	[ &quot;$ENABLE_SERVER_FORWARD&quot; = &quot;1&quot; -a ! -e &quot;$SERVER_FORWARD_KEY&quot; ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;SERVER_FORWARD_KEY=$SERVER_FORWARD_KEY\&quot;&quot;
-	
-	[ -z $(echo &quot;$ENABLE_NOMACHINE_FORWARD_PORT&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;ENABLE_NOMACHINE_FORWARD_PORT=$ENABLE_NOMACHINE_FORWARD_PORT\&quot;&quot;
-	[ &quot;$ENABLE_NOMACHINE_FORWARD_PORT&quot; = &quot;1&quot; ] &amp;&amp; ! which &quot;$NOMACHINE_SERVER&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;NOMACHINE_SERVER=$NOMACHINE_SERVER\&quot;&quot;
-	[ &quot;$ENABLE_NOMACHINE_FORWARD_PORT&quot; = &quot;1&quot; -a -z $(echo &quot;$NOMACHINE_FORWARD_PORT&quot; | egrep &quot;^[1-9][0-9]{0,4}$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;NOMACHINE_FORWARD_PORT=$NOMACHINE_FORWARD_PORT\&quot;&quot;
-	
-	# Services directives
-	
-	[ -z $(echo &quot;$ENABLE_ESD_PRELOAD&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;ENABLE_ESD_PRELOAD=$ENABLE_ESD_PRELOAD\&quot;&quot;
-	[ &quot;$ENABLE_ESD_PRELOAD&quot; = &quot;1&quot; ] &amp;&amp; ! which &quot;$ESD_BIN_PRELOAD&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: Invalid value \&quot;ESD_BIN_PRELOAD=$ESD_BIN_PRELOAD\&quot;&quot; \
-					  &amp;&amp; echo &quot;         No esd preload will be performed.&quot;
-	
-	[ -z $(echo &quot;$ENABLE_ARTSD_PRELOAD&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;ENABLE_ARTSD_PRELOAD=$ENABLE_ARTSD_PRELOAD\&quot;&quot;
-	[ &quot;$ARTSD_BIN_PRELOAD&quot; = &quot;1&quot; ] &amp;&amp; ! which &quot;$ARTSD_BIN_PRELOAD&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: Invalid value \&quot;ARTSD_BIN_PRELOAD=$ARTSD_BIN_PRELOAD\&quot;&quot; \
-					  &amp;&amp; echo &quot;         No arts preload will be performed.&quot;
-	
-	[ -z $(echo &quot;$ENABLE_KDE_CUPS&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;ENABLE_KDE_CUPS=$ENABLE_KDE_CUPS\&quot;&quot;
-	[ &quot;$ENABLE_KDE_CUPS&quot; = &quot;1&quot; -a ! -e &quot;$KDE_PRINTRC&quot; ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;KDE_PRINTRC=$KDE_PRINTRC\&quot;&quot;
-
-
-	[ &quot;$ENABLE_FOOMATIC&quot; = &quot;1&quot; ] &amp;&amp; ! which &quot;$COMMAND_FOOMATIC&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: Invalid value \&quot;COMMAND_FOOMATIC=$COMMAND_FOOMATIC\&quot;&quot; \
-					  &amp;&amp; echo &quot;         Users will not be able to use foomatic.&quot;
-	[ ! -x &quot;$CUPS_IPP_BACKEND&quot; ] &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: \&quot;$CUPS_IPP_BACKEND\&quot; is not executable.&quot; \
-					  &amp;&amp; echo &quot;         Users will not be able to enable printing.&quot;
-	[ ! -x &quot;$CUPS_BACKEND/smb&quot; ] &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: \&quot;$CUPS_BACKEND/smb\&quot; is not executable.&quot; \
-					  &amp;&amp; echo &quot;         Users will not be able to enable printing.&quot;
-	[ ! -e &quot;$CUPS_ETC/mime.types&quot; -o ! -e &quot;$CUPS_ETC/mime.convs&quot; ] &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: Invalid value \&quot;CUPS_ETC=$CUPS_ETC\&quot;&quot; \
-					  &amp;&amp; echo &quot;         Users will not be able to enable printing.&quot;
-	
-	# Path directives
-	
-	[ ! -d &quot;$USER_FAKE_HOME&quot; ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;USER_FAKE_HOME=$USER_FAKE_HOME\&quot;&quot;
-	[ -z $(echo &quot;$SET_LD_LIBRARY_PATH&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;SET_LD_LIBRARY_PATH=$SET_LD_LIBRARY_PATH\&quot;&quot;
-	
-	[ &quot;$DEFAULT_X_WM&quot; != &quot;&quot; ] &amp;&amp; ! which &quot;$DEFAULT_X_WM&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;DEFAULT_X_WM=$DEFAULT_X_WM\&quot;&quot;
-	[ &quot;$DEFAULT_X_WM&quot; != &quot;&quot; -a  -z $(echo &quot;$KILL_DEFAULT_X_WM&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;KILL_DEFAULT_X_WM=$KILL_DEFAULT_X_WM\&quot;&quot;
-	[ -z &quot;$USER_X_STARTUP_SCRIPT&quot; ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;USER_X_STARTUP_SCRIPT=$USER_X_STARTUP_SCRIPT\&quot;&quot;
-	! which &quot;$DEFAULT_X_SESSION&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: Invalid value \&quot;DEFAULT_X_SESSION=$DEFAULT_X_SESSION\&quot;&quot; \
-					  &amp;&amp; echo &quot;         Users might not be able to request a default X session.&quot;
-	! which &quot;$COMMAND_START_KDE&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: Invalid value \&quot;COMMAND_START_KDE=$COMMAND_START_KDE\&quot;&quot; \
-					  &amp;&amp; echo &quot;         Users will not be able to request a KDE session.&quot;
-	! which &quot;$COMMAND_START_GNOME&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: Invalid value \&quot;COMMAND_START_GNOME=$COMMAND_START_GNOME\&quot;&quot; \
-					  &amp;&amp; echo &quot;         Users will not be able to request a Gnome session.&quot;
-	! which &quot;$COMMAND_START_CDE&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: Invalid value \&quot;COMMAND_START_CDE=$COMMAND_START_CDE\&quot;&quot; \
-					  &amp;&amp; echo &quot;         Users will not be able to request a CDE session.&quot;
-	! which &quot;$COMMAND_XTERM&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: Invalid value \&quot;COMMAND_XTERM=$COMMAND_XTERM\&quot;&quot; \
-					  &amp;&amp; echo &quot;         Users will not be able to request an xterm session.&quot;
-	! which &quot;$COMMAND_XAUTH&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;COMMAND_XAUTH=$COMMAND_XAUTH\&quot;&quot;
-	! which &quot;$COMMAND_SMBMOUNT&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: Invalid value \&quot;COMMAND_SMBMOUNT=$COMMAND_SMBMOUNT\&quot;. You'll not be able to use SAMBA. &quot;
-	! which &quot;$COMMAND_SMBUMOUNT&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: Invalid value \&quot;COMMAND_SMBUMOUNT=$COMMAND_SMBUMOUNT\&quot;. You'll not be able to use SAMBA.&quot;
-	! which &quot;$COMMAND_NETCAT&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;COMMAND_NETCAT=$COMMAND_NETCAT\&quot;&quot;
-	! which &quot;$COMMAND_SSH&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;COMMAND_SSH=$COMMAND_SSH\&quot;&quot;
-	! which &quot;$COMMAND_SSH_KEYGEN&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;COMMAND_SSH_KEYGEN=$COMMAND_SSH_KEYGEN\&quot;&quot;
-	! which &quot;$COMMAND_CUPSD&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: Invalid value \&quot;COMMAND_CUPSD=$COMMAND_CUPSD\&quot;&quot; \
-					  &amp;&amp; echo &quot;         Users will not be able to enable printing.&quot;
-	[ -z &quot;$(strings $COMMAND_CUPSD | egrep 'CUPS\/1.2')&quot; ] &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: Invalid cupsd version of \&quot;$COMMAND_CUPSD\&quot;. Need version 1.2.&quot; \
-					  &amp;&amp; echo &quot;         Users will not be able to enable printing.&quot;
-	! which &quot;$COMMAND_MD5SUM&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;COMMAND_MD5SUM=$COMMAND_MD5SUM\&quot;&quot;
-
-	# Check for expect
-	COMMAND_EXPECT=$(head -n1 $PATH_BIN/nxnode-login | cut -d'!' -f2)
-	! which &quot;$COMMAND_EXPECT&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: expect necessary for $PATH_BIN/nxnode-login could not be found in '$COMMAND_EXPECT'. Please install it or change nxnode-login accordingly.&quot;
-
-	# Misc directives
-	
-	[ -z $(echo &quot;$ENABLE_AUTORECONNECT&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;ENABLE_AUTORECONNECT=$ENABLE_AUTORECONNECT\&quot;&quot;
-	[ -z $(echo &quot;$ENABLE_AUTORECONNECT_BEFORE_140&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;ENABLE_AUTORECONNECT_BEFORE_140=$ENABLE_AUTORECONNECT_BEFORE_140\&quot;&quot;
-	
-	[ -z $(echo &quot;$EXPORT_USERIP&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;EXPORT_USERIP=$EXPORT_USERIP\&quot;&quot;
-	[ -z $(echo &quot;$EXPORT_SESSIONID&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;EXPORT_SESSIONID=$EXPORT_SESSIONID\&quot;&quot;
-	[ -n &quot;$NODE_AUTOSTART&quot; ] &amp;&amp; ! which &quot;$NODE_AUTOSTART&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: Invalid value \&quot;NODE_AUTOSTART=$NODE_AUTOSTART\&quot;&quot; \
-					  &amp;&amp; echo &quot;         No autostart will be performed.&quot;
-
-	[ -z $(echo &quot;$ENABLE_ROOTLESS_MODE&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;ENABLE_ROOTLESS_MODE=$ENABLE_ROOTLESS_MODE\&quot;&quot;
-
-	[ -z &quot;$(strings $PATH_BIN/nxagent | egrep 'NXAGENT - Version 1.5.0|NXAGENT - Version 2.[01].0')&quot; ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Could not find 1.5.0 or 2.[01].0 version string in nxagent. NX 1.5.0 or 2.[01].0 backend is needed for this version of FreeNX.&quot;
-		
-	[ -z $(echo &quot;$ENABLE_USESSION&quot; | egrep &quot;^[0|1]$&quot;) ] &amp;&amp; \
-		ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;ENABLE_USESSION=$ENABLE_USESSION\&quot;&quot;
-	[ &quot;$ENABLE_USESSION&quot; = &quot;1&quot; ] &amp;&amp; ! which &quot;$COMMAND_SESSREG&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; \
-		WARNING=&quot;yes&quot; &amp;&amp; echo &quot;Warning: Invalid value \&quot;COMMAND_SESSREG=$COMMAND_SESSREG\&quot;&quot; \
-					  &amp;&amp; echo &quot;         Logged in users will not be registered with sessreg.&quot;
-	
-	#AGENT_EXTRA_OPTIONS_RFB=&quot;&quot;
-	#AGENT_EXTRA_OPTIONS_RDP=&quot;&quot;
-	#AGENT_EXTRA_OPTIONS_X=&quot;&quot;
-	#PROXY_EXTRA_OPTIONS=&quot;&quot;
-		#Can these be checked???
-	
-	#AGENT_FONT_SERVER=&quot;&quot;
-		#Any ideas on how I can check for a VALID host is velcome!
-	
-	#[ -z $(echo &quot;$PROXY_TCP_NODELAY&quot; | egrep &quot;^[|0|1]$&quot;) ] &amp;&amp; \
-	#	ERROR=&quot;yes&quot; &amp;&amp; echo &quot;Error: Invalid value \&quot;PROXY_TCP_NODELAY=$PROXY_TCP_NODELAY\&quot;&quot;
-	
-	
-	if [ &quot;$ERROR&quot; = &quot;yes&quot; ]
-	then
-		echo
-		echo &quot;  Errors occured during config check.&quot;
-		echo &quot;  Please correct the configuration file.&quot;
-		echo
-		[ &quot;$NXLCFG_IGNORE_ERRORS&quot; = &quot;no&quot; ] &amp;&amp; exit 1 || exit 0
-	elif [ &quot;$WARNING&quot; = &quot;yes&quot; ]
-	then
-		echo
-		echo &quot;  Warnings occured during config check.&quot;
-		echo &quot;  To enable these features please correct the configuration file.&quot;
-		echo
-	fi
-fi

Copied: freenx-server/tags/FreeNX-0.7.1/nxloadconfig (from rev 402, freenx-server/trunk/nxloadconfig)

Deleted: freenx-server/tags/FreeNX-0.7.1/nxnode
===================================================================
--- freenx-server/trunk/nxnode	2007-05-29 15:27:07 UTC (rev 334)
+++ freenx-server/tags/FreeNX-0.7.1/nxnode	2007-10-14 22:25:14 UTC (rev 405)
@@ -1,1356 +0,0 @@
-#!/bin/bash
-
-# Free implementation of nxserver components
-#
-# nxnode does accept (for now):
-# 
-#	--startsession
-#	--terminate
-#	--smbmount 
-#		(smbmount is not implemented yet)
-#
-# Copyright (c) 2004 by Fabian Franz.
-#
-# License: GNU GPL, version 2
-#
-# SVN: $Id$
-#
-# 21.06.2004: - Full reconnection support
-
-# Read the config file
-. $(PATH=$(cd $(dirname $0) &amp;&amp; pwd):$PATH which nxloadconfig) --userconf
-
-#
-# -----------------------------------------------------------------------------
-# Startup of nxnode
-# -----------------------------------------------------------------------------
-#
-
-echo &quot;NX&gt; 1000 NXNODE - Version $NX_VERSION $NX_LICENSE&quot;
-
-if [ &quot;$1&quot; != &quot;--check&quot; -a &quot;$1&quot; != &quot;--setkey&quot; -a &quot;$1&quot; != &quot;--agent&quot; -a &quot;$1&quot; != &quot;--slave&quot; ]
-then 
-	read CMDLINE
-
-	CMDLINE=&quot;a=b&amp;$CMDLINE&quot;
-fi
-
-#
-# -----------------------------------------------------------------------------
-# Various helper functions
-# -----------------------------------------------------------------------------
-#
-
-stringinstring()
-{
-	case &quot;$2&quot; in
-		*$1*)
-			return 0
-		;;
-	esac
-	
-	return 1
-}
-
-getparam()
-{
-	stringinstring &quot;&amp;$1=&quot; &quot;$CMDLINE&quot; || return 1
-	
-	echo &quot;$CMDLINE&quot; |  tr &quot;&amp;&quot; &quot;\n&quot; | egrep &quot;^&quot;$1&quot;=&quot; | awk -F= '{ VAL=$2 } END { print VAL }'
-	
-	return 0
-}
-
-find_app()
-{
-	set -- $*
-	which $1 2&gt;/dev/null
-}
-
-getparam_sessionid()
-{
-	sessionid=$(getparam sessionid)
-	
-	[ -n &quot;$sessionid&quot; ] || sessionid=$(getparam session_id)
-	if [ -z &quot;$sessionid&quot; ]
-	then
-		echo &quot;NX&gt; 500 Error: Fatal - Missing parameter session id.&quot; 1&gt;&amp;2
-		exit 1
-	fi
-	
-	echo $sessionid
-}
-
-#
-# -----------------------------------------------------------------------------
-# Node functions module
-# -----------------------------------------------------------------------------
-#
-
-#
-# node_terminate_agent &lt;session id&gt;
-#
-
-node_terminate_agent()
-{
-	NODE_AGENT_PID=$(cat &quot;$USER_FAKE_HOME/.nx/C-$1/pids/agent&quot; 2&gt;/dev/null)
-	[ -n &quot;$NODE_AGENT_PID&quot; ] &amp;&amp; kill $NODE_AGENT_PID 2&gt;/dev/null
-}
-
-#
-# node_terminate_session &lt;session id&gt;
-#
-#	Used local vars: $virtualdesktop, $rootless
-#
-#	Used config vars: $COMMAND_XAUTH, $SESSION_LOG_CLEAN
-#
-
-node_terminate_session()
-{
-	#
-	# Cleanup session
-	#
-
-	[ -d &quot;$USER_FAKE_HOME/.nx/C-$1/&quot; ] || return
-
-	# Kill nxagent
-	
-	NODE_AGENT_PID=$(cat &quot;$USER_FAKE_HOME/.nx/C-$1/pids/agent&quot; 2&gt;/dev/null)
-	
-	if [ -n &quot;$NODE_AGENT_PID&quot; ]
-	then
-		kill $NODE_AGENT_PID 2&gt;/dev/null
-		if ! [ &quot;$virtualdesktop&quot; = &quot;0&quot; -a &quot;$rootless&quot; != &quot;1&quot; ]
-		then
-			sleep 1
-			kill -0 $NODE_AGENT_PID 2&gt;/dev/null &amp;&amp; kill -9 $NODE_AGENT_PID 2&gt;/dev/null
-		fi
-	fi
-
-	# Kill tail process
-	
-	NODE_TAIL_PID=$(cat &quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/tail&quot; 2&gt;/dev/null)
-	[ -n &quot;$NODE_TAIL_PID&quot; ] &amp;&amp; kill $NODE_TAIL_PID 2&gt;/dev/null
-
-	# Remove display information
-	
-	NODE_DISPLAY=$(echo $1 | rev | cut -d&quot;-&quot; -f2 | rev)
-	rm -f /tmp/.X$NODE_DISPLAY-lock
-	rm -f /tmp/.X11-unix/X$NODE_DISPLAY
-	
-	# Remove magic cookie information
-	
-	$COMMAND_XAUTH -v source &quot;$USER_FAKE_HOME/.nx/C-$1/scripts/authority&quot; &gt;/dev/null 2&gt;&amp;1
-
-	# Preserve or remove session information
-	
-	[ &quot;$SESSION_LOG_CLEAN&quot; = &quot;1&quot; ] &amp;&amp; rm -rf &quot;$USER_FAKE_HOME/.nx/C-$1/&quot;
-	
-	[ &quot;$SESSION_LOG_CLEAN&quot; = &quot;0&quot; -a &quot;$2&quot; = &quot;failed&quot; ] &amp;&amp; mv &quot;$USER_FAKE_HOME/.nx/C-$1/&quot; &quot;$USER_FAKE_HOME/.nx/F-C-$1/&quot;
-	[ &quot;$SESSION_LOG_CLEAN&quot; = &quot;0&quot; -a &quot;$2&quot; != &quot;failed&quot; ] &amp;&amp; mv &quot;$USER_FAKE_HOME/.nx/C-$1/&quot; &quot;$USER_FAKE_HOME/.nx/T-C-$1/&quot;
-}
-
-#
-# node_fail_restore_session &lt;session id&gt;
-#
-
-# TODO: Kill still running tail -f process.
-
-node_fail_restore_session()
-{
-	echo &quot;NX&gt; 1004 Error: Could not resume session. nxagent process could not be found.&quot;
-	
-	NODE_TAIL_PID=$(cat &quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/tail&quot; 2&gt;/dev/null)
-	[ -n &quot;$NODE_TAIL_PID&quot; ] &amp;&amp; kill $NODE_TAIL_PID
-	[ -n &quot;$NODE_TAIL_PID&quot; ] &amp;&amp; echo &quot;NX 1004&gt; kill $NODE_TAIL_PID&quot;
-	
-	node_terminate_session &quot;$1&quot; &quot;failed&quot;
-	exit 1
-}
-
-#
-# node_suspend_session &lt;session id&gt;
-#
-
-node_suspend_session()
-{
-	NODE_AGENT_PID=$(cat &quot;$USER_FAKE_HOME/.nx/C-$1/pids/agent&quot; 2&gt;/dev/null)
-
-	if [ -n &quot;$NODE_AGENT_PID&quot; ]
-	then
-		kill -0 $NODE_AGENT_PID || return 1
-		kill -HUP $NODE_AGENT_PID &amp;&amp; return 0
-	fi
-
-	return 1
-}
-
-#
-# node_find_application &lt;type&gt;
-#
-#	Used config vars: $COMMAND_START_KDE, $COMMAND_START_GNOME,
-#			  $COMMAND_START_CDE, $COMMAND_XTERM, $USER_X_STARTUP_SCRIPT,
-#			  $DEFAULT_X_SESSION
-
-node_find_application()
-{
-	NODE_STARTX=&quot;&quot;
-
-	case $1 in
-		unix-kde)
-			NODE_STARTX=$COMMAND_START_KDE
-		;;
-		unix-gnome)
-			NODE_STARTX=$COMMAND_START_GNOME
-		;;
-		unix-cde)
-			NODE_STARTX=$COMMAND_START_CDE
-		;;
-		unix-application)
-			[ &quot;$application&quot; = &quot;xterm&quot; ] &amp;&amp; application=&quot;$COMMAND_XTERM&quot;
-			NODE_STARTX=$application
-		;;
-		unix-default)
-			if [ -x &quot;$HOME/$USER_X_STARTUP_SCRIPT&quot; ]; then
-				NODE_STARTX=&quot;$HOME/$USER_X_STARTUP_SCRIPT&quot;
-			elif which &quot;$DEFAULT_X_SESSION&quot; &gt;/dev/null 2&gt;&amp;1 ; then
-				NODE_STARTX=&quot;$DEFAULT_X_SESSION&quot;
-			fi
-		;;
-	esac
-
-	echo &quot;$NODE_STARTX&quot;
-}
-
-#
-# node_start_applications
-#
-#	Used local vars: $type, $application, $sess_id, $mediahelper,
-#		         $virtualdesktop, $rootless, $display
-#
-#	Used config vars: &lt;several&gt;
-#
-
-node_start_applications()
-{
-	# close input and output file descriptors
-	exec 0&lt;&amp;-
-	exec 1&gt;&amp;-
-	exec 2&gt;&amp;-
-
-	#
-	# Prepare application startup
-	#
-	
-	. /etc/profile
-	[ -f ~/.bash_profile ] &amp;&amp; . ~/.bash_profile
-
-	mkdir -p &quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/&quot;
-
-	#
-	# Which application do we start?
-	#
-
-	NODE_APPLICATION=$(node_find_application &quot;$type&quot;)
-	
-	# For rdesktop/VNC, there is no application to start
-	[ -n &quot;$NODE_APPLICATION&quot; ] || return
-
-	#
-	# Check if we want to use a mediahelper
-	#
-
-	if [ &quot;$mediahelper&quot; = &quot;esd&quot; ]
-	then
-		# Set Espeaker variable
-		let ESPEAKER=$display+7000
-		export ESPEAKER=&quot;127.0.0.1:$ESPEAKER&quot;
-		
-		# Do not spawn new ESD daemons
-		export ESD_NO_SPAWN=&quot;yes&quot;
-			
-		# Check for config file directive
-		if [ &quot;$ENABLE_ESD_PRELOAD&quot; = &quot;1&quot; -a -x &quot;$(find_app $ESD_BIN_PRELOAD)&quot; ]
-		then
-			NODE_APPLICATION=&quot;$ESD_BIN_PRELOAD $NODE_APPLICATION&quot;
-			echo &quot;Info: NXNODE - Using $ESD_BIN_PRELOAD wrapper script.&quot; &gt;&gt; &quot;$USER_FAKE_HOME/.nx/C-$sess_id/session&quot;
-		fi
-	elif [ &quot;$mediahelper&quot; = &quot;artsd&quot; ]
-	then
-		# Overwrite users mcoprc
-		echo -n &quot;GlobalComm=Arts::X11GlobalComm&quot; &gt; $HOME/.mcoprc
-		if [ &quot;$ENABLE_ARTSD_PRELOAD&quot; = &quot;1&quot; -a -x &quot;$(find_app $ARTSD_BIN_PRELOAD)&quot; ]
-		then
-			NODE_APPLICATION=&quot;$ARTSD_BIN_PRELOAD $NODE_APPLICATION&quot;
-			echo &quot;Info: NXNODE - Using $ARTSD_BIN_PRELOAD wrapper script.&quot; &gt;&gt; &quot;$USER_FAKE_HOME/.nx/C-$sess_id/session&quot;
-		fi
-	fi
-
-	[ &quot;$cups&quot; = &quot;1&quot; -a &quot;$ENABLE_CUPS_SERVER_EXPORT&quot; = &quot;1&quot; ] &amp;&amp; export CUPS_SERVER=&quot;$USER_FAKE_HOME/.nx/C-$sess_id/cups/cups.sock&quot;
-
-	#
-	# Do we need to PRELOAD any libraries?
-	#	
-
-	[ &quot;$virtualdesktop&quot; = &quot;0&quot; -a &quot;$rootless&quot; != &quot;1&quot; ] &amp;&amp; export LD_PRELOAD=&quot;$APPLICATION_LIBRARY_PRELOAD:$LD_PRELOAD&quot;
-
-	#
-	# Should we start a window manager?
-	#
-	
-	if [ &quot;$virtualdesktop&quot; = &quot;1&quot; -a &quot;$type&quot; = &quot;unix-application&quot; -a &quot;$DEFAULT_X_WM&quot; != &quot;&quot; -a -x &quot;$(find_app $DEFAULT_X_WM)&quot; ]
-	then
-		DISPLAY=unix:$display $DEFAULT_X_WM &gt;&gt;&quot;$USER_FAKE_HOME/.nx/C-$sess_id/session&quot; 2&gt;&amp;1 &amp;
-		NODE_WM_PID=$!
-	fi
-
-	#
-	# Startup the application
-	#
-	
-	DISPLAY=unix:$display $NODE_APPLICATION &gt;&gt;&quot;$USER_FAKE_HOME/.nx/C-$sess_id/session&quot; 2&gt;&amp;1 &amp;
-	NODE_APP_PID=$!
-	
-	mkdir -p &quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/&quot;
-	echo &quot;$NODE_APP_PID&quot; &gt;&quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/applications&quot;
-	wait $NODE_APP_PID
-
-	#
-	# Kill or wait for the started window manager
-	#	
-	
-	if [ -n &quot;$NODE_WM_PID&quot; ]
-	then
-		# kill the WM after application is finished?
-		[ &quot;$KILL_DEFAULT_X_WM&quot; = &quot;1&quot; ] &amp;&amp; kill $NODE_WM_PID 2&gt;/dev/null
-		# or just wait until it finishes?
-		[ &quot;$KILL_DEFAULT_X_WM&quot; = &quot;1&quot; ] || wait $NODE_WM_PID
-	fi
-	rm -f &quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/applications&quot;
-
-	# Do not terminate agent in case of rootless agent mode.
-	# The agent times out after a while by itself anyway.
-	
-	[ &quot;$virtualdesktop&quot; = &quot;1&quot; -o &quot;$rootless&quot; != &quot;1&quot; ] &amp;&amp; node_terminate_agent &quot;$sess_id&quot;
-}
-
-#
-# node_persistent_session
-#
-#	Is the user allowed to run a persistent session?
-#
-
-node_agent_persistent_session()
-{
-	P=&quot;-nopersistent&quot;
-	OLD_IFS=$IFS
-	IFS=&quot;,&quot;
-	[ &quot;$ENABLE_PERSISTENT_SESSION&quot; = &quot;all&quot; ] &amp;&amp; P=&quot;-persistent&quot;
-	[ &quot;$ENABLE_PERSISTENT_SESSION&quot; = &quot;all&quot; ] || for USERNAME in $ENABLE_PERSISTENT_SESSION; do
-		[ &quot;${USERNAME:0:1}&quot; != &quot;@&quot; ] &amp;&amp; [ &quot;$USER&quot; = &quot;$USERNAME&quot; ] &amp;&amp; P=&quot;-persistent&quot; &amp;&amp; break ;
-		[ &quot;${USERNAME:0:1}&quot; = &quot;@&quot; ] &amp;&amp; [ -z $(groups &quot;$USER&quot; | egrep &quot;^${USERNAME:1}:&quot;) ] &amp;&amp; P=&quot;-persistent&quot; &amp;&amp; break ;
-	done
-	for USERNAME in $DISABLE_PERSISTENT_SESSION; do
-		[ &quot;${USERNAME:0:1}&quot; != &quot;@&quot; ] &amp;&amp; [ &quot;$USER&quot; = &quot;$USERNAME&quot; ] &amp;&amp; P=&quot;-nopersistent&quot; &amp;&amp; break ;
-		[ &quot;${USERNAME:0:1}&quot; = &quot;@&quot; ] &amp;&amp; [ -z $(groups &quot;$USER&quot; | egrep &quot;^${USERNAME:1}:&quot;) ] &amp;&amp; P=&quot;-nopersistent&quot; &amp;&amp; break ;
-	done
-	IFS=$OLD_IFS
-	echo &quot;$P&quot;
-}
-
-#
-# node_start_agent
-#
-
-node_start_agent()
-{
-	# Ok, now we do some wicked fd magic.
-	#
-	# first part:
-	#	
-	# nxagent's fd #2 -&gt; fd #3
-	
-	# second part:
-	#
-	# fd #1 -&gt; #4
-	# fd #3 -&gt; #1
-	# tee | node_start_monitor
-
-	# third part
-	# fd #4 -&gt; #1
-
-	# =&gt; all output of nxagent goes to tee | node_start_monitor, while
-	#    leaving all other output flow through like normally.
-	
-	# preparations
-	exec 3&gt;&amp;2
-	exec 4&gt;&amp;1
-
-	{
-	
-	{
-
-	#
-	# Setup environment
-	#
-
-	export DISPLAY=&quot;nx/nx,options=$USER_FAKE_HOME/.nx/C-$sess_id/options:$display&quot;
-	export XAUTHORITY=&quot;$USER_FAKE_HOME/.nx/C-$sess_id/authority&quot;
-	export HOME=&quot;$USER_FAKE_HOME&quot;
-
-	#
-	# Setup optional parameters for nxagent
-	#
-
-	# keyboard
-	
-	K=&quot;&quot;
-	# backwards compatibility
-	[ -n &quot;$keyboard&quot; ] &amp;&amp; K=&quot;-keyboard $keyboard&quot;
-	[ -n &quot;$kbtype&quot; ] &amp;&amp; K=&quot;-kbtype $kbtype&quot;
-
-	# backingstore
-	
-	B=&quot;&quot;
-	if [ -n &quot;$backingstore&quot; -a &quot;$ENABLE_2_0_0_BACKEND&quot; != &quot;1&quot; ]
-	then
-		[ &quot;$backingstore&quot; != 1 ] &amp;&amp; B=&quot;-bs $backingstore&quot;
-		[ &quot;$backingstore&quot; = 1 ] &amp;&amp; B=&quot;+bs&quot;
-	fi
-
-	# geometry
-	
-	G=&quot;&quot;
-	[ -n &quot;$geometry&quot; ] &amp;&amp; G=&quot;-geometry $geometry&quot;
-
-	# type of session
-	
-	R=&quot;-D&quot;
-	[ &quot;$rootless&quot; = &quot;1&quot; ] &amp;&amp; R=&quot;-R&quot;
-
-	# Setup fullscreen parameters
-	
-	vncfullscreen=&quot;&quot;
-	[ &quot;$geometry&quot; = &quot;fullscreen&quot; -a &quot;$type&quot; = &quot;vnc&quot; ] &amp;&amp; vncfullscreen=&quot;-fullscreen&quot; &amp;&amp; G=&quot;&quot;
-	
-	[ &quot;$geometry&quot; = &quot;fullscreen&quot; -a &quot;$type&quot; = &quot;windows&quot; ] &amp;&amp; G=&quot;-geometry `echo $screeninfo | cut -d&quot;x&quot; -f1,2`&quot;
-
-	#
-	# Start the wanted nxagent
-	#
-
-	if [ &quot;$type&quot; = &quot;windows&quot; ]
-	then
-		# nxdesktop session (Windows RDP)
-
-		[ &quot;$SET_LD_LIBRARY_PATH&quot; = &quot;1&quot; ] &amp;&amp; export LD_LIBRARY_PATH=&quot;$AGENT_LIBRARY_PATH:$LD_LIBRARY_PATH&quot;
-		# Setup optional parameters
-		
-		U=&quot;&quot;
-		P=&quot;&quot;
-		D=&quot;&quot;
-		[ -n &quot;$agent_user&quot; ] &amp;&amp; U=&quot;-u $agent_user&quot;
-		[ -n &quot;$agent_password&quot; ] &amp;&amp; P=&quot;-p -&quot;
-		[ -n &quot;$agent_domain&quot; ] &amp;&amp; D=&quot;-d $agent_domain&quot;
-
-		# Start the agent
-		
-		echo &quot;$agent_password&quot; | $PATH_BIN/nxdesktop -name &quot;NX - $user@$SERVER_NAME:$display - $session (GPL Edition)&quot; -option &quot;$USER_FAKE_HOME/.nx/C-$sess_id/options&quot; $K $G $U $P $D $agent_server $AGENT_EXTRA_OPTIONS_RDP 2&gt;&amp;3 &amp;
-
-	elif [ &quot;$type&quot; = &quot;vnc&quot; ]
-	then
-		# nxviewer session (VNC RFP)
-		
-		[ &quot;$SET_LD_LIBRARY_PATH&quot; = &quot;1&quot; ] &amp;&amp; export LD_LIBRARY_PATH=&quot;$AGENT_LIBRARY_PATH:$LD_LIBRARY_PATH&quot;
-		# Setup password
-		
-		mkdir -p &quot;$USER_FAKE_HOME/.nx/C-$sess_id/scripts/&quot;
-		echo &quot;$agent_password&quot; | $PATH_BIN/nxpasswd &quot;$USER_FAKE_HOME/.nx/C-$sess_id/scripts/.passwd&quot; doit
-		
-		# Start the agent
-		
-		$PATH_BIN/nxviewer -encodings tight hextile copyrect raw -passwd $USER_FAKE_HOME/.nx/C-$sess_id/scripts/.passwd -name &quot;NX - $user@$SERVER_NAME:$display - $session (GPL Edition)&quot; -option &quot;$USER_FAKE_HOME/.nx/C-$sess_id/options&quot; $vncfullscreen $G $K $agent_server $AGENT_EXTRA_OPTIONS_RFB 2&gt;&amp;3 &amp;
-
-	elif [ &quot;$R&quot; = &quot;-R&quot; -a &quot;$rootless&quot; != &quot;1&quot; ]
-	then
-		# nxproxy single application mode session
-		[ &quot;$SET_LD_LIBRARY_PATH&quot; = &quot;1&quot; ] &amp;&amp; export LD_LIBRARY_PATH=&quot;$PROXY_LIBRARY_PATH:$LD_LIBRARY_PATH&quot;
-		$PATH_BIN/nxproxy -C :$display $PROXY_EXTRA_OPTIONS 2&gt;&amp;3 &amp;
-	else
-		# nxagent session (X11)
-		[ &quot;$SET_LD_LIBRARY_PATH&quot; = &quot;1&quot; ] &amp;&amp; export LD_LIBRARY_PATH=&quot;$AGENT_LIBRARY_PATH:$LD_LIBRARY_PATH&quot;
-		
-		# Setup optional parameters
-
-		P=$(node_agent_persistent_session)
-		FP=&quot;&quot;
-		[ -n &quot;$AGENT_FONT_SERVER&quot; ] &amp;&amp; FP=&quot;-fp $AGENT_FONT_SERVER&quot;
-		
-		# Start the agent
-		
-		PATH=&quot;$PATH_BIN:$PATH&quot; $PATH_BIN/nxagent $P $R -name &quot;NX - $user@$SERVER_NAME:$display - $session (GPL Edition)&quot; -option &quot;$USER_FAKE_HOME/.nx/C-$sess_id/options&quot; $K $G $B $FP $AGENT_EXTRA_OPTIONS_X :$display 2&gt;&amp;3 &amp;
-	fi
-	
-	#
-	# Wait for the agent
-	#
-	
-	NODE_AGENT_PID=$!
-	mkdir -p &quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/&quot;
-	echo &quot;$NODE_AGENT_PID&quot; &gt;&quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/agent&quot;
-	wait $NODE_AGENT_PID
-
-	NODE_AGENT_EXIT_STATUS=$?
-	NODE_FAILED=&quot;&quot;
-	if [ $NODE_AGENT_EXIT_STATUS -ne 0 ]
-	then
-		echo &quot;NX&gt; 1004 Error: NX Agent exited with exit status 1. To troubleshoot set SESSION_LOG_CLEAN=0 in node.conf and investigate \&quot;$USER_FAKE_HOME/.nx/F-C-$sess_id/session\&quot;. You might also want to try: ssh -X myserver; $PATH_BIN/nxnode --agent to test the basic functionality. Session log follows:&quot;
-		cat &quot;$USER_FAKE_HOME/.nx/C-$sess_id/session&quot; 1&gt;&amp;2
-		NODE_FAILED=&quot;failed&quot;
-	fi
-	echo &quot;NX&gt; 1006 Session status: closed&quot;
-	
-	#
-	# Cleanup session information
-	#	
-	
-	rm -f &quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/agent&quot;
-	node_terminate_session &quot;$sess_id&quot; &quot;$NODE_FAILED&quot;
-	
-	# remove possible leftovers of nxagent
-	rm -f /tmp/.X$display-lock
-	rm -f /tmp/.X11-unix/X$display
-	} 3&gt;&amp;1 1&gt;&amp;4 | tee &quot;$USER_FAKE_HOME/.nx/C-$sess_id/session&quot; | node_start_monitor; } 4&gt;&amp;1
-}
-
-#
-# node_cupsd_stop
-#
-#	Used local vars: $sess_id
-#
-
-node_cupsd_stop()
-{
-	#
-	# Cleanup userspace cups daemon	
-	#
-	
-	[ -e &quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/cupsd&quot; ] || return
-	
-	NODE_CUPSD_PID=$(cat &quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/cupsd&quot;)
-	
-	# Check for a running userspace cupsd, look if its still active 
-	# and kill it if so
-	( [ -n &quot;$NODE_CUPSD_PID&quot; ] &amp;&amp; kill -0 $NODE_CUPSD_PID &amp;&amp; kill $NODE_CUPSD_PID &amp;&amp; sleep 2 &amp;&amp; kill -0 $NODE_CUPSD_PID &amp;&amp; kill -9 $NODE_CUPSD_PID ) 2&gt;/dev/null
-	
-	# delete pid file
-	rm -f &quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/cupsd&quot;
-	
-	# remove all printers
-	echo &gt;&quot;$USER_FAKE_HOME/.nx/C-$sess_id/cups/printers.conf&quot;
-}
-
-#
-# node_cupsd_setup
-#
-#	Used local vars: $sess_id, $display
-#
-
-node_cupsd_setup()
-{
-	let NODE_CUPSD_PORT=$display+9000 # offset 9000 for userspace cupsd's
-	export NODE_CUPSD_PORT
-	
-	export NODE_CUPSD_SOCKET=&quot;$USER_FAKE_HOME/.nx/C-$sess_id/cups/cups.sock&quot;
-	
-	mkdir -p &quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/&quot;
-	[ -e &quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/cupsd&quot; ] &amp;&amp; return
-	touch &quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/cupsd&quot;
-	
-	mkdir -p &quot;$USER_FAKE_HOME/.nx/C-$sess_id/cups/spool/tmp&quot; &quot;$USER_FAKE_HOME/.nx/C-$sess_id/cups/spool/certs&quot; &quot;$USER_FAKE_HOME/.nx/C-$sess_id/cups/ppd&quot; &quot;$USER_FAKE_HOME/.nx/C-$sess_id/cups/cache&quot;
-
-cat &lt;&lt;EOF &gt; $USER_FAKE_HOME/.nx/C-$sess_id/cups/cupsd.conf
-AccessLog /dev/null
-ErrorLog error_log
-PageLog page_log
-LogLevel info
-TempDir $USER_FAKE_HOME/.nx/C-$sess_id/cups/spool/tmp
-RequestRoot $USER_FAKE_HOME/.nx/C-$sess_id/cups/spool
-ServerRoot $USER_FAKE_HOME/.nx/C-$sess_id/cups/
-StateDir $USER_FAKE_HOME/.nx/C-$sess_id/cups/
-CacheDir $USER_FAKE_HOME/.nx/C-$sess_id/cups/cache
-
-Listen $NODE_CUPSD_SOCKET
-Browsing Off
-ServerName localhost
-PidFile $USER_FAKE_HOME/.nx/C-$sess_id/pids/cupsd
-
-&lt;Location /&gt;
-Order Deny,Allow
-Deny From All
-Allow from 127.0.0.1
-&lt;/Location&gt;
-
-# Allow everything for anonymous, because we are protected through UNIX socket
-&lt;Policy default&gt;
-  &lt;Limit All&gt;
-    AuthType None
-    Order deny,allow
-  &lt;/Limit&gt;
-&lt;/Policy&gt;
-EOF
-
-	touch &quot;$USER_FAKE_HOME/.nx/C-$sess_id/cups/printers.conf&quot; &quot;$USER_FAKE_HOME/.nx/C-$sess_id/cups/classes.conf&quot;
-
-	# copy mime.* files
-	cp -af &quot;$CUPS_ETC&quot;/mime.* &quot;$USER_FAKE_HOME/.nx/C-$sess_id/cups/&quot;
-
-	# start cupsd
-	$COMMAND_CUPSD -c &quot;$USER_FAKE_HOME/.nx/C-$sess_id/cups/cupsd.conf&quot; &amp;&gt;/dev/null &lt;/dev/null
-
-	# setup KDE
-	if [ &quot;$ENABLE_KDE_CUPS&quot; = &quot;1&quot; -a -e &quot;$KDE_PRINTRC&quot; ]
-	then
-		if egrep -q &quot;^Host=&quot; &quot;$KDE_PRINTRC&quot;
-		then
-			[ &quot;$ENABLE_KDE_CUPS_DYNAMIC&quot; = &quot;1&quot; ] &amp;&amp; perl -pi -e 's,^Host=.*,Host[\$ie]=\$\('&quot;$PATH_BIN/nxcups-gethost&quot;'),g' &quot;$KDE_PRINTRC&quot;
-			[ &quot;$ENABLE_KDE_CUPS_DYNAMIC&quot; != &quot;1&quot; ] &amp;&amp; perl -pi -e 's,^Host=.*,Host='&quot;$NODE_CUPSD_SOCKET&quot;',g' &quot;$KDE_PRINTRC&quot;
-		else
-			echo &quot;[CUPS]&quot; &gt;&gt; &quot;$KDE_PRINTRC&quot;
-			[ &quot;$ENABLE_KDE_CUPS_DYNAMIC&quot; = &quot;1&quot; ] &amp;&amp; echo &quot;Host[\$ie]=\$($PATH_BIN/nxcups-gethost)&quot; &gt;&gt; &quot;$KDE_PRINTRC&quot;
-			[ &quot;$ENABLE_KDE_CUPS_DYNAMIC&quot; != &quot;1&quot; ] &amp;&amp; echo &quot;Host=$NODE_CUPSD_SOCKET&quot; &gt;&gt; &quot;$KDE_PRINTRC&quot;
-		fi
-	fi
-}
-
-#
-# node_cupsd_reload
-#
-#	Used local vars: $sess_id
-#
-
-node_cupsd_reload()
-{
-	[ -e &quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/cupsd&quot; ] || return
-	NODE_CUPSD_PID=$(cat &quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/cupsd&quot;)
-	[ -n &quot;$NODE_CUPSD_PID&quot; ] &amp;&amp; kill -0 $NODE_CUPSD_PID &amp;&amp; kill -HUP $NODE_CUPSD_PID
-}
-
-node_cupsd_get_socket()
-{
-	node_cupsd_setup
-	echo $NODE_CUPSD_SOCKET
-}
-
-node_umount_smb()
-{
-	[ -e &quot;$USER_FAKE_HOME/.nx/C-$sess_id/scripts/mpoint&quot; ] || return
-	cat &quot;$USER_FAKE_HOME/.nx/C-$sess_id/scripts/mpoint&quot; | while read mpoint
-	do
-		$COMMAND_SMBUMOUNT &quot;$mpoint&quot; &gt;/dev/null 2&gt;/dev/null
-	done
-}
-
-node_stop_services()
-{
-	node_umount_smb
-	node_cupsd_stop
-}
-
-node_emergency_exit()
-{
-	# umount shares &amp; stop printers
-	node_stop_services
-
-	# kill the session
-	node_terminate_session &quot;$sess_id&quot; &quot;failed&quot;
-
-	echo &quot;NX&gt; 1004 Error: Emergency exit due to kill signal.&quot;
-}
-
-#
-# Monitoring the nxagent: Its also kind of a &quot;state-machine&quot; 
-#                         as it has to keep track of different 
-#                         connection states and react differently.
-#
-
-node_start_monitor_2_0_0()
-{
-	NODE_TAIL_PID=&quot;&quot;
-	NODE_SUSPEND_STATUS=&quot;$2&quot;
-
-	while read line 
-	do
-		#
-		# Catch tail pid
-		#
-		
-		if stringinstring &quot;Info: tail -f running with pid&quot; &quot;$line&quot;
-		then
-			NODE_TAIL_PID=$(echo $line | cut -d&quot;'&quot; -f2)
-			echo &quot;$NODE_TAIL_PID&quot; &gt;&quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/tail&quot;
-		fi
-
-		#
-		# Catch NXAGENT SMB Port (sometimes the port differs from what we got from nxserver)
-		#
-		
-		if stringinstring &quot;Info: Listening for SMB connections on port&quot; &quot;$line&quot;
-		then
-			SMBMOUNT_PORT=$(echo $line | cut -d&quot;'&quot; -f2)
-			echo &quot;$SMBMOUNT_PORT&quot; &gt;&quot;$USER_FAKE_HOME/.nx/C-$sess_id/scripts/mport&quot;
-		fi
-
-		#
-		# Session messages
-		#
-
-		if stringinstring &quot;Session: Starting session at&quot; &quot;$line&quot;
-		then
-			echo &quot;NX&gt; 1009 Session status: starting&quot;
-		fi
-		
-		if stringinstring &quot;Session: Suspending session at&quot; &quot;$line&quot;
-		then
-			echo &quot;NX&gt; 1009 Session status: suspending&quot;
-		fi
-		
-		if stringinstring &quot;Session: Terminating session at&quot; &quot;$line&quot;
-		then
-			echo &quot;NX&gt; 1009 Session status: terminating&quot;
-		fi
-		
-		if stringinstring &quot;Session: Resuming session at&quot; &quot;$line&quot;
-		then
-			echo &quot;NX&gt; 1009 Session status: resuming&quot;
-		fi
-
-
-		#
-		# Session suspend
-		#
-
-		if stringinstring &quot;Session: Session suspended at&quot; &quot;$line&quot;
-		then
-			echo &quot;NX&gt; 1005 Session status: suspended&quot;
-			# umount shares &amp; stop printers
-
-			if [ &quot;$NODE_SUSPEND_STATUS&quot; = &quot;Running&quot; ]
-			then
-				node_suspend_session &quot;$sess_id&quot;
-				NODE_SUSPEND_STATUS=&quot;&quot;
-			else
-				node_stop_services
-			fi
-		fi
-
-		#
-		# Watchdog termination
-		#
-
-		if stringinstring &quot;Info: Watchdog running with pid&quot; &quot;$line&quot;
-		then
-			NODE_WATCHDOG_PID=$(echo $line | cut -d&quot;'&quot; -f2)
-		fi
-
-		if stringinstring &quot;Info: Waiting the watchdog process to complete.&quot; &quot;$line&quot;
-		then
-			# Kill the watchdog
-			kill $NODE_WATCHDOG_PID 2&gt;/dev/null
-		fi
-		
-		#
-		# Session is running
-		#
-		
-		if stringinstring &quot;Info: Waiting for connection from&quot; &quot;$line&quot;
-		then
-			echo &quot;NX&gt; 710 Session status: running&quot;
-			echo &quot;NX&gt; 1002 Commit&quot;
-			echo &quot;NX&gt; 1006 Session status: running&quot;
-		fi
-
-		#
-		# Reconnection success!
-		#
-		
-		if stringinstring &quot;Session: Session resumed at&quot; &quot;$line&quot;
-		then
-			echo &quot;NX&gt; 718 Session restore succeded&quot;
-			if [ &quot;$1&quot; = &quot;restore&quot; ]
-			then
-				kill $NODE_TAIL_PID
-				break
-			fi
-		fi
-
-		#
-		# Reconnection failure
-		#
-		
-		if stringinstring &quot;Session: Display failure detected at&quot; &quot;$line&quot;
-		then
-			echo &quot;NX&gt; 596 Error: Session $1 failed. Reason was: $line&quot;
-			if [ &quot;$1&quot; = &quot;restore&quot; ]
-			then
-				kill $NODE_TAIL_PID
-				break
-			fi
-		fi
-	done
-	
-	trap &quot;&quot; EXIT
-	
-	[ &quot;$1&quot; = &quot;restore&quot; ] ||	node_stop_services
-	# close all open file descriptors
-	exec 0&lt;&amp;-
-	exec 1&gt;&amp;-
-	exec 2&gt;&amp;-
-	exit 0
-}
-
-node_start_monitor_1_5_0()
-{
-	NODE_RUNNING=0
-	NODE_TAIL_PID=&quot;&quot;
-	NODE_SUSPEND_STATUS=&quot;$2&quot;
-
-	while read line 
-	do
-		#
-		# Catch tail pid
-		#
-		
-		if stringinstring &quot;Info: tail -f running with pid&quot; &quot;$line&quot;
-		then
-			NODE_TAIL_PID=$(echo $line | cut -d&quot;'&quot; -f2)
-			echo &quot;$NODE_TAIL_PID&quot; &gt;&quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/tail&quot;
-		fi
-
-		#
-		# Session suspend
-		#
-
-		if stringinstring &quot;Info: Session suspended.&quot; &quot;$line&quot;
-		then
-			echo &quot;NX&gt; 1005 Session status: suspended&quot;
-			# umount shares &amp; stop printers
-
-			if [ &quot;$NODE_SUSPEND_STATUS&quot; = &quot;Running&quot; ]
-			then
-				node_suspend_session &quot;$sess_id&quot;
-				NODE_SUSPEND_STATUS=&quot;&quot;
-			else
-				node_stop_services
-			fi
-		fi
-
-		#
-		# Proxy termination
-		#
-
-		if stringinstring &quot;Info: Waiting for a further signal to complete.&quot; &quot;$line&quot;
-		then
-			# Kill the proxy
-			kill -HUP $NODE_PROXY_PID 2&gt;/dev/null
-		fi
-		
-		#
-		# Session end
-		#
-		
-		if stringinstring &quot;Info: End of session requested by &quot; &quot;$line&quot; &amp;&amp; [ &quot;$RECONNECT&quot; = &quot;0&quot; ] &amp;&amp; ! stringinstring &quot;'SIGHUP'&quot; &quot;$line&quot;
-		then
-			echo &quot;NX&gt; 1009 Session status: terminating&quot;
-			kill -HUP $NODE_PROXY_PID 2&gt;/dev/null
-		fi
-		
-		#
-		# Session is running
-		#
-		
-		if stringinstring &quot;Info: Waiting for connection from&quot; &quot;$line&quot;
-		then
-			echo &quot;NX&gt; 710 Session status: running&quot;
-			echo &quot;NX&gt; 1002 Commit&quot;
-			echo &quot;NX&gt; 1006 Session status: running&quot;
-		fi
-
-		#
-		# Status = Running - Do _not_ fail anymore.
-		#
-
-		if stringinstring &quot;Info: Connection with remote proxy established.&quot; &quot;$line&quot;
-		then
-			NODE_RUNNING=1
-		fi
-	
-		#
-		# Catch proxy pid
-		#
-		
-		if stringinstring &quot;Info: Proxy running in server mode with pid&quot; &quot;$line&quot;
-		then
-			NODE_PROXY_PID=$(echo $line | cut -d&quot;'&quot; -f2)
-		fi
-		
-		#
-		# Reconnection success!
-		#
-		
-		if stringinstring &quot;Info: Reconnection succeded.&quot; &quot;$line&quot;
-		then
-			echo &quot;NX&gt; 718 Session restore succeded&quot;
-			if [ &quot;$1&quot; = &quot;restore&quot; ]
-			then
-				kill $NODE_TAIL_PID
-				break
-			fi
-		fi
-
-		#
-		# Reconnection failure
-		#
-		
-		if stringinstring &quot;Info: Reconnection failed:&quot; &quot;$line&quot;
-		then
-			echo &quot;NX&gt; 1005 Session status: suspended&quot;
-			echo &quot;NX&gt; 596 Error: Session restore failed. Reason was: $line&quot;
-			if [ &quot;$1&quot; = &quot;restore&quot; ]
-			then
-				kill $NODE_TAIL_PID
-				break
-			fi
-		fi
-	done
-	
-	trap &quot;&quot; EXIT
-
-	[ &quot;$1&quot; = &quot;restore&quot; ] ||	node_stop_services
-	# close all open file descriptors
-	exec 0&lt;&amp;-
-	exec 1&gt;&amp;-
-	exec 2&gt;&amp;-
-	exit 0
-}
-
-#
-# node_start_monitor &lt;start|restore&gt; &lt;Running|Suspended&gt;
-#
-
-node_start_monitor()
-{
-	[ &quot;$ENABLE_2_0_0_BACKEND&quot; = &quot;1&quot; ] &amp;&amp; node_start_monitor_2_0_0 &quot;$@&quot;
-	[ &quot;$ENABLE_2_0_0_BACKEND&quot; = &quot;1&quot; ] || node_start_monitor_1_5_0 &quot;$@&quot;
-}
-
-#
-# -----------------------------------------------------------------------------
-# startsession - Start a new session.
-# -----------------------------------------------------------------------------
-#
-
-startsession()
-{
-
-	# user=knoppix&amp;userip=192.168.1.66&amp;uniqueid=6A8269CC467264EAEF6349D062689755&amp;display=1000&amp;session=lappi%5ffull&amp;type=unix%2dkde&amp;cache=8M&amp;images=32M&amp;cookie=84765070afee043cf83f85d21130145f&amp;link=lan&amp;render=1&amp;backingstore=when_requested&amp;imagecompressionmethod=0&amp;geometry=fullscreen&amp;keyboard=fr&amp;media=0&amp;samba=1&amp;agent_server=&amp;agent_user=&amp;agent_password=
-
-	user=$(getparam user)
-	userip=$(getparam userip)
-	uniqueid=$(getparam uniqueid)
-	display=$(getparam display)
-	session=$(getparam session)
-	type=$(getparam type | sed 's/%2d/-/g')
-	application=$(getparam application)
-	cache=$(getparam cache)
-	images=$(getparam images)
-	cookie=$(getparam cookie)
-	link=$(getparam link)
-	virtualdesktop=$(getparam virtualdesktop)
-	render=$(getparam render)
-	backingstore=$(getparam backingstore)
-	imagecompressionmethod=$(getparam imagecompressionmethod)
-	imagecompressionlevel=$(getparam imagecompressionlevel)
-	geometry=$(getparam geometry)
-	keyboard=$(getparam keyboard)
-	kbtype=$(getparam kbtype)
-	media=$(getparam media)
-	mediahelper=$(getparam mediahelper)
-	sync=$(getparam sync)
-	samba=$(getparam samba)
-	cups=$(getparam cups)
-	agent_server=$(getparam agent_server | sed 's/%3A/:/g')
-	agent_user=$(getparam agent_user)
-	agent_password=$(getparam agent_password)
-	agent_domain=$(getparam agent_domain)
-	screeninfo=$(getparam screeninfo)
-	nodelay=$(getparam nodelay)
-	[ &quot;$PROXY_TCP_NODELAY&quot; = &quot;0&quot; ] &amp;&amp; nodelay=0
-
-	# 1.5.0 options
-	rdpcolors=$(getparam rdpcolors)
-	rdpcache=$(getparam rdpcache)
-	http=$(getparam http)
-	
-	# nxclient &gt; 1.5.0-106 variables
-	resize=$(getparam resize)
-	keybd=$(getparam keybd)
-	kbload=$(getparam kbload)
-	keymap=$(getparam keymap)
-
-	rootless=0
-	# Its still the clients decision
-	[ &quot;$ENABLE_ROOTLESS_MODE&quot; = &quot;1&quot; ] &amp;&amp;  rootless=$(getparam rootless)
-
-	# Rootless fix from 2x nxserver 1.5.0
-	realtype=$type
-	[ &quot;$type&quot; = &quot;unix-application&quot; -o &quot;$type&quot; = &quot;unix-default&quot; ] &amp;&amp; realtype=&quot;unix-desktop&quot;
-	
-	# FreeNX specific variables
-	clientproto=$(getparam clientproto)
-	status=$(getparam status)
-	host=$(getparam host)
-
-	fullscreen=$(getparam fullscreen)
-	[ &quot;$geometry&quot; = &quot;fullscreen&quot; ] &amp;&amp; fullscreen=&quot;1&quot;
-
-	[ &quot;$EXPORT_USERIP&quot; = &quot;1&quot; ] &amp;&amp; export NXUSERIP=&quot;$userip&quot;
-
-	ssl_tunnel=$(getparam encryption)
-	[ -z &quot;$ssl_tunnel&quot; ] &amp;&amp; ssl_tunnel=0
-	
-	if [ &quot;$ssl_tunnel&quot; = &quot;1&quot; ]
-	then
-		# we need to use the IP of the &quot;calling&quot; server now
-		userip=$(echo $SSH_CLIENT $SSH2_CLIENT | cut -d&quot; &quot; -f1 | sed 's/::<A HREF="ffff://g">ffff://g</A>')
-
-		# TODO: This logic is broken ... ;-)
-		[ -z &quot;$userip&quot; ] &amp;&amp; userip=&quot;127.0.0.1&quot;
-		[ -z &quot;$userip&quot; -a &quot;$host&quot; != &quot;127.0.0.1&quot; ] &amp;&amp; userip=&quot;*&quot;
-	fi
-	
-	# ok, lets make the session dir first:
-	
-	sess_id=&quot;$SERVER_NAME-$display-$uniqueid&quot;
-	[ &quot;$EXPORT_SESSIONID&quot; = &quot;1&quot; ] &amp;&amp; export NXSESSIONID=&quot;$sess_id&quot;
-	
-	OLD_UMASK=$(umask)
-	umask 0022
-	mkdir -p $USER_FAKE_HOME
-	umask 0077
-	mkdir -p $USER_FAKE_HOME/.nx/C-$sess_id
-	umask $OLD_UMASK
-	
-	# cache=8M,images=32M,pack=nopack,link=lan,type=unix-kde,cleanup=0,accept=192.168.1.66,cookie=E38A94A77F975443AF04EC911881B120,id=Knoppix-1000-6A8269CC467264EAEF6349D062689755,samba=1,render=1:1000
-	
-	PACK=&quot;&quot;
-	[ -z &quot;$imagecompressionlevel&quot; ] &amp;&amp; imagecompressionlevel=&quot;9&quot;
-	
-	[ &quot;$imagecompressionmethod&quot; = &quot;0&quot; ] &amp;&amp; PACK=&quot;pack=nopack,&quot;
-	[ &quot;$imagecompressionmethod&quot; = &quot;1&quot; ] &amp;&amp; PACK=&quot;pack=16m-jpeg-$imagecompressionlevel,&quot;
-	[ &quot;$imagecompressionmethod&quot; = &quot;2&quot; ] &amp;&amp; PACK=&quot;pack=16m-png-9,&quot;
-	
-	proxy_cookie=$(echo $[$RANDOM*$RANDOM] | $COMMAND_MD5SUM | cut -d&quot; &quot; -f1)
-
-	# all newer clients support fake cookie authentication
-	if [ &quot;$clientproto&quot; != &quot;1.4.0&quot; ]
-	then
-		# enable fake cookie authentication
-		cookie=$proxy_cookie
-	fi
-
-	# write options file
-	[ -z &quot;$samba&quot; ] &amp;&amp; samba=0
-	[ -z &quot;$media&quot; ] &amp;&amp; media=0
-	[ -z &quot;$nodelay&quot; ] &amp;&amp; nodelay=1
-
-	CACHE=&quot;cache=$cache,&quot;
-	[ -z &quot;$cache&quot; ] &amp;&amp; CACHE=&quot;&quot;
-	IMAGES=&quot;images=$images,&quot;
-	[ -z &quot;$images&quot; ] &amp;&amp; IMAGES=&quot;&quot;
-
-	ACCEPT=&quot;accept=$userip,&quot;
-	[ &quot;$userip&quot; = &quot;*&quot; ] &amp;&amp; ACCEPT=&quot;&quot;
-
-	OLD_UMASK=$(umask)
-	umask 0077
-
-cat &lt;&lt; EOF &gt; $USER_FAKE_HOME/.nx/C-$sess_id/options
-${kbtype:+kbtype=$kbtype,}${kbload:+kbload=$kbload,}${keymap:+keymap=$keymap,}${resize:+resize=$resize,}${CACHE}${IMAGES}${PACK}link=$link,nodelay=$nodelay,type=$realtype,cleanup=0,${ACCEPT}cookie=$proxy_cookie,id=$sess_id,samba=$samba,media=$media${sync:+,sync=$sync}${cups:+,cups=$cups}${keybd:+,keybd=$keybd}${http:+,http=$http}${rdpcolors:+,rdpcolors=$rdpcolors}${rdpcache:+,rdpcache=$rdpcache}${fullscreen:+,fullscreen=1}:$display
-EOF
-	umask $OLD_UMASK
-#samba=$samba,
-	#cache=$cache,images=$images,pack=nopack,link=$link,type=$type,cleanup=0,accept=$userip,cookie=$proxy_cookie,id=$sess_id
-#samba=$samba,media=$media,render=$render:$display
-
-	# write xauth script file
-
-$COMMAND_XAUTH &gt;/dev/null 2&gt;&amp;1 &lt;&lt;EOF
-add localhost:$display MIT-MAGIC-COOKIE-1 $cookie
-add unix:$display MIT-MAGIC-COOKIE-1 $cookie
-exit
-EOF
-
-$COMMAND_XAUTH -f &quot;$USER_FAKE_HOME/.nx/C-$sess_id/authority&quot; &gt;/dev/null 2&gt;&amp;1 &lt;&lt;EOF
-add localhost:$display MIT-MAGIC-COOKIE-1 $cookie
-add unix:$display MIT-MAGIC-COOKIE-1 $cookie
-exit
-EOF
-
-	mkdir -m700 $USER_FAKE_HOME/.nx/C-$sess_id/scripts/ 2&gt;/dev/null || chmod 700 $USER_FAKE_HOME/.nx/C-$sess_id/scripts/
-
-cat &lt;&lt; EOF &gt;$USER_FAKE_HOME/.nx/C-$sess_id/scripts/authority
-remove localhost:$display
-remove unix:$display
-exit
-EOF
-
-if [ &quot;$1&quot; = &quot;restore&quot; ]
-then
-	echo &gt; $USER_FAKE_HOME/.nx/C-$sess_id/session
-	sh -c 'echo &quot;Info: tail -f running with pid '\'\$$\''.&quot;; exec tail -n1 -f '$USER_FAKE_HOME'/.nx/C-'$sess_id'/session' | node_start_monitor &quot;$1&quot; &quot;$status&quot; &amp;
-
-	MONITOR_PID=$!
-	export MONITOR_PID
-
-	mkdir -p $USER_FAKE_HOME/.nx/C-$sess_id/pids/
-	echo &quot;$MONITOR_PID&quot; &gt; $USER_FAKE_HOME/.nx/C-$sess_id/pids/monitor
-
-	node_suspend_session $sess_id || { echo &quot;Info: Reconnection failed: NX Agent process could not be found.&quot; &gt;&gt;&quot;$USER_FAKE_HOME/.nx/C-$sess_id/session&quot;; node_fail_restore_session $sess_id; }
-else
-	node_start_agent &amp;
-	node_start_applications &amp;
-fi
-
-if which &quot;$NODE_AUTOSTART&quot; &gt;/dev/null 2&gt;&amp;1
-then
-	sess_id=&quot;$SERVER_NAME-$display-$uniqueid&quot;
-	# go into background immediately
-	NXSESSIONID=&quot;$sess_id&quot; DISPLAY=unix:$display &quot;$NODE_AUTOSTART&quot; &quot;$1&quot; &gt;/dev/null 2&gt;&amp;1 &amp;
-	# dont't wait for this child!
-	disown $!
-fi
-	
-cat &lt;&lt; EOF
-NX&gt; 700 Session id: $sess_id
-NX&gt; 705 Session display: $display
-NX&gt; 703 Session type: $type
-NX&gt; 701 Proxy cookie: $proxy_cookie
-NX&gt; 702 Proxy IP: $userip
-NX&gt; 706 Agent cookie: $cookie
-NX&gt; 704 Session cache: $type
-NX&gt; 707 SSL tunneling: $ssl_tunnel
-EOF
-
-# collection ...
-
-# NX&gt; 1004 Error:
-#Session 'Knoppix-1000-40EFB9F64FA55C64C41C72CA39EBD720' has failed after reaching usable state. Session directory '/home/knoppix/.nx/F-C-Knoppix-1000-40EFB9F64FA55C64C41C72CA39EBD720' will be not deleted to allow for further investigation.
-
-if [ -n &quot;$MONITOR_PID&quot; ]
-then
-	wait &quot;$MONITOR_PID&quot;
-	rm -f &quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/monitor&quot;
-	rm -f &quot;$USER_FAKE_HOME/.nx/C-$sess_id/pids/tail&quot;
-fi
-wait # for all children
-}
-
-#
-# -----------------------------------------------------------------------------
-# cmd_node functions - changes lots of small variables
-# -----------------------------------------------------------------------------
-#
-
-cmd_node_terminate()
-{
-	sessionid=$(getparam_sessionid)
-	echo &quot;NX&gt; 716 Terminating session $sessionid on user request.&quot;
-	display=$(cd $USER_FAKE_HOME/.nx/; echo C-$SERVER_NAME-*-$sessionid | rev |cut -d&quot;-&quot; -f2 |rev)
-	node_terminate_session &quot;$SERVER_NAME-$display-$sessionid&quot;
-}
-
-cmd_node_suspend()
-{
-	sessionid=$(getparam_sessionid)
-	echo &quot;NX&gt; 716 Suspending session $sessionid on user request.&quot;
-	display=$(cd $USER_FAKE_HOME/.nx/; echo C-$SERVER_NAME-*-$sessionid | rev | cut -d&quot;-&quot; -f2 |rev)
-	node_suspend_session &quot;$SERVER_NAME-$display-$sessionid&quot;
-}
-
-cmd_node_smbmount()
-{
-	sessionid=$(getparam_sessionid)
-	port=$(getparam port)
-	username=$(getparam username)
-	password=$(getparam password)
-	share=$(getparam share)
-	computername=$(getparam computername)
-	dir=$(getparam dir | sed 's|$(SHARES)|MyShares|g')
-	# rdir=$(getparam dir | sed 's|$(SHARES)/||g')
-	display=$(cd $USER_FAKE_HOME/.nx/; echo C-$SERVER_NAME-*-$sessionid | rev|cut -d&quot;-&quot; -f2| rev)
-	mkdir -p &quot;$HOME/$dir&quot;
-	# wait up to 30 sec until nxagent has opened the listener port for samba connections
-	for (( i=30; $i; --i ))
-	do
-		[ -f &quot;$USER_FAKE_HOME/.nx/C-$SERVER_NAME-$display-$sessionid/scripts/mport&quot; ] &amp;&amp; break
-		sleep 1
-	done
-	# sometimes the samba port we get from nxserver is not the right one, so let's get it from nxagent
-	port=$(cat &quot;$USER_FAKE_HOME/.nx/C-$SERVER_NAME-$display-$sessionid/scripts/mport&quot;)
-	error=$(PASSWD=&quot;$password&quot; &quot;$COMMAND_SMBMOUNT&quot; &quot;//$computername/$share&quot; &quot;$HOME/$dir&quot; -o username=&quot;$username,ip=127.0.0.1,port=$port&quot; 2&gt;&amp;1)
-	if [ $? -eq 0 ]
-	then
-		$PATH_BIN/nxclient -dialog ok -caption &quot;NXServer Message&quot; -message &quot;Info: Share: '//$computername/$share' mounted on: '$HOME/$dir'&quot; -noautokill -display :$display &amp;
-		echo &quot;$HOME/$dir&quot; &gt;&gt; &quot;$USER_FAKE_HOME/.nx/C-$SERVER_NAME-$display-$sessionid/scripts/mpoint&quot;
-	else
-		$PATH_BIN/nxclient -dialog ok -caption &quot;NXServer Message&quot; -message &quot;Info: Share: '//$computername/$share' failed to mount: $error&quot; -noautokill -display :$display &amp;
-	fi
-}
-
-cmd_node_addprinter()
-{
-	sessionid=$(getparam_sessionid)
-	type=$(getparam type)
-	port=$(getparam port)
-	username=$(getparam username)
-	password=$(getparam password)
-	share=$(getparam share)
-	printer=$(getparam printer)
-	computername=$(getparam computername)
-	public=$(getparam public)
-	model=$(getparam model)
-	defaultPrinter=$(getparam defaultPrinter)
-	display=$(cd $USER_FAKE_HOME/.nx/; echo C-$SERVER_NAME-*-$sessionid | rev | cut -d&quot;-&quot; -f2 | rev)
-	sess_id=&quot;$SERVER_NAME-$display-$sessionid&quot;
-	
-	# this will also setup the userspace cupsd
-	export CUPS_SERVER=$(node_cupsd_get_socket)
-	
-	if [ &quot;$type&quot; = &quot;smb&quot; ]
-	then
-		DEVICE_URI=&quot;<A HREF="smb://$username:$password@127.0.0.1:$port/$share">smb://$username:$password@127.0.0.1:$port/$share</A>&quot;
-		NAME=&quot;$share&quot;
-		ENABLE_CUPS_SEAMLESS=&quot;0&quot;
-	else
-		DEVICE_URI=&quot;<A HREF="nxipp://$username:$password@127.0.0.1:$port/printers/$printer">nxipp://$username:$password@127.0.0.1:$port/printers/$printer</A>&quot;
-		NAME=&quot;$printer&quot;
-	fi
-	export PATH_BIN
-
-	if [ &quot;$ENABLE_CUPS_SEAMLESS&quot; != &quot;1&quot; ]
-	then
-		MODEL=$($PATH_BIN/nxclient -printer &quot;$NAME&quot; -noautokill -display :$display)
-		[ -z &quot;$MODEL&quot; -o &quot;$MODEL&quot; = &quot;cancel: aborted&quot; ] &amp;&amp; return
-	else
-		sleep $CUPS_SEAMLESS_DELAY
-		MODEL=&quot;download_cached&quot;
-	fi
-	
-	PUBLIC=&quot;-u allow:$USER&quot;
-	[ &quot;$public&quot; == &quot;1&quot; ] &amp;&amp; PUBLIC=&quot;&quot;
-
-	if [ &quot;$MODEL&quot; = &quot;download_new&quot; -o &quot;$MODEL&quot; = &quot;download_cached&quot; ]
-	then
-		mkdir -p &quot;$USER_FAKE_HOME/.nx/config/ppd/&quot;
-		if [ &quot;$MODEL&quot; = &quot;download_new&quot; -o ! -r &quot;$USER_FAKE_HOME/.nx/config/ppd/$printer.ppd&quot; ]
-		then
-			curl --digest -o &quot;$USER_FAKE_HOME/.nx/config/ppd/$printer.ppd&quot; &quot;<A HREF="http://$username:$password@127.0.0.1:$port/ppd/${printer">http://$username:$password@127.0.0.1:$port/ppd/${printer</A>}_nxdl.ppd&quot; &gt;&gt;$USER_FAKE_HOME/.nx/C-$sess_id/cups/curl.log 2&gt;&amp;1
-		RC=$?
-		[ $RC -eq 0 -a &quot;$ENABLE_CUPS_SEAMLESS&quot; != &quot;1&quot; ] &amp;&amp; $PATH_BIN/nxclient --message &quot;Download successful.&quot; -noautokill -display :$display
-		[ $RC -ne 0 -a &quot;$ENABLE_CUPS_SEAMLESS&quot; != &quot;1&quot; ] &amp;&amp; $PATH_BIN/nxclient --message &quot;Download failed. Log is: $USER_FAKE_HOME/.nx/C-$sess_id/cups/curl.log&quot; -noautokill -display :$display
-		fi
-		MODEL=&quot;$USER_FAKE_HOME/.nx/config/ppd/$printer.ppd&quot;
-	fi
-	
-	if [ ! -r &quot;$MODEL&quot; ]
-	then
-		# Foomatic and co
-		/usr/sbin/lpadmin -p &quot;$NAME&quot; -E -v &quot;$DEVICE_URI&quot; -m &quot;$MODEL&quot; $PUBLIC
-	else
-		/usr/sbin/lpadmin -p &quot;$NAME&quot; -E -v &quot;$DEVICE_URI&quot; -P &quot;$MODEL&quot; $PUBLIC
-	fi
-
-	[ &quot;$defaultPrinter&quot; = &quot;1&quot; ] &amp;&amp; /usr/sbin/lpadmin -d &quot;$NAME&quot;
-}
-
-nxnode_func()
-{
-
-case &quot;$1&quot; in 
-	--startsession)
-		startsession
-	;;
-	--resumesession)
-		startsession &quot;restore&quot;
-	;;
-	--terminate)
-		cmd_node_terminate
-	;;
-	--suspend)
-		cmd_node_suspend
-	;;
-	--smbmount)
-		cmd_node_smbmount &amp;&gt;/dev/null &lt;/dev/null &amp;
-	;;
-	--addprinter)
-		cmd_node_addprinter &amp;&gt;/dev/null &lt;/dev/null &amp;
-	;;
-	--check)
-		echo &quot;NX&gt; 716 finished&quot;
-	;;
-	--agent)
-		echo &quot;NX&gt; 716 Starting NX Agent ...&quot;
-		shift
-		[ &quot;$SET_LD_LIBRARY_PATH&quot; = &quot;1&quot; ] &amp;&amp; export LD_LIBRARY_PATH=&quot;$AGENT_LIBRARY_PATH:$LD_LIBRARY_PATH&quot;
-		PATH=&quot;$PATH:$PATH_BIN&quot; $PATH_BIN/nxagent -name &quot;NX Agent Test - Args: $@&quot; $@
-		echo &quot;NX&gt; 716 NX Agent exited with status: $?&quot;
-	;;
-	--setkey)
-		mkdir -m 700 -p $HOME/.ssh
-		if ! grep -q &quot;$(cat $NX_ETC_DIR/users.id_dsa.pub)&quot; $HOME/.ssh/$SSH_AUTHORIZED_KEYS 2&gt;/dev/null
-		then
-			cat $NX_ETC_DIR/users.id_dsa.pub &gt;&gt; $HOME/.ssh/$SSH_AUTHORIZED_KEYS
-			chmod 600 $HOME/.ssh/$SSH_AUTHORIZED_KEYS
-			echo &quot;NX&gt; 716 Public key added to: $HOME/.ssh/$SSH_AUTHORIZED_KEYS&quot;
-		else
-			echo &quot;NX&gt; 716 Public key is already present in: $HOME/.ssh/$SSH_AUTHORIZED_KEYS&quot;
-		fi
-	;;
-	*)
-		echo &quot;NX&gt; 500 Error: Command not found&quot;
-	;;
-esac
-
-}
-
-
-if [ &quot;$1&quot; = &quot;--slave&quot; ]
-then
-	# New slave mode accepts more than 1 command at a time
-	echo &quot;NX&gt; 716 Slave mode started successfully.&quot;
-	
-	while read CMD
-	do
-		set -- &quot;$CMD&quot;
-		if [ &quot;$1&quot; != &quot;--check&quot; -a &quot;$1&quot; != &quot;--setkey&quot; -a &quot;$1&quot; != &quot;--agent&quot; ]
-		then 
-			read CMDLINE
-
-			CMDLINE=&quot;a=b&amp;$CMDLINE&quot;
-		fi
-		
-		if [ &quot;$1&quot; = &quot;--startsession&quot; -o &quot;$1&quot; = &quot;--resumesession&quot; ]
-		then
-			export SLAVE_PID=$$
-			( echo $CMDLINE | &quot;$0&quot; &quot;$CMD&quot;; kill $SLAVE_PID ) &amp;
-		else
-			( echo $CMDLINE | &quot;$0&quot; &quot;$CMD&quot; ) &amp;
-		fi
-
-	done
-else
-	nxnode_func &quot;$@&quot;
-fi
-
-echo &quot;NX&gt; 1001 Bye.&quot;

Copied: freenx-server/tags/FreeNX-0.7.1/nxnode (from rev 403, freenx-server/trunk/nxnode)

Deleted: freenx-server/tags/FreeNX-0.7.1/nxprint
===================================================================
--- freenx-server/trunk/nxprint	2007-05-29 15:27:07 UTC (rev 334)
+++ freenx-server/tags/FreeNX-0.7.1/nxprint	2007-10-14 22:25:14 UTC (rev 405)
@@ -1,67 +0,0 @@
-#!/bin/bash
-#
-# nxprint - Prints a list of available drivers or printers
-# 
-# Copyright (c) 2005 by Fabian Franz &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">freenx at fabian-franz.de</A>&gt;
-#
-# License: GPL, version 2
-#
-# SVN: $Id$
-#
-
-HELP=&quot;no&quot;
-DRIVERS=&quot;no&quot;
-PRINTERS=&quot;no&quot;
-
-while [ &quot;$1&quot; ]
-do
-        case &quot;$1&quot; in
-                --help) HELP=&quot;yes&quot;; shift ;;
-                --drivers|-d) DRIVERS=&quot;yes&quot;; shift ;;
-                --printers|-l) PRINTERS=&quot;yes&quot;; shift ;;
-                --) shift ; break ;;
-                *) echo &quot;Invalid flag $1&quot; ; HELP=&quot;yes&quot;; shift ; break ;;
-        esac
-done
-
-[ &quot;$DRIVERS&quot; = &quot;no&quot; -a &quot;$PRINTERS&quot; = &quot;no&quot; ] &amp;&amp; HELP=&quot;yes&quot;
-
-if [ &quot;$HELP&quot; = &quot;yes&quot; ]
-then
-        echo &quot;nxprint - Prints a list of available drivers or printers&quot;
-	echo &quot;&quot;
-        echo &quot;Syntax: nxprint --help&quot;
-        echo &quot;        nxprint --drivers&quot;
-        echo &quot;        nxprint --printers&quot;
-        echo
-        echo &quot;  --drivers                prints a list of available CUPS drivers&quot;
-        echo &quot;  --printers               prints a list of available CUPS printers&quot;
-        exit 0
-fi
-
-if [ &quot;$DRIVERS&quot; = &quot;yes&quot; ]
-then
-	echo &quot;driver|Raw|Raw Queue|raw&quot;
-	echo &quot;driver|Download (CUPS)|Download from CUPS server (cached)|download_cached&quot;
-	echo &quot;driver|Download (CUPS)|Download from CUPS server (redownload)|download_new&quot;
-	{ 
-        cd /usr/share/ppd/
-        awk -F '&quot;' '/\*Manufacturer:/ { a[FILENAME]=$2 }
-                    /\*NickName:/ { b[FILENAME]=$2 } 
-                    END { 
-                       for (i in a) 
-                          print &quot;driver|&quot; (a[i]==&quot;ESP&quot;?substr(b[i],0,index(b[i],&quot; &quot;)-1):a[i]) &quot;|&quot;b[i]&quot;|&quot;i&quot;|en&quot;
-                    }' $(find -name &quot;*.ppd&quot;)
-
-	if [ &quot;$ENABLE_FOOMATIC&quot; = &quot;1&quot; ]
-	then
-		[ -z &quot;$COMMAND_FOOMATIC&quot; ] &amp;&amp; COMMAND_FOOMATIC=&quot;foomatic-ppdfile&quot; 
-		$COMMAND_FOOMATIC list | awk -F'&quot;' '{ A=&quot;&quot;; if ($4 == &quot;HP&quot;) { B=substr($6,index($6,&quot; &quot;)+1); A=&quot; &quot;substr(B,0,index(B,&quot; &quot;)); } printf(&quot;driver|%s%s|%s|%s|%s\n&quot;,$4,A,$6,$2,substr($3,2)) } '
-	fi
-	} | sort
-fi
-
-if [ &quot;$PRINTERS&quot; = &quot;yes&quot; ]
-then
-	lpstat -p | awk '{ print $1 &quot;|&quot; $2 }'
-fi

Copied: freenx-server/tags/FreeNX-0.7.1/nxprint (from rev 360, freenx-server/trunk/nxprint)

Deleted: freenx-server/tags/FreeNX-0.7.1/nxserver
===================================================================
--- freenx-server/trunk/nxserver	2007-05-29 15:27:07 UTC (rev 334)
+++ freenx-server/tags/FreeNX-0.7.1/nxserver	2007-10-14 22:25:14 UTC (rev 405)
@@ -1,1746 +0,0 @@
-#!/bin/bash
-
-# Free implementation of nxserver components
-#
-# To use nxserver add the user &quot;nx&quot; 
-# and use nxserver as default shell.
-#
-# Also make sure that hostkey based authentification works.
-# 
-# Copyright (c) 2004 by Fabian Franz &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">FreeNX at fabian-franz.de</A>&gt;.
-#
-# License: GNU GPL, version 2
-#
-# SVN: $Id$
-#
-
-# Read the config file
-. $(PATH=$(cd $(dirname $0) &amp;&amp; pwd):$PATH which nxloadconfig) --
-
-# following two functions are Copyright by Klaus Knopper
-
-stringinstring(){
-case &quot;$2&quot; in *$1*) return 0;; esac
-return 1
-}
-
-# Reread boot command line; echo last parameter's argument or return false.
-getparam(){
-stringinstring &quot;&amp;$1=&quot; &quot;$CMDLINE&quot; || return 1
-echo &quot;$CMDLINE&quot; |  tr &quot;&amp;&quot; &quot;\n&quot; | egrep &quot;^&quot;$1&quot;=&quot; | awk -F= '{ VAL=$2 } END { print VAL }'
-return 0
-}
-
-
-############### PACKAGE passdb.bm #######################
-#
-# Library of passdb functions (outsource)
-#
-
-# Policy: Variable and function names _must_ start with passdb_ / PASSDB_
-
-# Needed global vars: $NX_ETC_DIR, $PATH_BIN
-
-# Needed nonstd functions: md5sum
-
-
-passdb_get_crypt_pass()
-{
-	echo &quot;$@&quot; | $COMMAND_MD5SUM | cut -d&quot; &quot; -f1
-}
-
-passdb_get_pass()
-{
-	PASSDB_CHUSER=&quot;$1&quot;
-	PASSDB_PASS=$(egrep &quot;^$PASSDB_CHUSER:&quot; $NX_ETC_DIR/passwords 2&gt;/dev/null | cut -d&quot;:&quot; -f2)
-	if [ &quot;$ENABLE_PASSDB_AUTHENTICATION&quot; = &quot;1&quot; ]
-	then
-		egrep -q &quot;^$PASSDB_CHUSER:&quot; $NX_ETC_DIR/passwords 2&gt;/dev/null &amp;&amp; echo $PASSDB_PASS
-		egrep -q &quot;^$PASSDB_CHUSER:&quot; $NX_ETC_DIR/passwords 2&gt;/dev/null || echo &quot;NOT_VALID&quot;
-	else
-		echo &quot;NOT_VALID&quot;
-	fi
-}
-
-passdb_chpass()
-{
-	PASSDB_CHUSER=&quot;$1&quot;
-	PASSDB_ENC_PASS=&quot;$2&quot;
-	cp -f $NX_ETC_DIR/passwords $NX_ETC_DIR/passwords.orig
-	perl -pi -e &quot;s/$PASSDB_CHUSER:.*/$PASSDB_CHUSER:$PASSDB_ENC_PASS/g&quot; $NX_ETC_DIR/passwords
-}
-
-passdb_user_exists()
-{
-	PASSDB_CHUSER=&quot;$1&quot;
-	egrep -q &quot;^$PASSDB_CHUSER:&quot; $NX_ETC_DIR/passwords 2&gt;/dev/null
-}
-
-
-passdb_remove_user()
-{
-	PASSDB_CHUSER=&quot;$1&quot;
-	cp -f $NX_ETC_DIR/passwords $NX_ETC_DIR/passwords.orig
-	perl -pi -e &quot;s/$PASSDB_CHUSER:.*\n//g&quot; $NX_ETC_DIR/passwords
-}
-
-passdb_add_user()
-{
-	PASSDB_CHUSER=&quot;$1&quot;
-	cp -f $NX_ETC_DIR/passwords $NX_ETC_DIR/passwords.orig
-	echo &quot;$PASSDB_CHUSER:*&quot; &gt;&gt; $NX_ETC_DIR/passwords
-	# deactivated to avoid problems with comm-server
-	su - $PASSDB_CHUSER -c &quot;$PATH_BIN/nxnode --setkey&quot;
-}
-
-passdb_list_user()
-{
-	cat $NX_ETC_DIR/passwords | cut -d&quot;:&quot; -f1
-}
-
-#
-# End of passdb Library
-#
-
-############### PACKAGE session.bm #######################
-#
-# Library of session management functions
-#
-
-# Needed global vars: $NX_SESS_DIR
-
-session_list()
-{
-	cat $NX_SESS_DIR/running/sessionId&quot;{$1}&quot;
-}
-
-# Find all running session-filenames 
-
-session_find_all()
-{
-	for i in $NX_SESS_DIR/running/*
-	do
-		[ -f $i ] || break
-		echo $i
-	done
-}
-
-# Find all running sessions of a id
-session_find_id()
-{
-	[ -f $NX_SESS_DIR/running/sessionId&quot;{$1}&quot; ] &amp;&amp; echo $NX_SESS_DIR/running/sessionId&quot;{$1}&quot;
-}
-
-# finds out if a session belongs to a user
-
-session_find_id_user()
-{
-	[ -f $NX_SESS_DIR/running/sessionId&quot;{$1}&quot; ] &amp;&amp; egrep -q &quot;^userName=$2$&quot; $NX_SESS_DIR/running/sessionId&quot;{$1}&quot; &amp;&amp; return 0
-	return 1
-}
-
-# Find all running sessions of a user
-session_find_user()
-{
-	for i in $NX_SESS_DIR/running/*
-	do
-		[ -f $i ] || break
-		egrep -q &quot;^userName=$1$&quot; $i &amp;&amp; echo $i
-	done
-}
-
-# Find all running sessions of a display
-session_find_display()
-{	
-	for i in $NX_SESS_DIR/running/*
-	do
-		[ -f $i ] || break
-		egrep -q &quot;^display=$1$&quot; $i &amp;&amp; echo $i
-	done
-}
-
-# session_get_cmdline &lt;session filename&gt;
-
-session_get_cmdline()
-{
-	echo &quot;a=b&quot; | cat - $1 | tr '\n' '&amp;'
-}
-
-# session_get &lt;uniqueid&gt;
-
-session_get()
-{
-	session_get_cmdline $NX_SESS_DIR/running/sessionId&quot;{$1}&quot;
-}
-
-
-# Get the first session, which can be resumed
-
-session_get_user_suspended()
-{
-	for i in $NX_SESS_DIR/running/*
-	do
-		[ -f $i ] || break
-		if egrep -q &quot;^userName=$1$&quot; $i &amp;&amp; egrep -q &quot;^status=$2$&quot; $i
-		then
-			CMDLINE=$(session_get_cmdline $i)
-			echo &quot;$(getparam sessionId)&quot;
-			break
-		fi
-	done
-}
-
-# Count all sessions of a user
-# and save it in SESSION_COUNT and SESSION_COUNT_USER
-
-session_count_user()
-{
-	SESSION_COUNT=0
-	SESSION_COUNT_USER=0
-
-	for i in $NX_SESS_DIR/running/*
-	do
-		[ -f $i ] || break
-		let SESSION_COUNT=$SESSION_COUNT+1
-		egrep -q &quot;^userName=$1$&quot; $i &amp;&amp; let SESSION_COUNT_USER=$SESSION_COUNT_USER+1
-	done
-}
-
-# List all sessions of a user
-
-session_list_user_suspended()
-{
-	SESSION_COUNT=0
-	SESSION_COUNT_USER=0
-
-	TMPFILE=$(mktemp /tmp/nxserver_tmp.XXXXXXXXX)
-	echo &quot;NX&gt; 127 Sessions list of user '$1' for reconnect:&quot; &gt; $TMPFILE
-	echo &gt;&gt; $TMPFILE
-	if [ -z &quot;$4&quot; ]
-	then
-		
-		echo &quot;Display Type             Session ID                       Options  Depth Screensize     Available Session Name&quot; &gt;&gt; $TMPFILE
-		echo &quot;------- ---------------- -------------------------------- -------- ----- -------------- --------- ----------------------&quot; &gt;&gt; $TMPFILE
-	else
-		echo &quot;Display Type             Session ID                       Options  Depth Screen         Status      Session Name&quot; &gt;&gt; $TMPFILE
-		echo &quot;------- ---------------- -------------------------------- -------- ----- -------------- ----------- ------------------------------&quot; &gt;&gt; $TMPFILE
-	fi
-	for i in $NX_SESS_DIR/running/*
-	do
-		[ -f $i ] || break
-		let SESSION_COUNT=$SESSION_COUNT+1
-		if egrep -q &quot;^userName=$1$&quot; $i &amp;&amp; egrep -q &quot;^status=$2$&quot; $i #&amp;&amp; grep -q &quot;screeninfo=$3&quot; $i
-		then
-			CMDLINE=$(session_get_cmdline $i)
-			depth=$(getparam screeninfo | cut -d &quot;x&quot; -f3 | cut -d &quot;+&quot; -f1 )
-			geom=$(getparam screeninfo | cut -d &quot;x&quot; -f1,2) 
-			render=$(getparam screeninfo | cut -d &quot;+&quot; -f2 )
-			available=&quot;N/A&quot;
-			udepth=$(echo $3 | cut -d &quot;x&quot; -f3 | cut -d &quot;+&quot; -f1 )
-			urender=$(echo $3 | cut -d &quot;+&quot; -f2 )
-
-			mode=&quot;D&quot;
-			[ &quot;$(getparam sessionRootlessMode)&quot; = &quot;1&quot; ] &amp;&amp; mode=&quot;-&quot;
-			
-			options=&quot;-&quot;
-			stringinstring &quot;fullscreen&quot; &quot;$3&quot; &amp;&amp; options=&quot;F&quot;
-			[ &quot;$(getparam geometry)&quot; = &quot;fullscreen&quot; ] || options=&quot;-&quot;
-			[ &quot;$urender&quot; = &quot;render&quot; ] &amp;&amp; options=&quot;${options}R${mode}--PSA&quot;
-			[ &quot;$urender&quot; = &quot;render&quot; ] || options=&quot;${options}-${mode}--PSA&quot;
-			[ &quot;$udepth&quot; = &quot;$depth&quot; -a &quot;$urender&quot; = &quot;$render&quot; ] &amp;&amp; available=$(getparam status)
-			# FIXME: HACK !!! to keep compatibility with old snapshot version (Knoppix 3.6 based for example)
-			if [ -z &quot;$4&quot; -a &quot;$available&quot; != &quot;N/A&quot; ] 
-			then
-				available=&quot;Yes&quot;
-			fi
-			printf &quot;%-7s %-16s %32s %8s %5s %-14s %-11s %s\n&quot; &quot;$(getparam display)&quot; &quot;$(getparam type)&quot; &quot;$(getparam sessionId)&quot; &quot;$options&quot; &quot;$depth&quot; &quot;$geom&quot; &quot;$available&quot; &quot;$(getparam sessionName)&quot; &gt;&gt; $TMPFILE
-		fi
-		egrep -q &quot;^userName=$1$&quot; $i &amp;&amp; let SESSION_COUNT_USER=$SESSION_COUNT_USER+1
-	done
-	echo &quot;&quot; &gt;&gt; $TMPFILE
-	echo &quot;&quot; &gt;&gt; $TMPFILE
-	cat $TMPFILE
-	rm -f $TMPFILE
-	if [ &quot;$SESSION_COUNT&quot; -ge &quot;$SESSION_LIMIT&quot; -o &quot;$SESSION_COUNT_USER&quot; -ge &quot;$SESSION_USER_LIMIT&quot; ]
-	then
-		echo &quot;NX&gt; 147 Server capacity: reached for user: $1&quot;
-	else
-		echo &quot;NX&gt; 148 Server capacity: not reached for user: $1&quot;
-	fi
-}
-
-session_list_user()
-{
-	echo &quot;NX&gt; 127 Sessions list of user '$1'&quot;
-	echo
-	echo &quot;Display Username        Remote IP       Session ID&quot;
-	echo &quot;------- --------------- --------------- --------------------------------&quot;
-	for i in $NX_SESS_DIR/running/*
-	do
-		[ -f $i ] || break
-		if egrep -q &quot;^userName=$1$&quot; $i
-		then
-			CMDLINE=$(session_get_cmdline $i)
-			echo -e &quot;$(getparam display)\t$(getparam userName)\t$(getparam foreignAddress)\t$(getparam sessionId)&quot;
-		fi
-	done
-}
-
-session_history()
-{
-	userName=$1
-	sessionId=$2
-	echo &quot;NX&gt; 127 Session list:&quot;
-	echo
-	echo &quot;Display Username        Remote IP       Session ID                       Date                Status&quot;
-	echo &quot;------- --------------- --------------- -------------------------------- ------------------- -----------&quot;
-	for j in $(ls --time-style +%s -la &quot;$NX_SESS_DIR&quot;/{closed,failed,running} | awk '/sessionId/ { print $6 &quot; &quot; $7 }' | sort -n | cut -d&quot; &quot; -f2)
-	do
-		if [ -n &quot;$sessionId&quot; ]
-		then
-			[ &quot;$j&quot; = &quot;sessionId{$sessionId}&quot; ] || continue
-		fi
-		i=&quot;$NX_SESS_DIR&quot;/*/&quot;$j&quot;
-		[ -f $i ] || break
-		CMDLINE=$(session_get_cmdline $i)
-		if [ -n &quot;$userName&quot; ]
-		then
-			[ &quot;$userName&quot; = &quot;$(getparam userName)&quot; ] || continue
-		fi
-		echo -e &quot;$(getparam display)\t$(getparam userName)\t$(getparam foreignAddress)\t$(getparam sessionId)\t$(ls --time-style=&quot;+%F %X&quot; -l $i | awk '/sessionId/ { print $6 &quot; &quot; $7 }')\t$(getparam status)&quot;
-	done
-}
-
-# remove all sessions older than $SESSION_HISTORY seconds in failed/closed.
-
-session_cleanup()
-{
-	[ &quot;$SESSION_HISTORY&quot; -gt &quot;-1&quot; ] || return
-	let SESSION_HISTORY_MINUTES=$SESSION_HISTORY/60
-	find $NX_SESS_DIR/closed/ $NX_SESS_DIR/failed/ -type f -mmin +&quot;$SESSION_HISTORY_MINUTES&quot; -exec rm -f '{}' ';'
-}
-
-session_list_all()
-{
-	echo &quot;NX&gt; 127 Sessions list:&quot;
-	echo
-	echo &quot;Display Username        Remote IP       Session ID&quot;
-	echo &quot;------- --------------- --------------- --------------------------------&quot;
-	for i in $NX_SESS_DIR/running/*
-	do
-		[ -f $i ] || break
-		CMDLINE=$(session_get_cmdline $i)
-		echo -e &quot;$(getparam display)\t$(getparam userName)\t$(getparam foreignAddress)\t$(getparam sessionId)&quot;
-	done
-}
-
-
-# session_add &lt;session_id&gt; &lt;options&gt;
-
-session_add()
-{
-	id=$1
-	shift
-	echo &quot;$@&quot; | tr '&amp;' '\n' &gt; $NX_SESS_DIR/running/sessionId'{'$id'}'
-}
-
-# session_change &lt;session_id&gt; &lt;parameter&gt; &lt;new_value&gt;
-
-session_change()
-{
-	[ -f $NX_SESS_DIR/running/sessionId'{'$1'}' ] &amp;&amp; perl -pi -e &quot;s/$2=.*/$2=$3/&quot; $NX_SESS_DIR/running/sessionId'{'$1'}'
-}
-
-# session_id &lt;new status&gt;
-
-session_status()
-{
-	session_change &quot;$1&quot; &quot;status&quot; &quot;$2&quot;
-}
-
-# session_running &lt;session_id&gt;
-# return: true if running, false if not
-
-session_running()
-{
-	test -f $NX_SESS_DIR/running/sessionId'{'$1'}'
-}
-
-# session_close &lt;session_id&gt; &lt;end-time&gt;
-
-session_close()
-{
-	perl -pi -e &quot;s/startTime=\(.*\)/startTime=\1\nendTime=$(date +%s)/&quot; $NX_SESS_DIR/running/sessionId'{'$1'}'
-	session_status $1 &quot;Finished&quot;
-	[ &quot;$SESSION_HISTORY&quot; = &quot;0&quot; ] &amp;&amp; rm -f $NX_SESS_DIR/running/sessionId'{'$1'}'
-	[ &quot;$SESSION_HISTORY&quot; = &quot;0&quot; ] || mv -f $NX_SESS_DIR/running/sessionId'{'$1'}' $NX_SESS_DIR/closed/sessionId'{'$1'}'
-}
-
-session_fail()
-{
-	perl -pi -e &quot;s/startTime=\(.*\)/startTime=\1\nendTime=$(date +%s)/&quot; $NX_SESS_DIR/running/sessionId'{'$1'}'
-	session_status $1 &quot;Failed&quot;
-	[ &quot;$SESSION_HISTORY&quot; = &quot;0&quot; ] &amp;&amp; rm -f $NX_SESS_DIR/running/sessionId'{'$1'}'
-	[ &quot;$SESSION_HISTORY&quot; = &quot;0&quot; ] || mv -f $NX_SESS_DIR/running/sessionId'{'$1'}' $NX_SESS_DIR/failed/sessionId'{'$1'}'
-}
-
-session_suspend()
-{
-	session_status $1 &quot;Suspended&quot;
-	session_change $1 foreignAddress &quot;-&quot;
-}
-
-#
-# end of library
-#
-
-
-#
-# Main nxserver &lt;-&gt; nxclient communication module
-#
-
-if [ $USER = &quot;nxfree&quot; -o &quot;$USER&quot; = &quot;nx&quot; -o &quot;$ENABLE_USERMODE_AUTHENTICATION&quot; = &quot;1&quot; ]
-then
-
-setup_usermode_auth()
-{
-
-	[ $USER = &quot;nxfree&quot; -o &quot;$USER&quot; = &quot;nx&quot; ] &amp;&amp; ENABLE_USERMODE_AUTHENTICATION=&quot;0&quot;
-
-	if [ &quot;$ENABLE_USERMODE_AUTHENTICATION&quot; = &quot;1&quot; ]
-	then
-		export NX_SESS_DIR=&quot;$USER_FAKE_HOME/.nx/db/&quot;
-		export NX_LOGFILE=&quot;$USER_FAKE_HOME/.nx/temp/nxserver.log&quot;
-		mkdir -p $NX_SESS_DIR/{closed,running,failed}
-	fi
-}
-
-setup_usermode_auth
-
-# Loglevels:
-# 1: Errors
-# 2: Warnings
-# 3: Important information
-# 4: Server - Client communication
-# 5: Information
-# 6: Debugging information
-# 7: stderror-channel of some applications
-
-log()
-{
-	[ &quot;$NX_LOG_LEVEL&quot; -ge &quot;$1&quot; -a -w &quot;$NX_LOGFILE&quot; ] &amp;&amp; shift &amp;&amp; echo &quot;$@&quot; &gt;&gt; &quot;$NX_LOGFILE&quot;
-}
-
-# Log in a way that is secure for passwords / cookies / ...
-
-echo_secure()
-{
-	echo &quot;$@ &quot; | perl -pi -e 's/--cookie=&quot;.+?&quot;/--cookie=&quot;******&quot;/g; s/--agent_password=&quot;.+?&quot;/agent_password=&quot;******&quot;/g; s/--password=&quot;.+?&quot;/password=&quot;******&quot;/g; s/cookie=.+?&amp;/cookie=******&amp;/g; s/agent_password=.+?&amp;/agent_password=******&amp;/g; s/password=.+?&amp;/password=******&amp;/g;'
-}
-
-log_secure()
-{
-	if [ &quot;$NX_LOG_SECURE&quot; = &quot;0&quot; ]
-	then
-		log &quot;$@&quot;
-	else
-		[ &quot;$NX_LOG_LEVEL&quot; -ge &quot;$1&quot; -a -w &quot;$NX_LOGFILE&quot; ] &amp;&amp; shift &amp;&amp; echo_secure &quot;$@&quot; &gt;&gt; &quot;$NX_LOGFILE&quot;
-	fi
-}
-
-log_tee()
-{
-	[ &quot;$NX_LOG_LEVEL&quot; -ge &quot;4&quot; -a -w &quot;$NX_LOGFILE&quot; ] &amp;&amp; exec tee -a &quot;$NX_LOGFILE&quot;
-	[ &quot;$NX_LOG_LEVEL&quot; -ge &quot;4&quot; -a -w &quot;$NX_LOGFILE&quot; ] || exec cat -
-}
-
-log_error()
-{
-	[ &quot;$NX_LOG_LEVEL&quot; -ge &quot;7&quot; -a -w &quot;$NX_LOGFILE&quot; ] &amp;&amp; exec tee -a &quot;$NX_LOGFILE&quot;
-	[ &quot;$NX_LOG_LEVEL&quot; -ge &quot;7&quot; -a -w &quot;$NX_LOGFILE&quot; ] || exec cat - 
-}
-
-echo_x()
-{
-	log &quot;4&quot; &quot;$@&quot;
-	echo &quot;$@&quot;
-}
-
-
-#
-# needed for slave mode
-#
-
-nxnode_login_stop_slave()
-{
-	if [ -n &quot;$NXNODE_LOGIN_SLAVE&quot; ]
-	then
-		kill &quot;$NXNODE_LOGIN_SLAVE&quot;
-		sleep 2
-		kill -0 &quot;$NXNODE_LOGIN_SLAVE&quot; &amp;&amp; kill -9 &quot;$NXNODE_LOGIN_SLAVE&quot;
-	fi
-}
-
-nxnode_login()
-{
-	PASS=&quot;$1&quot;
-	shift
-
-	if [ &quot;$NXNODE_LOGIN_SLAVE_ENABLED&quot; != &quot;1&quot; ]
-	then
-		NXNODE_TOSEND=&quot;$NXNODE_TOSEND&quot; echo $PASS | $PATH_BIN/nxnode-login &quot;$@&quot;
-	else
-		if [ -z &quot;$NXNODE_LOGIN_SLAVE&quot; ]
-		then
-			# Send password
-			echo &quot;$PASS&quot; &gt;&amp;4 
-
-			# Connect to NXNODE
-			
-			$PATH_BIN/nxnode-login &quot;$1&quot; &quot;$2&quot; &quot;$3&quot; &quot;$4&quot; &quot;$5&quot; &quot;--slave&quot; &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3 &amp;
-			NXNODE_LOGIN_SLAVE=&quot;$!&quot;
-			disown $!
-
-			trap nxnode_login_stop_slave EXIT
-			
-			while read line &lt;&amp;4
-			do
-				log 6 &quot;$line&quot;
-				case &quot;$line&quot; in
-					&quot;NX&gt; 716 Slave mode started successfully.&quot;)
-						break
-					;;
-				esac
-			done
-
-			# TODO: KILL the slave node at end of session
-		fi
-		
-		#send CMD to nxnode
-		
-		echo &quot;$6&quot; &gt;&amp;4
-		[ -n &quot;$NXNODE_TOSEND&quot; ] &amp;&amp; echo &quot;$NXNODE_TOSEND&quot; &gt;&amp;4
-
-		NXNODE_RETURN=&quot;1&quot;
-
-		if [ -z &quot;$NXNODE_READER&quot; ]
-		then
-			while read line &lt;&amp;4
-			do
-				echo &quot;$line&quot;
-				case &quot;$line&quot; in
-					&quot;NX&gt; 716&quot;*) 
-						NXNODE_RETURN=&quot;0&quot;
-					;;
-					&quot;NX&gt; 1001&quot;*)
-						break
-					;;
-				esac
-			done
-		fi
-		test &quot;$NXNODE_RETURN&quot; = &quot;0&quot;
-	fi
-}
-
-nxnode_login_register_reader()
-{
-	# Register a reader
-	NXNODE_READER=&quot;1&quot;
-}
-
-#ENABLE_NXNODE_SLAVE_MODE=&quot;1&quot;
-
-# Start!
-[ &quot;$NX_LOG_LEVEL&quot; -ge &quot;1&quot; ] &amp;&amp; touch &quot;$NX_LOGFILE&quot; &gt;/dev/null 2&gt;&amp;1
-log 3 &quot;-- NX SERVER START: $@ - ORIG_COMMAND=$SSH_ORIGINAL_COMMAND&quot;
-
-if [ &quot;$ENABLE_SERVER_FORWARD&quot; = &quot;1&quot; -a -n &quot;$SERVER_FORWARD_HOST&quot; ]
-then
-	log 3 &quot;Info: Forwarding connection to $SERVER_FORWARD_HOST with secret key $SERVER_FORWARD_KEY.&quot;
-	$COMMAND_SSH -i &quot;$SERVER_FORWARD_KEY&quot; &quot;-p$SERVER_FORWARD_PORT&quot; &quot;nx@$SERVER_FORWARD_HOST&quot; &quot;host=$SERVER_NAME&quot;
-	exit 0
-fi
-
-# Get the hostname out of SSH_ORIGINAL_COMMAND
-PREFERRED_HOST=$(echo $SSH_ORIGINAL_COMMAND | tr '&amp;' '\n' | grep &quot;^host=&quot; | cut -d'=' -f2)
-
-# forward the connection to commercial NoMachine server?
-if [ &quot;$ENABLE_NOMACHINE_FORWARD_PORT&quot; = &quot;1&quot; -a &quot;$NOMACHINE_FORWARD_PORT&quot; = &quot;$(echo $SSH_CLIENT $SSH2_CLIENT| cut -d' ' -f3)&quot; -a -n &quot;$NOMACHINE_SERVER&quot; ]
-then
-	log 3 &quot;Info: Detected SSH destination port $NOMACHINE_FORWARD_PORT. Forwarding connection to commercial NoMachine server.&quot;
-	exec $NOMACHINE_SERVER
-	log 1 &quot;Error: Forwarding to NoMachine Server $NOMACHINE_SERVER failed. Using FreeNX server instead.&quot;
-fi
-
-#
-# nxnode slave mode preparations
-#
-
-NXNODE_LOGIN_SLAVE_ENABLED=&quot;0&quot;
-NXNODE_LOGIN_SLAVE=&quot;&quot;
-
-if [ &quot;$ENABLE_NXNODE_SLAVE_MODE&quot; = &quot;1&quot; -a &quot;$NXSERVER_HELPER_ACTIVE&quot; != &quot;1&quot; ]
-then
-	export SSH_ORIGINAL_COMMAND
-	export NXSERVER_HELPER_ACTIVE=&quot;1&quot;
-	exec $PATH_BIN/nxserver-helper &quot;$0&quot;
-	log 1 &quot;Error: Execution of $PATH_BIN/nxserver-helper failed. Disabling slave mode of nxnode.&quot;
-fi
-
-if [ &quot;$ENABLE_NXNODE_SLAVE_MODE&quot; = &quot;1&quot; -a &quot;$NXSERVER_HELPER_ACTIVE&quot; = &quot;1&quot; ]
-then
-	log 3 &quot;Info: Using fds #3 and #4 for communication with nxnode.&quot;
-	NXNODE_LOGIN_SLAVE_ENABLED=&quot;1&quot;
-fi
-
-echo_x &quot;HELLO NXSERVER - Version $NX_VERSION $NX_LICENSE&quot;
-
-# Login stage
-while true
-do
-	echo_x -n &quot;NX&gt; 105 &quot;
-	read CMD
-	# FIXME?
-	[ &quot;$CMD&quot; = &quot;&quot; ] &amp;&amp; CMD=&quot;quit&quot;
-	echo_x &quot;$CMD&quot;
-	
-	case &quot;$CMD&quot; in 
-		quit|QUIT)
-			echo_x &quot;Quit&quot;
-			echo_x &quot;NX&gt; 999 Bye&quot;
-			exit 0
-		;;
-		exit|EXIT)
-			echo_x &quot;Exit&quot;
-			echo_x &quot;NX&gt; 999 Bye&quot;
-			exit 0
-		;;
-		bye|BYE)
-			echo_x &quot;Bye&quot;
-			echo_x &quot;NX&gt; 999 Bye&quot;
-			exit 0
-		;;
-		hello*|HELLO*)
-			PROTO=$(echo $CMD | sed 's/.*Version \(.*\)/\1/g')
-			echo_x &quot;NX&gt; 134 Accepted protocol: $PROTO&quot;
-			if [ &quot;$PROTO&quot; = &quot;1.3.0&quot; -o &quot;$PROTO&quot; = &quot;1.3.2&quot; ]
-			then
-				[ &quot;$ENABLE_AUTORECONNECT_BEFORE_140&quot; = &quot;1&quot; ] &amp;&amp; ENABLE_AUTORECONNECT=&quot;1&quot;
-			fi
-		;;
-		&quot;set auth_mode*&quot;|&quot;SET AUTH_MODE*&quot;)
-			if [ &quot;$CMD&quot; = &quot;set auth_mode password&quot; -o &quot;$CMD&quot; = &quot;SET AUTH_MODE PASSWORD&quot; ]
-			then
-				echo_x &quot;Set auth_mode: password&quot;
-			else
-				echo_x &quot;NX&gt; 500 ERROR: unknown auth mode ''&quot;
-			fi
-		;;
-		login|LOGIN)
-			LOGIN_SUCCESS=&quot;0&quot;
-			
-			echo_x -n &quot;NX&gt; 101 User: &quot;
-			read USER
-			echo_x $USER
-			
-			echo_x -n &quot;NX&gt; 102 Password: &quot;
-			read -s PASS
-			echo_x &quot;&quot;
-			log 6 -n &quot;Info: Auth method: &quot;
-			
-			# USER already logged in?
-			if [ &quot;$ENABLE_USERMODE_AUTHENTICATION&quot; = &quot;1&quot; ]
-			then
-				LOGIN_SUCCESS=&quot;1&quot;
-				LOGIN_METHOD=&quot;USERMODE&quot;
-				USER=$(whoami)
-			fi
-
-			# PASSDB based auth
-			if [ &quot;$ENABLE_PASSDB_AUTHENTICATION&quot; = &quot;1&quot; -a &quot;$LOGIN_SUCCESS&quot; = &quot;0&quot; ]
-			then
-				log 6 -n &quot;passdb &quot;
-				if [ $(passdb_get_crypt_pass &quot;$PASS&quot;) = $(passdb_get_pass &quot;$USER&quot;) ]
-				then
-					LOGIN_SUCCESS=&quot;1&quot;
-					LOGIN_METHOD=&quot;PASSDB&quot;
-				fi
-			fi
-
-			# SSH based auth
-			if [ &quot;$ENABLE_SSH_AUTHENTICATION&quot; = &quot;1&quot; -a &quot;$LOGIN_SUCCESS&quot; = &quot;0&quot; ]
-			then
-				log 6 -n &quot;ssh &quot;
-				export COMMAND_SSH			
-				nxnode_login &quot;$PASS&quot; -- ssh &quot;$USER&quot; &quot;$SSHD_PORT&quot; &quot;$PATH_BIN/nxnode&quot; --check 2&gt;&amp;1 &gt;/dev/null
-				if [ $? -eq 0 ]
-				then
-					LOGIN_SUCCESS=&quot;1&quot;
-					LOGIN_METHOD=&quot;SSH&quot;
-				fi
-			fi
-			
-			# SU based auth
-			if [ &quot;$ENABLE_SU_AUTHENTICATION&quot; = &quot;1&quot; -a &quot;$LOGIN_SUCCESS&quot; = &quot;0&quot; ]
-			then
-				log 6 -n &quot;su &quot;
-				nxnode_login &quot;$PASS&quot; -- su &quot;$USER&quot; &quot;&quot; &quot;$PATH_BIN/nxnode&quot; --check 2&gt;&amp;1 &gt;/dev/null
-				if [ $? -eq 0 ]
-				then
-					LOGIN_SUCCESS=&quot;1&quot;
-					LOGIN_METHOD=&quot;SU&quot;
-				fi
-			fi
-			
-			# Check if user in passdb
-			if [ &quot;$ENABLE_USER_DB&quot; = &quot;1&quot; ]
-			then
-				log 6 &quot;userdb check&quot;
-				passdb_user_exists &quot;$USER&quot; || LOGIN_SUCCESS=&quot;0&quot;
-			fi
-			log 6 &quot;&quot;
-
-			if [ &quot;$LOGIN_SUCCESS&quot; = &quot;1&quot; ]
-			then
-				# Reread the config files (so that $USER.node.conf get sourced)
-				. $(PATH=$(cd $(dirname $0) &amp;&amp; pwd):$PATH which nxloadconfig) --userconf
-				setup_usermode_auth
-
-				echo_x &quot;NX&gt; 103 Welcome to: $SERVER_NAME user: $USER&quot;
-				break
-			else
-				echo_x &quot;NX&gt; 404 ERROR: wrong password or login&quot;
-				echo_x &quot;NX&gt; 999 Bye&quot;
-				exit 1
-			fi
-		;;
-	esac
-done
-
-# remove old session infos from history
-session_cleanup
-
-#
-# call it with: server_get_params $CMD # no &quot;&quot;!
-#
-
-server_get_params()
-{
-	SERVER_PARAMS=$(echo &quot;$@&quot; | sed &quot;s/^$1/\&quot;/g; s/\&quot; --/\&amp;/g; s/\&quot;//g; s/%20/ /g&quot;)
-	if [ &quot;$SERVER_PARAMS&quot; = &quot;&quot; ]
-	then
-		echo_x -n &quot;NX&gt; 106 Parameters: &quot;
-		read SERVER_PARAMS2
-		SERVER_PARAMS=$(echo $SERVER_PARAMS2 | sed 's/%2B/+/g; s/%20/ /g')
-		echo_x
-	fi
-}
-
-nxnode_start()
-{
-	:
-	#CMD=&quot;$1&quot;
-	#shift
-	#echo &quot;$@&quot; | $PATH_BIN/nxnode &quot;$CMD&quot;
-}
-
-#NX&gt; 1002 Commit
-#NX&gt; 1006 Session status: running
-
-server_nxnode_start()
-{
-	CMD=&quot;$1&quot;
-	USER=&quot;$2&quot;
-	shift
-	shift
-
-	# Find NODE_HOSTNAME
-	
-	NODE_HOSTNAME=&quot;&quot;
-	CMDLINE=&quot;$@&quot;
-	uniqueid=$(getparam uniqueid)
-	[ -z &quot;$uniqueid&quot; ] &amp;&amp; uniqueid=$(getparam sessionid)
-	[ -z &quot;$uniqueid&quot; ] &amp;&amp; uniqueid=$(getparam session_id)
-	CMDLINE=$(session_get &quot;$uniqueid&quot;)
-	
-	NODE_HOSTNAME=&quot;$(getparam host)&quot;
-	[ -z &quot;$NODE_HOSTNAME&quot; ] &amp;&amp; NODE_HOSTNAME=&quot;127.0.0.1&quot;
-	export NODE_HOSTNAME
-	
-	# Use nxnode-login?
-	if [ &quot;$LOGIN_METHOD&quot; = &quot;SSH&quot; ]
-	then
-	    export COMMAND_SSH
-	    NXNODE_TOSEND=&quot;$@&quot; nxnode_login &quot;$PASS&quot; -- ssh &quot;$USER&quot; &quot;$SSHD_PORT&quot; &quot;$PATH_BIN/nxnode&quot; &quot;$CMD&quot; 2&gt;&amp;1 | log_tee
-	elif [ &quot;$LOGIN_METHOD&quot; = &quot;SU&quot; ]
-	then
-	    NXNODE_TOSEND=&quot;$@&quot; nxnode_login &quot;$PASS&quot; -- su &quot;$USER&quot; &quot;&quot; &quot;$PATH_BIN/nxnode&quot; &quot;$CMD&quot; 2&gt;&amp;1 | log_tee
-	elif [ &quot;$LOGIN_METHOD&quot; = &quot;USERMODE&quot; ]
-	then
-	    echo &quot;$@&quot; | $PATH_BIN/nxnode &quot;$CMD&quot; 2&gt;&amp;1 | log_tee
-	else
-	    echo &quot;$@&quot; | $COMMAND_SSH -l &quot;$USER&quot; &quot;$NODE_HOSTNAME&quot; -p $SSHD_PORT -x -2 -i $NX_ETC_DIR/users.id_dsa -o 'PubkeyAuthentication yes' -o 'RSAAuthentication yes' -o 'RhostsAuthentication no' -o 'PasswordAuthentication no' -o 'RhostsRSAAuthentication no' -o 'StrictHostKeyChecking no' $PATH_BIN/nxnode &quot;$CMD&quot; | log_tee
-	fi
-}
-
-server_add_usession()
-{
-	[ &quot;$ENABLE_USESSION&quot; = &quot;1&quot; ] || return
-	
-	$COMMAND_SESSREG -l &quot;:$SESS_DISPLAY&quot; -h &quot;$USERIP&quot; -a $USER 2&gt;&amp;1 | log_error
-}
-
-server_remove_usession()
-{
-	[ &quot;$ENABLE_USESSION&quot; = &quot;1&quot; ] || return
-	$COMMAND_SESSREG -l &quot;:$SESS_DISPLAY&quot; -h &quot;$USERIP&quot; -d $USER 2&gt;&amp;1 | log_error
-}
-
-server_nxnode_echo()
-{
-	log 6 &quot;server_nxnode_echo: $@&quot;
-	[ &quot;$SERVER_CHANNEL&quot; = &quot;1&quot; ] &amp;&amp; echo &quot;$@&quot;
-	[ &quot;$SERVER_CHANNEL&quot; = &quot;2&quot; ] &amp;&amp; echo &quot;$@&quot; &gt;&amp;2
-}
-
-server_nxnode_exit_func()
-{
-	log 1 &quot;Info: Emergency-Shutting down due to kill signal ...&quot;
-	
-	session_fail $uniqueid
-	
-	server_remove_usession
-
-	# remove lock file
-	[ -e &quot;/tmp/.nX$SESS_DISPLAY-lock&quot; ] &amp;&amp; rm -f /tmp/.nX$SESS_DISPLAY-lock
-
-	# Kill possible slave node
-	nxnode_login_stop_slave
-}
-
-server_nxnode_start_wait()
-{
-	if [ &quot;$1&quot; = &quot;--startsession&quot; ]
-	then
-	
-	server_add_usession
-
-	# We need to stop sending things when a SIGPIPE arrives
-	trap &quot;SERVER_CHANNEL=0&quot; SIGPIPE
-	
-	trap server_nxnode_exit_func EXIT
-	
-	SERVER_CHANNEL=1
-	KILL_WAIT_PID=1
-	server_nxnode_start &quot;$@&quot; | while read CMD
-	do
-		case &quot;$CMD&quot; in 
-			&quot;NX&gt; 1006&quot;*|&quot;NX&gt; 1005&quot;*|&quot;NX&gt; 1009&quot;*)
-				case &quot;$CMD&quot; in 
-					*running*)
-						[ &quot;$KILL_WAIT_PID&quot; = &quot;1&quot; ] &amp;&amp; kill $SERVER_WAIT_PID
-						KILL_WAIT_PID=0
-						log 6 session_status $uniqueid &quot;Running&quot;
-						session_status $uniqueid &quot;Running&quot;
-						[ &quot;$SERVER_CHANNEL&quot; = &quot;1&quot; ] &amp;&amp; SERVER_CHANNEL=2
-					;;
-					*closed*)
-						log 6 session_close $uniqueid
-						session_close $uniqueid
-					;;
-					*suspended*)
-						[ &quot;$KILL_WAIT_PID&quot; = &quot;1&quot; ] &amp;&amp; kill $SERVER_WAIT_PID
-						KILL_WAIT_PID=0
-						log 6 session_suspend $uniqueid
-						session_suspend $uniqueid
-					;;
-					*suspending*)
-						log 6 session_status $uniqueid &quot;Suspending&quot;
-						session_status $uniqueid &quot;Suspending&quot;
-						# we need to stop sending to client as it will have already
-						# closed his side of the channel and this will lead to not 
-						# closed sessions.
-						SERVER_CHANNEL=0
-					;;
-					*terminating*)
-						log 6 session_status $uniqueid &quot;Terminating&quot;
-						session_status $uniqueid &quot;Terminating&quot;
-						# we need to stop sending to client as it will have already
-						# closed his side of the channel and this will lead to not 
-						# closed sessions.
-						SERVER_CHANNEL=0
-				esac
-			;;
-			&quot;NX&gt; 1004&quot;*)
-				[ &quot;$KILL_WAIT_PID&quot; = &quot;1&quot; ] &amp;&amp; kill $SERVER_WAIT_PID
-				KILL_WAIT_PID=0
-				session_fail $uniqueid
-				server_nxnode_echo &quot;NX&gt; 596 Session startup failed.&quot;
-				log 4 &quot;NX&gt; 596 Session startup failed.&quot;
-			;;
-		esac
-
-		case $CMD in
-			&quot;NX&gt; &quot;*)
-				server_nxnode_echo $CMD
-			;;
-		esac
-	done
-
-	trap - EXIT
-	trap - SIGPIPE
-	
-	# Close it in case the session is still running
-	session_running $uniqueid &amp;&amp; session_close $uniqueid
-	
-	server_remove_usession
-
-	# remove lock file
-	[ -e &quot;/tmp/.nX$SESS_DISPLAY-lock&quot; ] &amp;&amp; rm -f /tmp/.nX$SESS_DISPLAY-lock
-
-	nxnode_login_stop_slave
-
-	else # $1 = restore
-	
-	KILL_WAIT_PID=1
-	SERVER_CHANNEL=1
-	server_nxnode_start &quot;$@&quot; | while read CMD
-	do
-		case &quot;$CMD&quot; in 
-			&quot;NX&gt; 1006&quot;*|&quot;NX&gt; 1005&quot;*|&quot;NX&gt; 1009&quot;*)
-				case &quot;$CMD&quot; in 
-					*running*)
-						[ &quot;$KILL_WAIT_PID&quot; = &quot;1&quot; ] &amp;&amp; kill $SERVER_WAIT_PID
-						KILL_WAIT_PID=0
-						SERVER_CHANNEL=2
-					;;
-				esac
-			;;
-			&quot;NX&gt; 1004&quot;*)
-				[ &quot;$KILL_WAIT_PID&quot; = &quot;1&quot; ] &amp;&amp; kill $SERVER_WAIT_PID
-				KILL_WAIT_PID=0
-				
-				# This fail is correct here as somehow the 
-				# monitor process might have died and we don't 
-				# want the session to be resumed again.
-				
-				session_fail $uniqueid
-				
-				server_nxnode_echo &quot;NX&gt; 596 Session startup failed.&quot;
-				log 4 &quot;NX&gt; 596 Session startup failed.&quot;
-				break;
-			;;
-		esac
-	
-		case $CMD in
-			&quot;NX&gt; &quot;*)
-				server_nxnode_echo $CMD
-			;;
-		esac
-	done
-	
-	nxnode_login_stop_slave
-	
-	fi # $1 = start
-}
-
-server_check_session_count()
-{
-	session_count_user &quot;$USER&quot;
-	
-	if [ &quot;$SESSION_COUNT&quot; -ge &quot;$SESSION_LIMIT&quot; ]
-	then
-		echo_x &quot;NX&gt; 599 Reached the maximum number of concurrent sessions on this server.&quot;
-		echo_x &quot;NX&gt; 500 ERROR: Last operation failed.&quot;
-		return 1
-	fi
-	
-	if [ &quot;$SESSION_COUNT_USER&quot; -ge &quot;$SESSION_USER_LIMIT&quot; ]
-	then
-		echo_x &quot;NX&gt; 599 Server capacity: reached for user: $USER&quot;
-		echo_x &quot;NX&gt; 500 ERROR: Last operation failed.&quot;
-		return 1
-	fi
-
-	return 0
-}
-
-server_loadbalance_random()
-{
-	# Pick one based on &quot;random&quot; algorithm
-	SERVER_LB_HOSTS=( $LOAD_BALANCE_SERVERS )
-	SERVER_LB_NR_OF_HOSTS=${#SERVER_LB_HOSTS[@]}
-	let SERVER_LB_NR=(RANDOM % SERVER_LB_NR_OF_HOSTS)
-	SERVER_LB_HOST=${SERVER_LB_HOSTS[$SERVER_LB_NR]}
-	echo $SERVER_LB_HOST
-}
-
-# run in subshell!
-
-server_loadbalance_round_robin()
-{
-	SERVER_LB_HOSTS=( $LOAD_BALANCE_SERVERS )
-	SERVER_LB_NR_OF_HOSTS=${#SERVER_LB_HOSTS[@]}
-	
-	# Atomic incrementation:
-
-	# Enter critical section
-	# - Create .lock file
-	
-	SERVER_LB_LOCKFILE=$(mktemp &quot;$NX_SESS_DIR/round-robin.lock.XXXXXXXXX&quot;)
-
-	trap &quot;rm -f $SERVER_LB_LOCKFILE&quot; EXIT
-	
-	i=0
-	while [ $i -lt 200 ]
-	do
-		# ln is an atomic operation
-		ln $SERVER_LB_LOCKFILE &quot;$NX_SESS_DIR/round-robin.lock&quot; &amp;&amp; break
-		LANG=C sleep 0.01
-		let i=i+1
-	done
-
-	if [ $i -ge 200 ]
-	then
-		log 1 &quot;Load-Balancing: Round-Robin failed to gain lock file in 200 tries. Falling back to random.&quot;
-		server_loadbalance_random
-		return
-	fi
-	
-	trap &quot;rm -f $SERVER_LB_LOCKFILE $NX_SESS_DIR/round-robin.lock&quot; EXIT
-
-	# Lock held
-
-	SERVER_LB_NR=$(cat $NX_SESS_DIR/round-robin 2&gt;/dev/null)
-	let SERVER_LB_NR=(SERVER_LB_NR+1) % SERVER_LB_NR_OF_HOSTS
-	echo $SERVER_LB_NR &gt;$NX_SESS_DIR/round-robin
-
-	# Exit critical section
-	rm -f &quot;$SERVER_LB_LOCKFILE $NX_SESS_DIR/round-robin.lock&quot;
-
-	trap - EXIT
-
-	SERVER_LB_HOST=${SERVER_LB_HOSTS[$SERVER_LB_NR]}
-	echo $SERVER_LB_HOST
-}
-
-server_loadbalance_load()
-{
-	SERVER_LB_MAX=0
-	SERVER_LB_HOST=&quot;&quot;
-	
-	for i in $LOAD_BALANCE_SERVERS
-	do
-		SERVER_LB_LOAD=$($NX_DIR/bin/nxcheckload $i)
-		[ -z &quot;$SERVER_LB_LOAD&quot; ] &amp;&amp; continue
-		
-		if [ $SERVER_LB_LOAD -gt $SERVER_LB_MAX ]
-		then
-			SERVER_LB_MAX=$SERVER_LB_LOAD
-			SERVER_LB_HOST=$i
-		fi
-	done
-	echo $SERVER_LB_HOST
-}
-
-server_loadbalance()
-{
-	SERVER_HOST=&quot;127.0.0.1&quot;
-	if [ -n &quot;$LOAD_BALANCE_SERVERS&quot; ]
-	then
-		SERVER_HOST=&quot;&quot;
-		if [ -n &quot;$PREFERRED_HOST&quot; -a &quot;$ENABLE_LOAD_BALANCE_PREFERENCE&quot; = &quot;1&quot; ]
-		then
-			stringinstring &quot; $PREFERRED_HOST &quot; &quot; $LOAD_BALANCE_SERVERS &quot; &amp;&amp; SERVER_HOST=&quot;$PREFERRED_HOST&quot;
-		fi
-		
-		# Fallback if still empty
-		if [ -z &quot;$SERVER_HOST&quot; ]
-		then
-			case &quot;$LOAD_BALANCE_ALGORITHM&quot; in
-				random)
-					SERVER_HOST=$(server_loadbalance_random)
-				;;
-				round-robin)
-					SERVER_HOST=$(server_loadbalance_round_robin)
-				;;
-				load)
-					SERVER_HOST=$(server_loadbalance_load)
-				;;
-			esac
-		fi
-		
-		[ -z &quot;$SERVER_HOST&quot; ] &amp;&amp; SERVER_HOST=&quot;127.0.0.1&quot;
-		[ -n &quot;$SERVER_HOST&quot; ] &amp;&amp; log 5 &quot;Info: Load-Balancing (if possible) to $SERVER_HOST ...&quot;
-	fi
-	echo &quot;$SERVER_HOST&quot;
-}	
-
-server_startrestore_session()
-{
-	ACTION=&quot;$1&quot;
-	
-	server_get_params $CMD
-	PARAMS=$SERVER_PARAMS
-	PARAMS=&quot;$PARAMS&amp;clientproto=$PROTO&quot;
-	CMDLINE=$PARAMS
-	echo_x
-	
-	# If we can't get the userip and SSHD_CHECK_IP is set to 1
-	# we bail out.
-	if [ -z &quot;$SSH_CLIENT&quot; -a -z &quot;$SSH2_CLIENT&quot; ]
-	then 
-		if [ &quot;$SSHD_CHECK_IP&quot; = &quot;1&quot; ]
-		then
-			echo_x &quot;NX&gt; 596 Session startup failed. (Missing SSH_CLIENT environment variable)&quot;
-			return 1
-		else
-			log 2 &quot;Warning: Failed to determine the client IP.&quot;
-			log 2 &quot;Warning: The SSH_CLIENT or SSH2_CLIENT variable was not provided by SSHD.&quot;
-			log 2 &quot;Warning: Please set SSHD_CHECK_IP=1 if you want to refuse the connection.&quot;
-		fi
-	fi
-	
-	export ENCRYPTION=$(getparam encryption)
-	
-	if [ &quot;$ENABLE_FORCE_ENCRYPTION&quot; = &quot;1&quot; -a &quot;$ENCRYPTION&quot; != &quot;1&quot; ]
-	then
-			echo_x &quot;NX&gt; 596 Unencrypted sessions are not allowed.&quot;
-			return 1
-	fi
-
-	# check if there is a suspended session, which we could resume
-	if [ &quot;$ENABLE_AUTORECONNECT&quot; = &quot;1&quot; -a &quot;$ACTION&quot; = &quot;start&quot; ]
-	then
-		restore=$(session_get_user_suspended &quot;$USER&quot; &quot;Suspended&quot;)
-		if [ -n &quot;$restore&quot; ]
-		then
-			PARAMS=&quot;$PARAMS&amp;restore=$restore&quot;
-			CMDLINE=$PARAMS
-			ACTION=&quot;resume&quot;
-		fi
-	fi
-
-	# as only $SSH_CLIENT or $SSH2_CLIENT will be set, this should work
-	USERIP=$(echo $SSH_CLIENT $SSH2_CLIENT | cut -d&quot; &quot; -f1 | sed 's/::<A HREF="ffff://g">ffff://g</A>')
-	[ -z &quot;$USERIP&quot; ] &amp;&amp; USERIP=&quot;*&quot;
-	if [ &quot;$ACTION&quot; = &quot;start&quot; ]
-	then
-		server_check_session_count || return 1
-		
-		# start nxnode
-		SESS_DISPLAY=$DISPLAY_BASE
-		let SESS_DISPLAY_LIMIT=$DISPLAY_BASE+$DISPLAY_LIMIT
-	
-		# stupid but working algo ...
-			
-		# TODO: need to check for _all_ offset and ports :-/
-			
-		while true
-		do
-			while [ -e /tmp/.X$SESS_DISPLAY-lock -o -e &quot;/tmp/.nX$SESS_DISPLAY-lock&quot; ]
-			do
-				let SESS_DISPLAY=$SESS_DISPLAY+1
-			done
-
-			# Check if there is already an agent running on that display
-			let AGENT_DISPLAY=$SESS_DISPLAY+6000
-			if $COMMAND_NETCAT -z 127.0.0.1 $AGENT_DISPLAY 2&gt;/dev/null
-			then
-				log 2 &quot;Warning: Stray nxagent without .X$SESS_DISPLAY-lock found on port $AGENT_DISPLAY.&quot;
-				let SESS_DISPLAY=$SESS_DISPLAY+1
-				continue
-			fi
-			
-
-			SESS_LOCKFILE=$(mktemp &quot;/tmp/.nX$SESS_DISPLAY-lock.XXXXXXXXX&quot;)
-			# ln is an atomic operation
-			ln &quot;$SESS_LOCKFILE&quot; &quot;/tmp/.nX$SESS_DISPLAY-lock&quot; 2&gt;/dev/null &amp;&amp; break
-		done
-
-		rm -f &quot;$SESS_LOCKFILE&quot;
-		
-		if [ &quot;$SESS_DISPLAY&quot; -gt &quot;$SESS_DISPLAY_LIMIT&quot; ]
-		then
-			echo_x &quot;NX&gt; 596 Error: Display limit exceeded. Please remove some files from /tmp/.X*-lock.&quot;
-			rm -f &quot;/tmp/.nX$SESS_DISPLAY-lock&quot;
-			return
-		fi
-	
-		uniqueid=$(echo $[$RANDOM*$RANDOM] | $COMMAND_MD5SUM | cut -d&quot; &quot; -f1 | tr &quot;[a-z]&quot; &quot;[A-Z]&quot;)
-
-		# Possibly do loadbalancing
-		
-		SERVER_HOST=$(server_loadbalance)
-		
-		FULL_PARAMS=&quot;$PARAMS&amp;user=$USER&amp;userip=$USERIP&amp;uniqueid=$uniqueid&amp;display=$SESS_DISPLAY&amp;host=$SERVER_HOST&quot;
-		log_secure &quot;6&quot; &quot;$FULL_PARAMS&quot;
-
-		# now update the session listing
-		sessionRootlessMode=0
-		[ &quot;$(getparam rootless)&quot; = &quot;1&quot; ] &amp;&amp; sessionRootlessMode=1
-		CMDLINE=&quot;a=b&amp;$FULL_PARAMS&quot;
-		session_add $uniqueid &quot;sessionName=$(getparam session)&amp;display=$(getparam display)&amp;status=Running&amp;startTime=$(date +%s)&amp;foreignAddress=$(getparam userip)&amp;sessionRootlessMode=$sessionRootlessMode&amp;type=$(getparam type)&amp;sessionId=$uniqueid&amp;creationTime=$(date +%s)&amp;userName=$USER&amp;serverPid=$SERVER_PID&amp;screeninfo=$(getparam screeninfo)&amp;geometry=$(getparam geometry)&amp;host=$SERVER_HOST&quot;
-	else
-		uniqueid=$(getparam restore)
-		[ -z &quot;$uniqueid&quot; ] &amp;&amp; uniqueid=$(getparam id) # 1.4.0-5 compatibility
-		session_change &quot;$uniqueid&quot; &quot;foreignAddress&quot; &quot;$USERIP&quot;
-
-		CMDLINE=$(session_get &quot;$uniqueid&quot;)
-		FULL_PARAMS=&quot;$PARAMS&amp;user=$USER&amp;userip=$(getparam foreignAddress)&amp;uniqueid=$uniqueid&amp;display=$(getparam display)&amp;status=$(getparam status)&quot;
-		SESS_DISPLAY=$(getparam display)
-		SERVER_HOST=$(getparam host)
-		[ -z &quot;$SERVER_HOST&quot; ] &amp;&amp; SERVER_HOST=&quot;127.0.0.1&quot;
-	fi
-
-	# now start the node
-	sleep $AGENT_STARTUP_TIMEOUT &amp;
-	SERVER_WAIT_PID=$!
-	( server_nxnode_start_wait --&quot;$ACTION&quot;session $USER &quot;$FULL_PARAMS&quot; ) &amp;
-	SERVER_PID=$!
-	disown $SERVER_PID
-	
-	wait $SERVER_WAIT_PID
-	
-	if [ $? -eq 0 ]
-	then
-		# Something went wrong ...
-		[ &quot;$ACTION&quot; = &quot;start&quot; ] &amp;&amp; session_fail $uniqueid
-		echo_x &quot;NX&gt; 1004 Error: Session did not start.&quot;
-		echo_x &quot;NX&gt; 596 Session $ACTION failed.&quot;
-		echo_x &quot;NX&gt; 999 Bye&quot;
-		# FIXME: Send node signal to terminate
-		exit 1
-	fi
-	
-	# We have now an active reader
-	nxnode_login_register_reader
-}
-
-# Session stage
-while true
-do
-	echo_x -n &quot;NX&gt; 105 &quot;
-	unset CMD
-	read CMD 2&gt;/dev/null
-	# FIXME?
-	[ &quot;$CMD&quot; = &quot;&quot; ] &amp;&amp; CMD=&quot;quit&quot;
-	
-	# Logging 
-	case &quot;$CMD&quot; in
-		startsession*|restoresession*|addmount*|addprinter*)
-			echo_secure &quot;$CMD&quot;
-			log_secure &quot;4&quot; &quot;$CMD&quot;
-		;;
-		*)
-			echo &quot;$CMD&quot;
-			log &quot;4&quot; &quot;$CMD&quot;
-		;;
-	esac
-	
-	case &quot;$CMD&quot; in 
-		quit|QUIT)
-			echo_x &quot;Quit&quot;
-			echo_x &quot;NX&gt; 999 Bye&quot;
-			exit 0
-		;;
-		exit|EXIT)
-			echo_x &quot;Exit&quot;
-			echo_x &quot;NX&gt; 999 Bye&quot;
-			exit 0
-		;;
-		bye|BYE)
-			echo_x &quot;Bye&quot; 1&gt;&amp;2
-			echo_x &quot;NX&gt; 999 Bye&quot; 1&gt;&amp;2
-			if [ &quot;$ENCRYPTION&quot; = &quot;1&quot; ] 
-			then 
-				let PROXY_DISPLAY=$SESS_DISPLAY+4000
-				exec $COMMAND_NETCAT $SERVER_HOST $PROXY_DISPLAY
-			else
-				echo_x &quot;NX&gt; 1001 Bye.&quot;
-			fi
-		;;
-		startsession*)
-			server_startrestore_session &quot;start&quot;
-		;;
-		list*)
-			server_get_params $CMD
-			PARAMS=$SERVER_PARAMS
-			CMDLINE=$PARAMS
-			
-			status=$(getparam status)
-
-			if [ &quot;$status&quot; = &quot;Suspended&quot; -a -n &quot;$(getparam screeninfo)&quot; ]
-			then
-				session_list_user_suspended &quot;$USER&quot; &quot;Suspended&quot; &quot;$(getparam screeninfo)&quot; &quot;$(getparam type)&quot; | log_tee
-			elif [ &quot;$status&quot; = &quot;Suspended,Running&quot; -o &quot;$status&quot; = &quot;Suspended&quot; ] # since 1.4.0-5
-			then
-				# disabled due to problems with 1.4.0-5 client
-				#session_list_user_suspended &quot;$USER&quot; 'Suspended$|^status=Running$' &quot;$(getparam geometry)&quot; &quot;$(getparam type)&quot; | log_tee
-				session_list_user_suspended &quot;$USER&quot; 'Suspended' &quot;$(getparam geometry)&quot; &quot;$(getparam type)&quot; | log_tee
-			elif [ &quot;$status&quot; = &quot;suspended,running&quot; -o &quot;$status&quot; = &quot;suspended&quot; ] # since 1.5.0
-			then
-				status=$(echo $status | sed 's/,/$|^status=/g; s/suspended/Suspended/g; s/running/Running/g')
-				session_list_user_suspended &quot;$USER&quot; &quot;$status&quot; &quot;$(getparam geometry)&quot; &quot;$(getparam type)&quot; | log_tee
-			else
-				session_list_user &quot;$USER&quot; | log_tee
-			fi
-		;;
-		suspend*)
-			server_get_params $CMD
-			PARAMS=$SERVER_PARAMS
-			CMDLINE=$PARAMS
-			if session_find_id_user &quot;$(getparam sessionid)&quot; &quot;$USER&quot;
-			then
-				server_nxnode_start --suspend &quot;$USER&quot; &quot;$PARAMS&quot;
-			fi
-		;;
-		terminate*)
-			server_get_params $CMD
-			PARAMS=$SERVER_PARAMS
-			CMDLINE=$PARAMS
-			if session_find_id_user &quot;$(getparam sessionid)&quot; &quot;$USER&quot;
-			then
-				server_nxnode_start --terminate &quot;$USER&quot; &quot;$PARAMS&quot;
-			fi
-		;;
-		restoresession*)
-			server_startrestore_session &quot;resume&quot;
-		;;
-		passwd)
-			echo_x &quot;NX&gt; 113 Changing password of user '$USER'&quot;
-			echo_x -n &quot;NX&gt; 102 Current password:&quot;
-			read -s PASS
-			ENC_PASS=$(passdb_get_crypt_pass &quot;$PASS&quot;)
-			REAL_PASS=$(passdb_get_pass &quot;$USER&quot;)
-			echo_x
-			if [ &quot;$ENC_PASS&quot; = &quot;$REAL_PASS&quot; ]
-			then
-				echo_x -n &quot;NX&gt; 102 Password:&quot;
-				read -s NEW_PASS1
-				
-				if [ ${#NEW_PASS1} -lt 5 ]
-				then
-					echo_x &quot;NX&gt; 500 ERROR: incorrect password format, password must be long at least five characters&quot;
-					continue
-				fi
-
-				echo_x
-				echo_x -n &quot;NX&gt; 102 Confirm password:&quot;
-				read -s NEW_PASS1
-				echo_x
-				if [ &quot;$NEW_PASS1&quot; = &quot;$NEW_PASS2&quot; ]
-				then
-					ENC_PASS=$(passdb_get_crypt_pass &quot;$NEW_PASS1&quot;)
-					passdb_chpass &quot;$USER&quot; &quot;$ENC_PASS&quot;
-					echo_x &quot;NX&gt; 114 Password of user '$USER' changed&quot;
-				else
-					echo_x &quot;NX&gt; 537 ERROR: passwords do not match&quot;
-				fi
-			else
-				echo_x &quot;NX&gt; 500 ERROR: current password doesn't match&quot;
-			fi
-		;;
-		addmount*)
-			server_get_params $CMD
-			PARAMS=$SERVER_PARAMS
-			# TODO: This redirection is crap here.
-			server_nxnode_start --smbmount &quot;$USER&quot; &quot;$PARAMS&quot; &gt;/dev/null 2&gt;&amp;1 | log_error &gt;/dev/null
-			echo_x &quot;NX&gt; 719 SMB filesystem: running&quot;
-		;;
-		addprinter*)
-			server_get_params $CMD
-			PARAMS=$SERVER_PARAMS
-			# TODO: This redirecion is crap here.
-			server_nxnode_start --addprinter &quot;$USER&quot; &quot;$PARAMS&quot; &gt;/dev/null 2&gt;&amp;1 | log_error &gt;/dev/null
-			echo_x &quot;NX&gt; 719 CUPS printer: running&quot;
-		;;
-		*)
-			# disabled for 1.4.0-5 snapshot client
-			#echo_x &quot;NX&gt; 503 Error: undefined command: '$CMD'&quot;
-		;;
-	esac
-done
-
-fi
-
-#
-# End of Main nxserver &lt;--&gt; nxclient communication module
-#
-
-################### PACKAGE cmd.bm ############################
-
-#
-# library functions for nxserver-commandline cmds
-#
-
-# Policy: All functions and variables need to start with CMD_ / cmd_
-
-# Needed global vars: $NX_VERSION, $NX_LICENSE, $NX_ETC_DIR, $PATH_BIN, $NX_HOME_DIR, $SSH_AUTHORIZED_KEYS
-
-# Needed package: passdb
-
-cmd_usage()
-{
-	echo &quot;NXSERVER - Version $NX_VERSION $NX_LICENSE&quot; 1&gt;&amp;2
-	echo &quot;Usage: nxserver &lt;option&gt;&quot; 1&gt;&amp;2
-
-	if [ &quot;$1&quot; = &quot;root&quot; ]
-	then
-		echo &quot;--adduser &lt;user&gt;: Add a new user&quot; 1&gt;&amp;2
-		echo &quot;--passwd &lt;user&gt;: Change password of &lt;user&gt;&quot; 1&gt;&amp;2
-		echo &quot;--deluser &lt;user&gt;: Remove a user from nx&quot; 1&gt;&amp;2
-		echo &quot;--listuser: List enabled users&quot; 1&gt;&amp;2
-		echo &quot;&quot; 1&gt;&amp;2
-		echo &quot;--start: Start the nx server&quot; 1&gt;&amp;2
-		echo &quot;--stop: Stop the nx server&quot; 1&gt;&amp;2
-		echo &quot;--status: Show status of nx server&quot; 1&gt;&amp;2
-		echo &quot;--restart: Restart the nx server. (start,stop)&quot; 1&gt;&amp;2
-		echo &quot;&quot; 1&gt;&amp;2
-		echo &quot;--list [ user | sessionid ]: List running sessions of user or sessionid &quot; 1&gt;&amp;2
-		echo &quot;--history [ user | sessionid | clear ]: Show history [ of user | sessionid ] or clear the history&quot; 1&gt;&amp;2
-		echo &quot;--terminate &lt;user | :display | sessionid&gt;: Terminate the session pointed to by&quot; 1&gt;&amp;2
-		echo &quot;       sessionid or display, or all sessions of the specified user.&quot; 1&gt;&amp;2
-		echo &quot;       Use * for all sessions.&quot; 1&gt;&amp;2
-		echo &quot;--force-terminate: Like terminate, but removes also session info.&quot; 1&gt;&amp;2
-		echo &quot;--suspend &lt;user | :display | sessionid&gt;: Suspend the session pointed to by&quot; 1&gt;&amp;2
-		echo &quot;       sessionid or display, or all sessions of the specified user.&quot; 1&gt;&amp;2
-		echo &quot;       Use * for all sessions.&quot; 1&gt;&amp;2
-		echo &quot;--cleanup: Terminates all running sessions. Useful after power-outage.&quot;
-		echo &quot;&quot; 1&gt;&amp;2
-		echo &quot;--broadcast &lt;message&gt;: Send a message to all users&quot; 1&gt;&amp;2
-		echo &quot;--send &lt;user | :display | sessionid&gt; &lt;message&gt;: Send a message to the specified user or sessionid&quot; 1&gt;&amp;2
-	else
-		echo &quot;--passwd: Change password&quot; 1&gt;&amp;2
-	fi
-	exit 1
-}
-
-
-cmd_abort()
-{
-	echo &quot;NX&gt; 500&quot; &quot;$@&quot; 1&gt;&amp;2
-	echo &quot;NX&gt; 999 Bye&quot; 1&gt;&amp;2
-	exit 1
-}
-
-cmd_user_passwd()
-{
-	echo &quot;NX&gt; 100 NXSERVER - Version $NX_VERSION $NX_LICENSE&quot;
-	echo &quot;Sorry: Password changing for user is _not_ implemented, yet.&quot;
-	echo &quot;Please login to NX-Server to change password&quot;
-	echo &quot;or ask your local system administrator.&quot;
-	#echo &quot;NX&gt; 113 Changing password of user '$USER'&quot;
-	#echo &quot;Old password:&quot;
-	#read -s OLDPASS
-	#echo &quot;New password:&quot;
-	#read -s NEWPASS1
-	#echo &quot;Repeat:&quot;
-	#read -s NEWPASS2
-
-}
-
-cmd_passwd()
-{
-	CMD_CHUSER=$2
-	egrep -q &quot;^$CMD_CHUSER:&quot; $NX_ETC_DIR/passwords || cmd_abort &quot;Error: User $CMD_CHUSER not found in database.&quot;
-	echo -n &quot;New password: &quot;
-	read -s CMD_NEWPASS
-	echo
-	CMD_ENC_PASS=$(passdb_get_crypt_pass &quot;$CMD_NEWPASS&quot;)
-	passdb_chpass &quot;$CMD_CHUSER&quot; &quot;$CMD_ENC_PASS&quot;
-	echo &quot;Password changed.&quot;
-}
-
-cmd_adduser()
-{
-	CMD_CHUSER=$2
-	
-	[ ${#CMD_CHUSER} -ge 32 ] &amp;&amp; cmd_abort &quot;Error: User $CMD_CHUSER must be shorter than 32 characters.&quot;
-	egrep -q &quot;^$CMD_CHUSER:&quot; $NX_ETC_DIR/passwords &amp;&amp; cmd_abort &quot;Error: User $CMD_CHUSER already in database.&quot;
-	getent passwd &quot;$CMD_CHUSER&quot; &gt;/dev/null || cmd_abort &quot;Error: User $CMD_CHUSER not existing on local system. Can't add.&quot;
-	passdb_add_user &quot;$CMD_CHUSER&quot;
-}
-
-cmd_deluser()
-{
-	CMD_CHUSER=$2
-	egrep -q &quot;^$CMD_CHUSER:&quot; $NX_ETC_DIR/passwords || cmd_abort &quot;Error: User $CMD_CHUSER not found in database.&quot;
-	passdb_remove_user &quot;$CMD_CHUSER&quot;
-}
-
-cmd_listuser()
-{
-	echo &quot;NX&gt; 146 NX users list&quot;
-	echo
-	echo &quot;Username&quot;
-	echo &quot;---------------&quot;
-	echo
-	passdb_list_user
-	echo
-}
-
-cmd_start()
-{
-	
-	[ -f $NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS ] &amp;&amp; cmd_abort &quot;ERROR: Service already running&quot;
-	mv $NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS.disabled $NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS
-	echo &quot;NX&gt; 122 Service started&quot;
-}
-
-cmd_stop()
-{
-	[ -f $NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS ] || cmd_abort &quot;Service was already stopped&quot;
-	mv $NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS $NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS.disabled
-	echo &quot;NX&gt; 123 Service stopped&quot;
-}
-
-cmd_status()
-{
-	[ -f $NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS ] &amp;&amp; echo &quot;NX&gt; 110 NX Server is running&quot;
-	[ -f $NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS ] || echo &quot;NX&gt; 110 NX Server is stopped&quot;
-}
-
-cmd_restart()
-{
-	cmd_stop
-	cmd_start
-}
-
-cmd_parse_2_params()
-{
-	if [ ${#1} -eq 32 ]
-	then
-		CMD_APARAMS=&quot;sessionid=sessionId{$1}&quot;
-	else
-	if [ &quot;$1&quot; != &quot;&quot; ]
-	then
-		#egrep -q &quot;^$1:&quot; $NX_ETC_DIR/passwords || cmd_abort &quot;Error: User $1 not found in database.&quot;
-		CMD_APARAMS=&quot;user=$1&quot;
-	fi
-	fi
-	echo $CMD_APARAMS
-
-}
-
-cmd_parse_3_params()
-{
-	if [ ${#1} -eq 32 ]
-	then
-		CMD_APARAMS=$(session_find_id $1)
-		[ -n &quot;$CMD_APARAMS&quot; ] || cmd_abort &quot;Error: Session $1 could not be found.&quot;
-	elif [ &quot;${1:0:1}&quot; = &quot;:&quot; ]
-	then
-		CMD_APARAMS=$(session_find_display &quot;${1:1}&quot;)
-		[ -n &quot;$CMD_APARAMS&quot; ] || cmd_abort &quot;Error: No running sessions found for display $1.&quot;
-	elif [ &quot;$1&quot; = &quot;*&quot; ]
-	then
-		CMD_APARAMS=$(session_find_all)
-		[ -n &quot;$CMD_APARAMS&quot; ] || cmd_abort &quot;Error: No running sessions found.&quot;
-	elif [ &quot;$1&quot; != &quot;&quot; ]
-	then
-		#egrep -q &quot;^$1:&quot; $NX_ETC_DIR/passwords || cmd_abort &quot;Error: User $1 not found in database.&quot;
-		CMD_APARAMS=$(session_find_user &quot;$1&quot;)
-		[ -n &quot;$CMD_APARAMS&quot; ] || cmd_abort &quot;Error: No running sessions found for user $1.&quot;
-	else
-		cmd_abort &quot;Error: Not enough parameters.&quot;
-	fi
-	echo $CMD_APARAMS
-}
-
-cmd_list_suspended()
-{
-	CMD_PARAMS=$(cmd_parse_2_params &quot;$2&quot;)
-	[ -n &quot;$2&quot; -a -z &quot;$CMD_PARAMS&quot; ] &amp;&amp; exit 1
-	case $CMD_PARAMS in
-		user=*)
-			session_list_user_suspended $2 &quot;Suspended&quot;
-		;;
-	esac
-}
-cmd_list()
-{
-	CMD_PARAMS=$(cmd_parse_2_params &quot;$2&quot;)
-	[ -n &quot;$2&quot; -a -z &quot;$CMD_PARAMS&quot; ] &amp;&amp; exit 1
-	case $CMD_PARAMS in
-		user=*)
-			session_list_user $2
-		;;
-		sessionid=*)
-			session_list $2
-		;;
-		*)
-			session_list_all
-		;;
-	esac
-}
-
-cmd_history_clear()
-{
-	rm -f $NX_SESS_DIR/closed/*
-	rm -f $NX_SESS_DIR/failed/*
-}
-
-cmd_history()
-{
-	if [ &quot;$2&quot; = &quot;clear&quot; ]
-	then
-		cmd_history_clear
-	fi
-	
-	CMD_PARAMS=$(cmd_parse_2_params &quot;$2&quot;)
-	user=&quot;&quot;
-	sessid=&quot;&quot;
-	case $CMD_PARAMS in
-		user=*)
-			user=&quot;$2&quot;
-		;;
-		sessionid=*)
-			sessid=&quot;$2&quot;
-		;;
-	esac
-
-	session_history &quot;$user&quot; &quot;$sessid&quot;
-}
-
-cmd_terminate()
-{
-	CMD_PARAMS=$(cmd_parse_3_params &quot;$2&quot;)
-	[ -z &quot;$CMD_PARAMS&quot; ] &amp;&amp; exit 1
-	for i in $CMD_PARAMS;
-	do
-			CMDLINE=$(session_get_cmdline $i)
-			cmd_sessionid=$(getparam sessionId)
-			cmd_user=$(getparam userName)
-			cmd_type=$(getparam type)
-			cmd_status=$(getparam status)
-
-			# is it a &quot;good&quot; session?
-			case &quot;$1&quot; in 
-			--suspend)
-				if [ &quot;$cmd_status&quot; = &quot;Running&quot; ] &amp;&amp; stringinstring &quot;unix-&quot; &quot;$cmd_type&quot;
-				then
-					echo &quot;sessionid=$cmd_sessionid&quot; | su - &quot;$cmd_user&quot; -c &quot;$PATH_BIN/nxnode --suspend&quot;
-				fi
-			;;
-			--terminate)
-				echo &quot;sessionid=$cmd_sessionid&quot; | su - &quot;$cmd_user&quot; -c &quot;$PATH_BIN/nxnode --terminate&quot;
-			;;
-			--force-terminate)
-				echo &quot;sessionid=$cmd_sessionid&quot; | su - &quot;$cmd_user&quot; -c &quot;$PATH_BIN/nxnode --terminate&quot;
-				session_close $cmd_sessionid
-			;;
-			esac
-	done
-
-}
-
-cmd_send()
-{
-	if [ &quot;$1&quot; = &quot;--broadcast&quot; ]
-	then
-	  CMD_PARAMS=$(session_find_all)
-	  [ -z &quot;$CMD_PARAMS&quot; ] &amp;&amp; cmd_abort &quot;Error: No running session could be found.&quot;
-	else
-	  CMD_PARAMS=$(cmd_parse_3_params &quot;$2&quot;)
-	  [ -z &quot;$CMD_PARAMS&quot; ] &amp;&amp; exit 1
-	  shift
-	fi
-	shift
-	for i in $CMD_PARAMS;
-	do
-			CMDLINE=$(session_get_cmdline $i)
-			cmd_display=$(getparam display)
-			cmd_user=$(getparam userName)
-			cmd_type=$(getparam type)
-			cmd_status=$(getparam status)
-
-			# is it a &quot;good&quot; session?
-			if [ &quot;$cmd_status&quot; = &quot;Running&quot; ] &amp;&amp; stringinstring &quot;unix-&quot; &quot;$cmd_type&quot;
-			then
-				su - &quot;$cmd_user&quot; -c &quot;$PATH_BIN/nxclient --dialog ok --caption \&quot;NX Administrator Message\&quot; --message \&quot;$@\&quot; --noautokill -display \&quot;:$cmd_display\&quot;&quot; &amp;
-				disown $!
-			fi
-	done
-	#nxnode_start --send &quot;$CMD_PARAMS&quot;
-}
-
-#
-# user mode available functions
-#
-
-if [ $UID -ne 0 ]
-then
-	[ &quot;$1&quot; = &quot;--agent&quot; ] &amp;&amp; exec $PATH_BIN/nxnode &quot;$@&quot;
-	[ &quot;$1&quot; != &quot;--passwd&quot; ] &amp;&amp; cmd_usage
-	cmd_user_passwd
-	exit 0
-fi
-
-#
-# root mode available functions
-#
-
-[ $# -lt 1 ] &amp;&amp; cmd_usage &quot;root&quot;
-[ &quot;$1&quot; = &quot;--help&quot; ] &amp;&amp; cmd_usage &quot;root&quot;
-
-if [ &quot;$1&quot; = &quot;--version&quot; ]
-then
-  echo &quot;NXSERVER - Version $NX_VERSION $NX_LICENSE&quot;
-  exit 0
-fi
-
-CMD=$1
-
-echo &quot;NX&gt; 100 NXSERVER - Version $NX_VERSION $NX_LICENSE&quot;
-
-case $CMD in
-	# 
-	# User functions ...
-	# 
-	--passwd)
-		cmd_passwd &quot;$@&quot;
-	;;
-	--adduser|--useradd)
-		cmd_adduser &quot;$@&quot;
-	;;
-	--deluser|--userdel)
-		cmd_deluser &quot;$@&quot;
-	;;
-	--listuser|--userlist)
-		cmd_listuser
-	;;
-	--start)
-		cmd_start
-	;;
-	--stop)
-		cmd_stop
-	;;
-	--status)
-		cmd_status
-	;;
-	--restart)
-		cmd_restart
-	;;
-	--list)
-		cmd_list &quot;$@&quot;
-	;;
-	--list-suspended)
-		cmd_list_suspended &quot;$@&quot;
-	;;
-	--history)
-		cmd_history &quot;$@&quot;
-	;;
-	--terminate|--suspend|--force-terminate)
-		cmd_terminate &quot;$@&quot;
-	;;
-	--cleanup)
-		cmd_terminate &quot;--force-terminate&quot; &quot;*&quot;
-	;;
-	--send|--broadcast)
-		cmd_send &quot;$@&quot;
-	;;
-	*)
-		cmd_abort &quot;Error: Function $CMD not implemented yet.&quot;
-esac
-echo &quot;NX&gt; 999 Bye&quot;

Copied: freenx-server/tags/FreeNX-0.7.1/nxserver (from rev 398, freenx-server/trunk/nxserver)

Deleted: freenx-server/tags/FreeNX-0.7.1/nxserver-helper/nxserver-helper.c
===================================================================
--- freenx-server/trunk/nxserver-helper/nxserver-helper.c	2007-05-29 15:27:07 UTC (rev 334)
+++ freenx-server/tags/FreeNX-0.7.1/nxserver-helper/nxserver-helper.c	2007-10-14 22:25:14 UTC (rev 405)
@@ -1,20 +0,0 @@
-/*
- * Copyright (c) 2006 by Fabian Franz.
- *
- * License: GPL, v2
- *
- * SVN: $Id$
- *
- */
-
-#include &lt;sys/types.h&gt;
-#include &lt;sys/socket.h&gt;
-
-int main(int argc, char* argv[])
-{
-	int fds[2];
-
-	socketpair(AF_UNIX, SOCK_STREAM, 0, fds);
-	argv++;
-	execv(argv[0], argv);
-}

Copied: freenx-server/tags/FreeNX-0.7.1/nxserver-helper/nxserver-helper.c (from rev 370, freenx-server/trunk/nxserver-helper/nxserver-helper.c)

Deleted: freenx-server/tags/FreeNX-0.7.1/nxsetup
===================================================================
--- freenx-server/trunk/nxsetup	2007-05-29 15:27:07 UTC (rev 334)
+++ freenx-server/tags/FreeNX-0.7.1/nxsetup	2007-10-14 22:25:14 UTC (rev 405)
@@ -1,527 +0,0 @@
-#!/bin/bash
-
-# Coypright (c) 2004-2005 by Fabian Franz &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">freenx at fabian-franz.de</A>&gt;.
-#                    2005 by Jon Severinsson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">jonno at users.berlios.de</A>&gt;.
-#
-# License: GNU GPL, version 2
-#
-# SVN: $Id$ 
-#
-
-HELP=&quot;no&quot;
-INSTALL=&quot;no&quot;
-SETUP_NOMACHINE_KEY=&quot;no&quot;
-SETUP_UID=&quot;&quot;
-SETUP_GID=&quot;&quot;
-LOCAL_USER_OPTION=&quot;&quot;
-# luseradd / luserdel are only available on RedHat
-[ -f /etc/redhat-release ] &amp;&amp; LOCAL_USER_OPTION=&quot;yes&quot;
-SETUP_LOCAL_USER=&quot;no&quot;
-CLEAN=&quot;no&quot;
-UNINSTALL=&quot;no&quot;
-PURGE=&quot;no&quot;
-SETUP_SSH2_KEY=&quot;no&quot;
-BUILD_KNOWN_HOSTS=&quot;yes&quot;
-AUTOMATIC=&quot;no&quot;
-IGNORE_ERRORS=&quot;no&quot;
-
-while [ &quot;$1&quot; ]
-do
-	case &quot;$1&quot; in
-		--help) HELP=&quot;yes&quot;; shift ;;
-		--install) INSTALL=&quot;yes&quot;; shift ;;
-		--ignore-errors) IGNORE_ERRORS=&quot;yes&quot;; shift;;
-		--setup-nomachine-key) SETUP_NOMACHINE_KEY=&quot;yes&quot;; shift ;;
-		--ssh2) SETUP_SSH2_KEY=&quot;yes&quot;; shift;;
-		--dont-build-known-hosts) BUILD_KNOWN_HOSTS=&quot;no&quot;; shift;;
-		--uid) SETUP_UID=$2; shift 2 ;;
-		--gid) SETUP_GID=$2; shift 2 ;;
-		--localuser) SETUP_LOCAL_USER=&quot;yes&quot;; shift;;
-		--clean) CLEAN=&quot;yes&quot;; shift ;;
-		--uninstall) UNINSTALL=&quot;yes&quot;; shift ;;
-		--purge) PURGE=&quot;yes&quot;; shift ;;
-		--auto) AUTOMATIC=&quot;yes&quot;; shift ;;
-		--) shift ; break ;;
-		*) echo &quot;Invalid flag $1&quot; ; HELP=&quot;yes&quot;; shift ; break ;;
-	esac
-done
-
-#Check for invalid combinations:
-[ &quot;$SETUP_LOCAL_USER&quot; = &quot;yes&quot; -a -z &quot;$LOCAL_USER_OPTION&quot; ] &amp;&amp; HELP=&quot;yes&quot;
-[ &quot;$INSTALL&quot; = &quot;yes&quot; -a &quot;$UNINSTALL&quot; = &quot;yes&quot; ] &amp;&amp; HELP=&quot;yes&quot;
-[ &quot;$INSTALL&quot; = &quot;yes&quot; -a &quot;$CLEAN&quot; = &quot;no&quot; -a &quot;$PURGE&quot; = &quot;yes&quot; ] &amp;&amp; HELP=&quot;yes&quot;
-[ &quot;$UNINSTALL&quot; = &quot;yes&quot; ] &amp;&amp; [ &quot;$SETUP_NOMACHINE_KEY&quot; = &quot;yes&quot; -o -n &quot;$SETUP_UID&quot; -o &quot;$CLEAN&quot; = &quot;yes&quot; ] &amp;&amp; HELP=&quot;yes&quot;
-[ &quot;$UNINSTALL&quot; = &quot;yes&quot; -a &quot;$CLEAN&quot; = &quot;yes&quot; ] &amp;&amp; HELP=&quot;yes&quot;
-[ &quot;$SETUP_SSH2_KEY&quot; = &quot;yes&quot; -a &quot;$SETUP_NOMACHINE_KEY&quot; = &quot;no&quot; ] &amp;&amp; HELP=&quot;yes&quot;
-
-if [ &quot;$INSTALL&quot; = &quot;no&quot; -a &quot;$UNINSTALL&quot; = &quot;no&quot; -a &quot;$AUTOMATIC&quot; = &quot;no&quot; -a &quot;$HELP&quot; = &quot;no&quot; ]
-then
-	echo &quot;------&gt; You did select no action.&quot;
-	echo &quot;        FreeNX guesses that you want to _install_ the server.&quot;
-	echo &quot;        Type \&quot;y\&quot; to abort the installation at this point in time.&quot;
-	echo &quot;        \&quot;N\&quot; is the default and continues installation.&quot;
-	echo &quot;        Use \&quot;${0} --help\&quot; to get more detailed help hints.&quot;
-	echo &quot;&quot;
-	echo -n &quot; Do you want to abort now? [y/N] &quot;
-	read -n 1 CHOICE
-	echo
-	[ &quot;$CHOICE&quot; = &quot;y&quot; ] || INSTALL=&quot;yes&quot;
-fi
-
-[ &quot;$INSTALL&quot; = &quot;no&quot; -a &quot;$UNINSTALL&quot; = &quot;no&quot; ] &amp;&amp; HELP=&quot;yes&quot;
-
-if [ &quot;$HELP&quot; = &quot;yes&quot; ]
-then
-	echo &quot;nxsetup - Setup the FreeNX server.&quot;
-	echo &quot;Syntax: nxsetup --help&quot;
-	echo &quot;        nxsetup --install [--setup-nomachine-key] [--uid &lt;nummber&gt;] [--clean [--purge]]&quot;
-	echo &quot;        nxsetup --uninstall [--purge]&quot;
-	echo
-	echo &quot;  --help                 Display this help message.&quot;
-	echo &quot;  --install              Install necessary files and add the special user \&quot;nx\&quot;.&quot;
-	echo &quot;  --ignore-errors        Check for false configuration, but don't complain.&quot;
-	echo &quot;  --setup-nomachine-key  Allow login with the key shipped with the NoMachine&quot;
-	echo &quot;                         client. This is fairly secure, and it simplifies the &quot;
-	echo &quot;                         configuration of clients. (Using a custom key pair.&quot;
-	echo &quot;                         increases security even more, but complicates the&quot;
-	echo &quot;                         configuration of clients.)&quot;
-	echo &quot;                         Use this option at your own risk.&quot;
-	echo &quot;  --ssh2                 Create additionally commercial pubkey-support; beware:&quot;
-	echo &quot;                         own _commercial_ ssh2-key is not supported!&quot;
-	echo &quot;  --uid &lt;number&gt;         Give the uid &lt;number&gt; to the user \&quot;nx\&quot;.&quot;
-	echo &quot;  --gid &lt;number&gt;         Give the gid &lt;number&gt; to the user \&quot;nx\&quot;.&quot;
-	[ -n &quot;$LOCAL_USER_OPTION&quot; ] &amp;&amp; \
-	echo &quot;  --localuser            The special user \&quot;nx\&quot; will be created locally using&quot;
-	echo &quot;                         \&quot;luseradd\&quot;, for use in NIS and NISplus environments.&quot;
-	echo &quot;  --clean                Perform an uninstallation prior to installation.&quot;
-	echo &quot;  --uninstall            Remove log and session files, as well as the special&quot;
-	echo &quot;                         user \&quot;nx\&quot;.&quot;
-	echo &quot;  --purge                Remove extra configuration files and ssh keys when&quot;
-	echo &quot;                         performing a \&quot;--uninstall\&quot;.&quot;
-	echo &quot;                         Note that node.conf will always be saved.&quot;
-	exit 0
-fi
-#Undocumented
-#
-#    --dont-build-known-hosts		For system without /etc/ssh/ssh_host_key.rsa.pub and anyway
-#					expect should handle nx-users known-hosts keys so why borther
-#					in nxsetup?
-
-if [ $UID -ne 0 ]
-then
-	echo &quot;You need to be root to use this program.&quot; 
-	exit 1
-fi
-
-if [ &quot;$INSTALL&quot; = &quot;yes&quot; -a &quot;$AUTOMATIC&quot; = &quot;no&quot; -a &quot;$SETUP_NOMACHINE_KEY&quot; = &quot;no&quot; ]
-then
-	echo &quot;------&gt; It is recommended that you use the NoMachine key for&quot;
-	echo &quot;        easier setup. If you answer \&quot;y\&quot;, FreeNX creates a custom&quot;
-	echo &quot;        KeyPair and expects you to setup your clients manually. &quot;
-	echo &quot;        \&quot;N\&quot; is default and uses the NoMachine key for installation.&quot;
-	echo &quot;&quot;
-	echo -n &quot; Do you want to use your own custom KeyPair? [y/N] &quot;
-	read -n 1 CHOICE
-	[ &quot;$CHOICE&quot; = &quot;y&quot; ] || SETUP_NOMACHINE_KEY=&quot;yes&quot;
-fi
-
-
-# Read the config file
-. $(PATH=$(cd $(dirname $0) &amp;&amp; pwd):$PATH which nxloadconfig) --
-
-nx_user_exists()
-{
-	if [ &quot;$SETUP_LOCAL_USER&quot; = &quot;yes&quot; ]
-	then
-		egrep &quot;^nx:&quot; /etc/passwd &gt;/dev/null
-	else
-		getent passwd nx &gt;/dev/null
-	fi
-}	
-nx_group_exists()
-{
-	# useradd/adduser need a valid group to add the user to
-	if [ &quot;$SETUP_LOCAL_USER&quot; = &quot;yes&quot; ]
-	then
-		egrep &quot;^nx:&quot; /etc/group &gt;/dev/null
-	else
-		getent group nx &gt;/dev/null
-	fi
-}	
-
-# Tries to add a system user
-useradd_nx()
-{
-	# In any case create the basedir of the HOME directory before, 
-	# because useradd will fail to make more than one directory
-	mkdir -p $(dirname &quot;$NX_HOME_DIR&quot;)
-
-	# Is it a debian?
-	if [ -f /etc/debian_version -a -z &quot;$SETUP_UID&quot; ]
-	then
-		USERADD_OPTIONS=&quot;--ingroup nx --system --home $NX_HOME_DIR --shell $PATH_BIN/nxserver&quot;
-		[ -n &quot;$SETUP_GID&quot; ] &amp;&amp; GROUPADD_OPTIONS=&quot;--gid $SETUP_GID&quot;
-
-		# adduser needs a valid group to add the user to
-		! nx_group_exists &amp;&amp; addgroup --system --quiet $GROUPADD_OPTIONS nx
-		adduser $USERADD_OPTIONS nx
-		
-	# no, its a &quot;normal&quot; useradd
-	else
-		USERADD_OPTIONS=&quot;-g nx -d $NX_HOME_DIR -s $PATH_BIN/nxserver&quot;
-		[ -n &quot;$SETUP_GID&quot; ] &amp;&amp; GROUPADD_OPTIONS=&quot;-g $SETUP_GID&quot;
-
-		# uid specified?
-		if [ -n &quot;$SETUP_UID&quot; ]
-		then
-			USERADD_OPTIONS=&quot;-u $SETUP_UID $USERADD_OPTIONS&quot;
-		
-		# Is it a SuSE?
-		elif [ -f /etc/SuSE-release ]
-		then
-			USERADD_OPTIONS=&quot;-r $USERADD_OPTIONS&quot;
-		fi
-		
-		if [ &quot;$SETUP_LOCAL_USER&quot; = &quot;yes&quot; ]
-		then
-			! nx_group_exists &amp;&amp; lgroupadd $GROUPADD_OPTIONS nx 
-			luseradd $USERADD_OPTIONS nx
-		else
-			! nx_group_exists &amp;&amp; groupadd $GROUPADD_OPTIONS nx
-			useradd $USERADD_OPTIONS nx
-		fi
-
-		
-	fi
-
-	# the nx user account might be locked, so unlock it.
-	passwd -u nx
-}
-
-install_nx()
-{
-	set -e
-	
-	if [ &quot;$(pidof sshd 2&gt;/dev/null)&quot; = &quot;&quot; ]
-	then 
-		echo -n &quot;Starting ssh service ...&quot;
-		# Generate Host keys if they are not available, yet
-		[ -e /etc/ssh/ssh_host_rsa_key ] || $COMMAND_SSH_KEYGEN -q -t rsa -f /etc/ssh/ssh_host_rsa_key -C '' -N ''
-		[ -e /etc/ssh/ssh_host_dsa_key ] || $COMMAND_SSH_KEYGEN -q -t dsa -f /etc/ssh/ssh_host_dsa_key -C '' -N ''
-		[ -x /etc/init.d/sshd ] &amp;&amp; /etc/init.d/sshd start
-		[ -x /etc/init.d/ssh ] &amp;&amp; /etc/init.d/ssh start
-		echo &quot;done&quot;
-	fi
-	
-	echo -n &quot;Setting up $NX_ETC_DIR ...&quot;
-	mkdir -p $NX_ETC_DIR
-	touch $NX_ETC_DIR/passwords $NX_ETC_DIR/passwords.orig
-	chmod 600 $NX_ETC_DIR/passwords $NX_ETC_DIR/passwords.orig
-	echo &quot;done&quot;
-	
-	if [ ! -f $NX_ETC_DIR/users.id_dsa ]
-	then
-		$COMMAND_SSH_KEYGEN -f $NX_ETC_DIR/users.id_dsa -t dsa -N &quot;&quot;
-	fi
-	
-	echo -n &quot;Setting up $NX_SESS_DIR ...&quot;
-	mkdir -p $NX_SESS_DIR/closed $NX_SESS_DIR/running $NX_SESS_DIR/failed
-	chmod 700 $NX_SESS_DIR/*
-	echo &quot;done&quot;
-	
-	echo -n &quot;Setting up $NX_LOGFILE ...&quot;
-	mkdir -p $(dirname &quot;$NX_LOGFILE&quot;)
-	touch &quot;$NX_LOGFILE&quot;
-	chmod 600 &quot;$NX_LOGFILE&quot;
-	echo &quot;done&quot;
-	
-	if ! nx_user_exists
-	then
-		echo -n &quot;Setting up special user \&quot;nx\&quot; ...&quot;
-		useradd_nx
-		echo &quot;done&quot;
-	fi
-	
-	if [ &quot;$ENABLE_NOMACHINE_FORWARD_PORT&quot; = &quot;1&quot; -a -x &quot;$NOMACHINE_SERVER&quot; ]
-	then
-		echo -n &quot;Setting up NoMachine forwarding ...&quot;
-		usermod -s &quot;$PATH_BIN/nxserver&quot; -d &quot;$NOMACHINE_NX_HOME_DIR&quot; nx
-		echo &quot;done&quot;
-	fi
-	
-	echo -n &quot;Setting up known_hosts and $SSH_AUTHORIZED_KEYS ...&quot;
-	
-	SETUP_NX_KEY=&quot;no&quot;
-	
-	mkdir -p $NX_HOME_DIR/.ssh
-	chmod 700 $NX_HOME_DIR/ $NX_HOME_DIR/.ssh
-	
-	if [ ! -f $NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS -o &quot;$SETUP_NOMACHINE_KEY&quot; = &quot;yes&quot; ]
-	then
-		SETUP_NX_KEY=&quot;yes&quot;
-		if [ &quot;$SETUP_NOMACHINE_KEY&quot; = &quot;yes&quot; ]
-		then
-			cat &lt;&lt; EOF &gt;$NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS
-no-port-forwarding,no-agent-forwarding,command=&quot;$PATH_BIN/nxserver&quot; ssh-dss AAAAB3NzaC1kc3MAAACBAJe/0DNBePG9dYLWq7cJ0SqyRf1iiZN/IbzrmBvgPTZnBa5FT/0Lcj39sRYt1paAlhchwUmwwIiSZaON5JnJOZ6jKkjWIuJ9MdTGfdvtY1aLwDMpxUVoGwEaKWOyin02IPWYSkDQb6cceuG9NfPulS9iuytdx0zIzqvGqfvudtufAAAAFQCwosRXR2QA8OSgFWSO6+kGrRJKiwAAAIEAjgvVNAYWSrnFD+cghyJbyx60AAjKtxZ0r/Pn9k94Qt2rvQoMnGgt/zU0v/y4hzg+g3JNEmO1PdHh/wDPVOxlZ6Hb5F4IQnENaAZ9uTZiFGqhBO1c8Wwjiq/MFZy3jZaidarLJvVs8EeT4mZcWxwm7nIVD4lRU2wQ2lj4aTPcepMAAACANlgcCuA4wrC+3Cic9CFkqiwO/Rn1vk8dvGuEQqFJ6f6LVfPfRTfaQU7TGVLk2CzY4dasrwxJ1f6FsT8DHTNGnxELPKRuLstGrFY/PR7KeafeFZDf+fJ3mbX5nxrld3wi5titTnX+8s4IKv29HJguPvOK/SI7cjzA+SqNfD7qEo8= <A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">root at nettuno</A>
-EOF
-			chmod 600 $NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS
-			cat &lt;&lt; EOF &gt;$NX_HOME_DIR/.ssh/client.id_dsa.key
------BEGIN DSA PRIVATE KEY-----
-MIIBuwIBAAKBgQCXv9AzQXjxvXWC1qu3CdEqskX9YomTfyG865gb4D02ZwWuRU/9
-C3I9/bEWLdaWgJYXIcFJsMCIkmWjjeSZyTmeoypI1iLifTHUxn3b7WNWi8AzKcVF
-aBsBGiljsop9NiD1mEpA0G+nHHrhvTXz7pUvYrsrXcdMyM6rxqn77nbbnwIVALCi
-xFdHZADw5KAVZI7r6QatEkqLAoGBAI4L1TQGFkq5xQ/nIIciW8setAAIyrcWdK/z
-5/ZPeELdq70KDJxoLf81NL/8uIc4PoNyTRJjtT3R4f8Az1TsZWeh2+ReCEJxDWgG
-fbk2YhRqoQTtXPFsI4qvzBWct42WonWqyyb1bPBHk+JmXFscJu5yFQ+JUVNsENpY
-+Gkz3HqTAoGANlgcCuA4wrC+3Cic9CFkqiwO/Rn1vk8dvGuEQqFJ6f6LVfPfRTfa
-QU7TGVLk2CzY4dasrwxJ1f6FsT8DHTNGnxELPKRuLstGrFY/PR7KeafeFZDf+fJ3
-mbX5nxrld3wi5titTnX+8s4IKv29HJguPvOK/SI7cjzA+SqNfD7qEo8CFDIm1xRf
-8xAPsSKs6yZ6j1FNklfu
------END DSA PRIVATE KEY-----
-EOF
-			chmod 600 $NX_HOME_DIR/.ssh/client.id_dsa.key
-		else
-			# generate a new key, backup the old and copy it to $SSH_AUTHORIZED_KEYS
-			$PATH_BIN/nxkeygen
-		fi
-	fi
-
-	# commercial ssh2-server uses other authentification-files
-	# as they are more or less static, I don't integrated these variable
-	# in node.conf, you have to change them here, if you like
-	SSH2_AUTHORIZATION=&quot;authorization&quot;
-	SSH2_PUBKEY=&quot;nx_user.id.pub&quot;
-	SSH2_HOME_DIR=&quot;$NX_HOME_DIR/.ssh2&quot;
-	if [ ! -f &quot;${SSH2_HOME_DIR}/$SSH2_PUBKEY&quot; -a &quot;$SETUP_SSH2_KEY&quot; = &quot;yes&quot; -a &quot;$SETUP_NOMACHINE_KEY&quot; = &quot;yes&quot; ]
-	then
-		mkdir -p $SSH2_HOME_DIR
-		chmod 700 $SSH2_HOME_DIR
-		
-		cat &gt;  ${SSH2_HOME_DIR}/$SSH2_PUBKEY &lt;&lt;EOF
----- BEGIN SSH2 PUBLIC KEY ----
-Comment: &quot;1024-bit DSA, converted from OpenSSH by <A HREF="https://lists.berlios.de/mailman/listinfo/freenx-cvs">root at localhost</A>&quot;
-AAAAB3NzaC1kc3MAAACBAJe/0DNBePG9dYLWq7cJ0SqyRf1iiZN/IbzrmBvgPTZnBa5FT/
-0Lcj39sRYt1paAlhchwUmwwIiSZaON5JnJOZ6jKkjWIuJ9MdTGfdvtY1aLwDMpxUVoGwEa
-KWOyin02IPWYSkDQb6cceuG9NfPulS9iuytdx0zIzqvGqfvudtufAAAAFQCwosRXR2QA8O
-SgFWSO6+kGrRJKiwAAAIEAjgvVNAYWSrnFD+cghyJbyx60AAjKtxZ0r/Pn9k94Qt2rvQoM
-nGgt/zU0v/y4hzg+g3JNEmO1PdHh/wDPVOxlZ6Hb5F4IQnENaAZ9uTZiFGqhBO1c8Wwjiq
-/MFZy3jZaidarLJvVs8EeT4mZcWxwm7nIVD4lRU2wQ2lj4aTPcepMAAACANlgcCuA4wrC+
-3Cic9CFkqiwO/Rn1vk8dvGuEQqFJ6f6LVfPfRTfaQU7TGVLk2CzY4dasrwxJ1f6FsT8DHT
-NGnxELPKRuLstGrFY/PR7KeafeFZDf+fJ3mbX5nxrld3wi5titTnX+8s4IKv29HJguPvOK
-/SI7cjzA+SqNfD7qEo8=
----- END SSH2 PUBLIC KEY ----
-EOF
-		echo &quot;Key $SSH2_PUBKEY&quot; &gt;&gt; ${SSH2_HOME_DIR}/$SSH2_AUTHORIZATION
-		echo &quot;Options no-port-forwarding,no-agent-forwarding,command=\&quot;$PATH_BIN/nxserver\&quot;&quot; &gt;&gt; ${SSH2_HOME_DIR}/$SSH2_AUTHORIZATION
-		chmod 600 ${SSH2_HOME_DIR}/$SSH2_AUTHORIZATION ${SSH2_HOME_DIR}/$SSH2_PUBKEY
-	fi
-	
-	if [ ! -f $NX_HOME_DIR/.ssh/known_hosts -a &quot;$BUILD_KNOWN_HOSTS&quot; = &quot;yes&quot; ]
-	then
-		echo -n &quot;127.0.0.1 &quot; &gt; $NX_HOME_DIR/.ssh/known_hosts
-		cat /etc/ssh/ssh_host_rsa_key.pub &gt;&gt; $NX_HOME_DIR/.ssh/known_hosts
-	fi
-	
-	echo &quot;done&quot;
-	
-	echo -n &quot;Setting up permissions ...&quot;
-	chown -R nx:root $NX_SESS_DIR
-	chown -R nx:root $NX_ETC_DIR
-	chown -R nx:root $NX_HOME_DIR
-	chown nx:root &quot;$NX_LOGFILE&quot;
-
-	echo &quot;done&quot;
-
-	if [ -d &quot;$CUPS_BACKEND&quot; ]
-	then
-		echo -n &quot;Setting up cups nxipp backend ...&quot;
-		cp -af &quot;$CUPS_BACKEND/ipp&quot; &quot;$CUPS_IPP_BACKEND&quot;
-		chmod 755 &quot;$CUPS_IPP_BACKEND&quot;
-		echo &quot;done&quot;
-	fi
-}
-
-test_nx()
-{
-	echo &quot;&quot;
-	echo &quot;----&gt; Testing your nxserver configuration ...&quot;
-	[ &quot;$IGNORE_ERRORS&quot; = &quot;yes&quot; ] &amp;&amp; NO_ERRORS=&quot;--ignore-errors&quot;
-	. $(PATH=$(cd $(dirname $0) &amp;&amp; pwd):$PATH which nxloadconfig) --check $NO_ERRORS
-	echo &quot;&lt;---- done&quot;
-	echo &quot;&quot;
-	echo &quot;----&gt; Testing your nxserver connection ...&quot;
-	
-	CONNECTION=&quot;&quot;
-	while read -t 3 line
-	do
-		echo $line
-		
-		case &quot;$line&quot; in
-			*&quot;HELLO NXSERVER - Version $NX_VERSION&quot;*)
-				CONNECTION=&quot;yes&quot;
-			;;
-			*&quot;HELLO NXSERVER - Version&quot;*)
-				echo &quot;Warning: Version mismatch. Expected $NX_VERSION got: $line.&quot;
-				CONNECTION=&quot;yes&quot;
-			;;
-			*&quot;NX&gt; 999 Bye&quot;*)
-				break;
-			;;
-		esac
-
-	done &lt; &lt;(NODE_PUBLICKEY=&quot;$NX_HOME_DIR/.ssh/client.id_dsa.key&quot; $PATH_BIN/nxnode-login test-nx nx &quot;$SSHD_PORT&quot; nxserver --check)
-
-	if [ -z &quot;$CONNECTION&quot; ]
-	then
-		echo &quot;Fatal error: Could not connect to NX Server.&quot;
-		echo 
-		echo &quot;Please check your ssh setup:&quot;
-		echo &quot;&quot;
-		echo &quot;The following are _examples_ of what you might need to check.&quot;
-		echo &quot;&quot;
-		echo &quot;	- Make sure \&quot;nx\&quot; is one of the AllowUsers in sshd_config.&quot;
-		echo &quot;    (or that the line is outcommented/not there)&quot;
-		echo &quot;	- Make sure your sshd allows public key authentication.&quot;
-		echo &quot;	- Make sure your sshd is really running on port $SSHD_PORT.&quot;
-		echo &quot;	- Make sure your sshd_config AuthorizedKeysFile in sshd_config is set to $SSH_AUTHORIZED_KEYS.&quot;
-		echo &quot;    (this should be a filename not a pathname+filename)&quot;
-		exit 1
-	fi
-	echo &quot;&lt;--- done&quot;
-	echo &quot;&quot;
-}
-
-uninstall_nx() 
-{
-	if nx_user_exists
-	then
-		echo -n &quot;Removing special user \&quot;nx\&quot; ...&quot;
-		
-		if [ &quot;$SETUP_LOCAL_USER&quot; = &quot;yes&quot; ]
-		then
-			luserdel nx
-		else
-			userdel nx
-		fi
-			
-		echo &quot;done&quot;
-	fi
-	
-	if [ -e &quot;$NX_SESS_DIR&quot; ]
-	then
-		echo -n &quot;Removing session database ...&quot;
-		rm -f -r $NX_SESS_DIR/closed $NX_SESS_DIR/running $NX_SESS_DIR/failed 2&gt;/dev/null
-		rmdir -p $NX_SESS_DIR 2&gt;/dev/null
-		echo &quot;done&quot;
-	fi
-	
-	if [ -e &quot;$NX_LOGFILE&quot; ] 
-	then
-		echo -n &quot;Removing logfile ...&quot;
-		rm -f &quot;$NX_LOGFILE&quot; 2&gt;/dev/null
-		rmdir -p $(dirname &quot;$NX_LOGFILE&quot;) 2&gt;/dev/null
-		echo &quot;done&quot;
-	fi
-	
-	if [ &quot;$PURGE&quot; = &quot;yes&quot; -a -e &quot;$NX_HOME_DIR&quot; ]
-	then
-		echo -n &quot;Removing home directory of special user \&quot;nx\&quot; ...&quot;
-		rm -f -r &quot;$NX_HOME_DIR&quot; 2&gt;/dev/null
-		rmdir -p $(dirname &quot;$NX_HOME_DIR&quot;) 2&gt;/dev/null
-		echo &quot;done&quot;
-	fi
-	
-	if [ &quot;$PURGE&quot; = &quot;yes&quot; -a -e &quot;$NX_ETC_DIR&quot; ]
-	then
-		echo -n &quot;Removing configuration files ...&quot;
-		rm -f &quot;$NX_ETC_DIR/passwords&quot; &quot;$NX_ETC_DIR/passwords.orig&quot; &quot;$NX_ETC_DIR/users.id_dsa&quot; &quot;$NX_ETC_DIR/users.id_dsa.pub&quot; 2&gt;/dev/null
-		for i in `ls $NX_ETC_DIR/*.node.conf 2&gt;/dev/null` ;
-		do
-			rm -f &quot;$i&quot; 2&gt;/dev/null;
-		done
-		echo &quot;done&quot;
-	fi
-}
-
-if [ &quot;$INSTALL&quot; = &quot;yes&quot; ]
-then
-	#Perform cleanup?
-	[ &quot;$CLEAN&quot; = &quot;yes&quot; ] &amp;&amp; uninstall_nx
-	
-	install_nx
-
-	[ &quot;$AUTOMATIC&quot; = &quot;no&quot; ] &amp;&amp; test_nx
-	
-	echo &quot;Ok, nxserver is ready.&quot;
-	echo 
-	if [ &quot;$ENABLE_SSH_AUTHENTICATION&quot; = &quot;1&quot; -o &quot;$ENABLE_SU_AUTHENTICATION&quot; = &quot;1&quot; ]
-	then
-		echo &quot;PAM authentication enabled:&quot;
-		if [ &quot;$ENABLE_USER_DB&quot; = &quot;1&quot; ]
-		then
-			echo &quot;  Users will be able to login with their normal passwords,&quot;
-			echo &quot;  but they have to be registered in the NX database to do so.&quot;
-			echo &quot;  To add new users to the NX user database do:&quot;
-			echo &quot;    nxserver --adduser &lt;username&gt;&quot;
-		else
-			echo &quot;  All users will be able to login with their normal passwords.&quot;
-		fi
-		echo
-		if [ &quot;$ENABLE_SSH_AUTHENTICATION&quot; = &quot;1&quot; -a &quot;$ENABLE_SU_AUTHENTICATION&quot; = &quot;1&quot; ]
-		then
-			echo &quot;  Both SSH and SU authentication is enabled.&quot;
-			echo &quot;  This does work, but is redundant.&quot;
-			echo &quot;  Please check if this is really what you intended.&quot;
-		elif [ &quot;$ENABLE_SSH_AUTHENTICATION&quot; = &quot;1&quot; ]
-		then
-			echo &quot;  PAM authentication will be done through SSH.&quot;
-			echo &quot;  Please ensure that SSHD on localhost accepts password authentication.&quot;
-		else
-			echo &quot;  PAM authentication will be done through SU.&quot;
-			echo &quot;  Please ensure that the user &quot;nx&quot; is a member of the wheel group.&quot;
-		fi
-	else
-		echo &quot;PAM authentication disabled.&quot;
-		echo &quot;  Only users in the NX user database will be able to log in.&quot;
-		echo
-		echo &quot;  To add new users to the NX user database do:&quot;
-		echo &quot;    nxserver --adduser &lt;username&gt;&quot;
-		echo &quot;  Afterwards change the password with:&quot;
-		echo &quot;    nxserver --passwd &lt;username&gt;&quot;
-	fi
-	echo
-	echo &quot;  You can change this behaviour in the $NX_ETC_DIR/node.conf file.&quot;
-	
-	if [ &quot;$SETUP_NOMACHINE_KEY&quot; = &quot;no&quot; -a &quot;$SETUP_NX_KEY&quot; = &quot;yes&quot; ]
-	then
-		echo
-		echo &quot;Warning: Clients will not be able to login to this server with the standard key.&quot;
-		echo &quot;         Please replace /usr/NX/share/client.id_dsa.key on all clients you want&quot;
-		echo &quot;         to use with $NX_HOME_DIR/.ssh/client.id_dsa.key&quot;
-		echo &quot;         and protect it accordingly.&quot;
-		echo &quot;&quot;
-		echo &quot;         Since 1.5.0 you need to import the correct key via the GUI.&quot;
-		echo
-		echo &quot;         If you really want to use the NoMachine key please remove&quot;
-		echo &quot;         '$NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS'&quot;
-		echo &quot;         and then run this script with the --setup-nomachine-key parameter.&quot;
-	fi
-	
-	echo &quot;Have Fun!&quot;
-elif [ &quot;$UNINSTALL&quot; = &quot;yes&quot; ]
-then
-	uninstall_nx
-	
-	echo &quot;Ok, nxserver is uninstalled&quot;
-	echo 
-	if [ &quot;$PURGE&quot; = &quot;yes&quot; ]
-	then
-		echo &quot;To complete the uninstallation process, remove the FreeNX scripts in $PATH_BIN&quot;
-		echo &quot;and the $NX_ETC_DIR/node.conf configuration file.&quot;
-	else
-		echo &quot;To complete the uninstallation process, remove the FreeNX scripts in $PATH_BIN&quot;
-		echo
-		echo &quot;Configuration files and ssh keys are saved in case you would like to reinstall&quot;
-		echo &quot;freenx at a later time. To remove them, please run 'nxsetup --uninstall --purge'&quot;
-	fi
-fi

Copied: freenx-server/tags/FreeNX-0.7.1/nxsetup (from rev 355, freenx-server/trunk/nxsetup)

Copied: freenx-server/tags/FreeNX-0.7.1/nxviewer_helper (from rev 398, freenx-server/trunk/nxviewer_helper)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000533.html">[Freenx-cvs] r404 - freenx-server/trunk
</A></li>
	<LI>Next message: <A HREF="000534.html">[Freenx-cvs] r406 - freenx-website
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#665">[ date ]</a>
              <a href="thread.html#665">[ thread ]</a>
              <a href="subject.html#665">[ subject ]</a>
              <a href="author.html#665">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/freenx-cvs">More information about the Freenx-cvs
mailing list</a><br>
</body></html>
