From freenx-cvs at berlios.de  Mon Aug  1 01:28:12 2005
From: freenx-cvs at berlios.de (fabianx)
Date: Mon, 01 Aug 2005 01:28:12 +0200
Subject: [Freenx-cvs] CVS: freenx - fabianx modified ChangeLog
Message-ID: <42ED5E8C.mailAW9112YYX@lists.berlios.de>

User:      fabianx
Date:      2005-07-31 23:28:11 GMT
Modified:  .        ChangeLog
Log:
Moved some commits to 0.4.4. Planned the 0.4.4 UKUUG Enterprise edition.

Revision  Changes    Path
1.86      +8 -5      freenx/ChangeLog


rev 1.86, prev_rev 1.85
Index: ChangeLog
===================================================================
RCS file: /cvsroot/freenx/freenx/ChangeLog,v
retrieving revision 1.85
retrieving revision 1.86
diff -u -r1.85 -r1.86
--- ChangeLog	29 Jul 2005 17:01:39 -0000	1.85
+++ ChangeLog	31 Jul 2005 23:28:11 -0000	1.86
@@ -1,3 +1,11 @@
+06.08.2005 FreeNX 0.4.4 "UKUUG Enterprise Edition"
+	* Added ENABLE_1_5_0_BACKEND configuration directive:
+		* Fixed fullscreen support in nxdesktop (still feels more like
+		  'Available Area', but with Ctrl-Alt-F you can get "real"
+		  fullscreen)
+	* Added COMMAND_MD5SUM directive
+	* Security: $USER_FAKE_HOME/.nx now gets 0700
+
 28.07.2005 FreeNX 0.4.3 "NoMachine 1.5.0 Edition"
 	* Fixed reconnection problems with !M 1.5.0 client.
 	* Fixed reconnection problems with !M 1.5.0 backend.
@@ -11,16 +19,11 @@
 		  backend.
 		* Added RDP highcolor support for !M 1.5.0 client
 		  with !M 1.5.0 backend.
-		* Fixed fullscreen support in nxdesktop (still feels more like
-		  'Available Area', but with Ctrl-Alt-F you can get "real"
-		  fullscreen)
 	* Added secure logging - Passwords are no longer shown in log files.
 	* Security: Certain passwords for VNC/RDP could have been visible via 
 	  `ps aux`.
 	* Added experimental usermode authentication scheme.
 	  (Disabled by default)
-	* Added COMMAND_MD5SUM directive
-	* Security: $USER_FAKE_HOME/.nx now gets 0700
 
 16.07.2005 FreeNX 0.4.2 "Solaris / Bugfix / Linux Infotag Pforzheim Edition"
 	* Removed forwarding support via "freenx.<user>", because it was






From freenx-cvs at berlios.de  Mon Aug  1 01:53:48 2005
From: freenx-cvs at berlios.de (fabianx)
Date: Mon, 01 Aug 2005 01:53:48 +0200
Subject: [Freenx-cvs] CVS: freenx - fabianx modified 2 files
Message-ID: <42ED648C.mailIBO15S33X@lists.berlios.de>

User:      fabianx
Date:      2005-07-31 23:53:44 GMT
Modified:  .        ChangeLog nxnode
Log:
Fixed support for CUPS forwarding.

Revision  Changes    Path
1.87      +1 -0      freenx/ChangeLog


rev 1.87, prev_rev 1.86
Index: ChangeLog
===================================================================
RCS file: /cvsroot/freenx/freenx/ChangeLog,v
retrieving revision 1.86
retrieving revision 1.87
diff -u -r1.86 -r1.87
--- ChangeLog	31 Jul 2005 23:28:11 -0000	1.86
+++ ChangeLog	31 Jul 2005 23:53:43 -0000	1.87
@@ -5,6 +5,7 @@
 		  fullscreen)
 	* Added COMMAND_MD5SUM directive
 	* Security: $USER_FAKE_HOME/.nx now gets 0700
+	* Fixed support for CUPS forwarding.
 
 28.07.2005 FreeNX 0.4.3 "NoMachine 1.5.0 Edition"
 	* Fixed reconnection problems with !M 1.5.0 client.



1.76      +2 -1      freenx/nxnode


rev 1.76, prev_rev 1.75
Index: nxnode
===================================================================
RCS file: /cvsroot/freenx/freenx/nxnode,v
retrieving revision 1.75
retrieving revision 1.76
diff -u -r1.75 -r1.76
--- nxnode	29 Jul 2005 17:01:39 -0000	1.75
+++ nxnode	31 Jul 2005 23:53:43 -0000	1.76
@@ -13,7 +13,7 @@
 #
 # License: GNU GPL, version 2
 #
-# CVS: $Id: nxnode,v 1.75 2005/07/29 17:01:39 fux Exp $
+# CVS: $Id: nxnode,v 1.76 2005/07/31 23:53:43 fabianx Exp $
 #
 # 21.06.2004: - Full reconnection support
 
@@ -629,6 +629,7 @@
 	mediahelper=$(getparam mediahelper)
 	sync=$(getparam sync)
 	samba=$(getparam samba)
+	cups=$(getparam cups)
 	agent_server=$(getparam agent_server)
 	agent_user=$(getparam agent_user)
 	agent_password=$(getparam agent_password)






From freenx-cvs at berlios.de  Mon Aug  1 02:21:27 2005
From: freenx-cvs at berlios.de (fabianx)
Date: Mon, 01 Aug 2005 02:21:27 +0200
Subject: [Freenx-cvs] CVS: freenx - fabianx modified 2 files
Message-ID: <42ED6B07.mail5141YIOWS@lists.berlios.de>

User:      fabianx
Date:      2005-08-01 00:21:27 GMT
Modified:  .        ChangeLog nxserver
Log:
* Added secure re-transmitting to client.

Revision  Changes    Path
1.88      +1 -0      freenx/ChangeLog


rev 1.88, prev_rev 1.87
Index: ChangeLog
===================================================================
RCS file: /cvsroot/freenx/freenx/ChangeLog,v
retrieving revision 1.87
retrieving revision 1.88
diff -u -r1.87 -r1.88
--- ChangeLog	31 Jul 2005 23:53:43 -0000	1.87
+++ ChangeLog	1 Aug 2005 00:21:27 -0000	1.88
@@ -6,6 +6,7 @@
 	* Added COMMAND_MD5SUM directive
 	* Security: $USER_FAKE_HOME/.nx now gets 0700
 	* Fixed support for CUPS forwarding.
+	* Added secure re-transmitting to client.
 
 28.07.2005 FreeNX 0.4.3 "NoMachine 1.5.0 Edition"
 	* Fixed reconnection problems with !M 1.5.0 client.



1.71      +9 -4      freenx/nxserver


rev 1.71, prev_rev 1.70
Index: nxserver
===================================================================
RCS file: /cvsroot/freenx/freenx/nxserver,v
retrieving revision 1.70
retrieving revision 1.71
diff -u -r1.70 -r1.71
--- nxserver	28 Jul 2005 22:09:43 -0000	1.70
+++ nxserver	1 Aug 2005 00:21:27 -0000	1.71
@@ -11,7 +11,7 @@
 #
 # License: GNU GPL, version 2
 #
-# CVS: $Id: nxserver,v 1.70 2005/07/28 22:09:43 fux Exp $
+# CVS: $Id: nxserver,v 1.71 2005/08/01 00:21:27 fabianx Exp $
 #
 
 # Read the config file
@@ -421,13 +421,18 @@
 
 # Log in a way that is secure for passwords / cookies / ...
 
+echo_secure()
+{
+	echo "$@ " | perl -pi -e 's/--cookie=".+?"/--cookie="******"/g; s/--agent_password=".+?"/agent_password="******"/g; s/--password=".+?"/password="******"/g; s/cookie=.+?&/cookie=******&/g; s/agent_password=.+?&/agent_password=******&/g; s/password=.+?&/password=******&/g;'
+}
+
 log_secure()
 {
 	if [ "$NX_LOG_SECURE" = "0" ]
 	then
 		log "$@"
 	else
-		[ "$NX_LOG_LEVEL" -ge "$1" -a -w "$NX_LOGFILE" ] && shift && echo "$@ " | perl -pi -e 's/--cookie=".+?"/--cookie="******"/g; s/--agent_password=".+?"/agent_password="******"/g; s/--password=".+?"/password="******"/g; s/cookie=.+?&/cookie=******&/g; s/agent_password=.+?&/agent_password=******&/g; s/password=.+?&/password=******&/g;' >> "$NX_LOGFILE"
+		[ "$NX_LOG_LEVEL" -ge "$1" -a -w "$NX_LOGFILE" ] && shift && echo_secure "$@" >> "$NX_LOGFILE"
 	fi
 }
 
@@ -895,14 +900,14 @@
 	# FIXME?
 	[ "$CMD" = "" ] && CMD="quit"
 	
-	echo "$CMD"
-	
 	# Logging 
 	case "$CMD" in
 		startsession*|restoresession*|addmount*|addprinter*)
+			echo_secure "$CMD"
 			log_secure "4" "$CMD"
 		;;
 		*)
+			echo "$CMD"
 			log "4" "$CMD"
 		;;
 	esac






From freenx-cvs at berlios.de  Tue Aug  2 16:51:43 2005
From: freenx-cvs at berlios.de (fabianx)
Date: Tue, 02 Aug 2005 16:51:43 +0200
Subject: [Freenx-cvs] CVS: freenx - fabianx modified 4 files
Message-ID: <42EF887F.mail1BS1NRVRE@lists.berlios.de>

User:      fabianx
Date:      2005-08-02 14:51:43 GMT
Modified:  .        ChangeLog nxloadconfig nxserver nxsetup
Log:
* Removed grep from getent to not search through the whole database.
          (Suggestion by "Matthew S. Harris" <mharris at google.com>,
	                 "Ed Warnicke"       <eaw at cisco.com>)

Revision  Changes    Path
1.89      +3 -0      freenx/ChangeLog


rev 1.89, prev_rev 1.88
Index: ChangeLog
===================================================================
RCS file: /cvsroot/freenx/freenx/ChangeLog,v
retrieving revision 1.88
retrieving revision 1.89
diff -u -r1.88 -r1.89
--- ChangeLog	1 Aug 2005 00:21:27 -0000	1.88
+++ ChangeLog	2 Aug 2005 14:51:43 -0000	1.89
@@ -7,6 +7,9 @@
 	* Security: $USER_FAKE_HOME/.nx now gets 0700
 	* Fixed support for CUPS forwarding.
 	* Added secure re-transmitting to client.
+	* Removed grep from getent to not search through the whole database.
+	  (Suggestion by "Matthew S. Harris" <mharris at google.com>,
+	                 "Ed Warnicke"       <eaw at cisco.com>)
 
 28.07.2005 FreeNX 0.4.3 "NoMachine 1.5.0 Edition"
 	* Fixed reconnection problems with !M 1.5.0 client.



1.42      +5 -5      freenx/nxloadconfig


rev 1.42, prev_rev 1.41
Index: nxloadconfig
===================================================================
RCS file: /cvsroot/freenx/freenx/nxloadconfig,v
retrieving revision 1.41
retrieving revision 1.42
diff -u -r1.41 -r1.42
--- nxloadconfig	28 Jul 2005 22:09:43 -0000	1.41
+++ nxloadconfig	2 Aug 2005 14:51:43 -0000	1.42
@@ -5,7 +5,7 @@
 #
 # License: GPL, version 2
 #
-# CVS: $Id: nxloadconfig,v 1.41 2005/07/28 22:09:43 fux Exp $
+# CVS: $Id: nxloadconfig,v 1.42 2005/08/02 14:51:43 fabianx Exp $
 #
 # ========================================================================
 
@@ -326,16 +326,16 @@
 	if [ "$ENABLE_PERSISTENT_SESSION" != "all" ]
 	then
 		for USERNAME in $ENABLE_PERSISTENT_SESSION; do
-			[ "${USERNAME:0:1}" != "@" ] && [ -z $(getent passwd | egrep "^$USERNAME:") ] && \
+			[ "${USERNAME:0:1}" != "@" ] && [ -z $(getent passwd $USERNAME) ] && \
 				ERROR="yes" && echo "Error: Invalid value \"ENABLE_PERSISTENT_SESSION=$ENABLE_PERSISTENT_SESSION\"" && break ;
-			[ "${USERNAME:0:1}" = "@" ] && [ -z $(getent group | egrep "^${USERNAME:1}:") ] && \
+			[ "${USERNAME:0:1}" = "@" ] && [ -z $(getent group ${USERNAME:1}) ] && \
 				ERROR="yes" && echo "Error: Invalid value \"ENABLE_PERSISTENT_SESSION=$ENABLE_PERSISTENT_SESSION\"" && break ;
 		done
 	fi
 	for USERNAME in $DISABLE_PERSISTENT_SESSION; do
-		[ "${USERNAME:0:1}" != "@" ] && [ -z $(getent passwd | egrep "^$USERNAME:") ] && \
+		[ "${USERNAME:0:1}" != "@" ] && [ -z $(getent passwd $USERNAME) ] && \
 			ERROR="yes" && echo "Error: Invalid value \"DISABLE_PERSISTENT_SESSION=$DISABLE_PERSISTENT_SESSION\"" && break ;
-		[ "${USERNAME:0:1}" = "@" ] && [ -z $(getent group | egrep "^${USERNAME:1}:") ] && \
+		[ "${USERNAME:0:1}" = "@" ] && [ -z $(getent group ${USERNAME:1}) ] && \
 			ERROR="yes" && echo "Error: Invalid value \"DISABLE_PERSISTENT_SESSION=$DISABLE_PERSISTENT_SESSION\"" && break ;
 	done
 	IFS=$OLD_IFS



1.72      +2 -2      freenx/nxserver


rev 1.72, prev_rev 1.71
Index: nxserver
===================================================================
RCS file: /cvsroot/freenx/freenx/nxserver,v
retrieving revision 1.71
retrieving revision 1.72
diff -u -r1.71 -r1.72
--- nxserver	1 Aug 2005 00:21:27 -0000	1.71
+++ nxserver	2 Aug 2005 14:51:43 -0000	1.72
@@ -11,7 +11,7 @@
 #
 # License: GNU GPL, version 2
 #
-# CVS: $Id: nxserver,v 1.71 2005/08/01 00:21:27 fabianx Exp $
+# CVS: $Id: nxserver,v 1.72 2005/08/02 14:51:43 fabianx Exp $
 #
 
 # Read the config file
@@ -1132,7 +1132,7 @@
 	
 	[ ${#CMD_CHUSER} -ge 32 ] && cmd_abort "Error: User $CMD_CHUSER must be shorter than 32 characters."
 	egrep -q "^$CMD_CHUSER:" $NX_ETC_DIR/passwords && cmd_abort "Error: User $CMD_CHUSER already in database."
-	getent passwd | egrep -q "^$CMD_CHUSER:" || cmd_abort "Error: User $CMD_CHUSER not existing on local system. Can't add."
+	getent passwd "$CMD_CHUSER" >/dev/null || cmd_abort "Error: User $CMD_CHUSER not existing on local system. Can't add."
 	passdb_add_user "$CMD_CHUSER"
 }
 



1.30      +3 -3      freenx/nxsetup


rev 1.30, prev_rev 1.29
Index: nxsetup
===================================================================
RCS file: /cvsroot/freenx/freenx/nxsetup,v
retrieving revision 1.29
retrieving revision 1.30
diff -u -r1.29 -r1.30
--- nxsetup	16 Jul 2005 15:45:37 -0000	1.29
+++ nxsetup	2 Aug 2005 14:51:43 -0000	1.30
@@ -5,7 +5,7 @@
 #
 # License: GNU GPL, version 2
 #
-# CVS: $Id: nxsetup,v 1.29 2005/07/16 15:45:37 fabianx Exp $ 
+# CVS: $Id: nxsetup,v 1.30 2005/08/02 14:51:43 fabianx Exp $ 
 #
 
 HELP="no"
@@ -142,7 +142,7 @@
 	chmod 600 "$NX_LOGFILE"
 	echo "done"
 	
-	if ! { getent passwd | egrep -q "^nx:"; }
+	if ! { getent passwd nx >/dev/null; }
 	then
 		echo -n "Setting up user nx ..."
 		useradd_nx
@@ -226,7 +226,7 @@
 
 uninstall_nx() 
 {
-	if { getent passwd | egrep -q "^nx:"; }
+	if { getent passwd nx >/dev/null; }
 	then
 		echo -n "Removing user nx ..."
 		userdel nx






From freenx-cvs at berlios.de  Tue Aug  2 17:20:18 2005
From: freenx-cvs at berlios.de (fabianx)
Date: Tue, 02 Aug 2005 17:20:18 +0200
Subject: [Freenx-cvs] CVS: freenx - fabianx modified 3 files
Message-ID: <42EF8F32.mail326113WK3@lists.berlios.de>

User:      fabianx
Date:      2005-08-02 15:20:18 GMT
Modified:  .        ChangeLog nxnode nxserver
Log:
* Set sleeps to 60 instead of 10 seconds, removed one wrong trap.
  (Suggestion by "Sunil" <funtoos at yahoo.com>)
* Removed session failure if session is tried to be resumed.
  Session should still fail if nxagent died in the meanwhile.
Annotation: This session code still sucks. Will be rewritten for 0.5.0.

Revision  Changes    Path
1.90      +2 -0      freenx/ChangeLog


rev 1.90, prev_rev 1.89
Index: ChangeLog
===================================================================
RCS file: /cvsroot/freenx/freenx/ChangeLog,v
retrieving revision 1.89
retrieving revision 1.90
diff -u -r1.89 -r1.90
--- ChangeLog	2 Aug 2005 14:51:43 -0000	1.89
+++ ChangeLog	2 Aug 2005 15:20:18 -0000	1.90
@@ -10,6 +10,8 @@
 	* Removed grep from getent to not search through the whole database.
 	  (Suggestion by "Matthew S. Harris" <mharris at google.com>,
 	                 "Ed Warnicke"       <eaw at cisco.com>)
+	* Set sleeps to 60 instead of 10 seconds, removed one wrong trap.
+	  (Suggestion by "Sunil" <funtoos at yahoo.com>)
 
 28.07.2005 FreeNX 0.4.3 "NoMachine 1.5.0 Edition"
 	* Fixed reconnection problems with !M 1.5.0 client.



1.77      +3 -3      freenx/nxnode


rev 1.77, prev_rev 1.76
Index: nxnode
===================================================================
RCS file: /cvsroot/freenx/freenx/nxnode,v
retrieving revision 1.76
retrieving revision 1.77
diff -u -r1.76 -r1.77
--- nxnode	31 Jul 2005 23:53:43 -0000	1.76
+++ nxnode	2 Aug 2005 15:20:18 -0000	1.77
@@ -13,7 +13,7 @@
 #
 # License: GNU GPL, version 2
 #
-# CVS: $Id: nxnode,v 1.76 2005/07/31 23:53:43 fabianx Exp $
+# CVS: $Id: nxnode,v 1.77 2005/08/02 15:20:18 fabianx Exp $
 #
 # 21.06.2004: - Full reconnection support
 
@@ -427,9 +427,9 @@
 		if stringinstring "Info: tail -f running with pid" "$line"
 		then
 			TAIL_PID=$(echo $line | cut -d"'" -f2)
-			# now set a timeout of 10 seconds ...
+			# now set a timeout of 60 seconds ...
 			( 
-                          sleep 10
+                          sleep 60
 			  if [ -d "$HOME/.nx/C-$sess_id/" ]
 			  then
 		          	echo "NX> 1004 Error: nxagent failed to start. Session timed out."



1.73      +5 -4      freenx/nxserver


rev 1.73, prev_rev 1.72
Index: nxserver
===================================================================
RCS file: /cvsroot/freenx/freenx/nxserver,v
retrieving revision 1.72
retrieving revision 1.73
diff -u -r1.72 -r1.73
--- nxserver	2 Aug 2005 14:51:43 -0000	1.72
+++ nxserver	2 Aug 2005 15:20:18 -0000	1.73
@@ -11,7 +11,7 @@
 #
 # License: GNU GPL, version 2
 #
-# CVS: $Id: nxserver,v 1.72 2005/08/02 14:51:43 fabianx Exp $
+# CVS: $Id: nxserver,v 1.73 2005/08/02 15:20:18 fabianx Exp $
 #
 
 # Read the config file
@@ -684,7 +684,8 @@
 {
 	server_add_usession
 
-	trap server_nxnode_exit_func EXIT
+	# Trap did fire unnecessarily according to Sunil, so removed it again.
+	#trap server_nxnode_exit_func EXIT
 	
 	SERVER_CHANNEL=1
 	KILL_WAIT_PID=1
@@ -871,7 +872,7 @@
 	fi
 
 	# now start the node
-	(sleep 10; exit 1) &
+	(sleep 60; exit 1) &
 	SERVER_WAIT_PID=$!
 	server_nxnode_start_wait --"$ACTION"session $USER "$FULL_PARAMS" &
 	SERVER_PID=$!
@@ -881,7 +882,7 @@
 	if [ $? -eq 1 ]
 	then
 		# Something went wrong ...
-		session_fail $uniqueid
+		[ "$ACTION" = "start" ] && session_fail $uniqueid
 		# FIXME: Need correct error code.
 		echo_x "NX> 1004 Error: Session did not start."
 		echo_x "NX> 504 Session startup failed."






From freenx-cvs at berlios.de  Tue Aug  2 17:39:32 2005
From: freenx-cvs at berlios.de (fabianx)
Date: Tue, 02 Aug 2005 17:39:32 +0200
Subject: [Freenx-cvs] CVS: freenx - fabianx modified 4 files
Message-ID: <42EF93B4.mail47Z134QGL@lists.berlios.de>

User:      fabianx
Date:      2005-08-02 15:39:32 GMT
Modified:  .        ChangeLog node.conf.sample nxloadconfig nxserver
Log:
* Made automatic timeout configurable.
  (Patch by "Ed Warnicke" <eaw at cisco.com>)

Revision  Changes    Path
1.91      +2 -0      freenx/ChangeLog


rev 1.91, prev_rev 1.90
Index: ChangeLog
===================================================================
RCS file: /cvsroot/freenx/freenx/ChangeLog,v
retrieving revision 1.90
retrieving revision 1.91
diff -u -r1.90 -r1.91
--- ChangeLog	2 Aug 2005 15:20:18 -0000	1.90
+++ ChangeLog	2 Aug 2005 15:39:32 -0000	1.91
@@ -12,6 +12,8 @@
 	                 "Ed Warnicke"       <eaw at cisco.com>)
 	* Set sleeps to 60 instead of 10 seconds, removed one wrong trap.
 	  (Suggestion by "Sunil" <funtoos at yahoo.com>)
+	* Made automatic timeout configurable.
+	  (Patch by "Ed Warnicke" <eaw at cisco.com>)
 
 28.07.2005 FreeNX 0.4.3 "NoMachine 1.5.0 Edition"
 	* Fixed reconnection problems with !M 1.5.0 client.



1.35      +5 -1      freenx/node.conf.sample


rev 1.35, prev_rev 1.34
Index: node.conf.sample
===================================================================
RCS file: /cvsroot/freenx/freenx/node.conf.sample,v
retrieving revision 1.34
retrieving revision 1.35
diff -u -r1.34 -r1.35
--- node.conf.sample	29 Jul 2005 17:05:21 -0000	1.34
+++ node.conf.sample	2 Aug 2005 15:39:32 -0000	1.35
@@ -37,7 +37,7 @@
 #
 #           https://mail.kde.org/mailman/listinfo/freenx-knx
 #
-# CVS: $Id: node.conf.sample,v 1.34 2005/07/29 17:05:21 fux Exp $
+# CVS: $Id: node.conf.sample,v 1.35 2005/08/02 15:39:32 fabianx Exp $
 
 #########################################################################
 # General FreeNX directives
@@ -351,6 +351,10 @@
 #AGENT_EXTRA_OPTIONS_RFB=""
 #AGENT_EXTRA_OPTIONS_RDP=""
 #AGENT_EXTRA_OPTIONS_X=""
+
+# The number of seconds we wait for the nxagent to start before
+# deciding startup has failed
+#AGENT_STARTUP_TIMEOUT="60"
 
 # The font server the agent will use. If set to "" no font server is used.
 # For this to do any good, the client has to have the same font server set



1.43      +2 -1      freenx/nxloadconfig


rev 1.43, prev_rev 1.42
Index: nxloadconfig
===================================================================
RCS file: /cvsroot/freenx/freenx/nxloadconfig,v
retrieving revision 1.42
retrieving revision 1.43
diff -u -r1.42 -r1.43
--- nxloadconfig	2 Aug 2005 14:51:43 -0000	1.42
+++ nxloadconfig	2 Aug 2005 15:39:32 -0000	1.43
@@ -5,7 +5,7 @@
 #
 # License: GPL, version 2
 #
-# CVS: $Id: nxloadconfig,v 1.42 2005/08/02 14:51:43 fabianx Exp $
+# CVS: $Id: nxloadconfig,v 1.43 2005/08/02 15:39:32 fabianx Exp $
 #
 # ========================================================================
 
@@ -174,6 +174,7 @@
 AGENT_EXTRA_OPTIONS_RFB=""
 AGENT_EXTRA_OPTIONS_RDP=""
 AGENT_EXTRA_OPTIONS_X=""
+AGENT_STARTUP_TIMEOUT="60"
 AGENT_FONT_SERVER=""
 PROXY_TCP_NODELAY="0"
 PROXY_EXTRA_OPTIONS=""



1.74      +2 -2      freenx/nxserver


rev 1.74, prev_rev 1.73
Index: nxserver
===================================================================
RCS file: /cvsroot/freenx/freenx/nxserver,v
retrieving revision 1.73
retrieving revision 1.74
diff -u -r1.73 -r1.74
--- nxserver	2 Aug 2005 15:20:18 -0000	1.73
+++ nxserver	2 Aug 2005 15:39:32 -0000	1.74
@@ -11,7 +11,7 @@
 #
 # License: GNU GPL, version 2
 #
-# CVS: $Id: nxserver,v 1.73 2005/08/02 15:20:18 fabianx Exp $
+# CVS: $Id: nxserver,v 1.74 2005/08/02 15:39:32 fabianx Exp $
 #
 
 # Read the config file
@@ -872,7 +872,7 @@
 	fi
 
 	# now start the node
-	(sleep 60; exit 1) &
+	(sleep $AGENT_STARTUP_TIMEOUT; exit 1) &
 	SERVER_WAIT_PID=$!
 	server_nxnode_start_wait --"$ACTION"session $USER "$FULL_PARAMS" &
 	SERVER_PID=$!






From freenx-cvs at berlios.de  Tue Aug  2 19:30:00 2005
From: freenx-cvs at berlios.de (fabianx)
Date: Tue, 02 Aug 2005 19:30:00 +0200
Subject: [Freenx-cvs] CVS: freenx - fabianx modified 2 files
Message-ID: <42EFAD98.mailIUY111XM0@lists.berlios.de>

User:      fabianx
Date:      2005-08-02 17:30:00 GMT
Modified:  .        ChangeLog nxsetup
Log:
* Made nxsetup more enterprise friendly. Added --localuser
  (RedHat only) and --gid.
  (Based on a patch by "Ed Warnicke" <eaw at cisco.com>

Annotation: This release is now tagged 0.4.4-RC1 and such feature-freezed!

Revision  Changes    Path
1.92      +3 -0      freenx/ChangeLog


rev 1.92, prev_rev 1.91
Index: ChangeLog
===================================================================
RCS file: /cvsroot/freenx/freenx/ChangeLog,v
retrieving revision 1.91
retrieving revision 1.92
diff -u -r1.91 -r1.92
--- ChangeLog	2 Aug 2005 15:39:32 -0000	1.91
+++ ChangeLog	2 Aug 2005 17:29:59 -0000	1.92
@@ -14,6 +14,9 @@
 	  (Suggestion by "Sunil" <funtoos at yahoo.com>)
 	* Made automatic timeout configurable.
 	  (Patch by "Ed Warnicke" <eaw at cisco.com>)
+	* Made nxsetup more enterprise friendly. Added --localuser
+	  (RedHat only) and --gid. 
+	  (Based on a patch by "Ed Warnicke" <eaw at cisco.com>)
 
 28.07.2005 FreeNX 0.4.3 "NoMachine 1.5.0 Edition"
 	* Fixed reconnection problems with !M 1.5.0 client.



1.31      +58 -17    freenx/nxsetup


rev 1.31, prev_rev 1.30
Index: nxsetup
===================================================================
RCS file: /cvsroot/freenx/freenx/nxsetup,v
retrieving revision 1.30
retrieving revision 1.31
diff -u -r1.30 -r1.31
--- nxsetup	2 Aug 2005 14:51:43 -0000	1.30
+++ nxsetup	2 Aug 2005 17:29:59 -0000	1.31
@@ -5,13 +5,18 @@
 #
 # License: GNU GPL, version 2
 #
-# CVS: $Id: nxsetup,v 1.30 2005/08/02 14:51:43 fabianx Exp $ 
+# CVS: $Id: nxsetup,v 1.31 2005/08/02 17:29:59 fabianx Exp $ 
 #
 
 HELP="no"
 INSTALL="no"
 SETUP_NOMACHINE_KEY="no"
 SETUP_UID=""
+SETUP_GID=""
+LOCAL_USER_OPTION=""
+# luseradd / luserdel are only available on RedHat
+[ -f /etc/redhat-release ] && LOCAL_USER_OPTION="yes"
+SETUP_LOCAL_USER="no"
 CLEAN="no"
 UNINSTALL="no"
 PURGE="no"
@@ -27,6 +32,8 @@
 		--ssh2) SETUP_SSH2_KEY="yes"; shift;;
 		--dont-build-known-hosts) BUILD_KNOWN_HOSTS="no"; shift;;
 		--uid) SETUP_UID=$2; shift 2 ;;
+		--gid) SETUP_GID=$2; shift 2 ;;
+		--localuser) SETUP_LOCAL_USER="yes"; shift;;
 		--clean) CLEAN="yes"; shift ;;
 		--uninstall) UNINSTALL="yes"; shift ;;
 		--purge) PURGE="yes"; shift ;;
@@ -36,6 +43,7 @@
 done
 
 #Check for invalid combinations:
+[ "$SETUP_LOCAL_USER" = "yes" -a -z "$LOCAL_USER_OPTION" ] && HELP="yes"
 [ "$INSTALL" = "yes" -a "$UNINSTALL" = "yes" ] && HELP="yes"
 [ "$INSTALL" = "no" -a "$UNINSTALL" = "no" ] && HELP="yes"
 [ "$INSTALL" = "yes" -a "$CLEAN" = "no" -a "$PURGE" = "yes" ] && HELP="yes"
@@ -59,6 +67,8 @@
 	echo "  --ssh2		       Additionally create commercial pubkey-support, beware"
 	echo "			       own _commercial_ ssh2-key is not supported!."
 	echo "  --uid <number>         The nx user will be given the uid <number>."
+	echo "  --gid <number>         The nx user will be given the gid <number>."
+	[ -n "$LOCAL_USER_OPTION" ] && echo "  --localuser            The nx user will be created locally using luseradd, for use in NIS and NISplus environments."
 	echo "  --clean                Performs an uninstall prior to the installation"
 	echo "  --uninstall            Remove log and session files, as well as the nx user"
 	echo "  --purge                Uninstall will remove extra configuration files and ssh"
@@ -80,28 +90,52 @@
 # Read the config file
 . $(PATH=$(cd $(dirname $0) && pwd):$PATH which nxloadconfig) --
 
+nx_user_exists()
+{
+	if [ "$SETUP_LOCAL_USER" = "yes" ]
+	then
+		egrep "^nx:" /etc/passwd >/dev/null
+	else
+		getent passwd nx >/dev/null
+	fi
+}	
+
 # Tries to add a system user
 useradd_nx()
 {
 	# In any case create the basedir of the HOME directory before, 
 	# because useradd will fail to make more than one directory
 	mkdir -p $(dirname "$NX_HOME_DIR")
-	
-	# Are uid specified
-	if [ -n "$SETUP_UID" ]
-	then
-		useradd -u $SETUP_UID -d $NX_HOME_DIR -s $PATH_BIN/nxserver nx
+
 	# Is it a debian?
-	elif [ -f /etc/debian_version ]
-	then
-		adduser --system --home $NX_HOME_DIR --shell $PATH_BIN/nxserver nx
-	# or is it a SuSE?
-	elif [ -f /etc/SuSE-release ]
+	if [ -f /etc/debian_version -a -z "$SETUP_UID" ]
 	then
-		useradd -r -d $NX_HOME_DIR -s $PATH_BIN/nxserver nx
-	# we don't know the system, fallback
+		USERADD_OPTIONS="--system --home $NX_HOME_DIR --shell $PATH_BIN/nxserver"
+		[ -n "$SETUP_GID" ] && USERADD_OPTIONS="--gid $SETUP_GID $USERADD_OPTIONS"
+		adduser $USERADD_OPTIONS nx
+	# no, its a "normal" useradd
 	else
-		useradd -d $NX_HOME_DIR -s $PATH_BIN/nxserver nx
+		USERADD_OPTIONS="-d $NX_HOME_DIR -s $PATH_BIN/nxserver"
+		[ -n $SETUP_GID ] && USERADD_OPTIONS="-g $SETUP_GID $USERADD_OPTIONS"
+		# uid specified?
+		if [ -n "$SETUP_UID" ]
+		then
+			USERADD_OPTIONS="-u $SETUP_UID $USERADD_OPTIONS"
+		# Is it a SuSE?
+		elif [ -f /etc/SuSE-release ]
+		then
+			USERADD_OPTIONS="-r $USERADD_OPTIONS"
+		fi
+
+		if [ "$SETUP_LOCAL_USER" = "yes" ]
+		then
+			[ -n "$SETUP_GID" ] && /usr/sbin/lgroupadd -g $SETUP_GID nx
+			luseradd $USERADD_OPTIONS nx
+		else
+			useradd $USERADD_OPTIONS nx
+		fi
+
+		
 	fi
 }
 
@@ -142,7 +176,7 @@
 	chmod 600 "$NX_LOGFILE"
 	echo "done"
 	
-	if ! { getent passwd nx >/dev/null; }
+	if ! nx_user_exists
 	then
 		echo -n "Setting up user nx ..."
 		useradd_nx
@@ -226,10 +260,17 @@
 
 uninstall_nx() 
 {
-	if { getent passwd nx >/dev/null; }
+	if nx_user_exists
 	then
 		echo -n "Removing user nx ..."
-		userdel nx
+		
+		if [ "$SETUP_LOCAL_USER" = "yes" ]
+		then
+			luserdel nx
+		else
+			userdel nx
+		fi
+			
 		echo "done"
 	fi
 	






From fabianx at berlios.de  Tue Aug  2 19:37:10 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Tue, 2 Aug 2005 19:37:10 +0200
Subject: [Freenx-cvs] r91 - /
Message-ID: <200508021737.j72HbAb3026482@sheep.berlios.de>

Author: fabianx
Date: 2005-08-02 19:37:01 +0200 (Tue, 02 Aug 2005)
New Revision: 91

Added:
   freenx-server.tmp/
Log:
Added temporary directory.




From fabianx at berlios.de  Tue Aug  2 19:38:07 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Tue, 2 Aug 2005 19:38:07 +0200
Subject: [Freenx-cvs] r92 - / freenx-server.tmp
Message-ID: <200508021738.j72Hc7xs027446@sheep.berlios.de>

Author: fabianx
Date: 2005-08-02 19:38:00 +0200 (Tue, 02 Aug 2005)
New Revision: 92

Added:
   freenx-server.tmp/freenx-server/
Removed:
   freenx-server/
Log:
Reorganizing the repository.


Copied: freenx-server.tmp/freenx-server (from rev 91, freenx-server)



From fabianx at berlios.de  Tue Aug  2 19:39:08 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Tue, 2 Aug 2005 19:39:08 +0200
Subject: [Freenx-cvs] r93 - /
Message-ID: <200508021739.j72Hd8V9028738@sheep.berlios.de>

Author: fabianx
Date: 2005-08-02 19:39:02 +0200 (Tue, 02 Aug 2005)
New Revision: 93

Added:
   freenx-server/
Removed:
   freenx-server.tmp/
Log:
Reorganizing the repository.


Copied: freenx-server (from rev 92, freenx-server.tmp)



From fabianx at berlios.de  Tue Aug  2 19:43:28 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Tue, 2 Aug 2005 19:43:28 +0200
Subject: [Freenx-cvs] r94 - in freenx-server: . branches
Message-ID: <200508021743.j72HhSKa030217@sheep.berlios.de>

Author: fabianx
Date: 2005-08-02 19:43:13 +0200 (Tue, 02 Aug 2005)
New Revision: 94

Added:
   freenx-server/branches/
   freenx-server/branches/0_5_0-based-on-0.4.1/
   freenx-server/tags/
   freenx-server/trunk/
Removed:
   freenx-server/freenx-server/
Log:
still reorganzizing the repository.


Copied: freenx-server/branches/0_5_0-based-on-0.4.1 (from rev 93, freenx-server/freenx-server)



From fabianx at berlios.de  Tue Aug  2 19:46:37 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Tue, 2 Aug 2005 19:46:37 +0200
Subject: [Freenx-cvs] r95 - freenx-server
Message-ID: <200508021746.j72HkbLC031741@sheep.berlios.de>

Author: fabianx
Date: 2005-08-02 19:46:28 +0200 (Tue, 02 Aug 2005)
New Revision: 95

Removed:
   freenx-server/trunk/
Log:
And more reorganizing.




From fabianx at berlios.de  Tue Aug  2 19:56:30 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Tue, 2 Aug 2005 19:56:30 +0200
Subject: [Freenx-cvs] r97 - freenx-server/tags
Message-ID: <200508021756.j72HuUDC009630@sheep.berlios.de>

Author: fabianx
Date: 2005-08-02 19:56:19 +0200 (Tue, 02 Aug 2005)
New Revision: 97

Added:
   freenx-server/tags/FreeNX-0_4_4-RC1/
Log:
Added tag for starting point of 0_5_0.


Copied: freenx-server/tags/FreeNX-0_4_4-RC1 (from rev 96, freenx-server/trunk)



From fabianx at berlios.de  Wed Aug  3 00:21:02 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Wed, 3 Aug 2005 00:21:02 +0200
Subject: [Freenx-cvs] r98 - freenx-server/trunk
Message-ID: <200508022221.j72ML2eq001026@sheep.berlios.de>

Author: fabianx
Date: 2005-08-03 00:21:01 +0200 (Wed, 03 Aug 2005)
New Revision: 98

Modified:
   freenx-server/trunk/ChangeLog
   freenx-server/trunk/node.conf.sample
   freenx-server/trunk/nxloadconfig
   freenx-server/trunk/nxnode-login
   freenx-server/trunk/nxserver
Log:
Merged changes from 0_5_0_based_on_0.4.1 branch. (-r63:70):

r70 | fabianx | 2005-07-03 19:29:44 +0200 (So, 03 Jul 2005) | 2 lines
Ge?\195?\164nderte Pfade:
   M /freenx-server/node.conf.sample

Warned for using share session space via NFS, as nxserver is not yet fully ready to support it.

------------------------------------------------------------------------
r69 | fabianx | 2005-07-03 19:27:10 +0200 (So, 03 Jul 2005) | 2 lines
Ge?\195?\164nderte Pfade:
   M /freenx-server/nxloadconfig

Bumped version number to 0.5.0.

------------------------------------------------------------------------
r65 | fabianx | 2005-07-03 17:44:33 +0200 (So, 03 Jul 2005) | 2 lines
Ge?\195?\164nderte Pfade:
   M /freenx-server/ChangeLog
   M /freenx-server/node.conf.sample
   M /freenx-server/nxloadconfig
   M /freenx-server/nxnode-login
   M /freenx-server/nxserver

Initial support for loadbalancing.

------------------------------------------------------------------------
r64 | fabianx | 2005-07-03 16:39:45 +0200 (So, 03 Jul 2005) | 2 lines
Ge?\195?\164nderte Pfade:
   D /freenx-server/CVS

Deleted superflous CVS directory.

------------------------------------------------------------------------
r63 | fabianx | 2005-07-03 16:38:23 +0200 (So, 03 Jul 2005) | 2 lines
Ge?\195?\164nderte Pfade:
   D /freenx-server/RoadMap
   D /freenx-server/nxserver.old

Deleted two superflous files.



Modified: freenx-server/trunk/ChangeLog
===================================================================
--- freenx-server/trunk/ChangeLog	2005-08-02 17:56:19 UTC (rev 97)
+++ freenx-server/trunk/ChangeLog	2005-08-02 22:21:01 UTC (rev 98)
@@ -1,3 +1,7 @@
+XX.08.2005 FreeNX 0.5.0
+	* Opened the 0.5.0 branch.
+	* Added load balancing.
+
 06.08.2005 FreeNX 0.4.4 "UKUUG Enterprise Edition"
 	* Added ENABLE_1_5_0_BACKEND configuration directive:
 		* Fixed fullscreen support in nxdesktop (still feels more like

Modified: freenx-server/trunk/node.conf.sample
===================================================================
--- freenx-server/trunk/node.conf.sample	2005-08-02 17:56:19 UTC (rev 97)
+++ freenx-server/trunk/node.conf.sample	2005-08-02 22:21:01 UTC (rev 98)
@@ -200,7 +200,24 @@
 #ENABLE_NOMACHINE_FORWARD_PORT="0"
 #NOMACHINE_FORWARD_PORT="22"
 
+# To do loadbalancing setup some hosts in SERVER_LOADBALANCING and
+# make:
+#
+#   - either sure that all incoming connections are sent to the master
+#     server by using forwarding directives on the "slave" servers.
+#
+#   - or share the session database space via NFS between the servers.
+#     (not recommended at the moment as race conditions for DISPLAYs can 
+#      occur)
+#
+# By setting ENABLE_LOADBALANCE="1" you can let users choose their
+# preferred host, while being forwarded to another server. Of course
+# this is just a preference. The loadbalancing algorithm can completely
+# choose to ignore the users choice.
 
+#SERVER_LOADBALANCING=""
+#ENABLE_LOADBALANCE_PREFERENCE="0"
+
 #########################################################################
 # Services directives
 #########################################################################

Modified: freenx-server/trunk/nxloadconfig
===================================================================
--- freenx-server/trunk/nxloadconfig	2005-08-02 17:56:19 UTC (rev 97)
+++ freenx-server/trunk/nxloadconfig	2005-08-02 22:21:01 UTC (rev 98)
@@ -49,7 +49,7 @@
 # DO NOT TOUCH unless you REALLY know what you are doing
 #########################################################################
 
-NX_VERSION=1.4.0-04-CVS
+NX_VERSION=1.4.0-05-SVN
 NX_LICENSE="OS (GPL)"
 
 # Where can different nx components be found
@@ -125,6 +125,8 @@
 ENABLE_NOMACHINE_FORWARD_PORT="0"
 NOMACHINE_FORWARD_PORT="22"
 
+SERVER_LOADBALANCING=""
+ENABLE_LOADBALANCE_PREFERENCE="0"
 
 # Services directives
 

Modified: freenx-server/trunk/nxnode-login
===================================================================
--- freenx-server/trunk/nxnode-login	2005-08-02 17:56:19 UTC (rev 97)
+++ freenx-server/trunk/nxnode-login	2005-08-02 22:21:01 UTC (rev 98)
@@ -17,6 +17,8 @@
 catch {set tosend $env(NXNODE_TOSEND)}
 set command_ssh "ssh"
 catch {set command_ssh $env(COMMAND_SSH)}
+set host "127.0.0.1"
+catch {set host $env(NODE_HOSTNAME)}
 
 expect_user -re "(.*)\n" 
 set password $expect_out(1,string)
@@ -24,7 +26,7 @@
 set stty_init "raw icrnl -echo"
 
 if { "$auth_method"=="ssh" } { 
-	set pid [spawn -noecho $command_ssh -2 -x -l "$user" "127.0.0.1" -o "NumberOfPasswordPrompts 1" -p "$port" "$executable $command" ]
+	set pid [spawn -noecho $command_ssh -2 -x -l "$user" "$host" -o "NumberOfPasswordPrompts 1" -p "$port" "$executable $command" ]
 } elseif { "$auth_method"=="su" } {
 	set pid [spawn -noecho su - "$user" -c "$executable $command" ]
 } else {

Modified: freenx-server/trunk/nxserver
===================================================================
--- freenx-server/trunk/nxserver	2005-08-02 17:56:19 UTC (rev 97)
+++ freenx-server/trunk/nxserver	2005-08-02 22:21:01 UTC (rev 98)
@@ -456,15 +456,18 @@
 
 # Start!
 [ "$NX_LOG_LEVEL" -ge "1" ] && touch "$NX_LOGFILE" >/dev/null 2>&1
-log 3 "-- NX SERVER START: $@"
+log 3 "-- NX SERVER START: $@ - ORIG_COMMAND=$SSH_ORIGINAL_COMMAND"
 
 if [ "$ENABLE_SERVER_FORWARD" = "1" -a -n "$SERVER_FORWARD_HOST" ]
 then
 	log 3 "Info: Forwarding connection to $SERVER_FORWARD_HOST with secret key $SERVER_FORWARD_KEY."
-	$COMMAND_SSH -i "$SERVER_FORWARD_KEY" "nx@$SERVER_FORWARD_HOST:$SERVER_FORWARD_PORT"
+	$COMMAND_SSH -i "$SERVER_FORWARD_KEY" "-p$SERVER_FORWARD_PORT" "nx@$SERVER_FORWARD_HOST" "host=$SERVER_NAME"
 	exit 0
 fi
 
+# Get the hostname out of SSH_ORIGINAL_COMMAND
+PREFERRED_HOST=$(echo $SSH_ORIGINAL_COMMAND | tr '&' '\n' | grep "^host=" | cut -d'=' -f2)
+
 # forward the connection to commercial NoMachine server?
 if [ "$ENABLE_NOMACHINE_FORWARD_PORT" = "1" -a "$NOMACHINE_FORWARD_PORT" = "$(echo $SSH_CLIENT $SSH2_CLIENT| cut -d' ' -f3)" -a -n "$NOMACHINE_SERVER" ]
 then
@@ -633,6 +636,20 @@
 	USER="$2"
 	shift
 	shift
+
+	# Find NODE_HOSTNAME
+	
+	NODE_HOSTNAME=""
+	CMDLINE="$@"
+	uniqueid=$(getparam uniqueid)
+	[ -z "$uniqueid" ] && uniqueid=$(getparam sessionid)
+	[ -z "$uniqueid" ] && uniqueid=$(getparam session_id)
+	CMDLINE=$(session_get "$uniqueid")
+	
+	NODE_HOSTNAME="$(getparam host)"
+	[ -z "$NODE_HOSTNAME" ] && NODE_HOSTNAME="127.0.0.1"
+	export NODE_HOSTNAME
+	
 	# Use nxnode-login?
 	if [ "$LOGIN_METHOD" = "SSH" ]
 	then
@@ -645,7 +662,7 @@
 	then
 	    echo "$@" | $PATH_BIN/nxnode "$CMD" 2>&1 | log_tee
 	else
-	    echo "$@" | $COMMAND_SSH -l "$USER" 127.0.0.1 -p $SSHD_PORT -x -2 -i $NX_ETC_DIR/users.id_dsa -o 'PubkeyAuthentication yes' -o 'RSAAuthentication yes' -o 'RhostsAuthentication no' -o 'PasswordAuthentication no' -o 'RhostsRSAAuthentication no' -o 'StrictHostKeyChecking no' $PATH_BIN/nxnode "$CMD" | log_tee
+	    echo "$@" | $COMMAND_SSH -l "$USER" "$NODE_HOSTNAME" -p $SSHD_PORT -x -2 -i $NX_ETC_DIR/users.id_dsa -o 'PubkeyAuthentication yes' -o 'RSAAuthentication yes' -o 'RhostsAuthentication no' -o 'PasswordAuthentication no' -o 'RhostsRSAAuthentication no' -o 'StrictHostKeyChecking no' $PATH_BIN/nxnode "$CMD" | log_tee
 	fi
 }
 
@@ -762,6 +779,36 @@
 	return 0
 }
 
+# FIXME: Add round-robin algorithm
+server_loadbalance_random_rr()
+{
+	# Pick one based on "round-robin random"
+	SERVER_HOSTS=( $SERVER_LOADBALANCING )
+	SERVER_NR_OF_HOSTS=${#SERVER_HOSTS[@]}
+	let SERVER_NR=(RANDOM % SERVER_NR_OF_HOSTS)
+	SERVER_HOST_RR=${SERVER_HOSTS[$SERVER_NR]}
+	echo $SERVER_HOST_RR
+}
+
+server_loadbalance()
+{
+	SERVER_HOST="127.0.0.1"
+	if [ -n "$SERVER_LOADBALANCING" ]
+	then
+		# FIXME: Add preference host
+		SERVER_HOST=""
+		if [ -n "$PREFERRED_HOST" -a "$ENABLE_LOADBALANCE_PREFERENCE" = "1" ]
+		then
+			stringinstring " $PREFERRED_HOST " " $SERVER_LOADBALANCING " && SERVER_HOST="$PREFERRED_HOST"
+		fi
+		# Fallback if still empty
+		[ -z "$SERVER_HOST" ] && SERVER_HOST=$(server_loadbalance_random_rr)
+		[ -n "$SERVER_HOST" ] && log 5 "Info: Load-Balancing (if possible) to $SERVER_HOST ..."
+		[ -z "$SERVER_HOST" ] && SERVER_HOST="127.0.0.1"
+	fi
+	echo "$SERVER_HOST"
+}	
+
 server_startrestore_session()
 {
 	ACTION="$1"
@@ -858,9 +905,13 @@
 		FULL_PARAMS="$PARAMS&user=$USER&userip=$USERIP&uniqueid=$uniqueid&display=$SESS_DISPLAY"
 		log_secure "6" "$FULL_PARAMS"
 
+		# Possibly do loadbalancing
+		
+		SERVER_HOST=$(server_loadbalance)
+
 		# now update the session listing
 		CMDLINE="a=b&$FULL_PARAMS"
-		session_add $uniqueid "sessionName=$(getparam session)&display=$(getparam display)&status=Running&startTime=$(date +%s)&foreignAddress=$(getparam userip)&type=$(getparam type)&sessionId=$uniqueid&creationTime=$(date +%s)&userName=$USER&serverPid=$SERVER_PID&screeninfo=$(getparam screeninfo)&geometry=$(getparam geometry)"
+		session_add $uniqueid "sessionName=$(getparam session)&display=$(getparam display)&status=Running&startTime=$(date +%s)&foreignAddress=$(getparam userip)&type=$(getparam type)&sessionId=$uniqueid&creationTime=$(date +%s)&userName=$USER&serverPid=$SERVER_PID&screeninfo=$(getparam screeninfo)&geometry=$(getparam geometry)&host=$SERVER_HOST"
 	else
 		uniqueid=$(getparam restore)
 		[ -z "$uniqueid" ] && uniqueid=$(getparam id) # 1.4.0-5 compatibility
@@ -869,6 +920,8 @@
 		CMDLINE=$(session_get "$uniqueid")
 		FULL_PARAMS="$PARAMS&user=$USER&userip=$(getparam foreignAddress)&uniqueid=$uniqueid&display=$(getparam display)"
 		SESS_DISPLAY=$(getparam display)
+		SERVER_HOST=$(getparam host)
+		[ -z "$SERVER_HOST" ] && SERVER_HOST="127.0.0.1"
 	fi
 
 	# now start the node
@@ -930,7 +983,7 @@
 			if [ "$ENCRYPTION" = "1" ] 
 			then 
 				let PROXY_DISPLAY=$SESS_DISPLAY+4000
-				$COMMAND_NETCAT 127.0.0.1 $PROXY_DISPLAY
+				$COMMAND_NETCAT $SERVER_HOST $PROXY_DISPLAY
 				exit 0
 			else
 				echo_x "NX> 1001 Bye."



From fabianx at berlios.de  Wed Aug  3 02:48:37 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Wed, 3 Aug 2005 02:48:37 +0200
Subject: [Freenx-cvs] r99 - freenx-server/trunk
Message-ID: <200508030048.j730mbED020614@sheep.berlios.de>

Author: fabianx
Date: 2005-08-03 02:47:53 +0200 (Wed, 03 Aug 2005)
New Revision: 99

Modified:
   freenx-server/trunk/nxloadconfig
Log:
Bumped version to 1.5.0-50-SVN, which means 1.5.0 Backend supported, FreeNX 0.5.0, SVN snapshot.


Modified: freenx-server/trunk/nxloadconfig
===================================================================
--- freenx-server/trunk/nxloadconfig	2005-08-02 22:21:01 UTC (rev 98)
+++ freenx-server/trunk/nxloadconfig	2005-08-03 00:47:53 UTC (rev 99)
@@ -49,7 +49,7 @@
 # DO NOT TOUCH unless you REALLY know what you are doing
 #########################################################################
 
-NX_VERSION=1.4.0-05-SVN
+NX_VERSION=1.5.0-50-SVN
 NX_LICENSE="OS (GPL)"
 
 # Where can different nx components be found



From freenx-cvs at berlios.de  Fri Aug  5 18:38:45 2005
From: freenx-cvs at berlios.de (fabianx)
Date: Fri, 05 Aug 2005 18:38:45 +0200
Subject: [Freenx-cvs] CVS: freenx - fabianx modified 2 files
Message-ID: <42F39615.mail2XD11TOEC@lists.berlios.de>

User:      fabianx
Date:      2005-08-05 16:38:45 GMT
Modified:  .        ChangeLog nxserver
Log:
* Fixed resume of multiple sessions.

Revision  Changes    Path
1.93      +1 -0      freenx/ChangeLog


rev 1.93, prev_rev 1.92
Index: ChangeLog
===================================================================
RCS file: /cvsroot/freenx/freenx/ChangeLog,v
retrieving revision 1.92
retrieving revision 1.93
diff -u -r1.92 -r1.93
--- ChangeLog	2 Aug 2005 17:29:59 -0000	1.92
+++ ChangeLog	5 Aug 2005 16:38:44 -0000	1.93
@@ -17,6 +17,7 @@
 	* Made nxsetup more enterprise friendly. Added --localuser
 	  (RedHat only) and --gid. 
 	  (Based on a patch by "Ed Warnicke" <eaw at cisco.com>)
+	* Fixed resume of multiple sessions.
 
 28.07.2005 FreeNX 0.4.3 "NoMachine 1.5.0 Edition"
 	* Fixed reconnection problems with !M 1.5.0 client.



1.75      +2 -2      freenx/nxserver


rev 1.75, prev_rev 1.74
Index: nxserver
===================================================================
RCS file: /cvsroot/freenx/freenx/nxserver,v
retrieving revision 1.74
retrieving revision 1.75
diff -u -r1.74 -r1.75
--- nxserver	2 Aug 2005 15:39:32 -0000	1.74
+++ nxserver	5 Aug 2005 16:38:44 -0000	1.75
@@ -11,7 +11,7 @@
 #
 # License: GNU GPL, version 2
 #
-# CVS: $Id: nxserver,v 1.74 2005/08/02 15:39:32 fabianx Exp $
+# CVS: $Id: nxserver,v 1.75 2005/08/05 16:38:44 fabianx Exp $
 #
 
 # Read the config file
@@ -249,7 +249,7 @@
 			then
 				available="Yes"
 			fi
-			printf "%-7s %-16s %32s %8s %5s %-14s %-11s %s" "$(getparam display)" "$(getparam type)" "$(getparam sessionId)" "$options" "$depth" "$geom" "$available" "$(getparam sessionName)" >> $TMPFILE
+			printf "%-7s %-16s %32s %8s %5s %-14s %-11s %s\n" "$(getparam display)" "$(getparam type)" "$(getparam sessionId)" "$options" "$depth" "$geom" "$available" "$(getparam sessionName)" >> $TMPFILE
 		fi
 		egrep -q "^userName=$1$" $i && let SESSION_COUNT_USER=$SESSION_COUNT_USER+1
 	done






From fabianx at berlios.de  Fri Aug  5 19:07:35 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Fri, 5 Aug 2005 19:07:35 +0200
Subject: [Freenx-cvs] r102 - freenx-website
Message-ID: <200508051707.j75H7ZB0022171@sheep.berlios.de>

Author: fabianx
Date: 2005-08-05 19:07:17 +0200 (Fri, 05 Aug 2005)
New Revision: 102

Added:
   freenx-website/test.file
Log:
Added a test.file for testing the website update script.


Added: freenx-website/test.file
===================================================================
--- freenx-website/test.file	2005-08-03 05:44:31 UTC (rev 101)
+++ freenx-website/test.file	2005-08-05 17:07:17 UTC (rev 102)
@@ -0,0 +1 @@
+Test



From fabianx at berlios.de  Fri Aug  5 19:10:30 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Fri, 5 Aug 2005 19:10:30 +0200
Subject: [Freenx-cvs] r103 - freenx-website
Message-ID: <200508051710.j75HAUVJ024705@sheep.berlios.de>

Author: fabianx
Date: 2005-08-05 19:10:02 +0200 (Fri, 05 Aug 2005)
New Revision: 103

Modified:
   freenx-website/test.file
Log:
Added test2

Modified: freenx-website/test.file
===================================================================
--- freenx-website/test.file	2005-08-05 17:07:17 UTC (rev 102)
+++ freenx-website/test.file	2005-08-05 17:10:02 UTC (rev 103)
@@ -1 +1 @@
-Test
+Test2



From fabianx at berlios.de  Fri Aug  5 19:12:08 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Fri, 5 Aug 2005 19:12:08 +0200
Subject: [Freenx-cvs] r104 - freenx-website
Message-ID: <200508051712.j75HC8Rw026205@sheep.berlios.de>

Author: fabianx
Date: 2005-08-05 19:11:56 +0200 (Fri, 05 Aug 2005)
New Revision: 104

Modified:
   freenx-website/test.file
Log:
Added test3

Modified: freenx-website/test.file
===================================================================
--- freenx-website/test.file	2005-08-05 17:10:02 UTC (rev 103)
+++ freenx-website/test.file	2005-08-05 17:11:56 UTC (rev 104)
@@ -1 +1 @@
-Test2
+Test3



From fabianx at berlios.de  Fri Aug  5 19:18:12 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Fri, 5 Aug 2005 19:18:12 +0200
Subject: [Freenx-cvs] r105 - freenx-website
Message-ID: <200508051718.j75HICZb028874@sheep.berlios.de>

Author: fabianx
Date: 2005-08-05 19:17:53 +0200 (Fri, 05 Aug 2005)
New Revision: 105

Removed:
   freenx-website/test.file
Log:
Deleted it again.


Deleted: freenx-website/test.file
===================================================================
--- freenx-website/test.file	2005-08-05 17:11:56 UTC (rev 104)
+++ freenx-website/test.file	2005-08-05 17:17:53 UTC (rev 105)
@@ -1 +0,0 @@
-Test3



From fabianx at berlios.de  Sat Aug  6 15:35:13 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Sat, 6 Aug 2005 15:35:13 +0200
Subject: [Freenx-cvs] r106 - in freenx-website: . ukuug
Message-ID: <200508061335.j76DZDFF001517@sheep.berlios.de>

Author: fabianx
Date: 2005-08-06 15:35:10 +0200 (Sat, 06 Aug 2005)
New Revision: 106

Added:
   freenx-website/ukuug/
   freenx-website/ukuug/index.html
   freenx-website/ukuug/nxapplet.jar
   freenx-website/ukuug/ukuug.nxs
Log:
Added ukuug subdirectory for test with nxplugin on UKUUG and custom client.


Added: freenx-website/ukuug/index.html
===================================================================
--- freenx-website/ukuug/index.html	2005-08-05 17:17:53 UTC (rev 105)
+++ freenx-website/ukuug/index.html	2005-08-06 13:35:10 UTC (rev 106)
@@ -0,0 +1,193 @@
+<!--
+/**************************************************************************/
+/*                                                                        */
+/* Copyright (c) 2004, 2005 NoMachine, http://www.nomachine.com.          */
+/*                                                                        */
+/* NXAPPLET, NX protocol compression and NX extensions to this software   */
+/* are copyright of NoMachine. Redistribution and use of the present      */
+/* software is allowed according to terms specified in the file LICENSE   */
+/* which comes in the source distribution.                                */
+/*                                                                        */
+/* Check http://www.nomachine.com/licensing.html for applicability.       */
+/*                                                                        */
+/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
+/*                                                                        */
+/* All rights reserved.                                                   */
+/*                                                                        */
+/**************************************************************************/
+
+This file is provided as an example, you can freely personalize it to fit
+your needs.
+-->
+
+<HTML>
+<HEAD>
+  <META HTTP-EQUIV="expires" CONTENT="0">
+  <META HTTP-EQUIV="Pragma" CONTENT="no-cache">
+  <META HTTP-EQUIV="Cache-Control" CONTENT="no-cache">
+  <TITLE>The future of NX! - UKUUG Linux Conference 2005</TITLE>
+
+</HEAD>
+
+
+  <BODY>
+
+    <SCRIPT LANGUAGE="Javascript1.1">
+ <!-- hide JavaScript from non-JavaScript browsers
+
+
+  SOWIN = (navigator.userAgent.toLowerCase().indexOf("win") > -1) ? 1 : 0;
+  SOMAC = (navigator.userAgent.toLowerCase().indexOf("mac") > -1) ? 1 : 0;
+  SOLIN = (navigator.userAgent.toLowerCase().indexOf("linux") > -1) ? 1 : 0;
+  SOSOL = (navigator.userAgent.toLowerCase().indexOf("Solaris") > -1) ? 1 : 0;
+  SOALT = (!SOWIN && !SOMAC && !SOLIN && !SOSOL) ? 1 : 0;
+  var agt=navigator.userAgent.toLowerCase();
+  var is_nav = ((agt.indexOf('mozilla')!=-1) && (agt.indexOf('spoofer')==-1) &&
+               (agt.indexOf('compatible') == -1) && (agt.indexOf('opera')==-1) &&
+               (agt.indexOf('webtv')==-1) && (agt.indexOf('hotjava')==-1));
+
+  var is_ie = ((agt.indexOf("msie") != -1) && (agt.indexOf("opera") == -1));
+
+  var pluginDetected = false;
+
+
+
+  if (is_nav && !SOMAC)
+  {
+
+    for (i = 0; i < navigator.plugins.length; i++)
+    {
+      if (navigator.plugins[i].description.indexOf("Java") != -1)
+      {
+
+        pluginDetected = true;
+
+        document.writeln('<APPLET ARCHIVE="nxapplet.jar" CODE="nxapplet.class" NAME= "nxapplet" width="400" height="300">');
+        break;
+      }
+    };
+    if (pluginDetected == false)
+    {
+      document.write("<BR>You haven't a suitable Java Plugin installed.");
+      document.write("<BR>Please, download and install the jre from the Sun site:");
+      if (SOWIN) document.write('<a href="' + 'http://plugindoc.mozdev.org/windows.html#Java">Click here to download the plugin</a>');
+      if (SOLIN) document.write('<a href="' + 'http://plugindoc.mozdev.org/linux.html#Java">Click here to download the plugin</a>');
+    }
+  }
+  else if (is_ie && SOWIN)
+  {
+    document.writeln('<OBJECT classid="clsid:8AD9C840-044E-11D1-B3E9-00805F499D93" width="400" height="300" align="baseline" codebase="http://java.sun.com/products/plugin/autodl/jinstall-1_3_0_05-win.cab#Version=1,3,0,05">');
+  }
+  else if ((is_nav || is_ie) && SOMAC)
+  {
+    if(navigator.plugins)
+    {
+      navigator.plugins.refresh(false);
+    }
+    if(navigator.mimeTypes)
+    {
+      for (i=0; i < navigator.mimeTypes.length; i++)
+      {
+        if ((navigator.mimeTypes[i].type != null) &&
+           (navigator.mimeTypes[i].type.indexOf("application/x-java-applet") != -1))
+        {
+          pluginDetected = true;
+          break;
+        }
+      }
+    }
+   if (pluginDetected)
+   {
+     document.writeln('<APPLET ARCHIVE="nxapplet.jar" CODE="nxapplet.class" NAME= "nxapplet" width="400" height="300">');
+   }
+   else
+   {
+     document.write("<BR>You haven't a suitable Java Plugin installed.");
+     document.write("<BR>Please, download and install the jre from the Sun site:");
+     document.write('<a href="' + 'http://developer.apple.com/java/download/">Click here to download the plugin</a>');
+   }
+ }
+ else if(!is_nav && !is_ie)
+ {
+   document.writeln('<APPLET ARCHIVE="nxapplet.jar" CODE="nxapplet.class" NAME= "nxapplet" width="400" height="300">');
+ }
+
+
+
+// end hide JavaScript -->
+</SCRIPT>
+
+    <!--<APPLET ARCHIVE="nxapplet.jar" CODE="nxapplet.class" NAME= "nxapplet" width="400" height="300">-->
+    <PARAM NAME="boxbgcolor" VALUE="236, 235, 229">
+    <PARAM NAME="progressbar" VALUE="true">
+    <PARAM NAME="boxmessage" VALUE="Please wait while Java applet loads...">
+    <PARAM NAME="BackgroundsUrl" VALUE="http://debian.tu-bs.de/knoppix/nx/nxplugin/Java/images/backgrounds/">
+    <PARAM NAME="Background1" VALUE="background-1.gif">
+    <PARAM NAME="Background2" VALUE="background-2.gif">
+    <PARAM NAME="Background3" VALUE="background-3.gif">
+    <PARAM NAME="Background4" VALUE="background-2.gif">
+    <PARAM NAME="Background5" VALUE="background-4.gif">
+    <PARAM NAME="Background6" VALUE="background-4.gif">
+    <PARAM NAME="Background7" VALUE="background-5.gif">
+    <PARAM NAME="Background8" VALUE="background-6.gif">
+    <PARAM NAME="Background9" VALUE="background-7.gif">
+
+    <PARAM NAME="StringsUrl" VALUE="http://debian.tu-bs.de/knoppix/nx/nxplugin/Java/images/strings/">
+    <PARAM NAME="String1" VALUE="string-1.gif">
+    <PARAM NAME="String2" VALUE="string-2.gif">
+    <PARAM NAME="String3" VALUE="string-3.gif">
+    <PARAM NAME="String4" VALUE="string-4.gif">
+    <PARAM NAME="String5" VALUE="string-5.gif">
+    <PARAM NAME="String6" VALUE="string-6.gif">
+
+    <PARAM NAME="ErrorsUrl" VALUE="http://debian.tu-bs.de/knoppix/nx/nxplugin/Java/images/errors/">
+    <PARAM NAME="Error1" VALUE="error-1.gif">
+    <PARAM NAME="Error2" VALUE="error-2.gif">
+    <PARAM NAME="Error3" VALUE="error-3.gif">
+    <PARAM NAME="Error4" VALUE="error-4.gif">
+    <PARAM NAME="Error5" VALUE="error-5.gif">
+    <PARAM NAME="Error6" VALUE="error-6.gif">
+    <PARAM NAME="Error7" VALUE="error-7.gif">
+    <PARAM NAME="Error8" VALUE="error-8.gif">
+    <PARAM NAME="Error9" VALUE="error-9.gif">
+
+    <PARAM NAME="ButtonsUrl" VALUE="http://debian.tu-bs.de/knoppix/nx/nxplugin/Java/images/buttons/">
+    <PARAM NAME="Cancel" VALUE="cancel.gif">
+    <PARAM NAME="CancelOver" VALUE="cancel-over.gif">
+    <PARAM NAME="CancelActive" VALUE="cancel-active.gif">
+    <PARAM NAME="Continue" VALUE="continue.gif">
+    <PARAM NAME="ContinueOver" VALUE="continue-over.gif">
+    <PARAM NAME="ContinueActive" VALUE="continue-active.gif">
+    <PARAM NAME="Download" VALUE="download.gif">
+    <PARAM NAME="DownloadOver" VALUE="download-over.gif">
+    <PARAM NAME="DownloadActive" VALUE="download-active.gif">
+    <PARAM NAME="Run" VALUE="run.gif">
+    <PARAM NAME="RunOver" VALUE="run-over.gif">
+    <PARAM NAME="RunActive" VALUE="run-active.gif">
+    <PARAM NAME="Details" VALUE="details.gif">
+    <PARAM NAME="DetailsOver" VALUE="details-over.gif">
+    <PARAM NAME="DetailsActive" VALUE="details-active.gif">
+    <PARAM NAME="RedirectUrl" VALUE="http://freenx.berlios.de/ukuug/">
+    <PARAM NAME="SessionUrl" VALUE="http://freenx.berlios.de/ukuug/ukuug.nxs">
+    <PARAM NAME="SessionName" VALUE="ukuug.nxs">
+    <PARAM NAME="Linux" VALUE="/plugin/Linux/">
+    <PARAM NAME="DefaultPluginLinuxUrl" VALUE="http://debian.tu-bs.de/knoppix/nx/nxplugin/Linux/client-ukuug.zip">
+    <PARAM NAME="DefaultPluginLinuxVersion" VALUE = "1.5.0-97">
+    <PARAM NAME="Windows" VALUE="/plugin/Windows/">
+    <PARAM NAME="DefaultPluginWindowsUrl" VALUE="http://debian.tu-bs.de/knoppix/nx/nxplugin/Windows/client.zip">
+    <PARAM NAME="DefaultPluginWindowsVersion" VALUE = "1.5.0-97">
+    <PARAM NAME="MacOS" VALUE="/plugin/MacOSX/">
+    <PARAM NAME="DefaultPluginMacOSUrl" VALUE="http://debian.tu-bs.de/knoppix/nx/nxplugin/MacOSX/client.zip">
+    <PARAM NAME="DefaultPluginMacOSVersion" VALUE = "1.5.0-97">
+    <PARAM NAME="Solaris" VALUE="/plugin/Solaris/">
+    <PARAM NAME="DefaultPluginSolarisUrl" VALUE="http://debian.tu-bs.de/knoppix/nx/nxplugin/Solaris/client.zip">
+    <PARAM NAME="DefaultPluginSolarisVersion" VALUE = "1.5.0-97">
+    <PARAM NAME="archive" VALUE="nxapplet.jar">
+    <PARAM NAME="code" VALUE="nxapplet.class">
+    <PARAM NAME="type" VALUE="application/x-java-applet;version=1.2">
+
+   </OBJECT>
+  </APPLET>
+
+  </BODY>
+</HTML>

Added: freenx-website/ukuug/nxapplet.jar
===================================================================
--- freenx-website/ukuug/nxapplet.jar	2005-08-05 17:17:53 UTC (rev 105)
+++ freenx-website/ukuug/nxapplet.jar	2005-08-06 13:35:10 UTC (rev 106)
@@ -0,0 +1 @@
+link ../nxplugin-common/nxapplet.jar
\ No newline at end of file


Property changes on: freenx-website/ukuug/nxapplet.jar
___________________________________________________________________
Name: svn:special
   + *

Added: freenx-website/ukuug/ukuug.nxs
===================================================================
--- freenx-website/ukuug/ukuug.nxs	2005-08-05 17:17:53 UTC (rev 105)
+++ freenx-website/ukuug/ukuug.nxs	2005-08-06 13:35:10 UTC (rev 106)
@@ -0,0 +1,101 @@
+<!DOCTYPE NXClientSettings>
+<NXClientSettings application="nxclient" version="1.3" >
+<group name="Advanced" >
+<option key="Cache size" value="8" />
+<option key="Cache size on disk" value="32" />
+<option key="Current keyboard" value="false" />
+<option key="Custom keyboard layout" value="de" />
+<option key="Disable TCP no-delay" value="false" />
+<option key="Disable ZLIB stream compression" value="false" />
+<option key="Enable SSL encryption" value="true" />
+<option key="Restore cache" value="true" />
+<option key="StreamCompression" value="" />
+</group>
+<group name="Environment" >
+<option key="CUPSD path" value="/usr/sbin/cupsd" />
+</group>
+<group name="General" >
+<option key="Automatic reconnect" value="true" />
+<option key="Backingstore" value="when_requested" />
+<option key="Command line" value="/home/fabian/startit-ukuug.sh" />
+<option key="Custom Unix Desktop" value="application" />
+<option key="Desktop" value="console" />
+<option key="Link speed" value="modem" />
+<option key="Remember password" value="false" />
+<option key="Resolution" value="800x600" />
+<option key="Resolution height" value="600" />
+<option key="Resolution width" value="800" />
+<option key="Server host" value="82.165.41.51" />
+<option key="Server port" value="22" />
+<option key="Session" value="unix" />
+<option key="Use default image encoding" value="1" />
+<option key="Use render" value="true" />
+<option key="Use taint" value="true" />
+<option key="Virtual desktop" value="true" />
+<option key="XAgent encoding" value="true" />
+<option key="displaySaveOnExit" value="true" />
+<option key="xdm broadcast port" value="177" />
+<option key="xdm list host" value="localhost" />
+<option key="xdm list port" value="177" />
+<option key="xdm mode" value="server decide" />
+<option key="xdm query host" value="localhost" />
+<option key="xdm query port" value="177" />
+</group>
+<group name="Images" >
+<option key="Disable JPEG Compression" value="0" />
+<option key="Disable all image optimisations" value="false" />
+<option key="Image Compression Type" value="1" />
+<option key="Image Encoding Type" value="0" />
+<option key="Image JPEG Encoding" value="false" />
+<option key="JPEG Quality" value="0" />
+<option key="RDP optimization for low-bandwidth link" value="false" />
+<option key="Reduce colors to" value="" />
+<option key="Use PNG Compression" value="false" />
+<option key="VNC images compression" value="0" />
+<option key="Windows Image Compression" value="1" />
+</group>
+<group name="Login" >
+<option key="Auth" value="EMPTY_PASSWORD" />
+<option key="Public Key" value="-----BEGIN DSA PRIVATE KEY-----
+MIIBuwIBAAKBgQCXv9AzQXjxvXWC1qu3CdEqskX9YomTfyG865gb4D02ZwWuRU/9
+C3I9/bEWLdaWgJYXIcFJsMCIkmWjjeSZyTmeoypI1iLifTHUxn3b7WNWi8AzKcVF
+aBsBGiljsop9NiD1mEpA0G+nHHrhvTXz7pUvYrsrXcdMyM6rxqn77nbbnwIVALCi
+xFdHZADw5KAVZI7r6QatEkqLAoGBAI4L1TQGFkq5xQ/nIIciW8setAAIyrcWdK/z
+5/ZPeELdq70KDJxoLf81NL/8uIc4PoNyTRJjtT3R4f8Az1TsZWeh2+ReCEJxDWgG
+fbk2YhRqoQTtXPFsI4qvzBWct42WonWqyyb1bPBHk+JmXFscJu5yFQ+JUVNsENpY
++Gkz3HqTAoGANlgcCuA4wrC+3Cic9CFkqiwO/Rn1vk8dvGuEQqFJ6f6LVfPfRTfa
+QU7TGVLk2CzY4dasrwxJ1f6FsT8DHTNGnxELPKRuLstGrFY/PR7KeafeFZDf+fJ3
+mbX5nxrld3wi5titTnX+8s4IKv29HJguPvOK/SI7cjzA+SqNfD7qEo8CFDIm1xRf
+8xAPsSKs6yZ6j1FNklfu
+-----END DSA PRIVATE KEY-----
+" />
+<option key="User" value="fabian" />
+</group>
+<group name="Services" >
+<option key="Audio" value="false" />
+<option key="IPPPort" value="631" />
+<option key="IPPPrinting" value="true" />
+<option key="Shares" value="false" />
+</group>
+<group name="VNC Session" >
+<option key="Display" value="0" />
+<option key="Password" value="" />
+<option key="Remember" value="false" />
+<option key="Server" value="0" />
+</group>
+<group name="Windows Session" >
+<option key="Application" value="" />
+<option key="Authentication" value="1" />
+<option key="Color Depth" value="8" />
+<option key="Domain" value="" />
+<option key="Image Cache" value="true" />
+<option key="Password" value="" />
+<option key="Remember" value="false" />
+<option key="Run application" value="false" />
+<option key="Server" value="" />
+<option key="User" value="" />
+</group>
+<group name="share chosen" >
+<option key="Share number" value="0" />
+</group>
+</NXClientSettings>



From fabianx at berlios.de  Sat Aug  6 16:10:53 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Sat, 6 Aug 2005 16:10:53 +0200
Subject: [Freenx-cvs] r107 - freenx-website/ukuug
Message-ID: <200508061410.j76EArRs003126@sheep.berlios.de>

Author: fabianx
Date: 2005-08-06 16:10:52 +0200 (Sat, 06 Aug 2005)
New Revision: 107

Modified:
   freenx-website/ukuug/ukuug.nxs
Log:
Made ukuug session in Fullscreen mode by default.


Modified: freenx-website/ukuug/ukuug.nxs
===================================================================
--- freenx-website/ukuug/ukuug.nxs	2005-08-06 13:35:10 UTC (rev 106)
+++ freenx-website/ukuug/ukuug.nxs	2005-08-06 14:10:52 UTC (rev 107)
@@ -22,7 +22,7 @@
 <option key="Desktop" value="console" />
 <option key="Link speed" value="modem" />
 <option key="Remember password" value="false" />
-<option key="Resolution" value="800x600" />
+<option key="Resolution" value="fullscreen" />
 <option key="Resolution height" value="600" />
 <option key="Resolution width" value="800" />
 <option key="Server host" value="82.165.41.51" />



From fabianx at berlios.de  Sun Aug  7 12:46:29 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Sun, 7 Aug 2005 12:46:29 +0200
Subject: [Freenx-cvs] r110 - freenx-website
Message-ID: <200508071046.j77AkTe0012767@sheep.berlios.de>

Author: fabianx
Date: 2005-08-07 12:46:09 +0200 (Sun, 07 Aug 2005)
New Revision: 110

Modified:
   freenx-website/home.inc
Log:
Added information about FreeNX during LWE.


Modified: freenx-website/home.inc
===================================================================
--- freenx-website/home.inc	2005-08-07 10:39:11 UTC (rev 109)
+++ freenx-website/home.inc	2005-08-07 10:46:09 UTC (rev 110)
@@ -10,6 +10,12 @@
 	<h2>
 		News
 	</h2>
+	<h3>		<a
+	href="http://www.linuxjournal.com/article/8477">Visit FreeNX on Linux WorldExpo San Francisco Aug 9-11, 2005</a> 
+        - Saturday, August 07, 2005 - 
+	</h3>
+	We also have a nice <a href="http://www.linuxjournal.com/article/8477">article series</a> at the moment, which prepares you for FreeNX during LWE.
+	
 	<h3>
 		<a
 	href="http://mail.kde.org/pipermail/freenx-knx/2005-July/001690.html">FreeNX



From fabianx at berlios.de  Sun Aug  7 12:52:10 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Sun, 7 Aug 2005 12:52:10 +0200
Subject: [Freenx-cvs] r111 - / nx-utils.tags
Message-ID: <200508071052.j77AqA61016883@sheep.berlios.de>

Author: fabianx
Date: 2005-08-07 12:51:58 +0200 (Sun, 07 Aug 2005)
New Revision: 111

Added:
   nx-utils.tags/
   nx-utils.tags/FreeNX-0_5_5-LWE/
Log:
Tagged nx-utils for 0.5.0 LWE Technology Preview.


Copied: nx-utils.tags/FreeNX-0_5_5-LWE (from rev 101, nx-utils)



From fabianx at berlios.de  Sun Aug  7 12:55:01 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Sun, 7 Aug 2005 12:55:01 +0200
Subject: [Freenx-cvs] r112 - freenx-server/tags nx-utils.tags
Message-ID: <200508071055.j77At1W0018217@sheep.berlios.de>

Author: fabianx
Date: 2005-08-07 12:54:40 +0200 (Sun, 07 Aug 2005)
New Revision: 112

Added:
   freenx-server/tags/FreeNX-0_5_0-LWE/
   nx-utils.tags/FreeNX-0_5_0-LWE/
Removed:
   freenx-server/tags/FreeNX-0_5_5-LWE/
   nx-utils.tags/FreeNX-0_5_5-LWE/
Log:
Renamed the tags to be 0.5.0 and not 0.5.5 :-/.


Copied: freenx-server/tags/FreeNX-0_5_0-LWE (from rev 111, freenx-server/tags/FreeNX-0_5_5-LWE)

Copied: nx-utils.tags/FreeNX-0_5_0-LWE (from rev 111, nx-utils.tags/FreeNX-0_5_5-LWE)



From fabianx at berlios.de  Sun Aug  7 02:11:27 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Sun, 7 Aug 2005 02:11:27 +0200
Subject: [Freenx-cvs] r108 - freenx-server/trunk
Message-ID: <200508070011.j770BRZY014467@sheep.berlios.de>

Author: fabianx
Date: 2005-08-07 02:10:43 +0200 (Sun, 07 Aug 2005)
New Revision: 108

Modified:
   freenx-server/trunk/ChangeLog
   freenx-server/trunk/nxserver
Log:
Ported changes from 0.4.4 branch. (merged with 0.4.4 final).


Modified: freenx-server/trunk/ChangeLog
===================================================================
--- freenx-server/trunk/ChangeLog	2005-08-06 14:10:52 UTC (rev 107)
+++ freenx-server/trunk/ChangeLog	2005-08-07 00:10:43 UTC (rev 108)
@@ -21,6 +21,7 @@
 	* Made nxsetup more enterprise friendly. Added --localuser
 	  (RedHat only) and --gid. 
 	  (Based on a patch by "Ed Warnicke" <eaw at cisco.com>)
+	* Fixed resume of multiple sessions.	
 
 28.07.2005 FreeNX 0.4.3 "NoMachine 1.5.0 Edition"
 	* Fixed reconnection problems with !M 1.5.0 client.

Modified: freenx-server/trunk/nxserver
===================================================================
--- freenx-server/trunk/nxserver	2005-08-06 14:10:52 UTC (rev 107)
+++ freenx-server/trunk/nxserver	2005-08-07 00:10:43 UTC (rev 108)
@@ -249,7 +249,7 @@
 			then
 				available="Yes"
 			fi
-			printf "%-7s %-16s %32s %8s %5s %-14s %-11s %s" "$(getparam display)" "$(getparam type)" "$(getparam sessionId)" "$options" "$depth" "$geom" "$available" "$(getparam sessionName)" >> $TMPFILE
+			printf "%-7s %-16s %32s %8s %5s %-14s %-11s %s\n" "$(getparam display)" "$(getparam type)" "$(getparam sessionId)" "$options" "$depth" "$geom" "$available" "$(getparam sessionName)" >> $TMPFILE
 		fi
 		egrep -q "^userName=$1$" $i && let SESSION_COUNT_USER=$SESSION_COUNT_USER+1
 	done



From fabianx at berlios.de  Mon Aug  8 01:49:10 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Mon, 8 Aug 2005 01:49:10 +0200
Subject: [Freenx-cvs] r113 - in freenx-website: . lwe
Message-ID: <200508072349.j77NnAcX022320@sheep.berlios.de>

Author: fabianx
Date: 2005-08-08 01:49:03 +0200 (Mon, 08 Aug 2005)
New Revision: 113

Added:
   freenx-website/lwe/
   freenx-website/lwe/index.html
   freenx-website/lwe/lwe.nxs
   freenx-website/lwe/nxapplet.jar
Log:
Added applet and configuration for LWE.


Added: freenx-website/lwe/index.html
===================================================================
--- freenx-website/lwe/index.html	2005-08-07 10:54:40 UTC (rev 112)
+++ freenx-website/lwe/index.html	2005-08-07 23:49:03 UTC (rev 113)
@@ -0,0 +1,193 @@
+<!--
+/**************************************************************************/
+/*                                                                        */
+/* Copyright (c) 2004, 2005 NoMachine, http://www.nomachine.com.          */
+/*                                                                        */
+/* NXAPPLET, NX protocol compression and NX extensions to this software   */
+/* are copyright of NoMachine. Redistribution and use of the present      */
+/* software is allowed according to terms specified in the file LICENSE   */
+/* which comes in the source distribution.                                */
+/*                                                                        */
+/* Check http://www.nomachine.com/licensing.html for applicability.       */
+/*                                                                        */
+/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
+/*                                                                        */
+/* All rights reserved.                                                   */
+/*                                                                        */
+/**************************************************************************/
+
+This file is provided as an example, you can freely personalize it to fit
+your needs.
+-->
+
+<HTML>
+<HEAD>
+  <META HTTP-EQUIV="expires" CONTENT="0">
+  <META HTTP-EQUIV="Pragma" CONTENT="no-cache">
+  <META HTTP-EQUIV="Cache-Control" CONTENT="no-cache">
+  <TITLE>The future of NX! - Linux World Conference & Expo San Francisco 2005</TITLE>
+
+</HEAD>
+
+
+  <BODY>
+
+    <SCRIPT LANGUAGE="Javascript1.1">
+ <!-- hide JavaScript from non-JavaScript browsers
+
+
+  SOWIN = (navigator.userAgent.toLowerCase().indexOf("win") > -1) ? 1 : 0;
+  SOMAC = (navigator.userAgent.toLowerCase().indexOf("mac") > -1) ? 1 : 0;
+  SOLIN = (navigator.userAgent.toLowerCase().indexOf("linux") > -1) ? 1 : 0;
+  SOSOL = (navigator.userAgent.toLowerCase().indexOf("Solaris") > -1) ? 1 : 0;
+  SOALT = (!SOWIN && !SOMAC && !SOLIN && !SOSOL) ? 1 : 0;
+  var agt=navigator.userAgent.toLowerCase();
+  var is_nav = ((agt.indexOf('mozilla')!=-1) && (agt.indexOf('spoofer')==-1) &&
+               (agt.indexOf('compatible') == -1) && (agt.indexOf('opera')==-1) &&
+               (agt.indexOf('webtv')==-1) && (agt.indexOf('hotjava')==-1));
+
+  var is_ie = ((agt.indexOf("msie") != -1) && (agt.indexOf("opera") == -1));
+
+  var pluginDetected = false;
+
+
+
+  if (is_nav && !SOMAC)
+  {
+
+    for (i = 0; i < navigator.plugins.length; i++)
+    {
+      if (navigator.plugins[i].description.indexOf("Java") != -1)
+      {
+
+        pluginDetected = true;
+
+        document.writeln('<APPLET ARCHIVE="nxapplet.jar" CODE="nxapplet.class" NAME= "nxapplet" width="400" height="300">');
+        break;
+      }
+    };
+    if (pluginDetected == false)
+    {
+      document.write("<BR>You haven't a suitable Java Plugin installed.");
+      document.write("<BR>Please, download and install the jre from the Sun site:");
+      if (SOWIN) document.write('<a href="' + 'http://plugindoc.mozdev.org/windows.html#Java">Click here to download the plugin</a>');
+      if (SOLIN) document.write('<a href="' + 'http://plugindoc.mozdev.org/linux.html#Java">Click here to download the plugin</a>');
+    }
+  }
+  else if (is_ie && SOWIN)
+  {
+    document.writeln('<OBJECT classid="clsid:8AD9C840-044E-11D1-B3E9-00805F499D93" width="400" height="300" align="baseline" codebase="http://java.sun.com/products/plugin/autodl/jinstall-1_3_0_05-win.cab#Version=1,3,0,05">');
+  }
+  else if ((is_nav || is_ie) && SOMAC)
+  {
+    if(navigator.plugins)
+    {
+      navigator.plugins.refresh(false);
+    }
+    if(navigator.mimeTypes)
+    {
+      for (i=0; i < navigator.mimeTypes.length; i++)
+      {
+        if ((navigator.mimeTypes[i].type != null) &&
+           (navigator.mimeTypes[i].type.indexOf("application/x-java-applet") != -1))
+        {
+          pluginDetected = true;
+          break;
+        }
+      }
+    }
+   if (pluginDetected)
+   {
+     document.writeln('<APPLET ARCHIVE="nxapplet.jar" CODE="nxapplet.class" NAME= "nxapplet" width="400" height="300">');
+   }
+   else
+   {
+     document.write("<BR>You haven't a suitable Java Plugin installed.");
+     document.write("<BR>Please, download and install the jre from the Sun site:");
+     document.write('<a href="' + 'http://developer.apple.com/java/download/">Click here to download the plugin</a>');
+   }
+ }
+ else if(!is_nav && !is_ie)
+ {
+   document.writeln('<APPLET ARCHIVE="nxapplet.jar" CODE="nxapplet.class" NAME= "nxapplet" width="400" height="300">');
+ }
+
+
+
+// end hide JavaScript -->
+</SCRIPT>
+
+    <!--<APPLET ARCHIVE="nxapplet.jar" CODE="nxapplet.class" NAME= "nxapplet" width="400" height="300">-->
+    <PARAM NAME="boxbgcolor" VALUE="236, 235, 229">
+    <PARAM NAME="progressbar" VALUE="true">
+    <PARAM NAME="boxmessage" VALUE="Please wait while Java applet loads...">
+    <PARAM NAME="BackgroundsUrl" VALUE="http://debian.tu-bs.de/knoppix/nx/nxplugin/Java/images/backgrounds/">
+    <PARAM NAME="Background1" VALUE="background-1.gif">
+    <PARAM NAME="Background2" VALUE="background-2.gif">
+    <PARAM NAME="Background3" VALUE="background-3.gif">
+    <PARAM NAME="Background4" VALUE="background-2.gif">
+    <PARAM NAME="Background5" VALUE="background-4.gif">
+    <PARAM NAME="Background6" VALUE="background-4.gif">
+    <PARAM NAME="Background7" VALUE="background-5.gif">
+    <PARAM NAME="Background8" VALUE="background-6.gif">
+    <PARAM NAME="Background9" VALUE="background-7.gif">
+
+    <PARAM NAME="StringsUrl" VALUE="http://debian.tu-bs.de/knoppix/nx/nxplugin/Java/images/strings/">
+    <PARAM NAME="String1" VALUE="string-1.gif">
+    <PARAM NAME="String2" VALUE="string-2.gif">
+    <PARAM NAME="String3" VALUE="string-3.gif">
+    <PARAM NAME="String4" VALUE="string-4.gif">
+    <PARAM NAME="String5" VALUE="string-5.gif">
+    <PARAM NAME="String6" VALUE="string-6.gif">
+
+    <PARAM NAME="ErrorsUrl" VALUE="http://debian.tu-bs.de/knoppix/nx/nxplugin/Java/images/errors/">
+    <PARAM NAME="Error1" VALUE="error-1.gif">
+    <PARAM NAME="Error2" VALUE="error-2.gif">
+    <PARAM NAME="Error3" VALUE="error-3.gif">
+    <PARAM NAME="Error4" VALUE="error-4.gif">
+    <PARAM NAME="Error5" VALUE="error-5.gif">
+    <PARAM NAME="Error6" VALUE="error-6.gif">
+    <PARAM NAME="Error7" VALUE="error-7.gif">
+    <PARAM NAME="Error8" VALUE="error-8.gif">
+    <PARAM NAME="Error9" VALUE="error-9.gif">
+
+    <PARAM NAME="ButtonsUrl" VALUE="http://debian.tu-bs.de/knoppix/nx/nxplugin/Java/images/buttons/">
+    <PARAM NAME="Cancel" VALUE="cancel.gif">
+    <PARAM NAME="CancelOver" VALUE="cancel-over.gif">
+    <PARAM NAME="CancelActive" VALUE="cancel-active.gif">
+    <PARAM NAME="Continue" VALUE="continue.gif">
+    <PARAM NAME="ContinueOver" VALUE="continue-over.gif">
+    <PARAM NAME="ContinueActive" VALUE="continue-active.gif">
+    <PARAM NAME="Download" VALUE="download.gif">
+    <PARAM NAME="DownloadOver" VALUE="download-over.gif">
+    <PARAM NAME="DownloadActive" VALUE="download-active.gif">
+    <PARAM NAME="Run" VALUE="run.gif">
+    <PARAM NAME="RunOver" VALUE="run-over.gif">
+    <PARAM NAME="RunActive" VALUE="run-active.gif">
+    <PARAM NAME="Details" VALUE="details.gif">
+    <PARAM NAME="DetailsOver" VALUE="details-over.gif">
+    <PARAM NAME="DetailsActive" VALUE="details-active.gif">
+    <PARAM NAME="RedirectUrl" VALUE="http://freenx.berlios.de/lwe/">
+    <PARAM NAME="SessionUrl" VALUE="http://freenx.berlios.de/lwe/lwe.nxs">
+    <PARAM NAME="SessionName" VALUE="lwe.nxs">
+    <PARAM NAME="Linux" VALUE="/plugin/Linux/">
+    <PARAM NAME="DefaultPluginLinuxUrl" VALUE="http://debian.tu-bs.de/knoppix/nx/nxplugin/Linux/client-lwe.zip">
+    <PARAM NAME="DefaultPluginLinuxVersion" VALUE = "1.5.0-97">
+    <PARAM NAME="Windows" VALUE="/plugin/Windows/">
+    <PARAM NAME="DefaultPluginWindowsUrl" VALUE="http://debian.tu-bs.de/knoppix/nx/nxplugin/Windows/client.zip">
+    <PARAM NAME="DefaultPluginWindowsVersion" VALUE = "1.5.0-97">
+    <PARAM NAME="MacOS" VALUE="/plugin/MacOSX/">
+    <PARAM NAME="DefaultPluginMacOSUrl" VALUE="http://debian.tu-bs.de/knoppix/nx/nxplugin/MacOSX/client.zip">
+    <PARAM NAME="DefaultPluginMacOSVersion" VALUE = "1.5.0-97">
+    <PARAM NAME="Solaris" VALUE="/plugin/Solaris/">
+    <PARAM NAME="DefaultPluginSolarisUrl" VALUE="http://debian.tu-bs.de/knoppix/nx/nxplugin/Solaris/client.zip">
+    <PARAM NAME="DefaultPluginSolarisVersion" VALUE = "1.5.0-97">
+    <PARAM NAME="archive" VALUE="nxapplet.jar">
+    <PARAM NAME="code" VALUE="nxapplet.class">
+    <PARAM NAME="type" VALUE="application/x-java-applet;version=1.2">
+
+   </OBJECT>
+  </APPLET>
+
+  </BODY>
+</HTML>

Added: freenx-website/lwe/lwe.nxs
===================================================================
--- freenx-website/lwe/lwe.nxs	2005-08-07 10:54:40 UTC (rev 112)
+++ freenx-website/lwe/lwe.nxs	2005-08-07 23:49:03 UTC (rev 113)
@@ -0,0 +1,101 @@
+<!DOCTYPE NXClientSettings>
+<NXClientSettings application="nxclient" version="1.3" >
+<group name="Advanced" >
+<option key="Cache size" value="8" />
+<option key="Cache size on disk" value="32" />
+<option key="Current keyboard" value="false" />
+<option key="Custom keyboard layout" value="de" />
+<option key="Disable TCP no-delay" value="false" />
+<option key="Disable ZLIB stream compression" value="false" />
+<option key="Enable SSL encryption" value="true" />
+<option key="Restore cache" value="true" />
+<option key="StreamCompression" value="" />
+</group>
+<group name="Environment" >
+<option key="CUPSD path" value="/usr/sbin/cupsd" />
+</group>
+<group name="General" >
+<option key="Automatic reconnect" value="true" />
+<option key="Backingstore" value="when_requested" />
+<option key="Command line" value="startit-lwe.sh" />
+<option key="Custom Unix Desktop" value="application" />
+<option key="Desktop" value="console" />
+<option key="Link speed" value="modem" />
+<option key="Remember password" value="false" />
+<option key="Resolution" value="800x600" />
+<option key="Resolution height" value="600" />
+<option key="Resolution width" value="800" />
+<option key="Server host" value="82.165.41.51" />
+<option key="Server port" value="22" />
+<option key="Session" value="unix" />
+<option key="Use default image encoding" value="1" />
+<option key="Use render" value="true" />
+<option key="Use taint" value="true" />
+<option key="Virtual desktop" value="true" />
+<option key="XAgent encoding" value="true" />
+<option key="displaySaveOnExit" value="true" />
+<option key="xdm broadcast port" value="177" />
+<option key="xdm list host" value="localhost" />
+<option key="xdm list port" value="177" />
+<option key="xdm mode" value="server decide" />
+<option key="xdm query host" value="localhost" />
+<option key="xdm query port" value="177" />
+</group>
+<group name="Images" >
+<option key="Disable JPEG Compression" value="0" />
+<option key="Disable all image optimisations" value="false" />
+<option key="Image Compression Type" value="1" />
+<option key="Image Encoding Type" value="0" />
+<option key="Image JPEG Encoding" value="false" />
+<option key="JPEG Quality" value="0" />
+<option key="RDP optimization for low-bandwidth link" value="false" />
+<option key="Reduce colors to" value="" />
+<option key="Use PNG Compression" value="false" />
+<option key="VNC images compression" value="0" />
+<option key="Windows Image Compression" value="1" />
+</group>
+<group name="Login" >
+<option key="Auth" value="EMPTY_PASSWORD" />
+<option key="Public Key" value="-----BEGIN DSA PRIVATE KEY-----
+MIIBuwIBAAKBgQCXv9AzQXjxvXWC1qu3CdEqskX9YomTfyG865gb4D02ZwWuRU/9
+C3I9/bEWLdaWgJYXIcFJsMCIkmWjjeSZyTmeoypI1iLifTHUxn3b7WNWi8AzKcVF
+aBsBGiljsop9NiD1mEpA0G+nHHrhvTXz7pUvYrsrXcdMyM6rxqn77nbbnwIVALCi
+xFdHZADw5KAVZI7r6QatEkqLAoGBAI4L1TQGFkq5xQ/nIIciW8setAAIyrcWdK/z
+5/ZPeELdq70KDJxoLf81NL/8uIc4PoNyTRJjtT3R4f8Az1TsZWeh2+ReCEJxDWgG
+fbk2YhRqoQTtXPFsI4qvzBWct42WonWqyyb1bPBHk+JmXFscJu5yFQ+JUVNsENpY
++Gkz3HqTAoGANlgcCuA4wrC+3Cic9CFkqiwO/Rn1vk8dvGuEQqFJ6f6LVfPfRTfa
+QU7TGVLk2CzY4dasrwxJ1f6FsT8DHTNGnxELPKRuLstGrFY/PR7KeafeFZDf+fJ3
+mbX5nxrld3wi5titTnX+8s4IKv29HJguPvOK/SI7cjzA+SqNfD7qEo8CFDIm1xRf
+8xAPsSKs6yZ6j1FNklfu
+-----END DSA PRIVATE KEY-----
+" />
+<option key="User" value="fabian" />
+</group>
+<group name="Services" >
+<option key="Audio" value="false" />
+<option key="IPPPort" value="631" />
+<option key="IPPPrinting" value="true" />
+<option key="Shares" value="false" />
+</group>
+<group name="VNC Session" >
+<option key="Display" value="0" />
+<option key="Password" value="" />
+<option key="Remember" value="false" />
+<option key="Server" value="0" />
+</group>
+<group name="Windows Session" >
+<option key="Application" value="" />
+<option key="Authentication" value="1" />
+<option key="Color Depth" value="8" />
+<option key="Domain" value="" />
+<option key="Image Cache" value="true" />
+<option key="Password" value="" />
+<option key="Remember" value="false" />
+<option key="Run application" value="false" />
+<option key="Server" value="" />
+<option key="User" value="" />
+</group>
+<group name="share chosen" >
+<option key="Share number" value="0" />
+</group>
+</NXClientSettings>

Added: freenx-website/lwe/nxapplet.jar
===================================================================
--- freenx-website/lwe/nxapplet.jar	2005-08-07 10:54:40 UTC (rev 112)
+++ freenx-website/lwe/nxapplet.jar	2005-08-07 23:49:03 UTC (rev 113)
@@ -0,0 +1 @@
+link ../nxplugin-common/nxapplet.jar
\ No newline at end of file


Property changes on: freenx-website/lwe/nxapplet.jar
___________________________________________________________________
Name: svn:special
   + *



From fabianx at berlios.de  Wed Aug 10 01:00:30 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Wed, 10 Aug 2005 01:00:30 +0200
Subject: [Freenx-cvs] r114 - freenx-server/branches
Message-ID: <200508092300.j79N0UY5006777@sheep.berlios.de>

Author: fabianx
Date: 2005-08-10 00:59:59 +0200 (Wed, 10 Aug 2005)
New Revision: 114

Added:
   freenx-server/branches/FreeNX-0.4/
Log:
Added stable branch based on 0.4.4-RC1.


Copied: freenx-server/branches/FreeNX-0.4 (from rev 113, freenx-server/tags/FreeNX-0_4_4-RC1)



From fabianx at berlios.de  Wed Aug 10 01:03:07 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Wed, 10 Aug 2005 01:03:07 +0200
Subject: [Freenx-cvs] r115 - freenx-server/branches/FreeNX-0.4
Message-ID: <200508092303.j79N37Iv008586@sheep.berlios.de>

Author: fabianx
Date: 2005-08-10 01:02:45 +0200 (Wed, 10 Aug 2005)
New Revision: 115

Modified:
   freenx-server/branches/FreeNX-0.4/ChangeLog
   freenx-server/branches/FreeNX-0.4/nxserver
Log:
Merged changes to 0.4.4 final.

------------------------------------------------------------------------
r108 | fabianx | 2005-08-07 02:10:43 +0200 (So, 07 Aug 2005) | 2 lines

Ported changes from 0.4.4 branch. (merged with 0.4.4 final).



Modified: freenx-server/branches/FreeNX-0.4/ChangeLog
===================================================================
--- freenx-server/branches/FreeNX-0.4/ChangeLog	2005-08-09 22:59:59 UTC (rev 114)
+++ freenx-server/branches/FreeNX-0.4/ChangeLog	2005-08-09 23:02:45 UTC (rev 115)
@@ -17,6 +17,7 @@
 	* Made nxsetup more enterprise friendly. Added --localuser
 	  (RedHat only) and --gid. 
 	  (Based on a patch by "Ed Warnicke" <eaw at cisco.com>)
+	* Fixed resume of multiple sessions.	
 
 28.07.2005 FreeNX 0.4.3 "NoMachine 1.5.0 Edition"
 	* Fixed reconnection problems with !M 1.5.0 client.

Modified: freenx-server/branches/FreeNX-0.4/nxserver
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxserver	2005-08-09 22:59:59 UTC (rev 114)
+++ freenx-server/branches/FreeNX-0.4/nxserver	2005-08-09 23:02:45 UTC (rev 115)
@@ -249,7 +249,7 @@
 			then
 				available="Yes"
 			fi
-			printf "%-7s %-16s %32s %8s %5s %-14s %-11s %s" "$(getparam display)" "$(getparam type)" "$(getparam sessionId)" "$options" "$depth" "$geom" "$available" "$(getparam sessionName)" >> $TMPFILE
+			printf "%-7s %-16s %32s %8s %5s %-14s %-11s %s\n" "$(getparam display)" "$(getparam type)" "$(getparam sessionId)" "$options" "$depth" "$geom" "$available" "$(getparam sessionName)" >> $TMPFILE
 		fi
 		egrep -q "^userName=$1$" $i && let SESSION_COUNT_USER=$SESSION_COUNT_USER+1
 	done



From FabianFranz at gmx.de  Wed Aug 10 01:02:20 2005
From: FabianFranz at gmx.de (Fabian Franz)
Date: Wed, 10 Aug 2005 01:02:20 +0200
Subject: [Freenx-cvs] CVS no longer to be used!
Message-ID: <200508100102.22954.FabianFranz@gmx.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi,

all development will take place in SVN now.

0.4 branch can be found in freenx-server/branches/FreeNX-0.4

cu

Fabian
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)

iD8DBQFC+TX+I0lSH7CXz7MRAuwCAJ4jkAd/4QkbBbYc2oXFvHEi6OSPCwCghj3R
yBjk2H+FnCx+QhjFLjSaGok=
=edXh
-----END PGP SIGNATURE-----



From fabianx at berlios.de  Wed Aug 10 01:22:26 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Wed, 10 Aug 2005 01:22:26 +0200
Subject: [Freenx-cvs] r117 - freenx-server/branches/FreeNX-0.4
Message-ID: <200508092322.j79NMQHE015052@sheep.berlios.de>

Author: fabianx
Date: 2005-08-10 01:22:09 +0200 (Wed, 10 Aug 2005)
New Revision: 117

Modified:
   freenx-server/branches/FreeNX-0.4/nxsetup
Log:
Added interactive support to nxsetup.


Modified: freenx-server/branches/FreeNX-0.4/nxsetup
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-09 23:05:34 UTC (rev 116)
+++ freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-09 23:22:09 UTC (rev 117)
@@ -22,6 +22,7 @@
 PURGE="no"
 SETUP_SSH2_KEY="no"
 BUILD_KNOWN_HOSTS="yes"
+AUTOMATIC="no"
 
 while [ "$1" ]
 do
@@ -37,6 +38,7 @@
 		--clean) CLEAN="yes"; shift ;;
 		--uninstall) UNINSTALL="yes"; shift ;;
 		--purge) PURGE="yes"; shift ;;
+		--auto) AUTOMATIC="yes"; shift ;;
 		--) shift ; break ;;
 		*) echo "Invalid flag $1" ; HELP="yes"; shift ; break ;;
 	esac
@@ -87,6 +89,18 @@
 	exit 1
 fi
 
+if [ "$INSTALL" = "yes" -a "$AUTOMATIC" = "no" -a "$SETUP_NOMACHINE_KEY" = "no" ]
+then
+	echo "------> It is recommended that you use the NoMachine key for"
+	echo "        easier setup. At the moment FreeNX would create a custom"
+	echo "        KeyPair and expect you to setup your clients manually. "
+	echo ""
+	echo -n "        Do you really want to use your own keys? [y/N] "
+	read -n 1 CHOICE
+	[ "$CHOICE" = "y" ] || SETUP_NOMACHINE_KEY="yes"
+fi
+
+
 # Read the config file
 . $(PATH=$(cd $(dirname $0) && pwd):$PATH which nxloadconfig) --
 
@@ -364,6 +378,8 @@
 		echo "         Please replace /usr/NX/share/client.id_dsa.key on all clients you want"
 		echo "         to use with $NX_HOME_DIR/.ssh/client.id_dsa.key"
 		echo "         and protect it accordingly."
+		echo ""
+		echo "         Since 1.5.0 you need to import the correct key via the GUI."
 		echo
 		echo "         If you really want to use the NoMachine key please remove"
 		echo "         '$NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS'"



From fabianx at berlios.de  Wed Aug 10 01:30:08 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Wed, 10 Aug 2005 01:30:08 +0200
Subject: [Freenx-cvs] r118 - freenx-server/branches/FreeNX-0.4
Message-ID: <200508092330.j79NU8rm020435@sheep.berlios.de>

Author: fabianx
Date: 2005-08-10 01:29:49 +0200 (Wed, 10 Aug 2005)
New Revision: 118

Modified:
   freenx-server/branches/FreeNX-0.4/ChangeLog
   freenx-server/branches/FreeNX-0.4/nxsetup
Log:
setup-nomachine-key overwrites now always the old key.

Added neccessary changes of nxsetup to ChangeLog.



Modified: freenx-server/branches/FreeNX-0.4/ChangeLog
===================================================================
--- freenx-server/branches/FreeNX-0.4/ChangeLog	2005-08-09 23:22:09 UTC (rev 117)
+++ freenx-server/branches/FreeNX-0.4/ChangeLog	2005-08-09 23:29:49 UTC (rev 118)
@@ -1,3 +1,6 @@
+*****.2005 FreeNX 0.4.5 ???
+	* Made nxsetup more user-friendly and hopefully finally failsafe.
+
 06.08.2005 FreeNX 0.4.4 "UKUUG Enterprise Edition"
 	* Added ENABLE_1_5_0_BACKEND configuration directive:
 		* Fixed fullscreen support in nxdesktop (still feels more like

Modified: freenx-server/branches/FreeNX-0.4/nxsetup
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-09 23:22:09 UTC (rev 117)
+++ freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-09 23:29:49 UTC (rev 118)
@@ -211,7 +211,7 @@
 	mkdir -p $NX_HOME_DIR/.ssh
 	chmod 700 $NX_HOME_DIR/ $NX_HOME_DIR/.ssh
 	
-	if [ ! -f $NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS ]
+	if [ ! -f $NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS -o "$SETUP_NOMACHINE_KEY" = "yes" ]
 	then
 		SETUP_NX_KEY="yes"
 		if [ "$SETUP_NOMACHINE_KEY" = "yes" ]



From fabianx at berlios.de  Wed Aug 10 01:42:59 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Wed, 10 Aug 2005 01:42:59 +0200
Subject: [Freenx-cvs] r119 - freenx-server/branches/FreeNX-0.4
Message-ID: <200508092342.j79Ngx8x026679@sheep.berlios.de>

Author: fabianx
Date: 2005-08-10 01:42:34 +0200 (Wed, 10 Aug 2005)
New Revision: 119

Modified:
   freenx-server/branches/FreeNX-0.4/nxsetup
Log:
Added interactive support if neither --install nor --uninstall are present.


Modified: freenx-server/branches/FreeNX-0.4/nxsetup
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-09 23:29:49 UTC (rev 118)
+++ freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-09 23:42:34 UTC (rev 119)
@@ -47,12 +47,29 @@
 #Check for invalid combinations:
 [ "$SETUP_LOCAL_USER" = "yes" -a -z "$LOCAL_USER_OPTION" ] && HELP="yes"
 [ "$INSTALL" = "yes" -a "$UNINSTALL" = "yes" ] && HELP="yes"
-[ "$INSTALL" = "no" -a "$UNINSTALL" = "no" ] && HELP="yes"
 [ "$INSTALL" = "yes" -a "$CLEAN" = "no" -a "$PURGE" = "yes" ] && HELP="yes"
 [ "$UNINSTALL" = "yes" ] && [ "$SETUP_NOMACHINE_KEY" = "yes" -o -n "$SETUP_UID" -o "$CLEAN" = "yes" ] && HELP="yes"
 [ "$UNINSTALL" = "yes" -a "$CLEAN" = "yes" ] && HELP="yes"
 [ "$SETUP_SSH2_KEY" = "yes" -a "$SETUP_NOMACHINE_KEY" = "no" ] && HELP="yes"
 
+if [ "$INSTALL" = "no" -a "$UNINSTALL" = "no" ]
+then
+	if [ "$AUTOMATIC" = "no" -a "$HELP" = "no" ]
+	then
+		echo "------> You did select no action."
+		echo "        FreeNX guesses that you want to _install_ the"
+		echo "        server."
+		echo "        Use --help to get help contents."
+		echo ""
+		echo -n "Do you want to abort now? [y/N] "
+		read -n 1 CHOICE
+		echo
+		[ "$CHOICE" = "y" ] && HELP="yes"
+	else
+		HELP="yes"
+	fi
+fi
+
 if [ "$HELP" = "yes" ]
 then
 	echo "nxsetup - Setup the FreeNX server."
@@ -272,6 +289,11 @@
 	echo "done"
 }
 
+test_nx()
+{
+	:	
+}
+
 uninstall_nx() 
 {
 	if nx_user_exists
@@ -330,6 +352,8 @@
 	[ "$CLEAN" = "yes" ] && uninstall_nx
 	
 	install_nx
+
+	test_nx
 	
 	echo "Ok, nxserver is ready."
 	echo 



From fabianx at berlios.de  Wed Aug 10 02:28:25 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Wed, 10 Aug 2005 02:28:25 +0200
Subject: [Freenx-cvs] r120 - freenx-server/branches/FreeNX-0.4
Message-ID: <200508100028.j7A0SPFE012458@sheep.berlios.de>

Author: fabianx
Date: 2005-08-10 02:27:52 +0200 (Wed, 10 Aug 2005)
New Revision: 120

Modified:
   freenx-server/branches/FreeNX-0.4/nxloadconfig
   freenx-server/branches/FreeNX-0.4/nxsetup
Log:
Changed interactive mode to be less lines.
Added:

	- Enforcing of configuration check
	- Test of the connection to the server
		- Warning if version mismatches



Modified: freenx-server/branches/FreeNX-0.4/nxloadconfig
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxloadconfig	2005-08-09 23:42:34 UTC (rev 119)
+++ freenx-server/branches/FreeNX-0.4/nxloadconfig	2005-08-10 00:27:52 UTC (rev 120)
@@ -493,6 +493,7 @@
 		echo "  Errors occured during config check."
 		echo "  Please correct the configuration file."
 		echo
+		exit 1
 	elif [ "$WARNING" = "yes" ]
 	then
 		echo

Modified: freenx-server/branches/FreeNX-0.4/nxsetup
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-09 23:42:34 UTC (rev 119)
+++ freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-10 00:27:52 UTC (rev 120)
@@ -52,24 +52,21 @@
 [ "$UNINSTALL" = "yes" -a "$CLEAN" = "yes" ] && HELP="yes"
 [ "$SETUP_SSH2_KEY" = "yes" -a "$SETUP_NOMACHINE_KEY" = "no" ] && HELP="yes"
 
-if [ "$INSTALL" = "no" -a "$UNINSTALL" = "no" ]
+if [ "$INSTALL" = "no" -a "$UNINSTALL" = "no" -a "$AUTOMATIC" = "no" ]
 then
-	if [ "$AUTOMATIC" = "no" -a "$HELP" = "no" ]
-	then
-		echo "------> You did select no action."
-		echo "        FreeNX guesses that you want to _install_ the"
-		echo "        server."
-		echo "        Use --help to get help contents."
-		echo ""
-		echo -n "Do you want to abort now? [y/N] "
-		read -n 1 CHOICE
-		echo
-		[ "$CHOICE" = "y" ] && HELP="yes"
-	else
-		HELP="yes"
-	fi
+	echo "------> You did select no action."
+	echo "        FreeNX guesses that you want to _install_ the"
+	echo "        server."
+	echo "        Use --help to get help contents."
+	echo ""
+	echo -n "Do you want to abort now? [y/N] "
+	read -n 1 CHOICE
+	echo
+	[ "$CHOICE" = "y" ] || INSTALL="yes"
 fi
 
+[ "$INSTALL" = "no" -a "$UNINSTALL" = "no" ] && HELP="yes"
+
 if [ "$HELP" = "yes" ]
 then
 	echo "nxsetup - Setup the FreeNX server."
@@ -237,6 +234,21 @@
 no-port-forwarding,no-X11-forwarding,no-agent-forwarding,command="$PATH_BIN/nxserver" ssh-dss AAAAB3NzaC1kc3MAAACBAJe/0DNBePG9dYLWq7cJ0SqyRf1iiZN/IbzrmBvgPTZnBa5FT/0Lcj39sRYt1paAlhchwUmwwIiSZaON5JnJOZ6jKkjWIuJ9MdTGfdvtY1aLwDMpxUVoGwEaKWOyin02IPWYSkDQb6cceuG9NfPulS9iuytdx0zIzqvGqfvudtufAAAAFQCwosRXR2QA8OSgFWSO6+kGrRJKiwAAAIEAjgvVNAYWSrnFD+cghyJbyx60AAjKtxZ0r/Pn9k94Qt2rvQoMnGgt/zU0v/y4hzg+g3JNEmO1PdHh/wDPVOxlZ6Hb5F4IQnENaAZ9uTZiFGqhBO1c8Wwjiq/MFZy3jZaidarLJvVs8EeT4mZcWxwm7nIVD4lRU2wQ2lj4aTPcepMAAACANlgcCuA4wrC+3Cic9CFkqiwO/Rn1vk8dvGuEQqFJ6f6LVfPfRTfaQU7TGVLk2CzY4dasrwxJ1f6FsT8DHTNGnxELPKRuLstGrFY/PR7KeafeFZDf+fJ3mbX5nxrld3wi5titTnX+8s4IKv29HJguPvOK/SI7cjzA+SqNfD7qEo8= root at nettuno
 EOF
 			chmod 600 $NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS
+			cat << EOF >$NX_HOME_DIR/.ssh/client.id_dsa.key
+-----BEGIN DSA PRIVATE KEY-----
+MIIBuwIBAAKBgQCXv9AzQXjxvXWC1qu3CdEqskX9YomTfyG865gb4D02ZwWuRU/9
+C3I9/bEWLdaWgJYXIcFJsMCIkmWjjeSZyTmeoypI1iLifTHUxn3b7WNWi8AzKcVF
+aBsBGiljsop9NiD1mEpA0G+nHHrhvTXz7pUvYrsrXcdMyM6rxqn77nbbnwIVALCi
+xFdHZADw5KAVZI7r6QatEkqLAoGBAI4L1TQGFkq5xQ/nIIciW8setAAIyrcWdK/z
+5/ZPeELdq70KDJxoLf81NL/8uIc4PoNyTRJjtT3R4f8Az1TsZWeh2+ReCEJxDWgG
+fbk2YhRqoQTtXPFsI4qvzBWct42WonWqyyb1bPBHk+JmXFscJu5yFQ+JUVNsENpY
++Gkz3HqTAoGANlgcCuA4wrC+3Cic9CFkqiwO/Rn1vk8dvGuEQqFJ6f6LVfPfRTfa
+QU7TGVLk2CzY4dasrwxJ1f6FsT8DHTNGnxELPKRuLstGrFY/PR7KeafeFZDf+fJ3
+mbX5nxrld3wi5titTnX+8s4IKv29HJguPvOK/SI7cjzA+SqNfD7qEo8CFDIm1xRf
+8xAPsSKs6yZ6j1FNklfu
+-----END DSA PRIVATE KEY-----
+EOF
+			chmod 600 $NX_HOME_DIR/.ssh/client.id_dsa.key
 		else
 			# generate a new key, backup the old and copy it to $SSH_AUTHORIZED_KEYS
 			$PATH_BIN/nxkeygen
@@ -291,7 +303,43 @@
 
 test_nx()
 {
-	:	
+	echo ""
+	echo "----> Testing your nxserver configuration ..."
+	. $(PATH=$(cd $(dirname $0) && pwd):$PATH which nxloadconfig) --check
+	echo "<---- done"
+	
+	echo "----> Testing your nxserver connection ..."
+	
+	CONNECTION=""
+	while read -t 3 line
+	do
+		case "$line" in
+			*"HELLO NXSERVER - Version $NX_VERSION"*)
+				CONNECTION="yes"
+			;;
+			*"HELLO NXSERVER - Version"*)
+				echo "Warning: Version Mismatch. Expected $NX_VERSION got: $line."
+				CONNECTION="yes"
+			;;
+			*"NX> 999 Bye"*)
+				break;
+			;;
+		esac
+		echo $line
+	done < <(echo "quit" | ssh -i $NX_HOME_DIR/.ssh/client.id_dsa.key -p "$SSHD_PORT" nx at 127.0.0.1 -o "RhostsAuthentication no" -o "PasswordAuthentication no" -o "RSAAuthentication no" -o "RhostsRSAAuthentication no" -o "PubkeyAuthentication yes" -o "PreferredAuthentications publickey" nxserver)
+	if [ -z "$CONNECTION" ]
+	then
+		echo "Fatal error: Could not connect to NX Server."
+		echo 
+		echo "Please check your ssh setup:"
+		echo ""
+		echo "	- Make sure nx is one of the AllowUsers in sshd_config."
+		echo "	- Make sure your sshd allows public key authentication."
+		echo "	- Make sure your sshd is really running on port $SSHD_PORT."
+		echo "	- Make sure your sshd_config AuthorizedKeysFile in sshd_config is set to $SSH_AUTHORIZED_KEYS."
+		exit 1
+	fi
+	echo "<--- done"
 }
 
 uninstall_nx() 



From fabianx at berlios.de  Wed Aug 10 03:05:31 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Wed, 10 Aug 2005 03:05:31 +0200
Subject: [Freenx-cvs] r121 - freenx-server/branches/FreeNX-0.4
Message-ID: <200508100105.j7A15VDF029448@sheep.berlios.de>

Author: fabianx
Date: 2005-08-10 03:04:58 +0200 (Wed, 10 Aug 2005)
New Revision: 121

Modified:
   freenx-server/branches/FreeNX-0.4/nxloadconfig
   freenx-server/branches/FreeNX-0.4/nxsetup
Log:
Added lots of tests to nxloadconfig, which are enforced as checks for nxsetup now.


Modified: freenx-server/branches/FreeNX-0.4/nxloadconfig
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxloadconfig	2005-08-10 00:27:52 UTC (rev 120)
+++ freenx-server/branches/FreeNX-0.4/nxloadconfig	2005-08-10 01:04:58 UTC (rev 121)
@@ -258,6 +258,19 @@
 	
 	[ ! -d "$PATH_BIN" ] && \
 		ERROR="yes" && echo "Error: Invalid value \"PATH_BIN=$PATH_BIN\""
+	# Check for NX agents ...
+	
+	[ ! -f "$PATH_BIN/nxagent" ] && \
+		ERROR="yes" && echo "Error: Could not find nxagent in $PATH_BIN. Please install some OSS components."
+		
+	[ ! -f "$PATH_BIN/nxdesktop" ] && \
+		WARNING="yes" && echo "Warning: Could not find nxdesktop in $PATH_BIN. RDP sessions won't work."
+		
+	[ ! -f "$PATH_BIN/nxviewer" ] && \
+		WARNING="yes" && echo "Warning: Could not find nxviewer in $PATH_BIN. VNC sessions won't work."
+
+	# Check for paths
+		
 	[ ! -d "$PATH_LIB" ] && \
 		ERROR="yes" && echo "Error: Invalid value \"PATH_LIB=$PATH_LIB\""
 	[ ! -d "$NX_ETC_DIR" ] && \
@@ -467,7 +480,19 @@
 
 	[ -z $(echo "$ENABLE_ROOTLESS_MODE" | egrep "^[0|1]$") ] && \
 		ERROR="yes" && echo "Error: Invalid value \"ENABLE_ROOTLESS_MODE=$ENABLE_ROOTLESS_MODE\""
+		
+	[ -z $(echo "$ENABLE_1_5_0_BACKEND" | egrep "^[0|1]$") ] && \
+		ERROR="yes" && echo "Error: Invalid value \"ENABLE_1_5_0_BACKEND=$ENABLE_1_5_0_BACKEND\""
+		
+	[ "$ENABLE_ROOTLESS_MODE" = "1" -a "$ENABLE_1_5_0_BACKEND" = "0" ] && \
+		ERROR="yes" && echo "Error: Rootless mode can just be used with 1.5.0 backend."
 
+	[ "$ENABLE_1_5_0_BACKEND" = "1" -a -z "$(strings $PATH_BIN/nxagent | grep 'NXAGENT - Version 1.5.0')" ] && \
+		ERROR="yes" && echo "Error: Could not find 1.5.0 version string in nxagent. NX 1.5.0 backend option must be used with 1.5.0 OSS components."
+
+	[ "$ENABLE_1_5_0_BACKEND" = "0" -a -n "$(strings $PATH_BIN/nxagent | grep 'NXAGENT - Version 1.5.0')" ] && \
+		WARNING="yes" && echo "Warning: 1.5.0 OSS components found, but ENABLE_1_5_0 backend option is not set."
+
 	[ -z $(echo "$ENABLE_USESSION" | egrep "^[0|1]$") ] && \
 		ERROR="yes" && echo "Error: Invalid value \"ENABLE_USESSION=$ENABLE_USESSION\""
 	[ "$ENABLE_USESSION" = "1" ] && ! which "$COMMAND_SESSREG" >/dev/null 2>&1 && \

Modified: freenx-server/branches/FreeNX-0.4/nxsetup
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-10 00:27:52 UTC (rev 120)
+++ freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-10 01:04:58 UTC (rev 121)
@@ -307,7 +307,7 @@
 	echo "----> Testing your nxserver configuration ..."
 	. $(PATH=$(cd $(dirname $0) && pwd):$PATH which nxloadconfig) --check
 	echo "<---- done"
-	
+	echo ""
 	echo "----> Testing your nxserver connection ..."
 	
 	CONNECTION=""
@@ -340,6 +340,7 @@
 		exit 1
 	fi
 	echo "<--- done"
+	echo ""
 }
 
 uninstall_nx() 



From fabianx at berlios.de  Wed Aug 10 03:20:02 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Wed, 10 Aug 2005 03:20:02 +0200
Subject: [Freenx-cvs] r122 - freenx-server/branches/FreeNX-0.4
Message-ID: <200508100120.j7A1K2q3014932@sheep.berlios.de>

Author: fabianx
Date: 2005-08-10 03:19:28 +0200 (Wed, 10 Aug 2005)
New Revision: 122

Modified:
   freenx-server/branches/FreeNX-0.4/nxsetup
Log:
Fixed nxsetup on non-SuSE and non-Debian.


Modified: freenx-server/branches/FreeNX-0.4/nxsetup
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-10 01:04:58 UTC (rev 121)
+++ freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-10 01:19:28 UTC (rev 122)
@@ -144,7 +144,7 @@
 	# no, its a "normal" useradd
 	else
 		USERADD_OPTIONS="-d $NX_HOME_DIR -s $PATH_BIN/nxserver"
-		[ -n $SETUP_GID ] && USERADD_OPTIONS="-g $SETUP_GID $USERADD_OPTIONS"
+		[ -n "$SETUP_GID" ] && USERADD_OPTIONS="-g $SETUP_GID $USERADD_OPTIONS"
 		# uid specified?
 		if [ -n "$SETUP_UID" ]
 		then



From fabianx at berlios.de  Fri Aug 12 03:15:28 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Fri, 12 Aug 2005 03:15:28 +0200
Subject: [Freenx-cvs] r123 - freenx-server/branches/FreeNX-0.4
Message-ID: <200508120115.j7C1FSUU012883@sheep.berlios.de>

Author: fabianx
Date: 2005-08-12 03:14:29 +0200 (Fri, 12 Aug 2005)
New Revision: 123

Modified:
   freenx-server/branches/FreeNX-0.4/ChangeLog
   freenx-server/branches/FreeNX-0.4/nxnode
   freenx-server/branches/FreeNX-0.4/nxserver
Log:
* Added --agent to nxnode/nxserver to allow easier debugging.

Example:

nxserver --agent :1000

or

/path/to/nxnode/nxnode --agent :1000


Modified: freenx-server/branches/FreeNX-0.4/ChangeLog
===================================================================
--- freenx-server/branches/FreeNX-0.4/ChangeLog	2005-08-10 01:19:28 UTC (rev 122)
+++ freenx-server/branches/FreeNX-0.4/ChangeLog	2005-08-12 01:14:29 UTC (rev 123)
@@ -1,5 +1,6 @@
 *****.2005 FreeNX 0.4.5 ???
 	* Made nxsetup more user-friendly and hopefully finally failsafe.
+	* Added --agent to nxnode/nxserver to allow easier debugging.
 
 06.08.2005 FreeNX 0.4.4 "UKUUG Enterprise Edition"
 	* Added ENABLE_1_5_0_BACKEND configuration directive:

Modified: freenx-server/branches/FreeNX-0.4/nxnode
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxnode	2005-08-10 01:19:28 UTC (rev 122)
+++ freenx-server/branches/FreeNX-0.4/nxnode	2005-08-12 01:14:29 UTC (rev 123)
@@ -22,7 +22,7 @@
 
 echo "NX> 1000 NXNODE - Version $NX_VERSION $NX_LICENSE"
 
-if [ "$1" != "--check" -a "$1" != "--setkey" ]
+if [ "$1" != "--check" -a "$1" != "--setkey" -a "$1" != "--agent" ]
 then 
 	read CMDLINE
 
@@ -862,6 +862,13 @@
 	--check)
 		echo "NX> 716 finished"
 	;;
+	--agent)
+		echo "NX> 716 Starting NX Agent ..."
+		shift
+		[ "$SET_LD_LIBRARY_PATH" = "1" ] && export LD_LIBRARY_PATH="$AGENT_LIBRARY_PATH:$LD_LIBRARY_PATH"
+		PATH="$PATH:$PATH_BIN" $PATH_BIN/nxagent -name "NX Agent Test - Args: $@" $@
+		echo "NX> 716 NX Agent exited with status: $?"
+	;;
 	--setkey)
 		mkdir -m 700 -p $HOME/.ssh
 		if ! grep -q "$(cat $NX_ETC_DIR/users.id_dsa.pub)" $HOME/.ssh/$SSH_AUTHORIZED_KEYS 2>/dev/null

Modified: freenx-server/branches/FreeNX-0.4/nxserver
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxserver	2005-08-10 01:19:28 UTC (rev 122)
+++ freenx-server/branches/FreeNX-0.4/nxserver	2005-08-12 01:14:29 UTC (rev 123)
@@ -1350,6 +1350,7 @@
 
 if [ $UID -ne 0 ]
 then
+	[ "$1" = "--agent" ] && exec $PATH_BIN/nxnode "$@"
 	[ "$1" != "--passwd" ] && cmd_usage
 	cmd_user_passwd
 	exit 0



From fux at berlios.de  Sat Aug 13 20:34:57 2005
From: fux at berlios.de (Thorsten Sandfuchs at BerliOS)
Date: Sat, 13 Aug 2005 20:34:57 +0200
Subject: [Freenx-cvs] r124 - / freenx-server/branches/FreeNX-0.4
Message-ID: <200508131834.j7DIYvfq027362@sheep.berlios.de>

Author: fux
Date: 2005-08-13 20:34:56 +0200 (Sat, 13 Aug 2005)
New Revision: 124

Modified:
   /
   freenx-server/branches/FreeNX-0.4/nxsetup
Log:
 r1203 at pulp:  thorsten | 2005-08-02 18:57:03 +0200
 local-trunk
 r1240 at pulp:  thorsten | 2005-08-13 20:30:09 +0200
 addgroup/groupadd added accordingly to adduser/useradd



Property changes on: 
___________________________________________________________________
Name: svk:merge
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1240

Modified: freenx-server/branches/FreeNX-0.4/nxsetup
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-12 01:14:29 UTC (rev 123)
+++ freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-13 18:34:56 UTC (rev 124)
@@ -127,6 +127,16 @@
 		getent passwd nx >/dev/null
 	fi
 }	
+nx_group_exists()
+{
+	# useradd/adduser need a valid group to add the user to
+	if [ "$SETUP_LOCAL_USER" = "yes" ]
+	then
+		egrep "^nx:" /etc/group >/dev/null
+	else
+		getent group nx >/dev/null
+	fi
+}	
 
 # Tries to add a system user
 useradd_nx()
@@ -139,27 +149,34 @@
 	if [ -f /etc/debian_version -a -z "$SETUP_UID" ]
 	then
 		USERADD_OPTIONS="--system --home $NX_HOME_DIR --shell $PATH_BIN/nxserver"
-		[ -n "$SETUP_GID" ] && USERADD_OPTIONS="--gid $SETUP_GID $USERADD_OPTIONS"
+		[ -n "$SETUP_GID" ] && USERADD_OPTIONS="--gid $SETUP_GID $USERADD_OPTIONS" && GROUPADD_OPTIONS="--gid $SETUP_GID"
+
+		# adduser needs a valid group to add the user to
+		! nx_group_exists && addgroup --system --quiet $GROUPADD_OPTIONS nx
 		adduser $USERADD_OPTIONS nx
+		
 	# no, its a "normal" useradd
 	else
 		USERADD_OPTIONS="-d $NX_HOME_DIR -s $PATH_BIN/nxserver"
-		[ -n "$SETUP_GID" ] && USERADD_OPTIONS="-g $SETUP_GID $USERADD_OPTIONS"
+		[ -n "$SETUP_GID" ] && USERADD_OPTIONS="-g $SETUP_GID $USERADD_OPTIONS" && GROUPADD_OPTIONS="-g $SETUP_GID"
+
 		# uid specified?
 		if [ -n "$SETUP_UID" ]
 		then
 			USERADD_OPTIONS="-u $SETUP_UID $USERADD_OPTIONS"
+		
 		# Is it a SuSE?
 		elif [ -f /etc/SuSE-release ]
 		then
 			USERADD_OPTIONS="-r $USERADD_OPTIONS"
 		fi
-
+		
 		if [ "$SETUP_LOCAL_USER" = "yes" ]
 		then
-			[ -n "$SETUP_GID" ] && /usr/sbin/lgroupadd -g $SETUP_GID nx
+			! nx_group_exists && lgroupadd $GROUPADD_OPTIONS nx 
 			luseradd $USERADD_OPTIONS nx
 		else
+			! nx_group_exists && groupadd $GROUPADD_OPTIONS nx
 			useradd $USERADD_OPTIONS nx
 		fi
 



From fux at berlios.de  Sat Aug 13 20:51:32 2005
From: fux at berlios.de (Thorsten Sandfuchs at BerliOS)
Date: Sat, 13 Aug 2005 20:51:32 +0200
Subject: [Freenx-cvs] r125 - / freenx-server/branches/FreeNX-0.4
Message-ID: <200508131851.j7DIpWLF028090@sheep.berlios.de>

Author: fux
Date: 2005-08-13 20:51:31 +0200 (Sat, 13 Aug 2005)
New Revision: 125

Modified:
   /
   freenx-server/branches/FreeNX-0.4/ChangeLog
Log:
 r1242 at pulp:  thorsten | 2005-08-13 20:51:19 +0200
 forgot Changelog :)



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1240
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1242

Modified: freenx-server/branches/FreeNX-0.4/ChangeLog
===================================================================
--- freenx-server/branches/FreeNX-0.4/ChangeLog	2005-08-13 18:34:56 UTC (rev 124)
+++ freenx-server/branches/FreeNX-0.4/ChangeLog	2005-08-13 18:51:31 UTC (rev 125)
@@ -1,6 +1,7 @@
 *****.2005 FreeNX 0.4.5 ???
 	* Made nxsetup more user-friendly and hopefully finally failsafe.
 	* Added --agent to nxnode/nxserver to allow easier debugging.
+	* Added addgroup/groupadd to nxsetup
 
 06.08.2005 FreeNX 0.4.4 "UKUUG Enterprise Edition"
 	* Added ENABLE_1_5_0_BACKEND configuration directive:



From fux at berlios.de  Sun Aug 14 12:11:53 2005
From: fux at berlios.de (Thorsten Sandfuchs at BerliOS)
Date: Sun, 14 Aug 2005 12:11:53 +0200
Subject: [Freenx-cvs] r126 - / freenx-server/branches/FreeNX-0.4
Message-ID: <200508141011.j7EABrU8007599@sheep.berlios.de>

Author: fux
Date: 2005-08-14 12:11:50 +0200 (Sun, 14 Aug 2005)
New Revision: 126

Modified:
   /
   freenx-server/branches/FreeNX-0.4/ChangeLog
   freenx-server/branches/FreeNX-0.4/nxsetup
Log:
 r1244 at pap:  thorsten | 2005-08-14 12:10:13 +0200
 added groupdel



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1242
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1244

Modified: freenx-server/branches/FreeNX-0.4/ChangeLog
===================================================================
--- freenx-server/branches/FreeNX-0.4/ChangeLog	2005-08-13 18:51:31 UTC (rev 125)
+++ freenx-server/branches/FreeNX-0.4/ChangeLog	2005-08-14 10:11:50 UTC (rev 126)
@@ -1,7 +1,7 @@
 *****.2005 FreeNX 0.4.5 ???
 	* Made nxsetup more user-friendly and hopefully finally failsafe.
 	* Added --agent to nxnode/nxserver to allow easier debugging.
-	* Added addgroup/groupadd to nxsetup
+	* Added addgroup/groupadd/delgroup to nxsetup
 
 06.08.2005 FreeNX 0.4.4 "UKUUG Enterprise Edition"
 	* Added ENABLE_1_5_0_BACKEND configuration directive:

Modified: freenx-server/branches/FreeNX-0.4/nxsetup
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-13 18:51:31 UTC (rev 125)
+++ freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-14 10:11:50 UTC (rev 126)
@@ -369,8 +369,10 @@
 		if [ "$SETUP_LOCAL_USER" = "yes" ]
 		then
 			luserdel nx
+			lgroupdel nx
 		else
 			userdel nx
+			groupdel nx
 		fi
 			
 		echo "done"



From fux at berlios.de  Thu Aug 18 21:45:31 2005
From: fux at berlios.de (Thorsten Sandfuchs at BerliOS)
Date: Thu, 18 Aug 2005 21:45:31 +0200
Subject: [Freenx-cvs] r127 - / freenx-server/branches/FreeNX-0.4
Message-ID: <200508181945.j7IJjVUc000999@sheep.berlios.de>

Author: fux
Date: 2005-08-18 21:45:28 +0200 (Thu, 18 Aug 2005)
New Revision: 127

Modified:
   /
   freenx-server/branches/FreeNX-0.4/nxsetup
Log:
help gets displayed now



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1244
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1278

Modified: freenx-server/branches/FreeNX-0.4/nxsetup
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-14 10:11:50 UTC (rev 126)
+++ freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-18 19:45:28 UTC (rev 127)
@@ -52,7 +52,7 @@
 [ "$UNINSTALL" = "yes" -a "$CLEAN" = "yes" ] && HELP="yes"
 [ "$SETUP_SSH2_KEY" = "yes" -a "$SETUP_NOMACHINE_KEY" = "no" ] && HELP="yes"
 
-if [ "$INSTALL" = "no" -a "$UNINSTALL" = "no" -a "$AUTOMATIC" = "no" ]
+if [ "$INSTALL" = "no" -a "$UNINSTALL" = "no" -a "$AUTOMATIC" = "no" -a "$HELP" = "no" ]
 then
 	echo "------> You did select no action."
 	echo "        FreeNX guesses that you want to _install_ the"



From fux at berlios.de  Thu Aug 18 22:45:29 2005
From: fux at berlios.de (Thorsten Sandfuchs at BerliOS)
Date: Thu, 18 Aug 2005 22:45:29 +0200
Subject: [Freenx-cvs] r128 - / freenx-server/branches/FreeNX-0.4
Message-ID: <200508182045.j7IKjTlw005026@sheep.berlios.de>

Author: fux
Date: 2005-08-18 22:45:27 +0200 (Thu, 18 Aug 2005)
New Revision: 128

Modified:
   /
   freenx-server/branches/FreeNX-0.4/ChangeLog
   freenx-server/branches/FreeNX-0.4/nxsetup
Log:
fixed useradd/adduser-calls with nx-group. Reverted r126 as groupdel isn't really necessary obviously



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1278
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1280

Modified: freenx-server/branches/FreeNX-0.4/ChangeLog
===================================================================
--- freenx-server/branches/FreeNX-0.4/ChangeLog	2005-08-18 19:45:28 UTC (rev 127)
+++ freenx-server/branches/FreeNX-0.4/ChangeLog	2005-08-18 20:45:27 UTC (rev 128)
@@ -1,7 +1,7 @@
 *****.2005 FreeNX 0.4.5 ???
 	* Made nxsetup more user-friendly and hopefully finally failsafe.
 	* Added --agent to nxnode/nxserver to allow easier debugging.
-	* Added addgroup/groupadd/delgroup to nxsetup
+	* Added addgroup/groupadd to nxsetup
 
 06.08.2005 FreeNX 0.4.4 "UKUUG Enterprise Edition"
 	* Added ENABLE_1_5_0_BACKEND configuration directive:

Modified: freenx-server/branches/FreeNX-0.4/nxsetup
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-18 19:45:28 UTC (rev 127)
+++ freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-18 20:45:27 UTC (rev 128)
@@ -148,8 +148,8 @@
 	# Is it a debian?
 	if [ -f /etc/debian_version -a -z "$SETUP_UID" ]
 	then
-		USERADD_OPTIONS="--system --home $NX_HOME_DIR --shell $PATH_BIN/nxserver"
-		[ -n "$SETUP_GID" ] && USERADD_OPTIONS="--gid $SETUP_GID $USERADD_OPTIONS" && GROUPADD_OPTIONS="--gid $SETUP_GID"
+		USERADD_OPTIONS="--ingroup nx --system --home $NX_HOME_DIR --shell $PATH_BIN/nxserver"
+		[ -n "$SETUP_GID" ] && GROUPADD_OPTIONS="--gid $SETUP_GID"
 
 		# adduser needs a valid group to add the user to
 		! nx_group_exists && addgroup --system --quiet $GROUPADD_OPTIONS nx
@@ -157,8 +157,8 @@
 		
 	# no, its a "normal" useradd
 	else
-		USERADD_OPTIONS="-d $NX_HOME_DIR -s $PATH_BIN/nxserver"
-		[ -n "$SETUP_GID" ] && USERADD_OPTIONS="-g $SETUP_GID $USERADD_OPTIONS" && GROUPADD_OPTIONS="-g $SETUP_GID"
+		USERADD_OPTIONS="-g nx -d $NX_HOME_DIR -s $PATH_BIN/nxserver"
+		[ -n "$SETUP_GID" ] && GROUPADD_OPTIONS="-g $SETUP_GID"
 
 		# uid specified?
 		if [ -n "$SETUP_UID" ]
@@ -369,10 +369,8 @@
 		if [ "$SETUP_LOCAL_USER" = "yes" ]
 		then
 			luserdel nx
-			lgroupdel nx
 		else
 			userdel nx
-			groupdel nx
 		fi
 			
 		echo "done"



From fux at berlios.de  Fri Aug 19 10:03:16 2005
From: fux at berlios.de (Thorsten Sandfuchs at BerliOS)
Date: Fri, 19 Aug 2005 10:03:16 +0200
Subject: [Freenx-cvs] r129 - / freenx-server/branches/FreeNX-0.4
Message-ID: <200508190803.j7J83GV7026996@sheep.berlios.de>

Author: fux
Date: 2005-08-19 10:02:59 +0200 (Fri, 19 Aug 2005)
New Revision: 129

Modified:
   /
   freenx-server/branches/FreeNX-0.4/ChangeLog
   freenx-server/branches/FreeNX-0.4/nxloadconfig
   freenx-server/branches/FreeNX-0.4/nxsetup
Log:
implemented --ignore-errors on nxloadconfig/nxsetup for broken setups



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1280
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1282

Modified: freenx-server/branches/FreeNX-0.4/ChangeLog
===================================================================
--- freenx-server/branches/FreeNX-0.4/ChangeLog	2005-08-18 20:45:27 UTC (rev 128)
+++ freenx-server/branches/FreeNX-0.4/ChangeLog	2005-08-19 08:02:59 UTC (rev 129)
@@ -2,6 +2,7 @@
 	* Made nxsetup more user-friendly and hopefully finally failsafe.
 	* Added --agent to nxnode/nxserver to allow easier debugging.
 	* Added addgroup/groupadd to nxsetup
+	* Added --ignore-errors support on nxsetup/nxloadconfig
 
 06.08.2005 FreeNX 0.4.4 "UKUUG Enterprise Edition"
 	* Added ENABLE_1_5_0_BACKEND configuration directive:

Modified: freenx-server/branches/FreeNX-0.4/nxloadconfig
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxloadconfig	2005-08-18 20:45:27 UTC (rev 128)
+++ freenx-server/branches/FreeNX-0.4/nxloadconfig	2005-08-19 08:02:59 UTC (rev 129)
@@ -16,12 +16,14 @@
 HELP="no"
 CHECK="no"
 USERCONF="no"
+NXLCFG_IGNORE_ERRORS="no"
 
 while [ "$1" ]
 do
 	case "$1" in
 		--help) HELP="yes"; shift ;;
 		--check) CHECK="yes"; shift ;;
+		--ignore-errors) NXLCFG_IGNORE_ERRORS="yes"; shift;;
 		--userconf) USERCONF="yes" ; 
 					case "$2" in
 						"" | --*) shift ;;
@@ -39,6 +41,7 @@
 	echo "        nxloadconfig [--check] [--userconf [<username>]]"
 	echo
 	echo "  --check                  Write errors to standard output."
+	echo "	--ignore-errors		 just warn, and don't exit with a error, if errors occure"
 	echo "  --userconf [<username>]  Parse <username>.node.conf as well as node.conf."
 	echo "                           Assume current user if no username is specified."
 	exit 0
@@ -518,7 +521,7 @@
 		echo "  Errors occured during config check."
 		echo "  Please correct the configuration file."
 		echo
-		exit 1
+		[ "$NXLCFG_IGNORE_ERRORS" = "no" ] && echo $NXLCFG_IGNORE_ERRORS exit1 && exit 1 || exit 0
 	elif [ "$WARNING" = "yes" ]
 	then
 		echo

Modified: freenx-server/branches/FreeNX-0.4/nxsetup
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-18 20:45:27 UTC (rev 128)
+++ freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-19 08:02:59 UTC (rev 129)
@@ -23,12 +23,14 @@
 SETUP_SSH2_KEY="no"
 BUILD_KNOWN_HOSTS="yes"
 AUTOMATIC="no"
+IGNORE_ERRORS="no"
 
 while [ "$1" ]
 do
 	case "$1" in
 		--help) HELP="yes"; shift ;;
 		--install) INSTALL="yes"; shift ;;
+		--ignore-errors) IGNORE_ERRORS="yes"; shift;;
 		--setup-nomachine-key) SETUP_NOMACHINE_KEY="yes"; shift ;;
 		--ssh2) SETUP_SSH2_KEY="yes"; shift;;
 		--dont-build-known-hosts) BUILD_KNOWN_HOSTS="no"; shift;;
@@ -76,6 +78,7 @@
 	echo
 	echo "  --help                 Displays this help message"
 	echo "  --install              Install nessesary files and add the nx user"
+	echo "	--ignore-errors	       check false configuration, but don't complain"
 	echo "  --setup-nomachine-key  Allow login with the key shipped with the NoMachine"
 	echo "                         client. This is not as secure, but it simplifies the "
 	echo "                         configuration of clients."
@@ -322,7 +325,8 @@
 {
 	echo ""
 	echo "----> Testing your nxserver configuration ..."
-	. $(PATH=$(cd $(dirname $0) && pwd):$PATH which nxloadconfig) --check
+	[ "$IGNORE_ERRORS" = "yes" ] && $NO_ERRORS="--ignore-errors"
+	. $(PATH=$(cd $(dirname $0) && pwd):$PATH which nxloadconfig) --check $NO_ERRORS
 	echo "<---- done"
 	echo ""
 	echo "----> Testing your nxserver connection ..."



From fux at berlios.de  Fri Aug 19 10:10:28 2005
From: fux at berlios.de (Thorsten Sandfuchs at BerliOS)
Date: Fri, 19 Aug 2005 10:10:28 +0200
Subject: [Freenx-cvs] r130 - / freenx-server/branches/FreeNX-0.4
Message-ID: <200508190810.j7J8ASg9027980@sheep.berlios.de>

Author: fux
Date: 2005-08-19 10:10:25 +0200 (Fri, 19 Aug 2005)
New Revision: 130

Modified:
   /
   freenx-server/branches/FreeNX-0.4/nxloadconfig
Log:
forgot debug-comments ...



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1282
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1284

Modified: freenx-server/branches/FreeNX-0.4/nxloadconfig
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxloadconfig	2005-08-19 08:02:59 UTC (rev 129)
+++ freenx-server/branches/FreeNX-0.4/nxloadconfig	2005-08-19 08:10:25 UTC (rev 130)
@@ -521,7 +521,7 @@
 		echo "  Errors occured during config check."
 		echo "  Please correct the configuration file."
 		echo
-		[ "$NXLCFG_IGNORE_ERRORS" = "no" ] && echo $NXLCFG_IGNORE_ERRORS exit1 && exit 1 || exit 0
+		[ "$NXLCFG_IGNORE_ERRORS" = "no" ] && exit 1 || exit 0
 	elif [ "$WARNING" = "yes" ]
 	then
 		echo



From fux at berlios.de  Sun Aug 21 07:47:34 2005
From: fux at berlios.de (Thorsten Sandfuchs at BerliOS)
Date: Sun, 21 Aug 2005 07:47:34 +0200
Subject: [Freenx-cvs] r131 - / freenx-website
Message-ID: <200508210547.j7L5lYqC010893@sheep.berlios.de>

Author: fux
Date: 2005-08-21 07:46:51 +0200 (Sun, 21 Aug 2005)
New Revision: 131

Modified:
   /
   freenx-website/download.inc
Log:
updated kanotix-location



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1284
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286

Modified: freenx-website/download.inc
===================================================================
--- freenx-website/download.inc	2005-08-19 08:10:25 UTC (rev 130)
+++ freenx-website/download.inc	2005-08-21 05:46:51 UTC (rev 131)
@@ -21,7 +21,7 @@
 			Debian/Ubuntu DEBs
 		</dt>
 		<dd>
-			<a href="http://kanotix.com/files/debian/freenx/">http://kanotix.com/files/debian/freenx/</a>
+			<a href="http://kanotix.com/files/debian/pool/f/freenx/">http://kanotix.com/files/debian/pool/f/freenx/</a>
 		</dd>
                 <dd>
                         <a href="http://kalyxo-archive.mornfall.net/pool/main/f/freenx/">http://kalyxo-archive.mornfall.net/pool/main/f/freenx/</a>



From fabianx at berlios.de  Sun Aug 28 16:32:11 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Sun, 28 Aug 2005 16:32:11 +0200
Subject: [Freenx-cvs] r132 - / freenx-server/trunk
Message-ID: <200508281432.j7SEWBR8006977@sheep.berlios.de>

Author: fabianx
Date: 2005-08-28 16:32:09 +0200 (Sun, 28 Aug 2005)
New Revision: 132

Modified:
   /
   freenx-server/trunk/ChangeLog
   freenx-server/trunk/nxloadconfig
   freenx-server/trunk/nxnode
   freenx-server/trunk/nxserver
   freenx-server/trunk/nxsetup
Log:
 r136 at Bluemoon:  ffranz | 2005-08-28 16:28:09 +0200
 Merged changes from 0.4-Branch. (SVN: -r115:130 / SVK: -r117:132)



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:136

Modified: freenx-server/trunk/ChangeLog
===================================================================
--- freenx-server/trunk/ChangeLog	2005-08-21 05:46:51 UTC (rev 131)
+++ freenx-server/trunk/ChangeLog	2005-08-28 14:32:09 UTC (rev 132)
@@ -2,6 +2,12 @@
 	* Opened the 0.5.0 branch.
 	* Added load balancing.
 
+*****.2005 FreeNX 0.4.5 ???
+	* Made nxsetup more user-friendly and hopefully finally failsafe.
+	* Added --agent to nxnode/nxserver to allow easier debugging.
+	* Added addgroup/groupadd to nxsetup
+	* Added --ignore-errors support on nxsetup/nxloadconfig
+
 06.08.2005 FreeNX 0.4.4 "UKUUG Enterprise Edition"
 	* Added ENABLE_1_5_0_BACKEND configuration directive:
 		* Fixed fullscreen support in nxdesktop (still feels more like

Modified: freenx-server/trunk/nxloadconfig
===================================================================
--- freenx-server/trunk/nxloadconfig	2005-08-21 05:46:51 UTC (rev 131)
+++ freenx-server/trunk/nxloadconfig	2005-08-28 14:32:09 UTC (rev 132)
@@ -16,12 +16,14 @@
 HELP="no"
 CHECK="no"
 USERCONF="no"
+NXLCFG_IGNORE_ERRORS="no"
 
 while [ "$1" ]
 do
 	case "$1" in
 		--help) HELP="yes"; shift ;;
 		--check) CHECK="yes"; shift ;;
+		--ignore-errors) NXLCFG_IGNORE_ERRORS="yes"; shift;;
 		--userconf) USERCONF="yes" ; 
 					case "$2" in
 						"" | --*) shift ;;
@@ -39,6 +41,7 @@
 	echo "        nxloadconfig [--check] [--userconf [<username>]]"
 	echo
 	echo "  --check                  Write errors to standard output."
+	echo "	--ignore-errors		 just warn, and don't exit with a error, if errors occure"
 	echo "  --userconf [<username>]  Parse <username>.node.conf as well as node.conf."
 	echo "                           Assume current user if no username is specified."
 	exit 0
@@ -260,6 +263,19 @@
 	
 	[ ! -d "$PATH_BIN" ] && \
 		ERROR="yes" && echo "Error: Invalid value \"PATH_BIN=$PATH_BIN\""
+	# Check for NX agents ...
+	
+	[ ! -f "$PATH_BIN/nxagent" ] && \
+		ERROR="yes" && echo "Error: Could not find nxagent in $PATH_BIN. Please install some OSS components."
+		
+	[ ! -f "$PATH_BIN/nxdesktop" ] && \
+		WARNING="yes" && echo "Warning: Could not find nxdesktop in $PATH_BIN. RDP sessions won't work."
+		
+	[ ! -f "$PATH_BIN/nxviewer" ] && \
+		WARNING="yes" && echo "Warning: Could not find nxviewer in $PATH_BIN. VNC sessions won't work."
+
+	# Check for paths
+		
 	[ ! -d "$PATH_LIB" ] && \
 		ERROR="yes" && echo "Error: Invalid value \"PATH_LIB=$PATH_LIB\""
 	[ ! -d "$NX_ETC_DIR" ] && \
@@ -469,7 +485,19 @@
 
 	[ -z $(echo "$ENABLE_ROOTLESS_MODE" | egrep "^[0|1]$") ] && \
 		ERROR="yes" && echo "Error: Invalid value \"ENABLE_ROOTLESS_MODE=$ENABLE_ROOTLESS_MODE\""
+		
+	[ -z $(echo "$ENABLE_1_5_0_BACKEND" | egrep "^[0|1]$") ] && \
+		ERROR="yes" && echo "Error: Invalid value \"ENABLE_1_5_0_BACKEND=$ENABLE_1_5_0_BACKEND\""
+		
+	[ "$ENABLE_ROOTLESS_MODE" = "1" -a "$ENABLE_1_5_0_BACKEND" = "0" ] && \
+		ERROR="yes" && echo "Error: Rootless mode can just be used with 1.5.0 backend."
 
+	[ "$ENABLE_1_5_0_BACKEND" = "1" -a -z "$(strings $PATH_BIN/nxagent | grep 'NXAGENT - Version 1.5.0')" ] && \
+		ERROR="yes" && echo "Error: Could not find 1.5.0 version string in nxagent. NX 1.5.0 backend option must be used with 1.5.0 OSS components."
+
+	[ "$ENABLE_1_5_0_BACKEND" = "0" -a -n "$(strings $PATH_BIN/nxagent | grep 'NXAGENT - Version 1.5.0')" ] && \
+		WARNING="yes" && echo "Warning: 1.5.0 OSS components found, but ENABLE_1_5_0 backend option is not set."
+
 	[ -z $(echo "$ENABLE_USESSION" | egrep "^[0|1]$") ] && \
 		ERROR="yes" && echo "Error: Invalid value \"ENABLE_USESSION=$ENABLE_USESSION\""
 	[ "$ENABLE_USESSION" = "1" ] && ! which "$COMMAND_SESSREG" >/dev/null 2>&1 && \
@@ -495,6 +523,7 @@
 		echo "  Errors occured during config check."
 		echo "  Please correct the configuration file."
 		echo
+		[ "$NXLCFG_IGNORE_ERRORS" = "no" ] && exit 1 || exit 0
 	elif [ "$WARNING" = "yes" ]
 	then
 		echo

Modified: freenx-server/trunk/nxnode
===================================================================
--- freenx-server/trunk/nxnode	2005-08-21 05:46:51 UTC (rev 131)
+++ freenx-server/trunk/nxnode	2005-08-28 14:32:09 UTC (rev 132)
@@ -22,7 +22,7 @@
 
 echo "NX> 1000 NXNODE - Version $NX_VERSION $NX_LICENSE"
 
-if [ "$1" != "--check" -a "$1" != "--setkey" ]
+if [ "$1" != "--check" -a "$1" != "--setkey" -a "$1" != "--agent" ]
 then 
 	read CMDLINE
 
@@ -862,6 +862,13 @@
 	--check)
 		echo "NX> 716 finished"
 	;;
+	--agent)
+		echo "NX> 716 Starting NX Agent ..."
+		shift
+		[ "$SET_LD_LIBRARY_PATH" = "1" ] && export LD_LIBRARY_PATH="$AGENT_LIBRARY_PATH:$LD_LIBRARY_PATH"
+		PATH="$PATH:$PATH_BIN" $PATH_BIN/nxagent -name "NX Agent Test - Args: $@" $@
+		echo "NX> 716 NX Agent exited with status: $?"
+	;;
 	--setkey)
 		mkdir -m 700 -p $HOME/.ssh
 		if ! grep -q "$(cat $NX_ETC_DIR/users.id_dsa.pub)" $HOME/.ssh/$SSH_AUTHORIZED_KEYS 2>/dev/null

Modified: freenx-server/trunk/nxserver
===================================================================
--- freenx-server/trunk/nxserver	2005-08-21 05:46:51 UTC (rev 131)
+++ freenx-server/trunk/nxserver	2005-08-28 14:32:09 UTC (rev 132)
@@ -1403,6 +1403,7 @@
 
 if [ $UID -ne 0 ]
 then
+	[ "$1" = "--agent" ] && exec $PATH_BIN/nxnode "$@"
 	[ "$1" != "--passwd" ] && cmd_usage
 	cmd_user_passwd
 	exit 0

Modified: freenx-server/trunk/nxsetup
===================================================================
--- freenx-server/trunk/nxsetup	2005-08-21 05:46:51 UTC (rev 131)
+++ freenx-server/trunk/nxsetup	2005-08-28 14:32:09 UTC (rev 132)
@@ -22,12 +22,15 @@
 PURGE="no"
 SETUP_SSH2_KEY="no"
 BUILD_KNOWN_HOSTS="yes"
+AUTOMATIC="no"
+IGNORE_ERRORS="no"
 
 while [ "$1" ]
 do
 	case "$1" in
 		--help) HELP="yes"; shift ;;
 		--install) INSTALL="yes"; shift ;;
+		--ignore-errors) IGNORE_ERRORS="yes"; shift;;
 		--setup-nomachine-key) SETUP_NOMACHINE_KEY="yes"; shift ;;
 		--ssh2) SETUP_SSH2_KEY="yes"; shift;;
 		--dont-build-known-hosts) BUILD_KNOWN_HOSTS="no"; shift;;
@@ -37,6 +40,7 @@
 		--clean) CLEAN="yes"; shift ;;
 		--uninstall) UNINSTALL="yes"; shift ;;
 		--purge) PURGE="yes"; shift ;;
+		--auto) AUTOMATIC="yes"; shift ;;
 		--) shift ; break ;;
 		*) echo "Invalid flag $1" ; HELP="yes"; shift ; break ;;
 	esac
@@ -45,12 +49,26 @@
 #Check for invalid combinations:
 [ "$SETUP_LOCAL_USER" = "yes" -a -z "$LOCAL_USER_OPTION" ] && HELP="yes"
 [ "$INSTALL" = "yes" -a "$UNINSTALL" = "yes" ] && HELP="yes"
-[ "$INSTALL" = "no" -a "$UNINSTALL" = "no" ] && HELP="yes"
 [ "$INSTALL" = "yes" -a "$CLEAN" = "no" -a "$PURGE" = "yes" ] && HELP="yes"
 [ "$UNINSTALL" = "yes" ] && [ "$SETUP_NOMACHINE_KEY" = "yes" -o -n "$SETUP_UID" -o "$CLEAN" = "yes" ] && HELP="yes"
 [ "$UNINSTALL" = "yes" -a "$CLEAN" = "yes" ] && HELP="yes"
 [ "$SETUP_SSH2_KEY" = "yes" -a "$SETUP_NOMACHINE_KEY" = "no" ] && HELP="yes"
 
+if [ "$INSTALL" = "no" -a "$UNINSTALL" = "no" -a "$AUTOMATIC" = "no" -a "$HELP" = "no" ]
+then
+	echo "------> You did select no action."
+	echo "        FreeNX guesses that you want to _install_ the"
+	echo "        server."
+	echo "        Use --help to get help contents."
+	echo ""
+	echo -n "Do you want to abort now? [y/N] "
+	read -n 1 CHOICE
+	echo
+	[ "$CHOICE" = "y" ] || INSTALL="yes"
+fi
+
+[ "$INSTALL" = "no" -a "$UNINSTALL" = "no" ] && HELP="yes"
+
 if [ "$HELP" = "yes" ]
 then
 	echo "nxsetup - Setup the FreeNX server."
@@ -60,6 +78,7 @@
 	echo
 	echo "  --help                 Displays this help message"
 	echo "  --install              Install nessesary files and add the nx user"
+	echo "	--ignore-errors	       check false configuration, but don't complain"
 	echo "  --setup-nomachine-key  Allow login with the key shipped with the NoMachine"
 	echo "                         client. This is not as secure, but it simplifies the "
 	echo "                         configuration of clients."
@@ -87,6 +106,18 @@
 	exit 1
 fi
 
+if [ "$INSTALL" = "yes" -a "$AUTOMATIC" = "no" -a "$SETUP_NOMACHINE_KEY" = "no" ]
+then
+	echo "------> It is recommended that you use the NoMachine key for"
+	echo "        easier setup. At the moment FreeNX would create a custom"
+	echo "        KeyPair and expect you to setup your clients manually. "
+	echo ""
+	echo -n "        Do you really want to use your own keys? [y/N] "
+	read -n 1 CHOICE
+	[ "$CHOICE" = "y" ] || SETUP_NOMACHINE_KEY="yes"
+fi
+
+
 # Read the config file
 . $(PATH=$(cd $(dirname $0) && pwd):$PATH which nxloadconfig) --
 
@@ -99,6 +130,16 @@
 		getent passwd nx >/dev/null
 	fi
 }	
+nx_group_exists()
+{
+	# useradd/adduser need a valid group to add the user to
+	if [ "$SETUP_LOCAL_USER" = "yes" ]
+	then
+		egrep "^nx:" /etc/group >/dev/null
+	else
+		getent group nx >/dev/null
+	fi
+}	
 
 # Tries to add a system user
 useradd_nx()
@@ -110,28 +151,35 @@
 	# Is it a debian?
 	if [ -f /etc/debian_version -a -z "$SETUP_UID" ]
 	then
-		USERADD_OPTIONS="--system --home $NX_HOME_DIR --shell $PATH_BIN/nxserver"
-		[ -n "$SETUP_GID" ] && USERADD_OPTIONS="--gid $SETUP_GID $USERADD_OPTIONS"
+		USERADD_OPTIONS="--ingroup nx --system --home $NX_HOME_DIR --shell $PATH_BIN/nxserver"
+		[ -n "$SETUP_GID" ] && GROUPADD_OPTIONS="--gid $SETUP_GID"
+
+		# adduser needs a valid group to add the user to
+		! nx_group_exists && addgroup --system --quiet $GROUPADD_OPTIONS nx
 		adduser $USERADD_OPTIONS nx
+		
 	# no, its a "normal" useradd
 	else
-		USERADD_OPTIONS="-d $NX_HOME_DIR -s $PATH_BIN/nxserver"
-		[ -n $SETUP_GID ] && USERADD_OPTIONS="-g $SETUP_GID $USERADD_OPTIONS"
+		USERADD_OPTIONS="-g nx -d $NX_HOME_DIR -s $PATH_BIN/nxserver"
+		[ -n "$SETUP_GID" ] && GROUPADD_OPTIONS="-g $SETUP_GID"
+
 		# uid specified?
 		if [ -n "$SETUP_UID" ]
 		then
 			USERADD_OPTIONS="-u $SETUP_UID $USERADD_OPTIONS"
+		
 		# Is it a SuSE?
 		elif [ -f /etc/SuSE-release ]
 		then
 			USERADD_OPTIONS="-r $USERADD_OPTIONS"
 		fi
-
+		
 		if [ "$SETUP_LOCAL_USER" = "yes" ]
 		then
-			[ -n "$SETUP_GID" ] && /usr/sbin/lgroupadd -g $SETUP_GID nx
+			! nx_group_exists && lgroupadd $GROUPADD_OPTIONS nx 
 			luseradd $USERADD_OPTIONS nx
 		else
+			! nx_group_exists && groupadd $GROUPADD_OPTIONS nx
 			useradd $USERADD_OPTIONS nx
 		fi
 
@@ -197,7 +245,7 @@
 	mkdir -p $NX_HOME_DIR/.ssh
 	chmod 700 $NX_HOME_DIR/ $NX_HOME_DIR/.ssh
 	
-	if [ ! -f $NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS ]
+	if [ ! -f $NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS -o "$SETUP_NOMACHINE_KEY" = "yes" ]
 	then
 		SETUP_NX_KEY="yes"
 		if [ "$SETUP_NOMACHINE_KEY" = "yes" ]
@@ -206,6 +254,21 @@
 no-port-forwarding,no-X11-forwarding,no-agent-forwarding,command="$PATH_BIN/nxserver" ssh-dss AAAAB3NzaC1kc3MAAACBAJe/0DNBePG9dYLWq7cJ0SqyRf1iiZN/IbzrmBvgPTZnBa5FT/0Lcj39sRYt1paAlhchwUmwwIiSZaON5JnJOZ6jKkjWIuJ9MdTGfdvtY1aLwDMpxUVoGwEaKWOyin02IPWYSkDQb6cceuG9NfPulS9iuytdx0zIzqvGqfvudtufAAAAFQCwosRXR2QA8OSgFWSO6+kGrRJKiwAAAIEAjgvVNAYWSrnFD+cghyJbyx60AAjKtxZ0r/Pn9k94Qt2rvQoMnGgt/zU0v/y4hzg+g3JNEmO1PdHh/wDPVOxlZ6Hb5F4IQnENaAZ9uTZiFGqhBO1c8Wwjiq/MFZy3jZaidarLJvVs8EeT4mZcWxwm7nIVD4lRU2wQ2lj4aTPcepMAAACANlgcCuA4wrC+3Cic9CFkqiwO/Rn1vk8dvGuEQqFJ6f6LVfPfRTfaQU7TGVLk2CzY4dasrwxJ1f6FsT8DHTNGnxELPKRuLstGrFY/PR7KeafeFZDf+fJ3mbX5nxrld3wi5titTnX+8s4IKv29HJguPvOK/SI7cjzA+SqNfD7qEo8= root at nettuno
 EOF
 			chmod 600 $NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS
+			cat << EOF >$NX_HOME_DIR/.ssh/client.id_dsa.key
+-----BEGIN DSA PRIVATE KEY-----
+MIIBuwIBAAKBgQCXv9AzQXjxvXWC1qu3CdEqskX9YomTfyG865gb4D02ZwWuRU/9
+C3I9/bEWLdaWgJYXIcFJsMCIkmWjjeSZyTmeoypI1iLifTHUxn3b7WNWi8AzKcVF
+aBsBGiljsop9NiD1mEpA0G+nHHrhvTXz7pUvYrsrXcdMyM6rxqn77nbbnwIVALCi
+xFdHZADw5KAVZI7r6QatEkqLAoGBAI4L1TQGFkq5xQ/nIIciW8setAAIyrcWdK/z
+5/ZPeELdq70KDJxoLf81NL/8uIc4PoNyTRJjtT3R4f8Az1TsZWeh2+ReCEJxDWgG
+fbk2YhRqoQTtXPFsI4qvzBWct42WonWqyyb1bPBHk+JmXFscJu5yFQ+JUVNsENpY
++Gkz3HqTAoGANlgcCuA4wrC+3Cic9CFkqiwO/Rn1vk8dvGuEQqFJ6f6LVfPfRTfa
+QU7TGVLk2CzY4dasrwxJ1f6FsT8DHTNGnxELPKRuLstGrFY/PR7KeafeFZDf+fJ3
+mbX5nxrld3wi5titTnX+8s4IKv29HJguPvOK/SI7cjzA+SqNfD7qEo8CFDIm1xRf
+8xAPsSKs6yZ6j1FNklfu
+-----END DSA PRIVATE KEY-----
+EOF
+			chmod 600 $NX_HOME_DIR/.ssh/client.id_dsa.key
 		else
 			# generate a new key, backup the old and copy it to $SSH_AUTHORIZED_KEYS
 			$PATH_BIN/nxkeygen
@@ -258,6 +321,49 @@
 	echo "done"
 }
 
+test_nx()
+{
+	echo ""
+	echo "----> Testing your nxserver configuration ..."
+	[ "$IGNORE_ERRORS" = "yes" ] && $NO_ERRORS="--ignore-errors"
+	. $(PATH=$(cd $(dirname $0) && pwd):$PATH which nxloadconfig) --check $NO_ERRORS
+	echo "<---- done"
+	echo ""
+	echo "----> Testing your nxserver connection ..."
+	
+	CONNECTION=""
+	while read -t 3 line
+	do
+		case "$line" in
+			*"HELLO NXSERVER - Version $NX_VERSION"*)
+				CONNECTION="yes"
+			;;
+			*"HELLO NXSERVER - Version"*)
+				echo "Warning: Version Mismatch. Expected $NX_VERSION got: $line."
+				CONNECTION="yes"
+			;;
+			*"NX> 999 Bye"*)
+				break;
+			;;
+		esac
+		echo $line
+	done < <(echo "quit" | ssh -i $NX_HOME_DIR/.ssh/client.id_dsa.key -p "$SSHD_PORT" nx at 127.0.0.1 -o "RhostsAuthentication no" -o "PasswordAuthentication no" -o "RSAAuthentication no" -o "RhostsRSAAuthentication no" -o "PubkeyAuthentication yes" -o "PreferredAuthentications publickey" nxserver)
+	if [ -z "$CONNECTION" ]
+	then
+		echo "Fatal error: Could not connect to NX Server."
+		echo 
+		echo "Please check your ssh setup:"
+		echo ""
+		echo "	- Make sure nx is one of the AllowUsers in sshd_config."
+		echo "	- Make sure your sshd allows public key authentication."
+		echo "	- Make sure your sshd is really running on port $SSHD_PORT."
+		echo "	- Make sure your sshd_config AuthorizedKeysFile in sshd_config is set to $SSH_AUTHORIZED_KEYS."
+		exit 1
+	fi
+	echo "<--- done"
+	echo ""
+}
+
 uninstall_nx() 
 {
 	if nx_user_exists
@@ -316,6 +422,8 @@
 	[ "$CLEAN" = "yes" ] && uninstall_nx
 	
 	install_nx
+
+	test_nx
 	
 	echo "Ok, nxserver is ready."
 	echo 
@@ -364,6 +472,8 @@
 		echo "         Please replace /usr/NX/share/client.id_dsa.key on all clients you want"
 		echo "         to use with $NX_HOME_DIR/.ssh/client.id_dsa.key"
 		echo "         and protect it accordingly."
+		echo ""
+		echo "         Since 1.5.0 you need to import the correct key via the GUI."
 		echo
 		echo "         If you really want to use the NoMachine key please remove"
 		echo "         '$NX_HOME_DIR/.ssh/$SSH_AUTHORIZED_KEYS'"



From fabianx at berlios.de  Sun Aug 28 16:59:13 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Sun, 28 Aug 2005 16:59:13 +0200
Subject: [Freenx-cvs] r133 - / freenx-server/branches/FreeNX-0.4
Message-ID: <200508281459.j7SExDkd011384@sheep.berlios.de>

Author: fabianx
Date: 2005-08-28 16:59:10 +0200 (Sun, 28 Aug 2005)
New Revision: 133

Modified:
   /
   freenx-server/branches/FreeNX-0.4/nxloadconfig
Log:
 r139 at Bluemoon:  ffranz | 2005-08-28 16:50:46 +0200
 Added check for expect.



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:136
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:139

Modified: freenx-server/branches/FreeNX-0.4/nxloadconfig
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxloadconfig	2005-08-28 14:32:09 UTC (rev 132)
+++ freenx-server/branches/FreeNX-0.4/nxloadconfig	2005-08-28 14:59:10 UTC (rev 133)
@@ -464,8 +464,13 @@
 		WARNING="yes" && echo "Warning: Invalid value \"COMMAND_CUPSD=$COMMAND_CUPSD\"" \
 					  && echo "         Users will not be able to enable printing."
 	! which "$COMMAND_MD5SUM" >/dev/null 2>&1 && \
-		ERROR="yes" && echo "Warning: Invalid value \"COMMAND_MD5SUM=$COMMAND_MD5SUM\""
+		ERROR="yes" && echo "Error: Invalid value \"COMMAND_MD5SUM=$COMMAND_MD5SUM\""
 
+	# Check for expect
+	COMMAND_EXPECT=$(head -n1 $PATH_BIN/nxnode-login | cut -d'!' -f2)
+	! which "$COMMAND_EXPECT" >/dev/null 2>&1 && \
+		ERROR="yes" && echo "Error: expect necessary for $PATH_BIN/nxnode-login could not be found in '$COMMAND_EXPECT'. Please install it or change nxnode-login accordingly."
+
 	# Misc directives
 	
 	[ -z $(echo "$ENABLE_AUTORECONNECT" | egrep "^[0|1]$") ] && \



From fabianx at berlios.de  Sun Aug 28 16:59:31 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Sun, 28 Aug 2005 16:59:31 +0200
Subject: [Freenx-cvs] r134 - / freenx-server/branches/FreeNX-0.4
Message-ID: <200508281459.j7SExVXE011441@sheep.berlios.de>

Author: fabianx
Date: 2005-08-28 16:59:30 +0200 (Sun, 28 Aug 2005)
New Revision: 134

Modified:
   /
   freenx-server/branches/FreeNX-0.4/ChangeLog
Log:
 r140 at Bluemoon:  ffranz | 2005-08-28 16:59:00 +0200
 Added check for expect.



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:139
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:140

Modified: freenx-server/branches/FreeNX-0.4/ChangeLog
===================================================================
--- freenx-server/branches/FreeNX-0.4/ChangeLog	2005-08-28 14:59:10 UTC (rev 133)
+++ freenx-server/branches/FreeNX-0.4/ChangeLog	2005-08-28 14:59:30 UTC (rev 134)
@@ -3,6 +3,7 @@
 	* Added --agent to nxnode/nxserver to allow easier debugging.
 	* Added addgroup/groupadd to nxsetup
 	* Added --ignore-errors support on nxsetup/nxloadconfig
+	* Added check for expect.
 
 06.08.2005 FreeNX 0.4.4 "UKUUG Enterprise Edition"
 	* Added ENABLE_1_5_0_BACKEND configuration directive:



From fabianx at berlios.de  Sun Aug 28 17:25:31 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Sun, 28 Aug 2005 17:25:31 +0200
Subject: [Freenx-cvs] r135 - / freenx-server/trunk
Message-ID: <200508281525.j7SFPVBV019110@sheep.berlios.de>

Author: fabianx
Date: 2005-08-28 17:25:27 +0200 (Sun, 28 Aug 2005)
New Revision: 135

Modified:
   /
   freenx-server/trunk/
   freenx-server/trunk/nxloadconfig
Log:
 r143 at Bluemoon:  ffranz | 2005-08-28 17:21:11 +0200
  r139 at Bluemoon:  ffranz | 2005-08-28 16:50:46 +0200
  Added check for expect.
 



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:140
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:143


Property changes on: freenx-server/trunk
___________________________________________________________________
Name: svk:merge
   + dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx/freenx-server/branches/FreeNX-0.4:139

Modified: freenx-server/trunk/nxloadconfig
===================================================================
--- freenx-server/trunk/nxloadconfig	2005-08-28 14:59:30 UTC (rev 134)
+++ freenx-server/trunk/nxloadconfig	2005-08-28 15:25:27 UTC (rev 135)
@@ -466,8 +466,13 @@
 		WARNING="yes" && echo "Warning: Invalid value \"COMMAND_CUPSD=$COMMAND_CUPSD\"" \
 					  && echo "         Users will not be able to enable printing."
 	! which "$COMMAND_MD5SUM" >/dev/null 2>&1 && \
-		ERROR="yes" && echo "Warning: Invalid value \"COMMAND_MD5SUM=$COMMAND_MD5SUM\""
+		ERROR="yes" && echo "Error: Invalid value \"COMMAND_MD5SUM=$COMMAND_MD5SUM\""
 
+	# Check for expect
+	COMMAND_EXPECT=$(head -n1 $PATH_BIN/nxnode-login | cut -d'!' -f2)
+	! which "$COMMAND_EXPECT" >/dev/null 2>&1 && \
+		ERROR="yes" && echo "Error: expect necessary for $PATH_BIN/nxnode-login could not be found in '$COMMAND_EXPECT'. Please install it or change nxnode-login accordingly."
+
 	# Misc directives
 	
 	[ -z $(echo "$ENABLE_AUTORECONNECT" | egrep "^[0|1]$") ] && \



From fabianx at berlios.de  Sun Aug 28 17:25:42 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Sun, 28 Aug 2005 17:25:42 +0200
Subject: [Freenx-cvs] r136 - / freenx-server/trunk
Message-ID: <200508281525.j7SFPgOH019163@sheep.berlios.de>

Author: fabianx
Date: 2005-08-28 17:25:41 +0200 (Sun, 28 Aug 2005)
New Revision: 136

Modified:
   /
   freenx-server/trunk/
   freenx-server/trunk/ChangeLog
Log:
 r144 at Bluemoon:  ffranz | 2005-08-28 17:21:11 +0200
  r140 at Bluemoon:  ffranz | 2005-08-28 16:59:00 +0200
  Added check for expect.
 



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:143
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:144


Property changes on: freenx-server/trunk
___________________________________________________________________
Name: svk:merge
   - dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx/freenx-server/branches/FreeNX-0.4:139
   + dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx/freenx-server/branches/FreeNX-0.4:140

Modified: freenx-server/trunk/ChangeLog
===================================================================
--- freenx-server/trunk/ChangeLog	2005-08-28 15:25:27 UTC (rev 135)
+++ freenx-server/trunk/ChangeLog	2005-08-28 15:25:41 UTC (rev 136)
@@ -7,6 +7,7 @@
 	* Added --agent to nxnode/nxserver to allow easier debugging.
 	* Added addgroup/groupadd to nxsetup
 	* Added --ignore-errors support on nxsetup/nxloadconfig
+	* Added check for expect.
 
 06.08.2005 FreeNX 0.4.4 "UKUUG Enterprise Edition"
 	* Added ENABLE_1_5_0_BACKEND configuration directive:



From fabianx at berlios.de  Sun Aug 28 22:48:20 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Sun, 28 Aug 2005 22:48:20 +0200
Subject: [Freenx-cvs] r137 - / nx-utils/nxfish
Message-ID: <200508282048.j7SKmKB8008555@sheep.berlios.de>

Author: fabianx
Date: 2005-08-28 22:48:18 +0200 (Sun, 28 Aug 2005)
New Revision: 137

Modified:
   /
   nx-utils/nxfish/Makefile.am
   nx-utils/nxfish/fish.cpp
   nx-utils/nxfish/nxfish.protocol
Log:
 r147 at Bluemoon:  ffranz | 2005-08-28 22:48:08 +0200
 Updated to more KDE-friendly patch.



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:144
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:147

Modified: nx-utils/nxfish/Makefile.am
===================================================================
--- nx-utils/nxfish/Makefile.am	2005-08-28 15:25:41 UTC (rev 136)
+++ nx-utils/nxfish/Makefile.am	2005-08-28 20:48:18 UTC (rev 137)
@@ -1,18 +1,18 @@
-kde_module_LTLIBRARIES = kio_nxfish.la
+kde_module_LTLIBRARIES = kio_fish.la
 
 INCLUDES = $(all_includes)
 AM_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
-kio_nxfish_la_SOURCES = fish.cpp
-kio_nxfish_la_LIBADD = $(LIB_KSYCOCA) #$(LIBUTIL) 
-kio_nxfish_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
+kio_fish_la_SOURCES = fish.cpp
+kio_fish_la_LIBADD = $(LIB_KSYCOCA) #$(LIBUTIL) 
+kio_fish_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 noinst_HEADERS = fishcode.h fish.h
 
 EXTRA_DIST = AUTHORS COPYING ChangeLog INSTALL README TODO FAQ fish.pl
 
 DISTCLEANFILES = fishcode.h
 
-kdelnk_DATA = nxfish.protocol
+kdelnk_DATA = fish.protocol nxfish.protocol
 kdelnkdir = $(kde_servicesdir)
 
 METASOURCES = AUTO

Modified: nx-utils/nxfish/fish.cpp
===================================================================
--- nx-utils/nxfish/fish.cpp	2005-08-28 15:25:41 UTC (rev 136)
+++ nx-utils/nxfish/fish.cpp	2005-08-28 20:48:18 UTC (rev 137)
@@ -110,6 +110,8 @@
 // disabled: currently not needed. Didn't work reliably.
 // static int isOpenSSH = 0;
 
+static int isNXFish = 0;
+
 #define E(x) ((const char*)remoteEncoding()->encode(x).data())
 
 using namespace KIO;
@@ -146,6 +148,12 @@
     ;
     sigaction(SIGCHLD,&act,NULL);
 
+    if (QString(argv[1])==QString("nxfish")) {
+        // Set NXFish - Mode
+        isNXFish=1;
+        sshPath = strdup(QFile::encodeName(KStandardDirs::findExe("nxfish")));
+    }
+
     fishProtocol slave(argv[2], argv[3]);
     slave.dispatchLoop();
 
@@ -244,7 +252,7 @@
     if (sshPath == NULL) {
         // disabled: currently not needed. Didn't work reliably.
         // isOpenSSH = !system("ssh -V 2>&1 | grep OpenSSH > /dev/null");
-        sshPath = strdup(QFile::encodeName(KStandardDirs::findExe("nxfish")));
+        sshPath = strdup(QFile::encodeName(KStandardDirs::findExe("ssh")));
     }
     if (suPath == NULL) {
         suPath = strdup(QFile::encodeName(KStandardDirs::findExe("su")));
@@ -297,11 +305,11 @@
 void fishProtocol::openConnection() {
     if (childPid) return;
 
-    /*if (connectionHost.isEmpty())
+    if (connectionHost.isEmpty() && !isNXFish)
     {
        error( KIO::ERR_UNKNOWN_HOST, QString::null );
        return;
-    }*/
+    }
 
     infoMessage(i18n("Connecting..."));
 
@@ -637,10 +645,9 @@
 void fishProtocol::setHost(const QString & host, int port, const QString & u, const QString & pass){
     QString user(u);
 
-    //local = (host == "localhost" && port == 0);
+    if (!isNXFish)
+        local = (host == "localhost" && port == 0);
 
-    local = 0;
-
     if (port <= 0) port = 0;
     if (user.isEmpty()) user = getenv("LOGNAME");
 

Modified: nx-utils/nxfish/nxfish.protocol
===================================================================
--- nx-utils/nxfish/nxfish.protocol	2005-08-28 15:25:41 UTC (rev 136)
+++ nx-utils/nxfish/nxfish.protocol	2005-08-28 20:48:18 UTC (rev 137)
@@ -1,5 +1,5 @@
 [Protocol]
-exec=kio_nxfish
+exec=kio_fish
 protocol=nxfish
 input=none
 output=filesystem
@@ -11,7 +11,7 @@
 linking=true
 moving=true
 Icon=remote
-Description=A kioslave for the FISH protocol
+Description=A kioslave for the NXFISH protocol
 Description[bn]=??? (FISH) ????????-?? ???? ???? kioslave
 Description[bs]=kioslave za FISH protokol
 Description[ca]=Un kioslave pel protocol FISH



From fabianx at berlios.de  Mon Aug 29 13:44:52 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Mon, 29 Aug 2005 13:44:52 +0200
Subject: [Freenx-cvs] r138 - / freenx-server/trunk
Message-ID: <200508291144.j7TBiqS3002380@sheep.berlios.de>

Author: fabianx
Date: 2005-08-29 13:44:51 +0200 (Mon, 29 Aug 2005)
New Revision: 138

Modified:
   /
   freenx-server/trunk/nxloadconfig
Log:
Only 1_5_0 Backend is supported now.



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:147
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:149

Modified: freenx-server/trunk/nxloadconfig
===================================================================
--- freenx-server/trunk/nxloadconfig	2005-08-28 20:48:18 UTC (rev 137)
+++ freenx-server/trunk/nxloadconfig	2005-08-29 11:44:51 UTC (rev 138)
@@ -173,7 +173,7 @@
 EXPORT_SESSIONID="0"
 NODE_AUTOSTART=""
 ENABLE_ROOTLESS_MODE="0"
-ENABLE_1_5_0_BACKEND="0"
+ENABLE_1_5_0_BACKEND="1"
 ENABLE_USESSION="0"
 COMMAND_SESSREG="sessreg"
 AGENT_EXTRA_OPTIONS_RFB=""



From fabianx at berlios.de  Mon Aug 29 13:45:02 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Mon, 29 Aug 2005 13:45:02 +0200
Subject: [Freenx-cvs] r139 - / freenx-server/trunk
Message-ID: <200508291145.j7TBj2HX002469@sheep.berlios.de>

Author: fabianx
Date: 2005-08-29 13:44:59 +0200 (Mon, 29 Aug 2005)
New Revision: 139

Modified:
   /
   freenx-server/trunk/ChangeLog
   freenx-server/trunk/node.conf.sample
   freenx-server/trunk/nxloadconfig
   freenx-server/trunk/nxnode
Log:
Completely removed support for 1.4.0 and earlier backends. Made rootless mode the default.



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:149
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:150

Modified: freenx-server/trunk/ChangeLog
===================================================================
--- freenx-server/trunk/ChangeLog	2005-08-29 11:44:51 UTC (rev 138)
+++ freenx-server/trunk/ChangeLog	2005-08-29 11:44:59 UTC (rev 139)
@@ -1,6 +1,8 @@
-XX.08.2005 FreeNX 0.5.0
+XX.XX.2005 FreeNX 0.5.0
 	* Opened the 0.5.0 branch.
 	* Added load balancing.
+	* Completely removed support for 1.4.0 backend.
+	* Rootless mode is now the default.
 
 *****.2005 FreeNX 0.4.5 ???
 	* Made nxsetup more user-friendly and hopefully finally failsafe.

Modified: freenx-server/trunk/node.conf.sample
===================================================================
--- freenx-server/trunk/node.conf.sample	2005-08-29 11:44:51 UTC (rev 138)
+++ freenx-server/trunk/node.conf.sample	2005-08-29 11:44:59 UTC (rev 139)
@@ -349,12 +349,8 @@
 #NODE_AUTOSTART=""
 
 # When set to 1 will start nxagent in rootless mode.
-#ENABLE_ROOTLESS_MODE="0"
+#ENABLE_ROOTLESS_MODE="1"
 
-# When set to 1 enables fake cookie authentication, when a 1.5.0 client 
-# connects.
-#ENABLE_1_5_0_BACKEND="0"
-
 # If enabled writes entries via the COMMAND_SESSREG program
 # into utmp/wtmp/lastlog database.
 # Note: You have to make sure that you add the nx user to the

Modified: freenx-server/trunk/nxloadconfig
===================================================================
--- freenx-server/trunk/nxloadconfig	2005-08-29 11:44:51 UTC (rev 138)
+++ freenx-server/trunk/nxloadconfig	2005-08-29 11:44:59 UTC (rev 139)
@@ -172,8 +172,7 @@
 EXPORT_USERIP="0"
 EXPORT_SESSIONID="0"
 NODE_AUTOSTART=""
-ENABLE_ROOTLESS_MODE="0"
-ENABLE_1_5_0_BACKEND="1"
+ENABLE_ROOTLESS_MODE="1"
 ENABLE_USESSION="0"
 COMMAND_SESSREG="sessreg"
 AGENT_EXTRA_OPTIONS_RFB=""
@@ -490,19 +489,10 @@
 
 	[ -z $(echo "$ENABLE_ROOTLESS_MODE" | egrep "^[0|1]$") ] && \
 		ERROR="yes" && echo "Error: Invalid value \"ENABLE_ROOTLESS_MODE=$ENABLE_ROOTLESS_MODE\""
-		
-	[ -z $(echo "$ENABLE_1_5_0_BACKEND" | egrep "^[0|1]$") ] && \
-		ERROR="yes" && echo "Error: Invalid value \"ENABLE_1_5_0_BACKEND=$ENABLE_1_5_0_BACKEND\""
-		
-	[ "$ENABLE_ROOTLESS_MODE" = "1" -a "$ENABLE_1_5_0_BACKEND" = "0" ] && \
-		ERROR="yes" && echo "Error: Rootless mode can just be used with 1.5.0 backend."
 
-	[ "$ENABLE_1_5_0_BACKEND" = "1" -a -z "$(strings $PATH_BIN/nxagent | grep 'NXAGENT - Version 1.5.0')" ] && \
-		ERROR="yes" && echo "Error: Could not find 1.5.0 version string in nxagent. NX 1.5.0 backend option must be used with 1.5.0 OSS components."
-
-	[ "$ENABLE_1_5_0_BACKEND" = "0" -a -n "$(strings $PATH_BIN/nxagent | grep 'NXAGENT - Version 1.5.0')" ] && \
-		WARNING="yes" && echo "Warning: 1.5.0 OSS components found, but ENABLE_1_5_0 backend option is not set."
-
+	[ -z "$(strings $PATH_BIN/nxagent | grep 'NXAGENT - Version 1.5.0')"] && \
+		ERROR="yes" && echo "Error: Could not find 1.5.0 version string in nxagent. NX 1.5.0 backend is needed for this version of FreeNX."
+		
 	[ -z $(echo "$ENABLE_USESSION" | egrep "^[0|1]$") ] && \
 		ERROR="yes" && echo "Error: Invalid value \"ENABLE_USESSION=$ENABLE_USESSION\""
 	[ "$ENABLE_USESSION" = "1" ] && ! which "$COMMAND_SESSREG" >/dev/null 2>&1 && \

Modified: freenx-server/trunk/nxnode
===================================================================
--- freenx-server/trunk/nxnode	2005-08-29 11:44:51 UTC (rev 138)
+++ freenx-server/trunk/nxnode	2005-08-29 11:44:59 UTC (rev 139)
@@ -236,7 +236,7 @@
 	[ "$virtualdesktop" = "0" ] && R="-R"
 	vncfullscreen=""
 	[ "$geometry" = "fullscreen" -a "$type" = "vnc" ] && vncfullscreen="-fullscreen" && G=""
-	[ "$geometry" = "fullscreen" -a "$type" = "windows" -a "$ENABLE_1_5_0_BACKEND" = "1" ] && G="-geometry `echo $screeninfo | cut -d"x" -f1,2`"
+	[ "$geometry" = "fullscreen" -a "$type" = "windows" ] && G="-geometry `echo $screeninfo | cut -d"x" -f1,2`"
 
 	if [ "$type" = "windows" ]
 	then
@@ -499,8 +499,7 @@
 		if stringinstring "Info: End of session requested by " "$line" && [ "$RECONNECT" = "0" ] && ! stringinstring "'SIGHUP'" "$line"
 		then
 			echo "NX> 1009 Session status: terminating"
-			[ "$ENABLE_1_5_0_BACKEND" = "1" ] || kill $PROXY_PID 2>/dev/null
-			[ "$ENABLE_1_5_0_BACKEND" = "1" ] && kill -HUP $PROXY_PID 2>/dev/null
+			kill -HUP $PROXY_PID 2>/dev/null
 		fi
 		
 		TERM=""
@@ -636,18 +635,13 @@
 	agent_domain=$(getparam agent_domain)
 	screeninfo=$(getparam screeninfo)
 
-	if [ "$ENABLE_1_5_0_BACKEND" = "1" ]
-	then
-		rdpcolors=$(getparam rdpcolors)
-		rdpcache=$(getparam rdpcache)
-	else
-		unset rdpcolors rdpcache
-	fi
+	rdpcolors=$(getparam rdpcolors)
+	rdpcache=$(getparam rdpcache)
 	
 	clientproto=$(getparam clientproto)
 
 	fullscreen=""
-	[ "$geometry" = "fullscreen" -a "$ENABLE_1_5_0_BACKEND" = "1" ] && fullscreen="1"
+	[ "$geometry" = "fullscreen" ] && fullscreen="1"
 
 	[ "$EXPORT_USERIP" = "1" ] && export NXUSERIP="$userip"
 
@@ -679,7 +673,7 @@
 	
 	proxy_cookie=$(echo $[$RANDOM*$RANDOM] | $COMMAND_MD5SUM | cut -d" " -f1)
 
-	if [ "$ENABLE_1_5_0_BACKEND" = "1" -a "$clientproto" = "1.5.0" ]
+	if [ "$clientproto" = "1.5.0" ]
 	then
 		# enable fake cookie authentication
 		cookie=$proxy_cookie



From fabianx at berlios.de  Mon Aug 29 18:11:54 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Mon, 29 Aug 2005 18:11:54 +0200
Subject: [Freenx-cvs] r140 - / nx-utils/nxfish
Message-ID: <200508291611.j7TGBs8b002710@sheep.berlios.de>

Author: fabianx
Date: 2005-08-29 18:11:53 +0200 (Mon, 29 Aug 2005)
New Revision: 140

Modified:
   /
   nx-utils/nxfish/fish.cpp
   nx-utils/nxfish/nxfish.protocol
Log:
Changed NXFish according to Waldo Bastians instructions for inclusion into KDE.



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:150
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:153

Modified: nx-utils/nxfish/fish.cpp
===================================================================
--- nx-utils/nxfish/fish.cpp	2005-08-29 11:44:59 UTC (rev 139)
+++ nx-utils/nxfish/fish.cpp	2005-08-29 16:11:53 UTC (rev 140)
@@ -148,10 +148,9 @@
     ;
     sigaction(SIGCHLD,&act,NULL);
 
-    if (QString(argv[1])==QString("nxfish")) {
+    if (qstrcmp(argv[1],"nxfish")==0) {
         // Set NXFish - Mode
         isNXFish=1;
-        sshPath = strdup(QFile::encodeName(KStandardDirs::findExe("nxfish")));
     }
 
     fishProtocol slave(argv[2], argv[3]);
@@ -252,7 +251,10 @@
     if (sshPath == NULL) {
         // disabled: currently not needed. Didn't work reliably.
         // isOpenSSH = !system("ssh -V 2>&1 | grep OpenSSH > /dev/null");
-        sshPath = strdup(QFile::encodeName(KStandardDirs::findExe("ssh")));
+	if (isNXFish)
+            sshPath = strdup(QFile::encodeName(KStandardDirs::findExe("nxfish")));
+	else
+            sshPath = strdup(QFile::encodeName(KStandardDirs::findExe("ssh")));
     }
     if (suPath == NULL) {
         suPath = strdup(QFile::encodeName(KStandardDirs::findExe("su")));

Modified: nx-utils/nxfish/nxfish.protocol
===================================================================
--- nx-utils/nxfish/nxfish.protocol	2005-08-29 11:44:59 UTC (rev 139)
+++ nx-utils/nxfish/nxfish.protocol	2005-08-29 16:11:53 UTC (rev 140)
@@ -12,43 +12,4 @@
 moving=true
 Icon=remote
 Description=A kioslave for the NXFISH protocol
-Description[bn]=??? (FISH) ????????-?? ???? ???? kioslave
-Description[bs]=kioslave za FISH protokol
-Description[ca]=Un kioslave pel protocol FISH
-Description[cs]=Pomocn? protokol FISH
-Description[da]=En kioslave for FISH-protokollen
-Description[de]=Ein-/Ausgabemodul f?r das FISH-Protokoll
-Description[el]=???? kioslave ??? ?? ?????????? FISH
-Description[es]=Un kioslave para el protocolo FISH
-Description[et]=Protokolli FISH IO-moodul
-Description[eu]=FISH protokolorako kioslavea
-Description[fi]=Liit?nt? FISH-yhteysk?yt?nt?
-Description[fr]=Un kioslave pour le protocole FISH
-Description[fy]=In kioslave foar it FISH protokol
-Description[hi]=??? ????????? ???? ??-??-?-?????
-Description[hu]=KDE-protokoll a FISH protokollhoz
-Description[is]=kioslave fyrir FISH samskiptaregluna
-Description[it]=Un kioslave per il protocollo FISH
-Description[ja]=FISH ????????? kioslave
-Description[lt]=Kiovergas FISH protokolui
-Description[nb]=En IU-slave for FISH-protokollen
-Description[nds]=En In-/Utgaavdeenst f?r dat FISH-Protokull
-Description[nl]=Een kioslave voor het protocol FISH
-Description[nn]=Ein IU-slave for FISH-protokollen
-Description[pa]=FISH ????????? ?? kioslave
-Description[pl]=Wtyczka protoko?u FISH
-Description[pt]=Um 'kioslave' para protocolo FISH
-Description[pt_BR]=Uma implementa??o para o protocolo FISH
-Description[ro]=Un dispozitiv de I/E pentru protocolul FISH
-Description[ru]=?????? ???????? ??????? ??? ????????? FISH
-Description[se]=SO-?l?va FISH-protokolla v?r?s
-Description[sk]=IO klient pre protokol FISH
-Description[sl]=kioslave za protokol FISH
-Description[sr]=Kioslave ?? ???????? FISH
-Description[sr at Latn]=Kioslave za protokol FISH
-Description[sv]=En I/O-slav f?r protokollet FISH
-Description[ta]=FISH ????????????? ??? ??????????
-Description[tg]=?????? ?????? ??????? ????? ????????? FISH
-Description[tr]=FISH protokol? i?in kioslave
-Description[uk]=????????? B/? ??? ????????? FISH
 DocPath=kioslave/fish.html



From fabianx at berlios.de  Tue Aug 30 12:08:40 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Tue, 30 Aug 2005 12:08:40 +0200
Subject: [Freenx-cvs] r141 - / freenx-website freenx-website/intern freenx-website/intern/press
Message-ID: <200508301008.j7UA8env010521@sheep.berlios.de>

Author: fabianx
Date: 2005-08-30 12:08:39 +0200 (Tue, 30 Aug 2005)
New Revision: 141

Added:
   freenx-website/intern/
   freenx-website/intern/press/
   freenx-website/intern/press/0.5.0-development-plan.txt
   freenx-website/intern/press/akademy-release.txt
   freenx-website/intern/press/announce-devel-lists.txt
Modified:
   /
Log:
 r155 at Bluemoon:  ffranz | 2005-08-30 12:08:19 +0200
 Made up a place for drafts for press releases going over FreeNX mailing lists.



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:153
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:155

Added: freenx-website/intern/press/0.5.0-development-plan.txt
===================================================================

Added: freenx-website/intern/press/akademy-release.txt
===================================================================

Added: freenx-website/intern/press/announce-devel-lists.txt
===================================================================
--- freenx-website/intern/press/announce-devel-lists.txt	2005-08-29 16:11:53 UTC (rev 140)
+++ freenx-website/intern/press/announce-devel-lists.txt	2005-08-30 10:08:39 UTC (rev 141)
@@ -0,0 +1,15 @@
+Malaga, 30th August, aKademy conference,
+
+The FreeNX team is proud to announce the availability of a new development mailing list, so that interested developers can focus and exchange on development of FreeNX and associated programs.
+
+Interested developers can join freenx-devel at lists.berlios.de through the BerliOS project page:
+
+http://developer.berlios.de/projects/freenx/ [FIXME]
+
+FreeNX-knx at kde.org will remain as a mailing lists for user questions and general exchange on the FreeNX movement.
+
+Fabian, project leader of FreeNX says: "I hope that this step will speedup the FreeNX development and encourage more people to participate actively in the FreeNX development."
+
+For the FreeNX team,
+
+Fabian



From fabianx at berlios.de  Tue Aug 30 22:12:28 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Tue, 30 Aug 2005 22:12:28 +0200
Subject: [Freenx-cvs] r142 - / freenx-server/branches/FreeNX-0.4
Message-ID: <200508302012.j7UKCSL1024538@sheep.berlios.de>

Author: fabianx
Date: 2005-08-30 22:12:25 +0200 (Tue, 30 Aug 2005)
New Revision: 142

Modified:
   /
   freenx-server/branches/FreeNX-0.4/INSTALL
Log:
 r157 at Bluemoon:  ffranz | 2005-08-30 22:11:54 +0200
 Added nxclient / nxprint and 1.5.0 backend to installation instructions.



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:155
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:157

Modified: freenx-server/branches/FreeNX-0.4/INSTALL
===================================================================
--- freenx-server/branches/FreeNX-0.4/INSTALL	2005-08-30 10:08:39 UTC (rev 141)
+++ freenx-server/branches/FreeNX-0.4/INSTALL	2005-08-30 20:12:25 UTC (rev 142)
@@ -56,6 +56,8 @@
 cp -a freenx*/nxkeygen ${NXPREFIX}/bin
 cp -a freenx*/nxnode-login ${NXPREFIX}/bin
 cp -a freenx*/nxloadconfig ${NXPREFIX}/bin
+cp -a freenx*/nxprint ${NXPREFIX}/bin
+cp -a freenx*/nxclient ${NXPREFIX}/bin
 
 # config file
 cp -a freenx*/node.conf.sample ${NXPREFIX}/etc/
@@ -63,3 +65,5 @@
 You should also install the nxclient from NoMachine or also copy the nxclient program from freenx. 
 
 Then you need to run 'nxsetup --install' and follow the instructions given.
+
+If you use 1.5.0 as backend be sure to set ENABLE_1_5_0_BACKEND to 1 in node.conf or nxloadconfig.



From fabianx at berlios.de  Tue Aug 30 22:12:34 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Tue, 30 Aug 2005 22:12:34 +0200
Subject: [Freenx-cvs] r143 - / freenx-website/intern/press
Message-ID: <200508302012.j7UKCYcb024591@sheep.berlios.de>

Author: fabianx
Date: 2005-08-30 22:12:32 +0200 (Tue, 30 Aug 2005)
New Revision: 143

Modified:
   /
   freenx-website/intern/press/0.5.0-development-plan.txt
   freenx-website/intern/press/akademy-release.txt
Log:
 r158 at Bluemoon:  ffranz | 2005-08-30 22:12:20 +0200
 Update to the press drafts.



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:157
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:158

Modified: freenx-website/intern/press/0.5.0-development-plan.txt
===================================================================
--- freenx-website/intern/press/0.5.0-development-plan.txt	2005-08-30 20:12:25 UTC (rev 142)
+++ freenx-website/intern/press/0.5.0-development-plan.txt	2005-08-30 20:12:32 UTC (rev 143)
@@ -0,0 +1,26 @@
+30th August 2005, Malaga, aKademy Conference.
+
+The FreeNX team is proud to present the development plan for the 0.5.0 release of FreeNX.
+
+First of all:
+
+Its ready when its ready.
+
+Second:
+
+It won't be released until:
+	- The documentation is finished
+	- The website is in good state, which can be marketed.
+	- Its ready ;-)
+
+There will however be several development snapshots to keep up the "release often and early" cycle.
+
+Plans for 0.5.0 include the rewrite of the Suspend / Resume / Session keep up management with the first priority on _stability_.
+
+0.5.0 also will only support the 1.5.0 backend and get lots of cleanup.
+
+Also planned is the integration of several features, like nxfish, and a fully featured OSS client.
+
+cu
+
+Fabian

Modified: freenx-website/intern/press/akademy-release.txt
===================================================================
--- freenx-website/intern/press/akademy-release.txt	2005-08-30 20:12:25 UTC (rev 142)
+++ freenx-website/intern/press/akademy-release.txt	2005-08-30 20:12:32 UTC (rev 143)
@@ -0,0 +1,5 @@
+Malaga, 30th August, aKademy conference,
+
+The FreeNX team is proud to present the 5th release of the 0.4 tree.
+
+This release removes common pitfalls



From fabianx at berlios.de  Tue Aug 30 22:15:25 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Tue, 30 Aug 2005 22:15:25 +0200
Subject: [Freenx-cvs] r144 - / freenx-server/trunk
Message-ID: <200508302015.j7UKFP0i024940@sheep.berlios.de>

Author: fabianx
Date: 2005-08-30 22:15:23 +0200 (Tue, 30 Aug 2005)
New Revision: 144

Modified:
   /
   freenx-server/trunk/
   freenx-server/trunk/INSTALL
Log:
 r161 at Bluemoon:  ffranz | 2005-08-30 22:15:10 +0200
  r157 at Bluemoon:  ffranz | 2005-08-30 22:11:54 +0200
  Added nxclient / nxprint and 1.5.0 backend to installation instructions.
 



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:158
   + 0e379f48-0dfb-0310-837f-faf58c73f1fd:/freenx/local/freenx:1286
dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx:161


Property changes on: freenx-server/trunk
___________________________________________________________________
Name: svk:merge
   - dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx/freenx-server/branches/FreeNX-0.4:140
   + dfed1786-65ff-0310-a727-a632acf074e8:/local/freenx/freenx-server/branches/FreeNX-0.4:157

Modified: freenx-server/trunk/INSTALL
===================================================================
--- freenx-server/trunk/INSTALL	2005-08-30 20:12:32 UTC (rev 143)
+++ freenx-server/trunk/INSTALL	2005-08-30 20:15:23 UTC (rev 144)
@@ -56,6 +56,8 @@
 cp -a freenx*/nxkeygen ${NXPREFIX}/bin
 cp -a freenx*/nxnode-login ${NXPREFIX}/bin
 cp -a freenx*/nxloadconfig ${NXPREFIX}/bin
+cp -a freenx*/nxprint ${NXPREFIX}/bin
+cp -a freenx*/nxclient ${NXPREFIX}/bin
 
 # config file
 cp -a freenx*/node.conf.sample ${NXPREFIX}/etc/
@@ -63,3 +65,5 @@
 You should also install the nxclient from NoMachine or also copy the nxclient program from freenx. 
 
 Then you need to run 'nxsetup --install' and follow the instructions given.
+
+If you use 1.5.0 as backend be sure to set ENABLE_1_5_0_BACKEND to 1 in node.conf or nxloadconfig.



From fabianx at berlios.de  Wed Aug 31 21:00:36 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Wed, 31 Aug 2005 21:00:36 +0200
Subject: [Freenx-cvs] r145 - freenx-website/intern/press
Message-ID: <200508311900.j7VJ0a1p029054@sheep.berlios.de>

Author: fabianx
Date: 2005-08-31 21:00:34 +0200 (Wed, 31 Aug 2005)
New Revision: 145

Modified:
   freenx-website/intern/press/akademy-release.txt
Log:
First draft.


Modified: freenx-website/intern/press/akademy-release.txt
===================================================================
--- freenx-website/intern/press/akademy-release.txt	2005-08-30 20:15:23 UTC (rev 144)
+++ freenx-website/intern/press/akademy-release.txt	2005-08-31 19:00:34 UTC (rev 145)
@@ -1,5 +1,22 @@
+This annoucement tries to follow the "Marketing for Geeks" guide, which was recently showcasted by Aaron and Waldo on akademy 2005 KDE conference. 
+
 Malaga, 30th August, aKademy conference,
 
-The FreeNX team is proud to present the 5th release of the 0.4 tree.
+The FreeNX team is proud to release a new version of the remote desktop access server software FreeNX.
 
-This release removes common pitfalls
+This release features for you:
+
+* Easiest installation ever
+
+* Work better, faster, and more colorful (NX 1.5.0)
+	* Resizable Desktop.
+	* Fast single application mode.
+	* Truecolor Windows Sessions.
+
+* Use it in restricted environments
+
+* Easily get help for your problems
+
+* First official FreeNX background picture
+
+* 



From fabianx at berlios.de  Wed Aug 31 21:31:51 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Wed, 31 Aug 2005 21:31:51 +0200
Subject: [Freenx-cvs] r146 - freenx-server/branches/FreeNX-0.4
Message-ID: <200508311931.j7VJVp6c031360@sheep.berlios.de>

Author: fabianx
Date: 2005-08-31 21:31:50 +0200 (Wed, 31 Aug 2005)
New Revision: 146

Modified:
   freenx-server/branches/FreeNX-0.4/nxsetup
Log:
Fixed --ignore-errors.


Modified: freenx-server/branches/FreeNX-0.4/nxsetup
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-31 19:00:34 UTC (rev 145)
+++ freenx-server/branches/FreeNX-0.4/nxsetup	2005-08-31 19:31:50 UTC (rev 146)
@@ -325,7 +325,7 @@
 {
 	echo ""
 	echo "----> Testing your nxserver configuration ..."
-	[ "$IGNORE_ERRORS" = "yes" ] && $NO_ERRORS="--ignore-errors"
+	[ "$IGNORE_ERRORS" = "yes" ] && NO_ERRORS="--ignore-errors"
 	. $(PATH=$(cd $(dirname $0) && pwd):$PATH which nxloadconfig) --check $NO_ERRORS
 	echo "<---- done"
 	echo ""



From fabianx at berlios.de  Wed Aug 31 22:06:01 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Wed, 31 Aug 2005 22:06:01 +0200
Subject: [Freenx-cvs] r148 - freenx-website/intern/press
Message-ID: <200508312006.j7VK61lG000769@sheep.berlios.de>

Author: fabianx
Date: 2005-08-31 22:06:00 +0200 (Wed, 31 Aug 2005)
New Revision: 148

Modified:
   freenx-website/intern/press/akademy-release.txt
Log:
Backup of 2nd draft.


Modified: freenx-website/intern/press/akademy-release.txt
===================================================================
--- freenx-website/intern/press/akademy-release.txt	2005-08-31 19:35:11 UTC (rev 147)
+++ freenx-website/intern/press/akademy-release.txt	2005-08-31 20:06:00 UTC (rev 148)
@@ -17,6 +17,93 @@
 
 * Easily get help for your problems
 
+* Better support for big corporate environments
+
+* Lots of bugfixes, more stability and improved security
+
+And last but not least:
+
+THE
+
 * First official FreeNX background picture
 
-* 
+What customers say about FreeNX at aKademy:
+
+""
+
+""
+
+Now let us give you some details about the new release:
+
+Easiest installation ever
+-------------------------
+
+The setup program of FreeNX 0.4.5 is now interactive, checks for a correct configuration, automatic self-tests and a help system were added.
+
+Important changes:
+
+* nxsetup is now interactive. Use --auto to disable this.
+* NoMachine key is now the default, but the user still has to confirm it.
+  [FIXME]
+* nxsetup checks for a correct configuration file. Use --ignore-errors to continue nxsetup even when the check fails.
+* If the automatic self-test fails nxsetup reminds the user of some common pitfalls.
+
+Work better, faster, and more colorful (NX 1.5.0)
+-------------------------------------------------
+
+FreeNX 0.4.5 has full support for the most important 1.5.0 features.
+
+Your virtual Desktop is now resizable. Just drag the borders and if you want to switch to/from fullscreen mode just press Ctrl+Alt+F.
+
+FreeNX 0.4.5 supports the fast single application mode. To enable this feature, set ENABLE_ROOTLESS_MODE="1" in node.conf. From your client select a Unix-Custom "Floating windows" session and booh: You are up and running remote applications blazingly fast. 
+
+Truecolor Windows Sessions are now supported by FreeNX. Just use the 1.5.0 client and select from the Display-box "Use custom settings, Modify, Allowed Colors '16M'".
+
+Use FreeNX in restricted environments
+---------------------------------
+
+Imagine the following scenario:
+
+You have a really nice remote access to a machine in your company and you would love to use FreeNX to do your everyday work. But the problem is: You do not have root access and so you can't use it. FreeNX 0.4.5 enables you do to it nevertheless.
+
+You can install FreeNX 0.4.5 in a special mode to access it directly via your user account. The only problem remaining is patching the client and setting it all up.
+
+Fux has explained this in detail in a howto available from:
+
+http://openfacts.berlios.de/index-en.phtml?title=FreeNX_Howto
+
+FreeNX plans to ship ready-made plug-and-play binary distributions of NX4MyHome as soon as all tests are finished.
+
+Easily get help for your problems
+---------------------------------
+
+We have several scenarios that come up over and over again. There are many different distributions all doing things a bit different. But you can't give "test this" and "test that" instructions without knowing a lot about the environment of the user.
+
+For example starting up nxagent over a ssh -X connection to test if the basic functionality works can now be done via:
+
+nxserver --agent :1000
+
+instead of:
+
+LD_LIBRARY_PATH=/where/nx/libs/live /where/nxagent/is :1000
+
+Better support for big corporate environments
+---------------------------------------------
+
+Thanks to the help of Google and Cisco employees FreeNX does now work also in environments where you have 1000ths of users.
+
+Technically speaking: getent does no longer retrieve the whole database and grep through it, but directly query for the information needed.
+
+Lots of bugfixes, more stability and improved security
+------------------------------------------------------
+
+
+
+And last but not least:
+
+THE
+
+First official FreeNX background picture
+----------------------------------------
+
+This release



From fabianx at berlios.de  Wed Aug 31 22:38:05 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Wed, 31 Aug 2005 22:38:05 +0200
Subject: [Freenx-cvs] r149 - freenx-website/intern/press
Message-ID: <200508312038.j7VKc5AE002630@sheep.berlios.de>

Author: fabianx
Date: 2005-08-31 22:38:04 +0200 (Wed, 31 Aug 2005)
New Revision: 149

Modified:
   freenx-website/intern/press/akademy-release.txt
Log:
First draft ready, some statements still need to be approved.


Modified: freenx-website/intern/press/akademy-release.txt
===================================================================
--- freenx-website/intern/press/akademy-release.txt	2005-08-31 20:06:00 UTC (rev 148)
+++ freenx-website/intern/press/akademy-release.txt	2005-08-31 20:38:04 UTC (rev 149)
@@ -27,18 +27,22 @@
 
 * First official FreeNX background picture
 
-What customers say about FreeNX at aKademy:
+What customers say about FreeNX at aKademy in Malaga, Spain:
 
-""
+[FIXME: Approve those two statements]
 
-""
+KDE/Konqueror developer Daniel Teske says: "It was easy to install, easy to use and it is blazingly fast. I was working here from Spain on my home machine in Germany without any problems."
 
+Stephan Kulow was using it since day 2 of aKademy: "I was working in my company all day long once I had it installed".
+
+[FIXME: More statements?]
+
 Now let us give you some details about the new release:
 
 Easiest installation ever
 -------------------------
 
-The setup program of FreeNX 0.4.5 is now interactive, checks for a correct configuration, automatic self-tests and a help system were added.
+The setup program of FreeNX 0.4.5 is now interactive, checks for a correct configuration and has automatic self-tests and a help system.
 
 Important changes:
 
@@ -60,7 +64,7 @@
 Truecolor Windows Sessions are now supported by FreeNX. Just use the 1.5.0 client and select from the Display-box "Use custom settings, Modify, Allowed Colors '16M'".
 
 Use FreeNX in restricted environments
----------------------------------
+-------------------------------------
 
 Imagine the following scenario:
 
@@ -87,18 +91,34 @@
 
 LD_LIBRARY_PATH=/where/nx/libs/live /where/nxagent/is :1000
 
+It should now be a lot easier to give advise.
+
 Better support for big corporate environments
 ---------------------------------------------
 
-Thanks to the help of Google and Cisco employees FreeNX does now work also in environments where you have 1000ths of users.
+Thanks to the help of Google and Cisco employees FreeNX does now work also in environments where you have 1000 users or more.
 
 Technically speaking: getent does no longer retrieve the whole database and grep through it, but directly query for the information needed.
 
 Lots of bugfixes, more stability and improved security
 ------------------------------------------------------
 
+We also again had several bugfixes:
 
+	* Fixed support for CUPS forwarding.
+	* Fixed resume with 1.5.0 client.
 
+Stability has been increased in the following fields:
+
+	* Reconnection support. (Yes, again)
+
+Security issues / concerns have been fixed regarding the following topics:
+
+        * Certain passwords for VNC/RDP could have been visible via `ps aux`.
+	* Privacy of passwords is assured. They are no longer shown in log files or re-transmitted to the client.
+	* $USER_FAKE_HOME/.nx is now protected.
+	* The client is no longer able to overwrite parameters set by the server.
+ 
 And last but not least:
 
 THE
@@ -106,4 +126,10 @@
 First official FreeNX background picture
 ----------------------------------------
 
-This release
+This release for the first time features a really nice background picture. Show your appreciation of FreeNX and use it on one of your desktops as a background. 
+
+Whenever you show off FreeNX, be sure to use it and spread the word!
+
+For the FreeNX team,
+
+Fabian



From fabianx at berlios.de  Wed Aug 31 22:42:32 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Wed, 31 Aug 2005 22:42:32 +0200
Subject: [Freenx-cvs] r150 - freenx-website/intern/press
Message-ID: <200508312042.j7VKgWXd002926@sheep.berlios.de>

Author: fabianx
Date: 2005-08-31 22:42:30 +0200 (Wed, 31 Aug 2005)
New Revision: 150

Modified:
   freenx-website/intern/press/akademy-release.txt
Log:
Added Martin Konold proposal quote.


Modified: freenx-website/intern/press/akademy-release.txt
===================================================================
--- freenx-website/intern/press/akademy-release.txt	2005-08-31 20:38:04 UTC (rev 149)
+++ freenx-website/intern/press/akademy-release.txt	2005-08-31 20:42:30 UTC (rev 150)
@@ -35,6 +35,8 @@
 
 Stephan Kulow was using it since day 2 of aKademy: "I was working in my company all day long once I had it installed".
 
+Martin Konold says: "The NX4Myhome will help FreeNX to conquer the market of ssh-X. FreeNX is just so much faster. I compared the output of a big textfile via cat, NX was 3 times as fast as a normal ssh connection."
+
 [FIXME: More statements?]
 
 Now let us give you some details about the new release:



From fabianx at berlios.de  Wed Aug 31 21:35:14 2005
From: fabianx at berlios.de (Fabian Franz at BerliOS)
Date: Wed, 31 Aug 2005 21:35:14 +0200
Subject: [Freenx-cvs] r147 - freenx-server/branches/FreeNX-0.4
Message-ID: <200508311935.j7VJZEgM031621@sheep.berlios.de>

Author: fabianx
Date: 2005-08-31 21:35:11 +0200 (Wed, 31 Aug 2005)
New Revision: 147

Modified:
   freenx-server/branches/FreeNX-0.4/nxloadconfig
Log:
Made smbmount / smbumount checks optional.



Modified: freenx-server/branches/FreeNX-0.4/nxloadconfig
===================================================================
--- freenx-server/branches/FreeNX-0.4/nxloadconfig	2005-08-31 19:31:50 UTC (rev 146)
+++ freenx-server/branches/FreeNX-0.4/nxloadconfig	2005-08-31 19:35:11 UTC (rev 147)
@@ -451,9 +451,9 @@
 	! which "$COMMAND_XAUTH" >/dev/null 2>&1 && \
 		ERROR="yes" && echo "Error: Invalid value \"COMMAND_XAUTH=$COMMAND_XAUTH\""
 	! which "$COMMAND_SMBMOUNT" >/dev/null 2>&1 && \
-		ERROR="yes" && echo "Error: Invalid value \"COMMAND_SMBMOUNT=$COMMAND_SMBMOUNT\""
+		WARNING="yes" && echo "Warning: Invalid value \"COMMAND_SMBMOUNT=$COMMAND_SMBMOUNT\". You'll not be able to use SAMBA. "
 	! which "$COMMAND_SMBUMOUNT" >/dev/null 2>&1 && \
-		ERROR="yes" && echo "Error: Invalid value \"COMMAND_SMBUMOUNT=$COMMAND_SMBUMOUNT\""
+		WARNING="yes" && echo "Warning: Invalid value \"COMMAND_SMBUMOUNT=$COMMAND_SMBUMOUNT\". You'll not be able to use SAMBA."
 	! which "$COMMAND_NETCAT" >/dev/null 2>&1 && \
 		ERROR="yes" && echo "Error: Invalid value \"COMMAND_NETCAT=$COMMAND_NETCAT\""
 	! which "$COMMAND_SSH" >/dev/null 2>&1 && \



